--------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:/Users/dyevre/Documents/mres_paper/log/003_buildYearlyNetworks.log
  log type:  text
 opened on:  29 Feb 2020, 17:35:19

. 
end of do-file

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. import delimited "$orig/compustat_quarterly_61_19.csv", clear
file C:/Users/dyevre/Documents/mres_paper/orig/compustat_quarterly_61_19.csv not found
r(601);

end of do-file

r(601);

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. import delimited "$orig/compustat_quarterly_61_19.csv", clear
file C:/Users/dyevre/Documents/mres_paper/orig/compustat_quarterly_61_19.csv not found
r(601);

end of do-file

r(601);

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Paths
. global wd "C:/Users/dyevre/Documents/mres_paper"

. global orig "C:/Users/dyevre/Downloads/mres_paper_orig"                                                 // I
> 'm using a different orig folder so as not to commit large datasets to GitHub

. global data "$wd/data/001_network"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. 
. *do-file number, used to save outputs 
. global doNum "003"                                      

. 
. *log
. cap log close
--------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:/Users/dyevre/Documents/mres_paper/log/003_buildYearlyNetworks.log
  log type:  text
 opened on:  29 Feb 2020, 17:40:27

. 
. /*******************************************************************************
>         GETTING THE WHOLE COMPUSTAT COMPANY DATA WITH GVKEYs
> *******************************************************************************/
. 
. import delimited "$orig/compustat_quarterly_61_19.csv", clear
(26 vars, 1,592,184 obs)

. 
end of do-file

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. collapse fqtr, by(gvkey conm) fast

. 
end of do-file

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. drop fqtr

. 
end of do-file

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. duplicates tag gvkey, gen(tag)

Duplicates in terms of gvkey

. 
end of do-file

. tab tag

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     32,956      100.00      100.00
------------+-----------------------------------
      Total |     32,956      100.00

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. drop tag

. 
end of do-file

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. gen comp = conm

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(7,167 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(46 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(11 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(57 real changes made)

. replace comp=subinword(comp,"CO","",.)
(1,595 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(15,107 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(63 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(601 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(3,496 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(528 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(1,145 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(94 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(26 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(139 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(140 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(4 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(30 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(167 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(557 real changes made)

. replace comp=trim(comp)
(21,729 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(1,220 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(139 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(1 real change made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(1 real change made)

. replace comp=subinstr(comp,"PLC","",.)
(285 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(871 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(293 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(679 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(4 real changes made)

. replace comp=trim(comp)
(2,153 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(18 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(530 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(313 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(446 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(1 real change made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(0 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(528 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(242 real changes made)

. replace comp=subinstr(comp,"'","",.)
(152 real changes made)

. replace comp=subinstr(comp," & ","",.)
(866 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(185 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(175 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(89 real changes made)

. replace comp=trim(comp)
(924 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(707 real changes made)

. replace comp=subinstr(comp,".","",.)
(363 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(1 real change made)

. replace comp=subinstr(comp,"OLD","",.)
(1,141 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(356 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(1 real change made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(12 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(369 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(251 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(14 real changes made)

. replace comp=trim(comp)
(717 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(95 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(18 real changes made)

. replace comp=subinstr(comp,"(","",.)
(231 real changes made)

. replace comp=subinstr(comp,")","",.)
(231 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(92 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(4 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(1 real change made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(14 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(1 real change made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(27 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(33 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(77 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(119 real changes made)

. replace comp=trim(comp)
(3 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(1 real change made)

. replace comp=subinstr(comp,"LLC","",.)
(145 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(0 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(52 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(46 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(1 real change made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(0 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(25 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(3 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(6 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(731 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(26 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(15 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(15 real changes made)

. replace comp=trim(comp)
(101 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(1 real change made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(5 real changes made)

. replace comp=trim(comp)
(1 real change made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(647 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. replace comp=subinstr(comp,"EI","",.)
(342 real changes made)

. replace comp=subinstr(comp,"PRO FORMA","",.)
(6 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(72 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(68 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(75 real changes made)

. replace comp=subinstr(comp,"&","",.)
(419 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(1 real change made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(71 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(21 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(11 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(347 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(0 real changes made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(2 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(1 real change made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(1 real change made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(1 real change made)

. replace comp=subinstr(comp,"MAN","MN",.)
(431 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(4 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(24 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(1,085 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(31 real changes made)

. replace comp=trim(comp)
(137 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(224 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(42 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(246 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(198 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(9 real changes made)

. replace comp=trim(comp)
(1 real change made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(3 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(11 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(212 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(1,193 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(0 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(98 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(0 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(116 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(4 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(18 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(77 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(429 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(91 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(419 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(14 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(148 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(16 real changes made)

. replace comp=trim(comp)
(973 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(55 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(9 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(33 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(0 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(17 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(8 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(1 real change made)

. replace comp=subinword(comp,"PARTS","PART",.)
(10 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(28 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(0 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(0 real changes made)

. replace comp=subinword(comp,"W","",.)
(17 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(1 real change made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(43 real changes made)

. replace comp=subinword(comp,"SP","",.)
(232 real changes made)

. replace comp=trim(comp)
(21 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(22 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(4 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(2 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(0 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(0 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(2 real changes made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(9 real changes made)

. replace comp=subinword(comp,"CELANESE","",.)
(4 real changes made)

. replace comp=subinword(comp,"CEL","",.)
(3 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(2 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(3 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(8 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(30 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(1 real change made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(157 real changes made)

. replace comp=trim(comp)
(149 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(10 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(0 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(8 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(1 real change made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(65 real changes made)

. replace comp=subinword(comp,"A","",.)
(127 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(66 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(4 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(4 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(1,548 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(81 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(0 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(113 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(4 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(47 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(25 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(2 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(20 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(5 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(2 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(45 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(1 real change made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(1 real change made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(0 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(303 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(7 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(5 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(3 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(5 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(187 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                                                   
>     //BLUNT way of improving match, remove white space
(24,782 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
end of do-file

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. duplicates tag comp, gen(tag)

Duplicates in terms of comp

. 
end of do-file

. tab tag

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     31,486       95.54       95.54
          1 |      1,272        3.86       99.40
          2 |        138        0.42       99.82
          3 |         48        0.15       99.96
          4 |          5        0.02       99.98
          6 |          7        0.02      100.00
------------+-----------------------------------
      Total |     32,956      100.00

. sort tag

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. br if tag!=0

. sort comp tag

. 
end of do-file

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. reshape wide conm gvkey, i(comp) j(tag)
(note: j = 0 1 2 3 4 6)
values of variable tag not unique within comp
    Your data are currently long.  You are performing a reshape wide.  You specified i(comp) and j(tag).
    There are observations within i(comp) with the same value of j(tag).  In the long data, variables i()
    and j() together must uniquely identify the observations.

         long                                wide
        +---------------+                   +------------------+
        | i   j   a   b |                   | i   a1 a2  b1 b2 |
        |---------------| <--- reshape ---> |------------------|
        | 1   1   1   2 |                   | 1   1   3   2  4 |
        | 1   2   3   4 |                   | 2   5   7   6  8 |
        | 2   1   5   6 |                   +------------------+
        | 2   2   7   8 |
        +---------------+
    Type reshape error for a list of the problem variables.
r(9);

end of do-file

r(9);

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. 
. /*******************************************************************************
>         
>         DESCRIPTION: Do file merging the cleaned company names from Compustat and 
>                                 the cleaned company names from Segment customer data
>         
>         INFILES:        - 001_supplierList.dta
>                                 - 001_customerList.dta 
>         
>         OUTFILES:       - merge company name list
>         
>         LOG: Created 28/01/2020
>         
> *******************************************************************************/
. 
. /*******************************************************************************
>         SETUP
> *******************************************************************************/
. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Paths
. global wd "C:/Users/dyevre/Documents/mres_paper"

. global orig "$wd/orig"

. global data "$wd/data/001_network"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. 
. *do-file number, used to save outputs 
. global doNum "002"                                      

. 
. *log
. cap log close
--------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:/Users/dyevre/Documents/mres_paper/log/003_buildYearlyNetworks.log
  log type:  text
 opened on:  29 Feb 2020, 18:12:16

. 
. /*******************************************************************************
>         GETTING THE WHOLE COMPUSTAT COMPANY DATA WITH GVKEYs
> *******************************************************************************/
. 
. import delimited "$orig/compustat_quarterly_61_19.csv", clear
(26 vars, 1,592,184 obs)

. collapse fqtr, by(gvkey conm) fast

. drop fqtr

. duplicates tag gvkey, gen(tag)                                                                              
>                     // No duplicates, good

Duplicates in terms of gvkey

. tab tag, mi

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     32,956      100.00      100.00
------------+-----------------------------------
      Total |     32,956      100.00

. drop tag

. 
. 
. *Applying the cleaning algorithm used in 002
. gen comp = conm

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(7,167 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(46 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(11 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(57 real changes made)

. replace comp=subinword(comp,"CO","",.)
(1,595 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(15,107 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(63 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(601 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(3,496 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(528 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(1,145 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(94 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(26 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(139 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(140 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(4 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(30 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(167 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(557 real changes made)

. replace comp=trim(comp)
(21,729 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(1,220 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(139 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(1 real change made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(1 real change made)

. replace comp=subinstr(comp,"PLC","",.)
(285 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(871 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(293 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(679 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(4 real changes made)

. replace comp=trim(comp)
(2,153 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(18 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(530 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(313 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(446 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(1 real change made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(0 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(528 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(242 real changes made)

. replace comp=subinstr(comp,"'","",.)
(152 real changes made)

. replace comp=subinstr(comp," & ","",.)
(866 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(185 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(175 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(89 real changes made)

. replace comp=trim(comp)
(924 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(707 real changes made)

. replace comp=subinstr(comp,".","",.)
(363 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(1 real change made)

. replace comp=subinstr(comp,"OLD","",.)
(1,141 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(356 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(1 real change made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(12 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(369 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(251 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(14 real changes made)

. replace comp=trim(comp)
(717 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(95 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(18 real changes made)

. replace comp=subinstr(comp,"(","",.)
(231 real changes made)

. replace comp=subinstr(comp,")","",.)
(231 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(92 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(4 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(1 real change made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(14 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(1 real change made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(27 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(33 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(77 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(119 real changes made)

. replace comp=trim(comp)
(3 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(1 real change made)

. replace comp=subinstr(comp,"LLC","",.)
(145 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(0 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(52 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(46 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(1 real change made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(0 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(25 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(3 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(6 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(731 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(26 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(15 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(15 real changes made)

. replace comp=trim(comp)
(101 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(1 real change made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(5 real changes made)

. replace comp=trim(comp)
(1 real change made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(647 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(6 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(72 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(68 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(75 real changes made)

. replace comp=subinstr(comp,"&","",.)
(419 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(1 real change made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(71 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(21 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(11 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(347 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(0 real changes made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(2 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(1 real change made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(1 real change made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(1 real change made)

. replace comp=subinstr(comp,"MAN","MN",.)
(431 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(4 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(24 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(1,085 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(31 real changes made)

. replace comp=trim(comp)
(137 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(224 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(42 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(246 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(198 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(9 real changes made)

. replace comp=trim(comp)
(1 real change made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(3 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(11 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(212 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(1,193 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(0 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(98 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(0 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(116 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(4 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(18 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(77 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(429 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(91 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(419 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(14 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(148 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(15 real changes made)

. replace comp=trim(comp)
(973 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(55 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(9 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(33 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(0 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(17 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(8 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(1 real change made)

. replace comp=subinword(comp,"PARTS","PART",.)
(10 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(28 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(0 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(0 real changes made)

. replace comp=subinword(comp,"W","",.)
(17 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(1 real change made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(43 real changes made)

. replace comp=subinword(comp,"SP","",.)
(232 real changes made)

. replace comp=trim(comp)
(21 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(22 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(4 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(2 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(0 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(0 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(2 real changes made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(9 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(3 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(2 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(3 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(8 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(30 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(1 real change made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(157 real changes made)

. replace comp=trim(comp)
(148 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(10 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(0 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(8 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(1 real change made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(65 real changes made)

. replace comp=subinword(comp,"A","",.)
(126 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(66 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(4 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(4 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(1,548 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(80 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(0 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(113 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(4 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(47 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(25 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(2 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(20 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(5 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(2 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(45 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(1 real change made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(1 real change made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(0 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(303 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(7 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(5 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(3 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(5 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(186 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                                                   
>     //BLUNT way of improving match, remove white space
(24,784 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. duplicates tag comp, gen(tag)

Duplicates in terms of comp

. br if tag!=0

. sort comp tag

. stop
command stop is unrecognized
r(199);

end of do-file

r(199);

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. drop if comp==""
(3 observations deleted)

. 
end of do-file

. tab tag, mi

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     31,501       95.59       95.59
          1 |      1,272        3.86       99.45
          2 |        135        0.41       99.86
          3 |         40        0.12       99.98
          4 |          5        0.02      100.00
------------+-----------------------------------
      Total |     32,953      100.00

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. bys comp: gen _n
_n invalid varname
r(198);

end of do-file

r(198);

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. bys comp: gen n = _n

. 
end of do-file

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. drop tag

. 
end of do-file

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. reshape wide conm gvkey, i(comp) j(n)
(note: j = 1 2 3 4 5)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                    32953   ->   32193
Number of variables                   4   ->      11
j variable (5 values)                 n   ->   (dropped)
xij variables:
                                   conm   ->   conm1 conm2 ... conm5
                                  gvkey   ->   gvkey1 gvkey2 ... gvkey5
-----------------------------------------------------------------------------

. 
end of do-file

. br

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. sort comp

. gen n = _n

. 
end of do-file

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. save "$data/${doNum}_netCompList.dta", replace
(note: file C:/Users/dyevre/Documents/mres_paper/data/001_network/003_netCompList.dta not found)
file C:/Users/dyevre/Documents/mres_paper/data/001_network/003_netCompList.dta saved

. 
end of do-file

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. 
end of do-file

. sort srcdate

. do "C:\Users\dyevre\AppData\Local\Temp\STD09000000.tmp"

. gen year = floor(srcdate/10000)

. 
end of do-file

. exit, clear
-----------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/003_buildYearlyNetworks.log
  log type:  text
 opened on:  21 Mar 2020, 17:35:52

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_quarterly_61_19.csv", clear
(26 vars, 1,592,184 obs)

. collapse fqtr, by(gvkey conm) fast

. drop fqtr

. duplicates tag gvkey, gen(tag)                                                   
>                                                // No duplicates, good

Duplicates in terms of gvkey

. tab tag, mi

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     32,956      100.00      100.00
------------+-----------------------------------
      Total |     32,956      100.00

. drop tag

. 
. 
. *Applying the cleaning algorithm used in 002
. gen comp = conm

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(7,167 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(46 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(11 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(57 real changes made)

. replace comp=subinword(comp,"CO","",.)
(1,595 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(15,107 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(63 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(601 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(3,496 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(528 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(1,145 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(94 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(26 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(139 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(140 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(4 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(30 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(167 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(557 real changes made)

. replace comp=trim(comp)
(21,729 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(1,220 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(139 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(1 real change made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(1 real change made)

. replace comp=subinstr(comp,"PLC","",.)
(285 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(871 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(293 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(679 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(4 real changes made)

. replace comp=trim(comp)
(2,153 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(18 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(530 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(313 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(446 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(1 real change made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(0 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(528 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(242 real changes made)

. replace comp=subinstr(comp,"'","",.)
(152 real changes made)

. replace comp=subinstr(comp," & ","",.)
(866 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(185 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(175 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(89 real changes made)

. replace comp=trim(comp)
(924 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(707 real changes made)

. replace comp=subinstr(comp,".","",.)
(363 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(1 real change made)

. replace comp=subinstr(comp,"OLD","",.)
(1,141 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(356 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(1 real change made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(12 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(369 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(251 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(14 real changes made)

. replace comp=trim(comp)
(717 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(95 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(18 real changes made)

. replace comp=subinstr(comp,"(","",.)
(231 real changes made)

. replace comp=subinstr(comp,")","",.)
(231 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(92 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(4 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(1 real change made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(14 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(1 real change made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(27 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(33 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(77 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(119 real changes made)

. replace comp=trim(comp)
(3 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(1 real change made)

. replace comp=subinstr(comp,"LLC","",.)
(145 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(0 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(52 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(46 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(1 real change made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(0 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(25 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(3 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(6 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(731 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(26 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(15 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(15 real changes made)

. replace comp=trim(comp)
(101 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(1 real change made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(5 real changes made)

. replace comp=trim(comp)
(1 real change made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(647 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(6 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(72 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(68 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(75 real changes made)

. replace comp=subinstr(comp,"&","",.)
(419 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(1 real change made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(71 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(21 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(11 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(347 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(0 real changes made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(2 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(1 real change made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(1 real change made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(1 real change made)

. replace comp=subinstr(comp,"MAN","MN",.)
(431 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(4 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(24 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(1,085 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(31 real changes made)

. replace comp=trim(comp)
(137 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(224 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(42 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(246 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(198 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(9 real changes made)

. replace comp=trim(comp)
(1 real change made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(3 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(11 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(212 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(1,193 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(0 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(98 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(0 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(116 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(4 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(18 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(77 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(429 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(91 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(419 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(14 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(148 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(15 real changes made)

. replace comp=trim(comp)
(973 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(55 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(9 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(33 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(0 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(17 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(8 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(1 real change made)

. replace comp=subinword(comp,"PARTS","PART",.)
(10 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(28 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(0 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(0 real changes made)

. replace comp=subinword(comp,"W","",.)
(17 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(1 real change made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(43 real changes made)

. replace comp=subinword(comp,"SP","",.)
(232 real changes made)

. replace comp=trim(comp)
(21 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(22 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(4 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(2 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(0 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(0 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(2 real changes made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(9 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(3 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(2 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(3 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(8 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(30 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(1 real change made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(157 real changes made)

. replace comp=trim(comp)
(148 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(10 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(0 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(8 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(1 real change made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(65 real changes made)

. replace comp=subinword(comp,"A","",.)
(126 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(66 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(4 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(4 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(1,548 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(80 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(0 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(113 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(4 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(47 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(25 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(2 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(20 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(5 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(2 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(45 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(1 real change made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(1 real change made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(0 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(303 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(7 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(5 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(3 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(5 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(186 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                        
>                                //BLUNT way of improving match, remove white space
(24,784 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. duplicates tag comp, gen(tag)

Duplicates in terms of comp

. br if tag!=0

. sort comp tag

. 
. *Reshaping dataset in wide format, with all gvkeys and alternative names
. drop if comp==""
(3 observations deleted)

. bys comp: gen n = _n

. drop tag

. reshape wide conm gvkey, i(comp) j(n)                                            
>                                        // 32,193 companies
(note: j = 1 2 3 4 5)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                    32953   ->   32193
Number of variables                   4   ->      11
j variable (5 values)                 n   ->   (dropped)
xij variables:
                                   conm   ->   conm1 conm2 ... conm5
                                  gvkey   ->   gvkey1 gvkey2 ... gvkey5
-----------------------------------------------------------------------------

. sort comp

. gen n = _n

. save "$data/${doNum}_netCompList.dta", replace
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_netCompList.dta sa
> ved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. 
end of do-file

. tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       1976 |        230        0.04        0.04
       1977 |      1,070        0.19        0.24
       1978 |      3,040        0.55        0.79
       1979 |      3,488        0.63        1.42
       1980 |      3,633        0.66        2.09
       1981 |      3,822        0.70        2.78
       1982 |      4,586        0.83        3.62
       1983 |      5,417        0.99        4.60
       1984 |      5,844        1.06        5.67
       1985 |      6,295        1.15        6.81
       1986 |      6,908        1.26        8.07
       1987 |      7,236        1.32        9.39
       1988 |      7,214        1.31       10.70
       1989 |      7,084        1.29       11.99
       1990 |      7,350        1.34       13.33
       1991 |      7,859        1.43       14.76
       1992 |      8,558        1.56       16.31
       1993 |      9,135        1.66       17.98
       1994 |      9,429        1.72       19.69
       1995 |     10,386        1.89       21.58
       1996 |     10,562        1.92       23.50
       1997 |     10,043        1.83       25.33
       1998 |     12,212        2.22       27.55
       1999 |     13,137        2.39       29.95
       2000 |     15,682        2.85       32.80
       2001 |     16,104        2.93       35.73
       2002 |     16,842        3.07       38.80
       2003 |     16,237        2.96       41.75
       2004 |     16,270        2.96       44.71
       2005 |     19,141        3.48       48.20
       2006 |     19,907        3.62       51.82
       2007 |     19,984        3.64       55.46
       2008 |     20,443        3.72       59.18
       2009 |     21,714        3.95       63.13
       2010 |     21,894        3.98       67.11
       2011 |     22,288        4.06       71.17
       2012 |     23,038        4.19       75.36
       2013 |     23,611        4.30       79.66
       2014 |     23,954        4.36       84.02
       2015 |     23,189        4.22       88.24
       2016 |     22,612        4.12       92.36
       2017 |     21,717        3.95       96.31
       2018 |     20,007        3.64       99.95
       2019 |        279        0.05      100.00
------------+-----------------------------------
      Total |    549,451      100.00

. hist year
(bin=57, start=1976, width=.75438596)

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-
> scheme-modern/master/")
checking scheme-modern consistency and verifying not already installed...
installing into /Users/ios/Library/Application Support/Stata/ado/plus/...
installation complete.

. set scheme modern, perm 
(set scheme preference recorded)

. 
end of do-file

. count sic if !missing(sic)
varlist not allowed
r(101);

. count sic if missing(sic)
varlist not allowed
r(101);

. count sic if sic!=.
varlist not allowed
r(101);

. count if !missing(sic)
  548,874

. count if !missing(naics)
  544,005

. tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       1976 |        230        0.04        0.04
       1977 |      1,070        0.19        0.24
       1978 |      3,040        0.55        0.79
       1979 |      3,488        0.63        1.42
       1980 |      3,633        0.66        2.09
       1981 |      3,822        0.70        2.78
       1982 |      4,586        0.83        3.62
       1983 |      5,417        0.99        4.60
       1984 |      5,844        1.06        5.67
       1985 |      6,295        1.15        6.81
       1986 |      6,908        1.26        8.07
       1987 |      7,236        1.32        9.39
       1988 |      7,214        1.31       10.70
       1989 |      7,084        1.29       11.99
       1990 |      7,350        1.34       13.33
       1991 |      7,859        1.43       14.76
       1992 |      8,558        1.56       16.31
       1993 |      9,135        1.66       17.98
       1994 |      9,429        1.72       19.69
       1995 |     10,386        1.89       21.58
       1996 |     10,562        1.92       23.50
       1997 |     10,043        1.83       25.33
       1998 |     12,212        2.22       27.55
       1999 |     13,137        2.39       29.95
       2000 |     15,682        2.85       32.80
       2001 |     16,104        2.93       35.73
       2002 |     16,842        3.07       38.80
       2003 |     16,237        2.96       41.75
       2004 |     16,270        2.96       44.71
       2005 |     19,141        3.48       48.20
       2006 |     19,907        3.62       51.82
       2007 |     19,984        3.64       55.46
       2008 |     20,443        3.72       59.18
       2009 |     21,714        3.95       63.13
       2010 |     21,894        3.98       67.11
       2011 |     22,288        4.06       71.17
       2012 |     23,038        4.19       75.36
       2013 |     23,611        4.30       79.66
       2014 |     23,954        4.36       84.02
       2015 |     23,189        4.22       88.24
       2016 |     22,612        4.12       92.36
       2017 |     21,717        3.95       96.31
       2018 |     20,007        3.64       99.95
       2019 |        279        0.05      100.00
------------+-----------------------------------
      Total |    549,451      100.00

. hist year
(bin=57, start=1976, width=.75438596)

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. forval y=1976/2019{
  2.         preserve
  3.         keep if year=`y'
  4.         save "$data/${doNum}_cust`y/.dta"
  5.         restore
  6.         }
=exp not allowed
r(101);

end of do-file

r(101);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. forval y=1976/2019{
  2.         preserve
  3.         keep if year==`y'
  4.         save "$data/${doNum}_cust`y/.dta"
  5.         restore
  6.         }
(549,221 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y/.dta
    could not be opened
r(603);

end of do-file

r(603);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. *saving datasets by year
. forval y=1976/2019{
  2.         preserve
  3.         keep if year==`y'
  4.         save "$data/${doNum}_cust`y.dta", replace
  5.         restore
  6.         }
(549,221 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta 
> not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(548,381 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(546,411 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(545,963 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(545,818 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(545,629 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(544,865 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(544,034 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(543,607 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(543,156 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(542,543 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(542,215 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(542,237 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(542,367 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(542,101 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(541,592 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(540,893 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(540,316 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(540,022 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(539,065 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(538,889 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(539,408 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(537,239 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(536,314 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(533,769 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(533,347 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(532,609 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(533,214 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(533,181 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(530,310 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(529,544 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(529,467 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(529,008 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(527,737 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(527,557 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(527,163 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(526,413 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(525,840 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(525,497 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(526,262 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(526,839 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(527,734 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(529,444 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved
(549,172 observations deleted)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust`y.dta saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. forval y=1976/2019{
  2.         preserve
  3.         keep if year==`y'
  4.         save "$data/${doNum}_cust`y'.dta", replace
  5.         restore
  6.         }
(549,221 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1976.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1976.dta saved
(548,381 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1977.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1977.dta saved
(546,411 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1978.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1978.dta saved
(545,963 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1979.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1979.dta saved
(545,818 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1980.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1980.dta saved
(545,629 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1981.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1981.dta saved
(544,865 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1982.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1982.dta saved
(544,034 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1983.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1983.dta saved
(543,607 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1984.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1984.dta saved
(543,156 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1985.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1985.dta saved
(542,543 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1986.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1986.dta saved
(542,215 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1987.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1987.dta saved
(542,237 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1988.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1988.dta saved
(542,367 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1989.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1989.dta saved
(542,101 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1990.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1990.dta saved
(541,592 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1991.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1991.dta saved
(540,893 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1992.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1992.dta saved
(540,316 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1993.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1993.dta saved
(540,022 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1994.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1994.dta saved
(539,065 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1995.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1995.dta saved
(538,889 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1996.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1996.dta saved
(539,408 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1997.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1997.dta saved
(537,239 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1998.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1998.dta saved
(536,314 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1999.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust1999.dta saved
(533,769 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2000.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2000.dta saved
(533,347 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2001.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2001.dta saved
(532,609 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2002.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2002.dta saved
(533,214 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2003.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2003.dta saved
(533,181 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2004.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2004.dta saved
(530,310 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2005.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2005.dta saved
(529,544 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2006.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2006.dta saved
(529,467 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2007.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2007.dta saved
(529,008 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2008.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2008.dta saved
(527,737 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2009.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2009.dta saved
(527,557 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2010.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2010.dta saved
(527,163 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2011.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2011.dta saved
(526,413 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2012.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2012.dta saved
(525,840 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2013.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2013.dta saved
(525,497 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2014.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2014.dta saved
(526,262 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2015.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2015.dta saved
(526,839 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2016.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2016.dta saved
(527,734 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2017.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2017.dta saved
(529,444 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2018.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2018.dta saved
(549,172 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2019.dt
> a not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_cust2019.dta saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. *saving datasets by year, after having cleaned company names, and added balance s
> heet data
. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. keep if year==1980
(545,818 observations deleted)

. 
end of do-file

. use "$data/${doNum}_netCompList.dta", clear

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_quarterly_61_19.csv", clear
(26 vars, 1,592,184 obs)

. collapse fqtr, by(gvkey conm) fast

. drop fqtr

. duplicates tag gvkey, gen(tag)                                                   
>                                                // No duplicates, good

Duplicates in terms of gvkey

. tab tag, mi

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     32,956      100.00      100.00
------------+-----------------------------------
      Total |     32,956      100.00

. drop tag

. 
. *Applying the cleaning algorithm used in 002
. do "$code/mres_xxx_cleanCompNames"

. 
. /*******************************************************************************
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat homogeneous nam
> es
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *******************************************************************************/
. 
. gen comp = conm

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(7,167 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(46 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(11 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(57 real changes made)

. replace comp=subinword(comp,"CO","",.)
(1,595 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(15,107 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(63 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(601 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(3,496 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(528 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(1,145 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(94 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(26 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(139 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(140 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(4 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(30 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(167 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(557 real changes made)

. replace comp=trim(comp)
(21,729 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(1,220 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(139 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(1 real change made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(1 real change made)

. replace comp=subinstr(comp,"PLC","",.)
(285 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(871 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(293 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(679 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(4 real changes made)

. replace comp=trim(comp)
(2,153 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(18 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(530 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(313 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(446 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(1 real change made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(0 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(528 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(242 real changes made)

. replace comp=subinstr(comp,"'","",.)
(152 real changes made)

. replace comp=subinstr(comp," & ","",.)
(866 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(185 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(175 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(89 real changes made)

. replace comp=trim(comp)
(924 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(707 real changes made)

. replace comp=subinstr(comp,".","",.)
(363 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(1 real change made)

. replace comp=subinstr(comp,"OLD","",.)
(1,141 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(356 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(1 real change made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(12 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(369 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(251 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(14 real changes made)

. replace comp=trim(comp)
(717 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(95 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(18 real changes made)

. replace comp=subinstr(comp,"(","",.)
(231 real changes made)

. replace comp=subinstr(comp,")","",.)
(231 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(92 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(4 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(1 real change made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(14 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(1 real change made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(27 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(33 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(77 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(119 real changes made)

. replace comp=trim(comp)
(3 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(1 real change made)

. replace comp=subinstr(comp,"LLC","",.)
(145 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(0 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(52 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(46 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(1 real change made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(0 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(25 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(3 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(6 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(731 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(26 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(15 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(15 real changes made)

. replace comp=trim(comp)
(101 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(1 real change made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(5 real changes made)

. replace comp=trim(comp)
(1 real change made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(647 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(6 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(72 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(68 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(75 real changes made)

. replace comp=subinstr(comp,"&","",.)
(419 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(1 real change made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(71 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(21 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(11 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(347 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(0 real changes made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(2 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(1 real change made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(1 real change made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(1 real change made)

. replace comp=subinstr(comp,"MAN","MN",.)
(431 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(4 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(24 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(1,085 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(31 real changes made)

. replace comp=trim(comp)
(137 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(224 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(42 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(246 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(198 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(9 real changes made)

. replace comp=trim(comp)
(1 real change made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(3 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(11 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(212 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(1,193 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(0 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(98 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(0 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(116 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(4 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(18 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(77 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(429 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(91 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(419 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(14 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(148 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(15 real changes made)

. replace comp=trim(comp)
(973 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(55 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(9 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(33 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(0 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(17 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(8 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(1 real change made)

. replace comp=subinword(comp,"PARTS","PART",.)
(10 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(28 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(0 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(0 real changes made)

. replace comp=subinword(comp,"W","",.)
(17 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(1 real change made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(43 real changes made)

. replace comp=subinword(comp,"SP","",.)
(232 real changes made)

. replace comp=trim(comp)
(21 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(22 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(4 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(2 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(0 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(0 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(2 real changes made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(9 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(3 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(2 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(3 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(8 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(30 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(1 real change made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(157 real changes made)

. replace comp=trim(comp)
(148 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(10 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(0 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(8 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(1 real change made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(65 real changes made)

. replace comp=subinword(comp,"A","",.)
(126 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(66 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(4 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(4 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(1,548 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(80 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(0 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(113 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(4 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(47 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(25 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(2 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(20 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(5 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(2 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(45 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(1 real change made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(1 real change made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(0 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(303 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(7 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(5 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(3 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(5 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(186 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                        
>                                //BLUNT way of improving match, remove white space
(24,784 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. 
. duplicates tag comp, gen(tag)

Duplicates in terms of comp

. br if tag!=0

. sort comp tag

. 
. *Reshaping dataset in wide format, with all gvkeys and alternative names
. drop if comp==""
(3 observations deleted)

. bys comp: gen n = _n

. drop tag

. reshape wide conm gvkey, i(comp) j(n)                                            
>                                        // 32,193 companies
(note: j = 1 2 3 4 5)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                    32953   ->   32193
Number of variables                   4   ->      11
j variable (5 values)                 n   ->   (dropped)
xij variables:
                                   conm   ->   conm1 conm2 ... conm5
                                  gvkey   ->   gvkey1 gvkey2 ... gvkey5
-----------------------------------------------------------------------------

. sort comp

. gen n = _n

. save "$data/${doNum}_netCompList.dta", replace
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_netCompList.dta sa
> ved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. 
. /*******************************************************************************
>         
>         DESCRIPTION: Do file building yearly networks of firms, using the cleanin
> g
>                                 procedure of 002
>         
>         INFILES:        - 
>         
>         OUTFILES:       - 
>         
>         LOG: Created 28/02/2020
>         
> *******************************************************************************/
. 
. /*******************************************************************************
>         SETUP
> *******************************************************************************/
. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000*useful packages
varlist not allowed
r(101);

end of do-file

r(101);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000*useful packages
varlist not allowed
r(101);

end of do-file

r(101);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-
> scheme-modern/master/")
checking scheme-modern consistency and verifying not already installed...
all files already exist and are up to date.

. set scheme modern, perm 
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                               
>                        // I'm using a different orig folder so as not to commit l
> arge datasets to GitHub

. global data "$wd/data/001_network"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. 
. *do-file number, used to save outputs 
. global doNum "003"                                      

. 
. *log
. cap log close
-----------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/003_buildYearlyNetworks.log
  log type:  text
 opened on:  21 Mar 2020, 18:06:02

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_quarterly_61_19.csv", clear
(26 vars, 1,592,184 obs)

. 
end of do-file

. tab fic

        fic |      Freq.     Percent        Cum.
------------+-----------------------------------
        ANT |        271        0.02        0.02
        ARG |      1,451        0.09        0.11
        ATG |         92        0.01        0.11
        AUS |      2,863        0.18        0.29
        AUT |         84        0.01        0.30
        BEL |        348        0.02        0.32
        BHS |        524        0.03        0.35
        BLZ |         82        0.01        0.36
        BMU |      8,070        0.51        0.87
        BRA |      2,752        0.17        1.04
        CAN |     28,921        1.82        2.86
        CHE |      2,099        0.13        2.99
        CHL |      1,769        0.11        3.10
        CHN |      1,198        0.08        3.17
        COL |        222        0.01        3.19
        CUW |        458        0.03        3.22
        CYM |     10,755        0.68        3.89
        CYP |         71        0.00        3.90
        DEU |      2,417        0.15        4.05
        DNK |        573        0.04        4.08
        DOM |         39        0.00        4.09
        ESP |      1,004        0.06        4.15
        FIN |        551        0.03        4.18
        FRA |      3,204        0.20        4.39
        GBR |     12,314        0.77        5.16
        GGY |         94        0.01        5.16
        GHA |         36        0.00        5.17
        GRC |        253        0.02        5.18
        HKG |        873        0.05        5.24
        HUN |         96        0.01        5.24
        IDN |        279        0.02        5.26
        IND |      1,068        0.07        5.33
        IRL |      4,582        0.29        5.62
        ISR |     10,718        0.67        6.29
        ITA |      1,029        0.06        6.35
        JAM |         10        0.00        6.35
        JEY |      1,078        0.07        6.42
        JPN |      5,350        0.34        6.76
        KOR |        971        0.06        6.82
        LBR |        453        0.03        6.85
        LIE |         33        0.00        6.85
        LUX |      1,492        0.09        6.94
        MCO |          8        0.00        6.94
        MEX |      2,904        0.18        7.13
        MHL |      2,648        0.17        7.29
        MUS |         44        0.00        7.30
        NLD |      4,989        0.31        7.61
        NOR |        772        0.05        7.66
        NZL |        377        0.02        7.68
        PAN |        780        0.05        7.73
        PER |        215        0.01        7.74
        PHL |        715        0.04        7.79
        PNG |         62        0.00        7.79
        POL |         23        0.00        7.79
        PRI |         68        0.00        7.80
        PRT |        255        0.02        7.81
        RUS |        543        0.03        7.85
        SGP |        771        0.05        7.90
        SWE |      1,552        0.10        7.99
        THA |         27        0.00        8.00
        TUR |         96        0.01        8.00
        TWN |        585        0.04        8.04
        USA |  1,458,617       91.61       99.65
        VEN |        157        0.01       99.66
        VGB |      3,674        0.23       99.89
        ZAF |      1,727        0.11      100.00
        ZMB |         28        0.00      100.00
------------+-----------------------------------
      Total |  1,592,184      100.00

. tab fic, sort

        fic |      Freq.     Percent        Cum.
------------+-----------------------------------
        USA |  1,458,617       91.61       91.61
        CAN |     28,921        1.82       93.43
        GBR |     12,314        0.77       94.20
        CYM |     10,755        0.68       94.88
        ISR |     10,718        0.67       95.55
        BMU |      8,070        0.51       96.06
        JPN |      5,350        0.34       96.39
        NLD |      4,989        0.31       96.71
        IRL |      4,582        0.29       96.99
        VGB |      3,674        0.23       97.22
        FRA |      3,204        0.20       97.43
        MEX |      2,904        0.18       97.61
        AUS |      2,863        0.18       97.79
        BRA |      2,752        0.17       97.96
        MHL |      2,648        0.17       98.13
        DEU |      2,417        0.15       98.28
        CHE |      2,099        0.13       98.41
        CHL |      1,769        0.11       98.52
        ZAF |      1,727        0.11       98.63
        SWE |      1,552        0.10       98.73
        LUX |      1,492        0.09       98.82
        ARG |      1,451        0.09       98.91
        CHN |      1,198        0.08       98.99
        JEY |      1,078        0.07       99.06
        IND |      1,068        0.07       99.12
        ITA |      1,029        0.06       99.19
        ESP |      1,004        0.06       99.25
        KOR |        971        0.06       99.31
        HKG |        873        0.05       99.37
        PAN |        780        0.05       99.41
        NOR |        772        0.05       99.46
        SGP |        771        0.05       99.51
        PHL |        715        0.04       99.56
        TWN |        585        0.04       99.59
        DNK |        573        0.04       99.63
        FIN |        551        0.03       99.66
        RUS |        543        0.03       99.70
        BHS |        524        0.03       99.73
        CUW |        458        0.03       99.76
        LBR |        453        0.03       99.79
        NZL |        377        0.02       99.81
        BEL |        348        0.02       99.83
        IDN |        279        0.02       99.85
        ANT |        271        0.02       99.87
        PRT |        255        0.02       99.88
        GRC |        253        0.02       99.90
        COL |        222        0.01       99.91
        PER |        215        0.01       99.93
        VEN |        157        0.01       99.94
        HUN |         96        0.01       99.94
        TUR |         96        0.01       99.95
        GGY |         94        0.01       99.96
        ATG |         92        0.01       99.96
        AUT |         84        0.01       99.97
        BLZ |         82        0.01       99.97
        CYP |         71        0.00       99.98
        PRI |         68        0.00       99.98
        PNG |         62        0.00       99.98
        MUS |         44        0.00       99.99
        DOM |         39        0.00       99.99
        GHA |         36        0.00       99.99
        LIE |         33        0.00       99.99
        ZMB |         28        0.00      100.00
        THA |         27        0.00      100.00
        POL |         23        0.00      100.00
        JAM |         10        0.00      100.00
        MCO |          8        0.00      100.00
------------+-----------------------------------
      Total |  1,592,184      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. 
. /*******************************************************************************
>         
>         DESCRIPTION: Do file building yearly networks of firms, using the cleanin
> g
>                                 procedure of 002
>         
>         INFILES:        - 
>         
>         OUTFILES:       - 
>         
>         LOG: Created 28/02/2020
>         
> *******************************************************************************/
. 
. /*******************************************************************************
>         SETUP
> *******************************************************************************/
. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-
> scheme-modern/master/")
checking scheme-modern consistency and verifying not already installed...
all files already exist and are up to date.

. set scheme modern, perm 
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                               
>                        // I'm using a different orig folder so as not to commit l
> arge datasets to GitHub

. global data "$wd/data/001_network"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. 
. *do-file number, used to save outputs 
. global doNum "003"                                      

. 
. *log
. cap log close
-----------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/003_buildYearlyNetworks.log
  log type:  text
 opened on:  21 Mar 2020, 19:02:29

. 
. /*******************************************************************************
>         GETTING THE WHOLE COMPUSTAT COMPANY DATA WITH GVKEYs
> *******************************************************************************/
. 
. import delimited "$orig/compustat_quarterly_61_19.csv", clear
--Break--
r(1);

end of do-file

--Break--
r(1);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_quarterly_61_19.csv", clear
(26 vars, 1,592,184 obs)

. keep gvkey fyeareq conm saleq sic
variable fyeareq not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. gtools, upgrade 
command gtools is unrecognized
r(199);

end of do-file

r(199);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. ssc install gtools
checking gtools consistency and verifying not already installed...
installing into /Users/ios/Library/Application Support/Stata/ado/plus/...
installation complete.

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. gcollapse (sum) saleq, by(gvkey fyeareq conm sic)
Variable fyeareq not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. keep gvkey fyearq conm saleq sic

. gcollapse (sum) saleq, by(gvkey fyearq conm sic)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. duplicates tag conm, gen(tag)

Duplicates in terms of conm

. 
end of do-file

. tab tag

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        484        0.12        0.12
          1 |      3,148        0.76        0.88
          2 |      8,094        1.96        2.84
          3 |     10,092        2.44        5.28
          4 |     12,090        2.92        8.20
          5 |     12,642        3.06       11.26
          6 |     14,140        3.42       14.68
          7 |     14,720        3.56       18.24
          8 |     13,932        3.37       21.61
          9 |     13,440        3.25       24.86
         10 |     13,684        3.31       28.17
         11 |     12,624        3.05       31.23
         12 |     14,079        3.41       34.63
         13 |     12,992        3.14       37.77
         14 |     12,435        3.01       40.78
         15 |     11,680        2.83       43.61
         16 |     12,053        2.92       46.52
         17 |     11,304        2.73       49.26
         18 |     11,077        2.68       51.94
         19 |     11,120        2.69       54.63
         20 |     11,046        2.67       57.30
         21 |     11,066        2.68       59.98
         22 |      8,832        2.14       62.11
         23 |     10,128        2.45       64.56
         24 |     11,100        2.69       67.25
         25 |      8,190        1.98       69.23
         26 |      8,856        2.14       71.37
         27 |      8,344        2.02       73.39
         28 |      6,409        1.55       74.94
         29 |      6,090        1.47       76.41
         30 |      4,991        1.21       77.62
         31 |      5,536        1.34       78.96
         32 |      6,402        1.55       80.51
         33 |      6,630        1.60       82.11
         34 |      5,285        1.28       83.39
         35 |      4,464        1.08       84.47
         36 |      5,032        1.22       85.69
         37 |      8,930        2.16       87.85
         38 |      7,176        1.74       89.58
         39 |      2,280        0.55       90.13
         40 |      1,517        0.37       90.50
         41 |      1,680        0.41       90.91
         42 |      2,752        0.67       91.57
         43 |      1,232        0.30       91.87
         44 |      1,035        0.25       92.12
         45 |      1,518        0.37       92.49
         46 |      2,162        0.52       93.01
         47 |      1,248        0.30       93.31
         48 |        931        0.23       93.54
         49 |      1,400        0.34       93.88
         50 |      1,428        0.35       94.22
         51 |      3,016        0.73       94.95
         52 |      1,643        0.40       95.35
         53 |      5,076        1.23       96.58
         54 |      1,705        0.41       96.99
         55 |        616        0.15       97.14
         56 |        855        0.21       97.35
         57 |     10,614        2.57       99.91
         58 |        354        0.09      100.00
------------+-----------------------------------
      Total |    413,399      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. duplicates tag conm year, gen(tag)
variable year not found
r(111);

end of do-file

r(111);

. drop tag

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. duplicates tag conm fyear, gen(tag)

Duplicates in terms of conm fyearq

. 
end of do-file

. tab tag

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    413,393      100.00      100.00
          1 |          6        0.00      100.00
------------+-----------------------------------
      Total |    413,399      100.00

. br if tag!=0

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_quarterly_61_19.csv", clear
(26 vars, 1,592,184 obs)

. keep gvkey fyearq conm saleq sic

. gcollapse (sum) saleq (firstnm) gvkey, by(fyearq conm sic)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. duplicates tag conm fyear, gen(tag)

Duplicates in terms of conm fyearq

. 
end of do-file

. tab tag

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    413,396      100.00      100.00
------------+-----------------------------------
      Total |    413,396      100.00

. br

. sort conm fyearq

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. rename fyearq year

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. do "$code/mres_xxx_cleanCompNames"

. 
. /*******************************************************************************
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat homogeneous nam
> es
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *******************************************************************************/
. 
. gen comp = conm

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(101,518 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(603 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(147 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(851 real changes made)

. replace comp=subinword(comp,"CO","",.)
(27,604 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(187,645 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(882 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(7,553 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(35,918 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(5,480 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(12,885 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(1,590 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(469 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,102 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,122 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(105 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(430 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(2,366 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(7,118 real changes made)

. replace comp=trim(comp)
(291,215 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(15,795 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,614 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(6 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(6 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(4,032 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(10,130 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(2,065 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(10,596 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(86 real changes made)

. replace comp=trim(comp)
(27,084 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(186 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(7,418 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(3,497 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(4,711 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(8 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(0 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(6,877 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(3,525 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,332 real changes made)

. replace comp=subinstr(comp," & ","",.)
(12,000 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(2,502 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(2,315 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(1,483 real changes made)

. replace comp=trim(comp)
(12,271 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(8,978 real changes made)

. replace comp=subinstr(comp,".","",.)
(3,366 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(47 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(12,823 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(4,771 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(6 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(210 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(5,150 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,077 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(191 real changes made)

. replace comp=trim(comp)
(8,214 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(1,192 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(231 real changes made)

. replace comp=subinstr(comp,"(","",.)
(4,147 real changes made)

. replace comp=subinstr(comp,")","",.)
(4,147 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(953 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(37 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(56 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(182 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(6 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(245 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(321 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(82 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(1,214 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(1,738 real changes made)

. replace comp=trim(comp)
(32 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(25 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(1,575 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(0 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(896 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(431 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(58 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(0 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(246 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(69 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(135 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(9,508 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(505 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(184 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(188 real changes made)

. replace comp=trim(comp)
(1,116 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(43 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(128 real changes made)

. replace comp=trim(comp)
(43 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(7,248 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(11 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(833 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(1,230 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,068 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,388 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(6 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(841 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(102 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(261 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(210 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(3,873 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(0 real changes made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(31 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(14 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(58 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(5,630 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(40 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(368 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(12,248 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(436 real changes made)

. replace comp=trim(comp)
(2,486 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(3,419 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(407 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(2,927 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(2,585 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(184 real changes made)

. replace comp=trim(comp)
(7 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(68 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(184 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(2,322 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(14,144 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(0 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(1,280 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(0 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(1,478 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(156 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(296 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(859 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,688 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(2,183 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(6,692 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(203 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(1,994 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(233 real changes made)

. replace comp=trim(comp)
(12,396 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(623 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(74 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(540 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(0 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(324 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(82 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(54 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(219 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(341 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(26 real changes made)

. replace comp=subinstr(comp,",","",.)
(0 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(0 real changes made)

. replace comp=subinword(comp,"W","",.)
(218 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(52 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(601 real changes made)

. replace comp=subinword(comp,"SP","",.)
(2,055 real changes made)

. replace comp=trim(comp)
(331 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(17 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(310 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(60 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(28 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(0 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(0 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(21 real changes made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(84 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(48 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(50 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(115 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(152 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(318 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(7 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(1,837 real changes made)

. replace comp=trim(comp)
(1,823 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(184 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(0 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(169 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(57 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(1,073 real changes made)

. replace comp=subinword(comp,"A","",.)
(1,423 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(700 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(45 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(65 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(17,456 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(0 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(1,027 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(82 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(504 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(357 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(36 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(186 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(85 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(51 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(747 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(35 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(58 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(0 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(3,484 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(93 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(52 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(28 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(88 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(2,149 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                        
>                                //BLUNT way of improving match, remove white space
(295,952 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. gcollapse (sum) saleq (firstnm) gvkey, by(fyearq comp sic)
Variable fyearq not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. gcollapse (sum) saleq (firstnm) gvkey, by(year comp sic)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. sort year comp

. 
end of do-file

. hist year
(bin=56, start=1961, width=1.0357143)

. tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       1961 |         46        0.01        0.01
       1962 |        692        0.17        0.18
       1963 |        735        0.18        0.36
       1964 |        771        0.19        0.54
       1965 |        874        0.21        0.76
       1966 |      1,915        0.46        1.22
       1967 |      1,987        0.48        1.70
       1968 |      2,501        0.61        2.31
       1969 |      2,597        0.63        2.94
       1970 |      2,681        0.65        3.59
       1971 |      2,765        0.67        4.26
       1972 |      2,852        0.69        4.96
       1973 |      2,899        0.70        5.66
       1974 |      2,907        0.71        6.37
       1975 |      2,931        0.71        7.08
       1976 |      2,904        0.71        7.78
       1977 |      2,983        0.72        8.51
       1978 |      2,935        0.71        9.22
       1979 |      2,915        0.71        9.93
       1980 |      2,887        0.70       10.63
       1981 |      5,101        1.24       11.87
       1982 |      6,839        1.66       13.53
       1983 |      7,215        1.75       15.28
       1984 |      7,456        1.81       17.09
       1985 |      7,994        1.94       19.03
       1986 |      8,497        2.06       21.10
       1987 |      8,638        2.10       23.19
       1988 |      8,660        2.10       25.30
       1989 |      8,596        2.09       27.38
       1990 |      8,622        2.09       29.48
       1991 |      8,629        2.10       31.57
       1992 |      9,191        2.23       33.80
       1993 |      9,858        2.39       36.20
       1994 |     10,446        2.54       38.73
       1995 |     11,352        2.76       41.49
       1996 |     11,457        2.78       44.27
       1997 |     11,341        2.75       47.02
       1998 |     11,761        2.86       49.88
       1999 |     11,841        2.88       52.76
       2000 |     11,526        2.80       55.55
       2001 |     11,011        2.67       58.23
       2002 |     10,497        2.55       60.78
       2003 |     10,178        2.47       63.25
       2004 |      9,849        2.39       65.64
       2005 |      9,795        2.38       68.02
       2006 |      9,621        2.34       70.35
       2007 |      9,641        2.34       72.69
       2008 |      9,502        2.31       75.00
       2009 |      9,315        2.26       77.26
       2010 |      9,366        2.27       79.54
       2011 |      9,490        2.30       81.84
       2012 |      9,783        2.38       84.22
       2013 |      9,840        2.39       86.61
       2014 |      9,800        2.38       88.99
       2015 |      9,713        2.36       91.35
       2016 |      9,616        2.33       93.68
       2017 |      9,387        2.28       95.96
       2018 |      9,071        2.20       98.16
       2019 |      7,571        1.84      100.00
------------+-----------------------------------
      Total |    411,843      100.00

. h hist

. h hist, width(1)
option width() not allowed
r(198);

. hist year, width(1)
(bin=58, start=1961, width=1)

. h hist

. hist year, width(1) discrete
(start=1961, width=1)

. hist year, discrete
(start=1961, width=1)

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. rename saleq sales

. levelsof year
1961 1962 1963 1964 1965 1966 1967 1968 1969 1970 1971 1972 1973 1974 1975 1976 197
> 7 1978 1979 1980 1981 1982 1983 1984 1985 1986 1987 1988 1989 1990 1991 1992 1993
>  1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 
> 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019

. foreach y in `r(level)'{
  2.         preserve
  3.         keep if year==`y'
  4.         save "$data/${doNum}_allComp`y'.dta", replace
  5.         restore
  6.         } 

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_quarterly_61_19.csv", clear
(26 vars, 1,592,184 obs)

. keep gvkey fyearq conm saleq sic

. gcollapse (sum) saleq (firstnm) gvkey, by(fyearq conm sic)                       
>                        // using firstnm as TELECOM ITALIA has two for the years 2
> 001-2003

. duplicates tag conm fyear, gen(tag)

Duplicates in terms of conm fyearq

. tab tag                                                                          
>                                                                        // 0 dupli
> cates, good

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    413,396      100.00      100.00
------------+-----------------------------------
      Total |    413,396      100.00

. rename fyearq year

. do "$code/mres_xxx_cleanCompNames"

. 
. /*******************************************************************************
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat homogeneous nam
> es
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *******************************************************************************/
. 
. gen comp = conm

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(101,518 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(603 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(147 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(851 real changes made)

. replace comp=subinword(comp,"CO","",.)
(27,604 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(187,645 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(882 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(7,553 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(35,918 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(5,480 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(12,885 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(1,590 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(469 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,102 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,122 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(105 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(430 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(2,366 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(7,118 real changes made)

. replace comp=trim(comp)
(291,215 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(15,795 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,614 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(6 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(6 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(4,032 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(10,130 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(2,065 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(10,596 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(86 real changes made)

. replace comp=trim(comp)
(27,084 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(186 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(7,418 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(3,497 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(4,711 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(8 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(0 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(6,877 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(3,525 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,332 real changes made)

. replace comp=subinstr(comp," & ","",.)
(12,000 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(2,502 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(2,315 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(1,483 real changes made)

. replace comp=trim(comp)
(12,271 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(8,978 real changes made)

. replace comp=subinstr(comp,".","",.)
(3,366 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(47 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(12,823 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(4,771 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(6 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(210 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(5,150 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,077 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(191 real changes made)

. replace comp=trim(comp)
(8,214 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(1,192 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(231 real changes made)

. replace comp=subinstr(comp,"(","",.)
(4,147 real changes made)

. replace comp=subinstr(comp,")","",.)
(4,147 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(953 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(37 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(56 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(182 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(6 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(245 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(321 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(82 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(1,214 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(1,738 real changes made)

. replace comp=trim(comp)
(32 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(25 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(1,575 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(0 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(896 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(431 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(58 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(0 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(246 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(69 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(135 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(9,508 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(505 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(184 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(188 real changes made)

. replace comp=trim(comp)
(1,116 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(43 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(128 real changes made)

. replace comp=trim(comp)
(43 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(7,248 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(11 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(833 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(1,230 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,068 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,388 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(6 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(841 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(102 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(261 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(210 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(3,873 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(0 real changes made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(31 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(14 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(58 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(5,630 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(40 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(368 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(12,248 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(436 real changes made)

. replace comp=trim(comp)
(2,486 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(3,419 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(407 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(2,927 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(2,585 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(184 real changes made)

. replace comp=trim(comp)
(7 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(68 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(184 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(2,322 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(14,144 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(0 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(1,280 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(0 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(1,478 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(156 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(296 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(859 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,688 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(2,183 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(6,692 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(203 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(1,994 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(233 real changes made)

. replace comp=trim(comp)
(12,396 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(623 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(74 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(540 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(0 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(324 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(82 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(54 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(219 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(341 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(26 real changes made)

. replace comp=subinstr(comp,",","",.)
(0 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(0 real changes made)

. replace comp=subinword(comp,"W","",.)
(218 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(52 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(601 real changes made)

. replace comp=subinword(comp,"SP","",.)
(2,055 real changes made)

. replace comp=trim(comp)
(331 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(17 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(310 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(60 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(28 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(0 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(0 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(21 real changes made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(84 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(48 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(50 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(115 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(152 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(318 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(7 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(1,837 real changes made)

. replace comp=trim(comp)
(1,823 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(184 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(0 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(169 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(57 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(1,073 real changes made)

. replace comp=subinword(comp,"A","",.)
(1,423 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(700 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(45 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(65 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(17,456 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(0 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(1,027 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(82 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(504 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(357 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(36 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(186 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(85 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(51 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(747 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(35 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(58 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(0 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(3,484 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(93 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(52 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(28 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(88 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(2,149 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                        
>                                //BLUNT way of improving match, remove white space
(295,952 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. gcollapse (sum) saleq (firstnm) gvkey, by(year comp sic)                         
>                        //very few firms are being collapsed together after the cl
> eaning, which is a good sign

. sort year comp

. hist year, discrete
(start=1961, width=1)

. rename saleq sales

. levelsof year
1961 1962 1963 1964 1965 1966 1967 1968 1969 1970 1971 1972 1973 1974 1975 1976 197
> 7 1978 1979 1980 1981 1982 1983 1984 1985 1986 1987 1988 1989 1990 1991 1992 1993
>  1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 
> 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019

. foreach y in `r(levels)' {
  2.         preserve
  3.         keep if year==`y'
  4.         save "$data/${doNum}_allComp`y'.dta", replace
  5.         restore
  6.         } 
(411,797 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1961
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1961.dta sa
> ved
(411,151 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1962
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1962.dta sa
> ved
(411,108 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1963
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1963.dta sa
> ved
(411,072 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1964
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1964.dta sa
> ved
(410,969 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1965
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1965.dta sa
> ved
(409,928 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1966
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1966.dta sa
> ved
(409,856 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1967
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1967.dta sa
> ved
(409,342 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1968
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1968.dta sa
> ved
(409,246 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1969
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1969.dta sa
> ved
(409,162 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1970
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1970.dta sa
> ved
(409,078 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1971
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1971.dta sa
> ved
(408,991 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1972
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1972.dta sa
> ved
(408,944 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1973
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1973.dta sa
> ved
(408,936 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1974
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1974.dta sa
> ved
(408,912 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1975
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1975.dta sa
> ved
(408,939 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1976
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1976.dta sa
> ved
(408,860 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1977
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1977.dta sa
> ved
(408,908 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1978
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1978.dta sa
> ved
(408,928 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1979
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1979.dta sa
> ved
(408,956 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1980
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1980.dta sa
> ved
(406,742 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1981
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1981.dta sa
> ved
(405,004 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1982
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1982.dta sa
> ved
(404,628 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1983
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1983.dta sa
> ved
(404,387 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1984
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1984.dta sa
> ved
(403,849 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1985
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1985.dta sa
> ved
(403,346 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1986
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1986.dta sa
> ved
(403,205 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1987
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1987.dta sa
> ved
(403,183 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1988
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1988.dta sa
> ved
(403,247 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1989
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1989.dta sa
> ved
(403,221 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1990
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1990.dta sa
> ved
(403,214 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1991
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1991.dta sa
> ved
(402,652 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1992
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1992.dta sa
> ved
(401,985 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1993
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1993.dta sa
> ved
(401,397 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1994
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1994.dta sa
> ved
(400,491 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1995
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1995.dta sa
> ved
(400,386 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1996
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1996.dta sa
> ved
(400,502 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1997
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1997.dta sa
> ved
(400,082 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1998
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1998.dta sa
> ved
(400,002 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1999
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp1999.dta sa
> ved
(400,317 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2000
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2000.dta sa
> ved
(400,832 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2001
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2001.dta sa
> ved
(401,346 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2002
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2002.dta sa
> ved
(401,665 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2003
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2003.dta sa
> ved
(401,994 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2004
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2004.dta sa
> ved
(402,048 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2005
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2005.dta sa
> ved
(402,222 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2006
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2006.dta sa
> ved
(402,202 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2007
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2007.dta sa
> ved
(402,341 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2008
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2008.dta sa
> ved
(402,528 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2009
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2009.dta sa
> ved
(402,477 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2010
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2010.dta sa
> ved
(402,353 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2011
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2011.dta sa
> ved
(402,060 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2012
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2012.dta sa
> ved
(402,003 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2013
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2013.dta sa
> ved
(402,043 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2014
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2014.dta sa
> ved
(402,130 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2015
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2015.dta sa
> ved
(402,227 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2016
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2016.dta sa
> ved
(402,456 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2017
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2017.dta sa
> ved
(402,772 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2018
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2018.dta sa
> ved
(404,272 observations deleted)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2019
> .dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp2019.dta sa
> ved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. keep if year==1980
(545,818 observations deleted)

. 
end of do-file

. sort salecs

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. merge 1:1 gvkey using "$data/${doNum}_allComp`y'.dta"
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp.dta not
    found
r(601);

end of do-file

r(601);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. merge 1:1 gvkey using "$data/${doNum}_allComp1980.dta"
variable gvkey does not uniquely identify observations in the master data
r(459);

end of do-file

r(459);

. sort gvkey

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. merge m:1 gvkey using "$data/${doNum}_allComp1980.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,189
        from master                     2,094  (_merge==1)
        from using                      2,095  (_merge==2)

    matched                             1,539  (_merge==3)
    -----------------------------------------

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_quarterly_61_19.csv", clear
(26 vars, 1,592,184 obs)

. keep gvkey fyearq conm saleq sic

. gcollapse (sum) saleq (firstnm) gvkey, by(fyearq conm sic)                       
>                        // using firstnm as TELECOM ITALIA has two for the years 2
> 001-2003

. duplicates tag conm fyear, gen(tag)

Duplicates in terms of conm fyearq

. tab tag                                                                          
>                                                                        // 0 dupli
> cates, good

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    413,396      100.00      100.00
------------+-----------------------------------
      Total |    413,396      100.00

. rename fyearq year

. do "$code/mres_xxx_cleanCompNames"

. 
. /*******************************************************************************
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat homogeneous nam
> es
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *******************************************************************************/
. 
. gen comp = conm

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(101,518 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(603 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(147 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(851 real changes made)

. replace comp=subinword(comp,"CO","",.)
(27,604 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(187,645 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(882 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(7,553 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(35,918 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(5,480 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(12,885 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(1,590 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(469 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,102 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,122 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(105 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(430 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(2,366 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(7,118 real changes made)

. replace comp=trim(comp)
(291,215 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(15,795 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,614 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(6 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(6 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(4,032 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(10,130 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(2,065 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(10,596 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(86 real changes made)

. replace comp=trim(comp)
(27,084 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(186 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(7,418 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(3,497 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(4,711 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(8 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(0 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(6,877 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(3,525 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,332 real changes made)

. replace comp=subinstr(comp," & ","",.)
(12,000 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(2,502 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(2,315 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(1,483 real changes made)

. replace comp=trim(comp)
(12,271 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(8,978 real changes made)

. replace comp=subinstr(comp,".","",.)
(3,366 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(47 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(12,823 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(4,771 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(6 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(210 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(5,150 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,077 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(191 real changes made)

. replace comp=trim(comp)
(8,214 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(1,192 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(231 real changes made)

. replace comp=subinstr(comp,"(","",.)
(4,147 real changes made)

. replace comp=subinstr(comp,")","",.)
(4,147 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(953 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(37 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(56 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(182 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(6 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(245 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(321 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(82 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(1,214 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(1,738 real changes made)

. replace comp=trim(comp)
(32 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(25 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(1,575 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(0 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(896 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(431 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(58 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(0 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(246 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(69 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(135 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(9,508 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(505 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(184 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(188 real changes made)

. replace comp=trim(comp)
(1,116 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(43 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(128 real changes made)

. replace comp=trim(comp)
(43 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(7,248 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(11 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(833 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(1,230 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,068 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,388 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(6 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(841 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(102 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(261 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(210 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(3,873 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(0 real changes made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(31 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(14 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(58 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(5,630 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(40 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(368 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(12,248 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(436 real changes made)

. replace comp=trim(comp)
(2,486 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(3,419 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(407 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(2,927 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(2,585 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(184 real changes made)

. replace comp=trim(comp)
(7 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(68 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(184 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(2,322 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(14,144 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(0 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(1,280 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(0 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(1,478 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(156 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(296 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(859 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,688 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(2,183 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(6,692 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(203 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(1,994 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(233 real changes made)

. replace comp=trim(comp)
(12,396 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(623 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(74 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(540 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(0 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(324 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(82 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(54 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(219 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(341 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(26 real changes made)

. replace comp=subinstr(comp,",","",.)
(0 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(0 real changes made)

. replace comp=subinword(comp,"W","",.)
(218 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(52 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(601 real changes made)

. replace comp=subinword(comp,"SP","",.)
(2,055 real changes made)

. replace comp=trim(comp)
(331 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(17 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(310 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(60 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(28 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(0 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(0 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(21 real changes made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(84 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(48 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(50 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(115 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(152 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(318 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(7 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(1,837 real changes made)

. replace comp=trim(comp)
(1,823 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(184 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(0 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(169 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(57 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(1,073 real changes made)

. replace comp=subinword(comp,"A","",.)
(1,423 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(700 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(45 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(65 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(17,456 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(0 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(1,027 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(82 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(504 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(357 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(36 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(186 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(85 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(51 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(747 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(35 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(58 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(0 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(3,484 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(93 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(52 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(28 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(88 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(2,149 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                        
>                                //BLUNT way of improving match, remove white space
(295,952 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. gcollapse (sum) saleq (firstnm) gvkey, by(year comp sic)                         
>                        //very few firms are being collapsed together after the cl
> eaning, which is a good sign

. sort year comp

. hist year, discrete
(start=1961, width=1)

. rename saleq sales

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. compress
  variable comp was str30 now str27
  (1,235,529 bytes saved)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. save "$data/${doNum}_allComp.dta", replace 
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_all
> Comp.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp.dt
> a saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. merge
merge :  invalid merge type
    merge types are 1:1, 1:m, m:1, or m:m
r(198);

end of do-file

r(198);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. merge m:1 gvkey using "$data/${doNum}_allComp.dta"
variable gvkey does not uniquely identify observations in the using data
r(459);

end of do-file

r(459);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. merge m:1 gvkey year using "$data/${doNum}_allComp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       277,458
        from master                    14,196  (_merge==1)
        from using                    263,262  (_merge==2)

    matched                           535,255  (_merge==3)
    -----------------------------------------

. 
end of do-file

. sort gvkey year

. tab year _merge

           |              _merge
      year | master on  using onl  matched ( |     Total
-----------+---------------------------------+----------
      1961 |         0         46          0 |        46 
      1962 |         0        692          0 |       692 
      1963 |         0        735          0 |       735 
      1964 |         0        771          0 |       771 
      1965 |         0        874          0 |       874 
      1966 |         0      1,915          0 |     1,915 
      1967 |         0      1,987          0 |     1,987 
      1968 |         0      2,501          0 |     2,501 
      1969 |         0      2,597          0 |     2,597 
      1970 |         0      2,681          0 |     2,681 
      1971 |         0      2,765          0 |     2,765 
      1972 |         0      2,852          0 |     2,852 
      1973 |         0      2,899          0 |     2,899 
      1974 |         0      2,907          0 |     2,907 
      1975 |         0      2,931          0 |     2,931 
      1976 |       197      2,884         33 |     3,114 
      1977 |       651      2,751        419 |     3,821 
      1978 |     1,708      2,232      1,332 |     5,272 
      1979 |     1,989      2,130      1,499 |     5,618 
      1980 |     2,094      2,095      1,539 |     5,728 
      1981 |       869      3,503      2,953 |     7,325 
      1982 |        45      4,416      4,541 |     9,002 
      1983 |        30      4,500      5,387 |     9,917 
      1984 |        49      4,557      5,795 |    10,401 
      1985 |        44      4,905      6,251 |    11,200 
      1986 |        42      5,157      6,866 |    12,065 
      1987 |        38      5,212      7,198 |    12,448 
      1988 |        55      5,288      7,159 |    12,502 
      1989 |        49      5,280      7,035 |    12,364 
      1990 |        60      5,225      7,290 |    12,575 
      1991 |       148      5,101      7,711 |    12,960 
      1992 |       160      5,342      8,398 |    13,900 
      1993 |       176      5,800      8,959 |    14,935 
      1994 |       160      6,221      9,269 |    15,650 
      1995 |       168      6,739     10,218 |    17,125 
      1996 |       179      6,711     10,383 |    17,273 
      1997 |       165      6,802      9,878 |    16,845 
      1998 |       237      6,905     11,975 |    19,117 
      1999 |       226      7,604     12,911 |    20,741 
      2000 |       310      7,092     15,372 |    22,774 
      2001 |       276      6,665     15,828 |    22,769 
      2002 |       303      6,090     16,539 |    22,932 
      2003 |       286      5,987     15,951 |    22,224 
      2004 |       244      5,719     16,026 |    21,989 
      2005 |       219      5,388     18,922 |    24,529 
      2006 |       229      5,271     19,678 |    25,178 
      2007 |       195      5,412     19,789 |    25,396 
      2008 |       226      5,313     20,217 |    25,756 
      2009 |       230      5,125     21,484 |    26,839 
      2010 |       243      5,269     21,651 |    27,163 
      2011 |       222      5,410     22,066 |    27,698 
      2012 |       214      5,676     22,824 |    28,714 
      2013 |       234      5,693     23,377 |    29,304 
      2014 |       238      5,712     23,716 |    29,666 
      2015 |       268      5,746     22,921 |    28,935 
      2016 |       237      5,807     22,375 |    28,419 
      2017 |       244      5,700     21,473 |    27,417 
      2018 |       231      6,174     19,776 |    26,181 
      2019 |         8      7,500        271 |     7,779 
-----------+---------------------------------+----------
     Total |    14,196    263,262    535,255 |   812,713 

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. keep if year>1975
(29,153 observations deleted)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. drop cid gareac gareat sid stype srcdate tic cusip cik

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. foreach v of varlist gvkey salecs conm sic naics comp sales{
  2.         rename `v' `v'_supplier
  3.         }

. 
end of do-file

. rename _merge _merge_supplier

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. rename cnms conm

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. do "$code/mres_xxx_cleanCompNames"

. 
. /************************************************************************
> *******
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat homogen
> eous names
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *************************************************************************
> ******/
. 
. gen comp = conm
(262,060 missing values generated)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(10,439 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(87 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(96 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(39 real changes made)

. replace comp=subinword(comp,"CO","",.)
(5,169 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(9,163 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(59 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(5,891 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(34,294 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(1,479 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(1,279 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(1,008 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(704 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(395 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(455 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(324 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(438 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(260 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(160 real changes made)

. replace comp=trim(comp)
(25,128 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(13 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(512 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(78 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(215 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(9 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(1,400 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(112 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(3,566 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(140 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(12 real changes made)

. replace comp=trim(comp)
(4,981 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(24 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(631 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(358 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(2,181 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(5 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(10 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(12 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(11 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(246 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(264 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,180 real changes made)

. replace comp=subinstr(comp," & ","",.)
(12,331 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(1,107 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(89 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(387 real changes made)

. replace comp=trim(comp)
(3,483 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(408 real changes made)

. replace comp=subinstr(comp,".","",.)
(18,563 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(0 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(302 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(29 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(9 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(20 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(308 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(414 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(0 real changes made)

. replace comp=trim(comp)
(490 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(748 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(17 real changes made)

. replace comp=subinstr(comp,"(","",.)
(5,832 real changes made)

. replace comp=subinstr(comp,")","",.)
(5,812 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(286 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(1 real change made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(1 real change made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(2 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(24 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(222 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(33 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(352 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(32 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(21 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(2,560 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(23 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(48 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(132 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(41 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(109 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(5 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(22 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(5 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(51 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(4 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(13 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(138 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(72 real changes made)

. replace comp=trim(comp)
(2,489 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(967 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(27 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(30 real changes made)

. replace comp=trim(comp)
(994 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(410 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(23 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(6 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(53 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(119 real changes made)

. replace comp=subinstr(comp,"&","",.)
(4,727 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(0 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(45 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(26 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(4 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(37 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(0 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(66 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(0 real changes made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(2 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(0 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(0 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(9 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(844 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(3 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(14 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(3,913 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(31 real changes made)

. replace comp=trim(comp)
(2,541 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(1,592 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(27 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(2,387 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(488 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(18 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(4 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(96 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(183 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(2,652 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(48 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(109 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(40 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(88 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(11 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(118 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(28 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(1,518 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(219 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(2,181 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(24 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(176 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(15 real changes made)

. replace comp=trim(comp)
(2,580 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(104 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(49 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(9 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(797 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(14 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(4 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(52 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(695 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(0 real changes made)

. replace comp=subinstr(comp,",","",.)
(13,361 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(42 real changes made)

. replace comp=subinword(comp,"W","",.)
(95 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(12 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(191 real changes made)

. replace comp=subinword(comp,"SP","",.)
(169 real changes made)

. replace comp=trim(comp)
(243 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(233 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(17 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(0 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(2 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(18 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(1 real change made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(5 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(15 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(0 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(0 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(2 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(114 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(0 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(34 real changes made)

. replace comp=trim(comp)
(47 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(21 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(2 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(51 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(34 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(130 real changes made)

. replace comp=subinword(comp,"A","",.)
(638 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(63 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(5 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(0 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(2,798 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(342 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(76 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(73 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(80 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(160 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(61 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(13 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(2 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(5 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(2 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(1 real change made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(179 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(0 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(105 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(91 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(106 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(13 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(50 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(37 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(0 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(696 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                
>                                        //BLUNT way of improving match, re
> move white space
(378,730 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. merge m:1 gvkey year using "$data/${doNum}_allComp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       277,458
        from master                    14,196  (_merge==1)
        from using                    263,262  (_merge==2)

    matched                           535,255  (_merge==3)
    -----------------------------------------

. keep if year>1975
(29,153 observations deleted)

. 
. *mergining in clean customer data
. drop cid gareac gareat sid stype srcdate tic cusip cik

. foreach v of varlist gvkey salecs conm sic naics comp sales _merge{
  2.         rename `v' `v'_supplier
  3.         }

. rename cnms conm

. do "$code/mres_xxx_cleanCompNames"

. 
. /************************************************************************
> *******
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat homogen
> eous names
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *************************************************************************
> ******/
. 
. replace conm = upper(conm)
(371,467 real changes made)

. gen comp = conm
(262,060 missing values generated)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(24,270 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(1,468 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(2,481 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(139 real changes made)

. replace comp=subinword(comp,"CO","",.)
(11,938 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(32,716 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(296 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(5,891 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(34,294 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(1,910 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(7,649 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(4,080 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(1,853 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,332 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,392 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(529 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(810 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(13,696 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(943 real changes made)

. replace comp=trim(comp)
(64,169 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(14 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(3,127 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,373 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(342 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(9 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(1,879 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(895 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(3,518 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(1,024 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(58 real changes made)

. replace comp=trim(comp)
(7,518 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(682 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(706 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(2,051 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(2,191 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(5 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(10 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(12 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(11 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(10,470 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(1,848 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,180 real changes made)

. replace comp=subinstr(comp," & ","",.)
(11,719 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(1,145 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(1,308 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(2,174 real changes made)

. replace comp=trim(comp)
(3,578 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(13,423 real changes made)

. replace comp=subinstr(comp,".","",.)
(18,563 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(0 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(1,114 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(188 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(10 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(127 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(1,486 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,148 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(8 real changes made)

. replace comp=trim(comp)
(10,039 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(926 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(1,223 real changes made)

. replace comp=subinstr(comp,"(","",.)
(5,832 real changes made)

. replace comp=subinstr(comp,")","",.)
(5,812 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(776 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(8 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(8 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(208 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(24 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(4,778 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(716 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(889 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(313 real changes made)

. replace comp=trim(comp)
(28 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(21 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(2,650 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(23 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(268 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(342 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(125 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(109 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(99 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(53 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(36 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(888 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(558 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(155 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(138 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(278 real changes made)

. replace comp=trim(comp)
(2,414 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(967 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(134 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(120 real changes made)

. replace comp=trim(comp)
(1,101 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(1,857 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(70 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(189 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(622 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,110 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,225 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(3 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(127 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(47 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(4 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(113 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(148 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(432 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(1 real change made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(5 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(2 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(33 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(7,188 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(86 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(85 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(10,240 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(407 real changes made)

. replace comp=trim(comp)
(3,256 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(5,282 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(89 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(5,334 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(883 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(66 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(27 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(191 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(756 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(13,023 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(48 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(335 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(40 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(219 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(19 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(236 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(852 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,001 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(5,972 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(10,841 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(58 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(4,019 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(33 real changes made)

. replace comp=trim(comp)
(5,737 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(456 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(77 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(399 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(9 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(1,599 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(275 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(20 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(195 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(1,334 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(13,361 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(42 real changes made)

. replace comp=subinword(comp,"W","",.)
(95 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(36 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(668 real changes made)

. replace comp=subinword(comp,"SP","",.)
(212 real changes made)

. replace comp=trim(comp)
(938 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(546 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(111 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(2 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(3 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(18 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(1 real change made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(77 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(16 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(7 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(10 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(20 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(622 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(0 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(424 real changes made)

. replace comp=trim(comp)
(375 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(165 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(15 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(127 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(136 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(152 real changes made)

. replace comp=subinword(comp,"A","",.)
(610 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(67 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(12 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(5 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(11,389 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(2,976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(362 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(565 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(300 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(1,277 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(181 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(1,316 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(7 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(16 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(2 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(1 real change made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(1,748 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(0 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(329 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(91 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(1,599 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(225 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(86 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(82 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(0 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(3,045 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                
>                                        //BLUNT way of improving match, re
> move white space
(356,115 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. merge m:1 gvkey year using "$data/${doNum}_allComp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       277,458
        from master                    14,196  (_merge==1)
        from using                    263,262  (_merge==2)

    matched                           535,255  (_merge==3)
    -----------------------------------------

. keep if year>1975
(29,153 observations deleted)

. 
. *mergining in clean customer data
. drop cid gareac gareat sid stype srcdate tic cusip cik

. foreach v of varlist gvkey salecs conm sic naics comp sales _merge{
  2.         rename `v' `v'_supplier
  3.         }

. rename cnms conm

. do "$code/mres_xxx_cleanCompNames"

. 
. /************************************************************************
> *******
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat homogen
> eous names
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *************************************************************************
> ******/
. 
. gen comp = conm
(262,060 missing values generated)

. replace comp = upper(comp)
(371,467 real changes made)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(24,270 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(1,468 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(2,481 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(139 real changes made)

. replace comp=subinword(comp,"CO","",.)
(11,938 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(32,716 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(296 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(5,891 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(34,294 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(1,910 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(7,649 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(4,080 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(1,853 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,332 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,392 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(529 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(810 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(13,696 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(943 real changes made)

. replace comp=trim(comp)
(64,169 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(14 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(3,127 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,373 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(342 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(9 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(1,879 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(895 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(3,518 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(1,024 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(58 real changes made)

. replace comp=trim(comp)
(7,518 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(682 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(706 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(2,051 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(2,191 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(5 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(10 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(12 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(11 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(10,470 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(1,848 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,180 real changes made)

. replace comp=subinstr(comp," & ","",.)
(11,719 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(1,145 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(1,308 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(2,174 real changes made)

. replace comp=trim(comp)
(3,578 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(13,423 real changes made)

. replace comp=subinstr(comp,".","",.)
(18,563 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(0 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(1,114 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(188 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(10 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(127 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(1,486 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,148 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(8 real changes made)

. replace comp=trim(comp)
(10,039 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(926 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(1,223 real changes made)

. replace comp=subinstr(comp,"(","",.)
(5,832 real changes made)

. replace comp=subinstr(comp,")","",.)
(5,812 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(776 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(8 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(8 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(208 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(24 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(4,778 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(716 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(889 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(313 real changes made)

. replace comp=trim(comp)
(28 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(21 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(2,650 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(23 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(268 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(342 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(125 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(109 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(99 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(53 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(36 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(888 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(558 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(155 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(138 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(278 real changes made)

. replace comp=trim(comp)
(2,414 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(967 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(134 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(120 real changes made)

. replace comp=trim(comp)
(1,101 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(1,857 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(70 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(189 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(622 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,110 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,225 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(3 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(127 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(47 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(4 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(113 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(148 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(432 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(1 real change made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(5 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(2 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(33 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(7,188 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(86 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(85 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(10,240 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(407 real changes made)

. replace comp=trim(comp)
(3,256 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(5,282 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(89 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(5,334 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(883 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(66 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(27 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(191 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(756 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(13,023 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(48 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(335 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(40 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(219 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(19 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(236 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(852 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,001 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(5,972 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(10,841 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(58 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(4,019 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(33 real changes made)

. replace comp=trim(comp)
(5,737 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(456 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(77 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(399 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(9 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(1,599 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(275 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(20 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(195 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(1,334 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(13,361 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(42 real changes made)

. replace comp=subinword(comp,"W","",.)
(95 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(36 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(668 real changes made)

. replace comp=subinword(comp,"SP","",.)
(212 real changes made)

. replace comp=trim(comp)
(938 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(546 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(111 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(2 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(3 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(18 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(1 real change made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(77 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(16 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(7 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(10 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(20 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(622 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(0 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(424 real changes made)

. replace comp=trim(comp)
(375 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(165 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(15 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(127 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(136 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(152 real changes made)

. replace comp=subinword(comp,"A","",.)
(610 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(67 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(12 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(5 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(11,389 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(2,976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(362 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(565 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(300 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(1,277 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(181 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(1,316 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(7 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(16 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(2 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(1 real change made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(1,748 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(0 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(329 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(91 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(1,599 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(225 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(86 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(82 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(0 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(3,045 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                
>                                        //BLUNT way of improving match, re
> move white space
(356,115 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02005.000000"

. merge m:1 comp using "$data/${doNum}_netCompList.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       724,436
        from master                   696,181  (_merge==1)
        from using                     28,255  (_merge==2)

    matched                            87,379  (_merge==3)
    -----------------------------------------

. 
end of do-file

-------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/003_buildYearlyNe
> tworks.log
  log type:  text
 opened on:  22 Mar 2020, 14:38:17

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. merge m:1 gvkey year using "$data/${doNum}_allComp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       277,458
        from master                    14,196  (_merge==1)
        from using                    263,262  (_merge==2)

    matched                           535,255  (_merge==3)
    -----------------------------------------

. keep if year>1975
(29,153 observations deleted)

. 
. *mergining in clean customer data
. drop cid gareac gareat sid stype srcdate tic cusip cik

. foreach v of varlist gvkey salecs conm sic naics comp sales _merge{
  2.         rename `v' `v'_supplier
  3.         }

. rename cnms conm

. do "$code/mres_xxx_cleanCompNames"

. 
. /*****************************************************************************
> **
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat homogeneous 
> names
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> ******************************************************************************
> */
. 
. gen comp = conm
(262,060 missing values generated)

. replace comp = upper(comp)
(371,467 real changes made)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(24,270 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(1,468 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(2,481 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(139 real changes made)

. replace comp=subinword(comp,"CO","",.)
(11,938 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(32,716 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(296 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(5,891 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(34,294 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(1,910 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(7,649 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(4,080 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(1,853 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,332 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,392 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(529 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(810 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(13,696 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(943 real changes made)

. replace comp=trim(comp)
(64,169 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(14 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(3,127 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,373 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(342 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(9 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(1,879 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(895 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(3,518 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(1,024 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(58 real changes made)

. replace comp=trim(comp)
(7,518 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(682 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(706 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(2,051 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(2,191 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(5 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(10 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(12 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(11 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(10,470 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(1,848 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,180 real changes made)

. replace comp=subinstr(comp," & ","",.)
(11,719 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(1,145 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(1,308 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(2,174 real changes made)

. replace comp=trim(comp)
(3,578 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(13,423 real changes made)

. replace comp=subinstr(comp,".","",.)
(18,563 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(0 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(1,114 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(188 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(10 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(127 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(1,486 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,148 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(8 real changes made)

. replace comp=trim(comp)
(10,039 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(926 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(1,223 real changes made)

. replace comp=subinstr(comp,"(","",.)
(5,832 real changes made)

. replace comp=subinstr(comp,")","",.)
(5,812 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(776 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(8 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(8 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(208 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(24 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(4,778 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(716 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(889 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(313 real changes made)

. replace comp=trim(comp)
(28 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(21 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(2,650 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(23 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(268 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(342 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(125 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(109 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(99 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(53 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(36 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(888 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(558 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(155 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(138 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(278 real changes made)

. replace comp=trim(comp)
(2,414 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(967 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(134 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(120 real changes made)

. replace comp=trim(comp)
(1,101 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(1,857 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(70 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(189 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(622 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,110 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,225 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(3 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(127 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(47 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(4 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(113 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(148 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(432 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(1 real change made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(5 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(2 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(33 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(7,188 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(86 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(85 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(10,240 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(407 real changes made)

. replace comp=trim(comp)
(3,256 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(5,282 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(89 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(5,334 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(883 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(66 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(27 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(191 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(756 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(13,023 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(48 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(335 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(40 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(219 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(19 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(236 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(852 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,001 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(5,972 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(10,841 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(58 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(4,019 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(33 real changes made)

. replace comp=trim(comp)
(5,737 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(456 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(77 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(399 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(9 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(1,599 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(275 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(20 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(195 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(1,334 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(13,361 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(42 real changes made)

. replace comp=subinword(comp,"W","",.)
(95 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(36 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(668 real changes made)

. replace comp=subinword(comp,"SP","",.)
(212 real changes made)

. replace comp=trim(comp)
(938 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(546 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(111 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(2 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(3 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(18 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(1 real change made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(77 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(16 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(7 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(10 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(20 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(622 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(0 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(424 real changes made)

. replace comp=trim(comp)
(375 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(165 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(15 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(127 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(136 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(152 real changes made)

. replace comp=subinword(comp,"A","",.)
(610 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(67 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(12 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(5 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(11,389 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(2,976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(362 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(565 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(300 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(1,277 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(181 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(1,316 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(7 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(16 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(2 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(1 real change made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(1,748 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(0 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(329 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(91 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(1,599 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(225 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(86 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(82 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(0 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(3,045 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                     
>                                   //BLUNT way of improving match, remove white
>  space
(356,115 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. merge m:1 comp using "$data/${doNum}_netCompList.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       724,436
        from master                   696,181  (_merge==1)
        from using                     28,255  (_merge==2)

    matched                            87,379  (_merge==3)
    -----------------------------------------

. 
end of do-file

. tab ctype _merge

           |        _merge
     ctype | master on  matched ( |     Total
-----------+----------------------+----------
   COMPANY |   239,277     76,649 |   315,926 
    GEOREG |   105,218      2,507 |   107,725 
    GOVDOM |    36,048         35 |    36,083 
    GOVFRN |     4,663          2 |     4,665 
    GOVLOC |       542          0 |       542 
  GOVSTATE |     1,218         10 |     1,228 
    MARKET |    75,106      8,176 |    83,282 
-----------+----------------------+----------
     Total |   462,072     87,379 |   549,451 

. tab ctype _merge, col

+-------------------+
| Key               |
|-------------------|
|     frequency     |
| column percentage |
+-------------------+

           |        _merge
     ctype | master on  matched ( |     Total
-----------+----------------------+----------
   COMPANY |   239,277     76,649 |   315,926 
           |     51.78      87.72 |     57.50 
-----------+----------------------+----------
    GEOREG |   105,218      2,507 |   107,725 
           |     22.77       2.87 |     19.61 
-----------+----------------------+----------
    GOVDOM |    36,048         35 |    36,083 
           |      7.80       0.04 |      6.57 
-----------+----------------------+----------
    GOVFRN |     4,663          2 |     4,665 
           |      1.01       0.00 |      0.85 
-----------+----------------------+----------
    GOVLOC |       542          0 |       542 
           |      0.12       0.00 |      0.10 
-----------+----------------------+----------
  GOVSTATE |     1,218         10 |     1,228 
           |      0.26       0.01 |      0.22 
-----------+----------------------+----------
    MARKET |    75,106      8,176 |    83,282 
           |     16.25       9.36 |     15.16 
-----------+----------------------+----------
     Total |   462,072     87,379 |   549,451 
           |    100.00     100.00 |    100.00 

. tab ctype _merge, row

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |        _merge
     ctype | master on  matched ( |     Total
-----------+----------------------+----------
   COMPANY |   239,277     76,649 |   315,926 
           |     75.74      24.26 |    100.00 
-----------+----------------------+----------
    GEOREG |   105,218      2,507 |   107,725 
           |     97.67       2.33 |    100.00 
-----------+----------------------+----------
    GOVDOM |    36,048         35 |    36,083 
           |     99.90       0.10 |    100.00 
-----------+----------------------+----------
    GOVFRN |     4,663          2 |     4,665 
           |     99.96       0.04 |    100.00 
-----------+----------------------+----------
    GOVLOC |       542          0 |       542 
           |    100.00       0.00 |    100.00 
-----------+----------------------+----------
  GOVSTATE |     1,218         10 |     1,228 
           |     99.19       0.81 |    100.00 
-----------+----------------------+----------
    MARKET |    75,106      8,176 |    83,282 
           |     90.18       9.82 |    100.00 
-----------+----------------------+----------
     Total |   462,072     87,379 |   549,451 
           |     84.10      15.90 |    100.00 

. di 76649/45
1703.3111

. br if ctype == "MARKET"

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. keep if ctype == "MARKET" | ctype == "MARKET"
(728,533 observations deleted)

. 
end of do-file

. tab conm2 _merge

                      |   _merge
               2 conm | matched ( |     Total
----------------------+-----------+----------
ACCESS SOLUTIONS IN.. |         8 |         8 
CONSOL RESOURCES GR.. |         2 |         2 
CONSOLIDATED ENERGY.. |       229 |       229 
     CP NATIONAL CORP |        21 |        21 
DUQUESNE LIGHT HOLD.. |         1 |         1 
         ECHELON CORP |         1 |         1 
         GOLDCORP INC |         2 |         2 
         HOMECORP INC |        14 |        14 
INFORMATION HOLDING.. |        13 |        13 
INTERNATIONAL PETRO.. |        16 |        16 
IT GROUP HOLDINGS INC |         6 |         6 
LM FUNDING AMERICA .. |         3 |         3 
          NEW TEL LTD |       297 |       297 
NEWPOWER HOLDINGS INC |        56 |        56 
OIL INTERNATIONAL LTD |         9 |         9 
      PLC SYSTEMS INC |         8 |         8 
RESEARCH SOLUTIONS .. |         7 |         7 
       S&P GLOBAL INC |         3 |         3 
             SLM CORP |        10 |        10 
   STAFFING GROUP LTD |         2 |         2 
TECHNOLOGY SOLUTION.. |       149 |       149 
WASHINGTON CORP  -C.. |         2 |         2 
WASTE MANAGEMENT IN.. |         2 |         2 
YORK INTERNATIONAL .. |        16 |        16 
----------------------+-----------+----------
                Total |       877 |       877 

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. foreach v of varlist conm ctype comp gvkey* conm* n _merge{
  2.         rename `v' `v'_customer
  3.         }
conm ambiguous abbreviation
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. foreach v of varlist ctype comp gvkey* conm* n _merge{
  2.         rename `v' `v'_customer
  3.         }
comp ambiguous abbreviation
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. merge m:1 gvkey year using "$data/${doNum}_allComp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       277,458
        from master                    14,196  (_merge==1)
        from using                    263,262  (_merge==2)

    matched                           535,255  (_merge==3)
    -----------------------------------------

. keep if year>1975
(29,153 observations deleted)

. 
. *mergining in clean customer data
. drop cid gareac gareat sid stype srcdate tic cusip cik

. foreach v of varlist gvkey salecs conm sic naics comp sales _merge{
  2.         rename `v' `v'_supplier
  3.         }

. rename cnms conm

. do "$code/mres_xxx_cleanCompNames"

. 
. /********************************************************************
> ***********
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat hom
> ogeneous names
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *********************************************************************
> **********/
. 
. gen comp = conm
(262,060 missing values generated)

. replace comp = upper(comp)
(371,467 real changes made)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(24,270 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(1,468 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(2,481 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(139 real changes made)

. replace comp=subinword(comp,"CO","",.)
(11,938 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(32,716 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(296 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(5,891 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(34,294 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(1,910 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(7,649 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(4,080 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(1,853 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,332 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,392 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(529 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(810 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(13,696 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(943 real changes made)

. replace comp=trim(comp)
(64,169 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(14 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(3,127 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,373 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(342 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(9 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(1,879 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(895 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(3,518 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(1,024 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(58 real changes made)

. replace comp=trim(comp)
(7,518 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(682 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(706 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(2,051 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(2,191 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(5 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(10 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(12 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(11 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(10,470 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(1,848 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,180 real changes made)

. replace comp=subinstr(comp," & ","",.)
(11,719 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(1,145 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(1,308 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(2,174 real changes made)

. replace comp=trim(comp)
(3,578 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(13,423 real changes made)

. replace comp=subinstr(comp,".","",.)
(18,563 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(0 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(1,114 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(188 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(10 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(127 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(1,486 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,148 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(8 real changes made)

. replace comp=trim(comp)
(10,039 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(926 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(1,223 real changes made)

. replace comp=subinstr(comp,"(","",.)
(5,832 real changes made)

. replace comp=subinstr(comp,")","",.)
(5,812 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(776 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(8 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(8 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(208 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(24 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(4,778 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(716 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(889 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(313 real changes made)

. replace comp=trim(comp)
(28 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(21 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(2,650 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(23 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(268 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(342 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(125 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(109 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(99 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(53 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(36 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(888 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(558 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(155 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(138 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(278 real changes made)

. replace comp=trim(comp)
(2,414 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(967 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(134 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(120 real changes made)

. replace comp=trim(comp)
(1,101 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(1,857 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(70 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(189 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(622 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,110 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,225 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(3 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(127 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(47 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(4 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(113 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(148 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(432 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(1 real change made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(5 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(2 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(33 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(7,188 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(86 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(85 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(10,240 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(407 real changes made)

. replace comp=trim(comp)
(3,256 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(5,282 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(89 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(5,334 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(883 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(66 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(27 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(191 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(756 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(13,023 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(48 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(335 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(40 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(219 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(19 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(236 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(852 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,001 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(5,972 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(10,841 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(58 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(4,019 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(33 real changes made)

. replace comp=trim(comp)
(5,737 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(456 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(77 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(399 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(9 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(1,599 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(275 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(20 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(195 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(1,334 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(13,361 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(42 real changes made)

. replace comp=subinword(comp,"W","",.)
(95 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(36 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(668 real changes made)

. replace comp=subinword(comp,"SP","",.)
(212 real changes made)

. replace comp=trim(comp)
(938 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(546 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(111 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(2 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(3 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(18 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(1 real change made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(77 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(16 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(7 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(10 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(20 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(622 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(0 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(424 real changes made)

. replace comp=trim(comp)
(375 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(165 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(15 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(127 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(136 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(152 real changes made)

. replace comp=subinword(comp,"A","",.)
(610 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(67 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(12 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(5 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(11,389 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(2,976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(362 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(565 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(300 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(1,277 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(181 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(1,316 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(7 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(16 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(2 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(1 real change made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(1,748 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",
> .)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(0 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(329 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(91 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(1,599 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(225 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(86 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(82 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(0 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(3,045 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                            
>                                            //BLUNT way of improving m
> atch, remove white space
(356,115 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. merge m:1 comp using "$data/${doNum}_netCompList.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       724,436
        from master                   696,181  (_merge==1)
        from using                     28,255  (_merge==2)

    matched                            87,379  (_merge==3)
    -----------------------------------------

.         // 25% of all company being supplied to find a match (76,649)
.         // This is the highest match rate I get across customer type 
> (followed by "market")
.         // "Market" is a srange one, decent match rate but I'm unsure
>  about their quality
. keep if ctype == "MARKET" | ctype == "MARKET"
(728,533 observations deleted)

. foreach v of varlist ctype comp gvkey* conm* n _merge{
  2.         rename `v' `v'_customer
  3.         }

. 
end of do-file

. tab ctype

ctype_custo |
        mer |      Freq.     Percent        Cum.
------------+-----------------------------------
     MARKET |     83,282      100.00      100.00
------------+-----------------------------------
      Total |     83,282      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. merge m:1 gvkey year using "$data/${doNum}_allComp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       277,458
        from master                    14,196  (_merge==1)
        from using                    263,262  (_merge==2)

    matched                           535,255  (_merge==3)
    -----------------------------------------

. keep if year>1975
(29,153 observations deleted)

. 
. *mergining in clean customer data
. drop cid gareac gareat sid stype srcdate tic cusip cik

. foreach v of varlist gvkey salecs conm sic naics comp sales _merge{
  2.         rename `v' `v'_supplier
  3.         }

. rename cnms conm

. do "$code/mres_xxx_cleanCompNames"

. 
. /********************************************************************
> ***********
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat hom
> ogeneous names
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *********************************************************************
> **********/
. 
. gen comp = conm
(262,060 missing values generated)

. replace comp = upper(comp)
(371,467 real changes made)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(24,270 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(1,468 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(2,481 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(139 real changes made)

. replace comp=subinword(comp,"CO","",.)
(11,938 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(32,716 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(296 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(5,891 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(34,294 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(1,910 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(7,649 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(4,080 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(1,853 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,332 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,392 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(529 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(810 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(13,696 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(943 real changes made)

. replace comp=trim(comp)
(64,169 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(14 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(3,127 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,373 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(342 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(9 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(1,879 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(895 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(3,518 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(1,024 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(58 real changes made)

. replace comp=trim(comp)
(7,518 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(682 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(706 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(2,051 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(2,191 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(5 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(10 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(12 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(11 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(10,470 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(1,848 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,180 real changes made)

. replace comp=subinstr(comp," & ","",.)
(11,719 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(1,145 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(1,308 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(2,174 real changes made)

. replace comp=trim(comp)
(3,578 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(13,423 real changes made)

. replace comp=subinstr(comp,".","",.)
(18,563 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(0 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(1,114 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(188 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(10 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(127 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(1,486 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,148 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(8 real changes made)

. replace comp=trim(comp)
(10,039 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(926 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(1,223 real changes made)

. replace comp=subinstr(comp,"(","",.)
(5,832 real changes made)

. replace comp=subinstr(comp,")","",.)
(5,812 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(776 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(8 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(8 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(208 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(24 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(4,778 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(716 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(889 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(313 real changes made)

. replace comp=trim(comp)
(28 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(21 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(2,650 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(23 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(268 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(342 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(125 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(109 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(99 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(53 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(36 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(888 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(558 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(155 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(138 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(278 real changes made)

. replace comp=trim(comp)
(2,414 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(967 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(134 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(120 real changes made)

. replace comp=trim(comp)
(1,101 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(1,857 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(70 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(189 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(622 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,110 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,225 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(3 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(127 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(47 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(4 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(113 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(148 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(432 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(1 real change made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(5 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(2 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(33 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(7,188 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(86 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(85 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(10,240 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(407 real changes made)

. replace comp=trim(comp)
(3,256 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(5,282 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(89 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(5,334 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(883 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(66 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(27 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(191 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(756 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(13,023 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(48 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(335 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(40 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(219 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(19 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(236 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(852 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,001 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(5,972 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(10,841 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(58 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(4,019 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(33 real changes made)

. replace comp=trim(comp)
(5,737 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(456 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(77 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(399 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(9 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(1,599 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(275 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(20 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(195 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(1,334 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(13,361 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(42 real changes made)

. replace comp=subinword(comp,"W","",.)
(95 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(36 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(668 real changes made)

. replace comp=subinword(comp,"SP","",.)
(212 real changes made)

. replace comp=trim(comp)
(938 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(546 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(111 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(2 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(3 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(18 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(1 real change made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(77 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(16 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(7 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(10 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(20 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(622 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(0 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(424 real changes made)

. replace comp=trim(comp)
(375 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(165 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(15 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(127 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(136 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(152 real changes made)

. replace comp=subinword(comp,"A","",.)
(610 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(67 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(12 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(5 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(11,389 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(2,976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(362 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(565 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(300 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(1,277 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(181 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(1,316 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(7 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(16 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(2 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(1 real change made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(1,748 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",
> .)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(0 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(329 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(91 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(1,599 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(225 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(86 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(82 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(0 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(3,045 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                            
>                                            //BLUNT way of improving m
> atch, remove white space
(356,115 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. merge m:1 comp using "$data/${doNum}_netCompList.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       724,436
        from master                   696,181  (_merge==1)
        from using                     28,255  (_merge==2)

    matched                            87,379  (_merge==3)
    -----------------------------------------

. 
end of do-file

. tab ctype

      ctype |      Freq.     Percent        Cum.
------------+-----------------------------------
    COMPANY |    315,926       57.50       57.50
     GEOREG |    107,725       19.61       77.10
     GOVDOM |     36,083        6.57       83.67
     GOVFRN |      4,665        0.85       84.52
     GOVLOC |        542        0.10       84.62
   GOVSTATE |      1,228        0.22       84.84
     MARKET |     83,282       15.16      100.00
------------+-----------------------------------
      Total |    549,451      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. keep if ctype == "MARKET" | ctype == "COMPANY"
(412,607 observations deleted)

. foreach v of varlist ctype comp gvkey* conm* n _merge{
  2.         rename `v' `v'_customer
  3.         }

. 
end of do-file

. tab _merge_supplier

        _merge_supplier |      Freq.     Percent        Cum.
------------------------+-----------------------------------
        master only (1) |     10,030        2.51        2.51
            matched (3) |    389,178       97.49      100.00
------------------------+-----------------------------------
                  Total |    399,208      100.00

. tab _merge_customer

        _merge_customer |      Freq.     Percent        Cum.
------------------------+-----------------------------------
        master only (1) |    314,383       78.75       78.75
            matched (3) |     84,825       21.25      100.00
------------------------+-----------------------------------
                  Total |    399,208      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. 
. /********************************************************************
> ***********
>         
>         DESCRIPTION: Do file building yearly networks of firms, using
>  the cleaning
>                                 procedure of 002
>         
>         INFILES:        - 
>         
>         OUTFILES:       - 
>         
>         LOG: Created 28/02/2020
>         
> *********************************************************************
> **********/
. 
. /********************************************************************
> ***********
>         SETUP
> *********************************************************************
> **********/
. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/
> mdroste/stata-scheme-modern/master/")
> set scheme modern, perm
> ssc install gtools
> gtools, upgrade*/
. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                   
>                                    // I'm using a different orig fold
> er so as not to commit large datasets to GitHub

. global data "$wd/data/001_network"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. 
. *do-file number, used to save outputs 
. global doNum "003"                                      

. 
. *log
. cap log close
-----------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/003_buildYearly
> Networks.log
  log type:  text
 opened on:  22 Mar 2020, 15:20:05

. 
. /********************************************************************
> ***********
>         GETTING THE WHOLE COMPUSTAT COMPANY DATA WITH GVKEYs
> *********************************************************************
> **********/
. 
. import delimited "$orig/compustat_quarterly_61_19.csv", clear
--Break--
r(1);

end of do-file

--Break--
r(1);

. use "$data/${doNum}_fullNet.dta", clear
file
    /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullN
    > et.dta not found
r(601);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. merge m:1 gvkey year using "$data/${doNum}_allComp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       277,458
        from master                    14,196  (_merge==1)
        from using                    263,262  (_merge==2)

    matched                           535,255  (_merge==3)
    -----------------------------------------

. keep if year>1975
(29,153 observations deleted)

. 
. *mergining in clean customer data
. drop cid gareac gareat sid stype srcdate tic cusip cik

. foreach v of varlist gvkey salecs conm sic naics comp sales _merge{
  2.         rename `v' `v'_supplier
  3.         }

. rename cnms conm

. do "$code/mres_xxx_cleanCompNames"

. 
. /********************************************************************
> ***********
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat hom
> ogeneous names
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *********************************************************************
> **********/
. 
. gen comp = conm
(262,060 missing values generated)

. replace comp = upper(comp)
(371,467 real changes made)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(24,270 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(1,468 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(2,481 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(139 real changes made)

. replace comp=subinword(comp,"CO","",.)
(11,938 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(32,716 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(296 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(5,891 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(34,294 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(1,910 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(7,649 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(4,080 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(1,853 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,332 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,392 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(529 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(810 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(13,696 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(943 real changes made)

. replace comp=trim(comp)
(64,169 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(14 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(3,127 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,373 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(342 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(9 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(1,879 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(895 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(3,518 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(1,024 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(58 real changes made)

. replace comp=trim(comp)
(7,518 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(682 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(706 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(2,051 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(2,191 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(5 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(10 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(12 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(11 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(10,470 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(1,848 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,180 real changes made)

. replace comp=subinstr(comp," & ","",.)
(11,719 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(1,145 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(1,308 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(2,174 real changes made)

. replace comp=trim(comp)
(3,578 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(13,423 real changes made)

. replace comp=subinstr(comp,".","",.)
(18,563 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(0 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(1,114 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(188 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(10 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(127 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(1,486 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,148 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(8 real changes made)

. replace comp=trim(comp)
(10,039 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(926 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(1,223 real changes made)

. replace comp=subinstr(comp,"(","",.)
(5,832 real changes made)

. replace comp=subinstr(comp,")","",.)
(5,812 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(776 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(8 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(8 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(208 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(24 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(4,778 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(716 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(889 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(313 real changes made)

. replace comp=trim(comp)
(28 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(21 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(2,650 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(23 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(268 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(342 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(125 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(109 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(99 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(53 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(36 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(888 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(558 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(155 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(138 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(278 real changes made)

. replace comp=trim(comp)
(2,414 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(967 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(134 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(120 real changes made)

. replace comp=trim(comp)
(1,101 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(1,857 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(70 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(189 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(622 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,110 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,225 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(3 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(127 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(47 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(4 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(113 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(148 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(432 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(1 real change made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(5 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(2 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(33 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(7,188 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(86 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(85 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(10,240 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(407 real changes made)

. replace comp=trim(comp)
(3,256 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(5,282 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(89 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(5,334 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(883 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(66 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(27 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(191 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(756 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(13,023 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(48 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(335 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(40 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(219 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(19 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(236 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(852 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,001 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(5,972 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(10,841 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(58 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(4,019 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(33 real changes made)

. replace comp=trim(comp)
(5,737 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(456 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(77 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(399 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(9 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(1,599 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(275 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(20 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(195 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(1,334 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(13,361 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(42 real changes made)

. replace comp=subinword(comp,"W","",.)
(95 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(36 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(668 real changes made)

. replace comp=subinword(comp,"SP","",.)
(212 real changes made)

. replace comp=trim(comp)
(938 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(546 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(111 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(2 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(3 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(18 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(1 real change made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(77 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(16 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(7 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(10 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(20 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(622 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(0 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(424 real changes made)

. replace comp=trim(comp)
(375 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(165 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(15 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(127 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(136 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(152 real changes made)

. replace comp=subinword(comp,"A","",.)
(610 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(67 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(12 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(5 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(11,389 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(2,976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(362 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(565 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(300 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(1,277 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(181 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(1,316 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(7 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(16 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(2 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(1 real change made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(1,748 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",
> .)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(0 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(329 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(91 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(1,599 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(225 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(86 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(82 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(0 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(3,045 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                            
>                                            //BLUNT way of improving m
> atch, remove white space
(356,115 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. merge m:1 comp using "$data/${doNum}_netCompList.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       724,436
        from master                   696,181  (_merge==1)
        from using                     28,255  (_merge==2)

    matched                            87,379  (_merge==3)
    -----------------------------------------

.         // 25% of all company being supplied to find a match (76,649)
.         // This is the highest match rate I get across customer type 
> (followed by "market")
.         // "Market" is a srange one, decent match rate but I'm unsure
>  about their quality
. keep if ctype == "MARKET" | ctype == "COMPANY"
(412,607 observations deleted)

. foreach v of varlist ctype comp gvkey* conm* n _merge{
  2.         rename `v' `v'_customer
  3.         }

. compress
  variable year was float now int
  variable n_customer was float now int
  variable ctype_customer was str8 now str7
  variable comp_customer was str50 now str46
  variable conm1_customer was str30 now str28
  variable conm2_customer was str30 now str28
  variable conm3_customer was str30 now str27
  variable conm4_customer was str30 now str24
  variable conm5_customer was str30 now str22
  (11,976,240 bytes saved)

. save "$data/${doNum}_fullNet.dta", replace
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003
> _fullNet.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNe
> t.dta saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. keep if _merge_customer == 3
(314,383 observations deleted)

. 
end of do-file

. tab ctype

ctype_custo |
        mer |      Freq.     Percent        Cum.
------------+-----------------------------------
    COMPANY |     76,649       90.36       90.36
     MARKET |      8,176        9.64      100.00
------------+-----------------------------------
      Total |     84,825      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/
> T//SD00936.000000"

. import delimited "$orig/compustat_segment_customer_
> 76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. merge m:1 gvkey year using "$data/${doNum}_allComp.
> dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       277,458
        from master                    14,196  (_merg
> e==1)
        from using                    263,262  (_merg
> e==2)

    matched                           535,255  (_merg
> e==3)
    -----------------------------------------

. keep if year>1975
(29,153 observations deleted)

. 
. *mergining in clean customer data
. drop cid gareac gareat sid stype srcdate tic cusip 
> cik

. foreach v of varlist gvkey salecs conm sic naics co
> mp sales _merge{
  2.         rename `v' `v'_supplier
  3.         }

. rename cnms conm

. do "$code/mres_xxx_cleanCompNames"

. 
. /**************************************************
> *****************************
>         
>         DESCRIPTION:    Cleaning company names -> G
> iving somewhat homogeneous names
>                                         across data
> sets
>         
>         INFILES:        - any string variable with 
> the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> ***************************************************
> ****************************/
. 
. gen comp = conm
(262,060 missing values generated)

. replace comp = upper(comp)
(371,467 real changes made)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(24,270 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(1,468 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(2,481 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(139 real changes made)

. replace comp=subinword(comp,"CO","",.)
(11,938 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(32,716 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(296 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(5,891 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(34,294 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(1,910 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(7,649 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(4,080 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(1,853 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,332 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,392 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(529 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(810 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(13,696 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",
> .)
(943 real changes made)

. replace comp=trim(comp)
(64,169 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(14 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(3,127 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,373 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(342 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","AB
> F FREIGHT",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(9 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(1,879 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(895 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(3,518 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(1,024 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(58 real changes made)

. replace comp=trim(comp)
(7,518 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TE
> LEM",.)
(682 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(706 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(2,051 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES"
> ,"AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(2,191 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(5 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TEC
> HNOLOGY",.)
(10 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CH
> EMICALS",.)
(12 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH 
> COMMUNICATIONS",.)
(11 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.
> )
(10,470 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(1,848 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,180 real changes made)

. replace comp=subinstr(comp," & ","",.)
(11,719 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(1,145 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(1,308 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(2,174 real changes made)

. replace comp=trim(comp)
(3,578 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(13,423 real changes made)

. replace comp=subinstr(comp,".","",.)
(18,563 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.
> )
(0 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(1,114 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(188 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAY
> S",.)
(10 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(127 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(1,486 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,148 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(8 real changes made)

. replace comp=trim(comp)
(10,039 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(926 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.
> )
(1,223 real changes made)

. replace comp=subinstr(comp,"(","",.)
(5,832 real changes made)

. replace comp=subinstr(comp,")","",.)
(5,812 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(776 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(8 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(8 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(208 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(24 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(4,778 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(716 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(889 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(313 real changes made)

. replace comp=trim(comp)
(28 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE I
> ND",.)
(21 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(2,650 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(23 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(268 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(342 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG
> &STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(125 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(109 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(99 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(53 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(36 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(888 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(558 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(155 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(138 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(278 real changes made)

. replace comp=trim(comp)
(2,414 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(967 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(134 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(120 real changes made)

. replace comp=trim(comp)
(1,101 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(1,857 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS",
> "DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(70 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(189 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(622 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,110 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,225 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(3 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(127 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(47 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(4 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(113 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKT
> S",.)
(148 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(432 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(1 real change made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(5 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(2 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR"
> ,.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(33 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(7,188 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(86 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(85 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(10,240 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(407 real changes made)

. replace comp=trim(comp)
(3,256 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(5,282 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(89 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(5,334 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(883 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(66 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON T
> ELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(27 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(191 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(756 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(13,023 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(48 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(335 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK
> ",.)
(40 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(219 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(19 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(236 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(852 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,001 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(5,972 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(10,841 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(58 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(4,019 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(33 real changes made)

. replace comp=trim(comp)
(5,737 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(456 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL"
> ,.)
(77 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(399 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(9 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(1,599 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(275 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(20 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(195 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(1,334 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",
> .)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(13,361 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(42 real changes made)

. replace comp=subinword(comp,"W","",.)
(95 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(36 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(668 real changes made)

. replace comp=subinword(comp,"SP","",.)
(212 real changes made)

. replace comp=trim(comp)
(938 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(546 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(111 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(2 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(3 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(18 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",
> .)
(1 real change made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(77 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(16 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(7 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(10 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(20 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(622 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(0 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(424 real changes made)

. replace comp=trim(comp)
(375 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(165 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN"
> ,.)
(15 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(127 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNS
> NJHNS",.)
(136 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(152 real changes made)

. replace comp=subinword(comp,"A","",.)
(610 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(67 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(12 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",
> .)
(5 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(11,389 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(2,976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIM
> LER",.)
(362 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(565 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(300 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(1,277 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(181 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(1,316 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(7 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(16 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(2 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",
> .)
(1 real change made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.
> )
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT
> ",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.
> )
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(1,748 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOU
> RS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",
> .)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(0 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",
> .)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEU
> SR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCK
> HEED",.)
(329 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED
> ",.)
(91 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.
> )
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.
> )
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(1,599 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(225 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(86 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(82 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NOR
> THROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOW
> ES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(0 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",
> .)
(0 real changes made)

. replace comp=trim(comp)
(3,045 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",
> .)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)          
>                                                    
>           //BLUNT way of improving match, remove wh
> ite space
(356,115 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " T
> RUST" " CO"{
>         replace toClean = subinstr(toClean, " `word
> '", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|
> ") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's cod
> e (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. merge m:1 comp using "$data/${doNum}_netCompList.dt
> a"

    Result                           # of obs.
    -----------------------------------------
    not matched                       724,436
        from master                   696,181  (_merg
> e==1)
        from using                     28,255  (_merg
> e==2)

    matched                            87,379  (_merg
> e==3)
    -----------------------------------------

.         // 25% of all company being supplied to fin
> d a match (76,649)
.         // This is the highest match rate I get acr
> oss customer type (followed by "market")
.         // "Market" is a srange one, decent match r
> ate but I'm unsure about their quality
. keep if ctype == "MARKET" | ctype == "COMPANY"
(412,607 observations deleted)

. foreach v of varlist ctype comp gvkey? conm? n _mer
> ge{
  2.         rename `v' `v'_customer
  3.         }

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/
> T//SD00936.000000"

. compress
  variable year was float now int
  variable n_customer was float now int
  variable ctype_customer was str8 now str7
  variable comp_customer was str50 now str46
  variable conm1_customer was str30 now str28
  variable conm2_customer was str30 now str28
  variable conm3_customer was str30 now str27
  variable conm4_customer was str30 now str24
  variable conm5_customer was str30 now str22
  (11,976,240 bytes saved)

. save "$data/${doNum}_fullNet.dta", replace
file /Users/ios/Documents/GitHub/mres_paper/data/001_
> network/003_fullNet.dta saved

. 
. *Keeping matched customer
. keep if _merge_customer == 3
(314,383 observations deleted)

. 
end of do-file

. tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       1976 |         68        0.08        0.08
       1977 |        334        0.39        0.47
       1978 |        651        0.77        1.24
       1979 |        682        0.80        2.05
       1980 |        720        0.85        2.89
       1981 |        731        0.86        3.76
       1982 |        772        0.91        4.67
       1983 |        933        1.10        5.77
       1984 |      1,049        1.24        7.00
       1985 |      1,235        1.46        8.46
       1986 |      1,366        1.61       10.07
       1987 |      1,423        1.68       11.75
       1988 |      1,334        1.57       13.32
       1989 |      1,368        1.61       14.93
       1990 |      1,412        1.66       16.60
       1991 |      1,522        1.79       18.39
       1992 |      1,604        1.89       20.28
       1993 |      1,734        2.04       22.33
       1994 |      1,833        2.16       24.49
       1995 |      1,986        2.34       26.83
       1996 |      2,017        2.38       29.21
       1997 |      1,801        2.12       31.33
       1998 |      1,773        2.09       33.42
       1999 |      2,032        2.40       35.81
       2000 |      2,585        3.05       38.86
       2001 |      2,559        3.02       41.88
       2002 |      2,634        3.11       44.98
       2003 |      2,584        3.05       48.03
       2004 |      2,541        3.00       51.03
       2005 |      2,893        3.41       54.44
       2006 |      2,840        3.35       57.78
       2007 |      2,844        3.35       61.14
       2008 |      2,876        3.39       64.53
       2009 |      2,984        3.52       68.05
       2010 |      3,000        3.54       71.58
       2011 |      3,006        3.54       75.13
       2012 |      3,094        3.65       78.77
       2013 |      3,162        3.73       82.50
       2014 |      3,153        3.72       86.22
       2015 |      3,029        3.57       89.79
       2016 |      3,049        3.59       93.38
       2017 |      2,927        3.45       96.83
       2018 |      2,657        3.13       99.97
       2019 |         28        0.03      100.00
------------+-----------------------------------
      Total |     84,825      100.00

. di 1976*3
5928

. di 1976/3
658.66667

. di 658*3
1974

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/
> T//SD00936.000000"

. gen year3 = floor(year/3)*3+3                      
>                                                    
>                           // so that 1976, 1977 and
>  1978 are grouped in year3 = 1977

. 
end of do-file

. tab year year3 if year<=1978

           |         year3
      year |      1977       1980 |     Total
-----------+----------------------+----------
      1976 |        68          0 |        68 
      1977 |         0        334 |       334 
      1978 |         0        651 |       651 
-----------+----------------------+----------
     Total |        68        985 |     1,053 

. di 1976/3
658.66667

. di 1977/3
659

. drop year3

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. gen year3 = floor((year-2)/3)*3+3                                             
>                                                           // so that 1976, 197
> 7 and 1978 are grouped in year3 = 1977

. 
end of do-file

. tab year year3 if year<=1978

           |   year3
      year |      1977 |     Total
-----------+-----------+----------
      1976 |        68 |        68 
      1977 |       334 |       334 
      1978 |       651 |       651 
-----------+-----------+----------
     Total |     1,053 |     1,053 

. sort gvkey_supplier

. sort conm_supplier

. sort sales_supplier

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T
> //SD00936.000000"

. import delimited "$orig/compustat_segment_customer_7
> 6_19.csv", clear
(16 vars, 549,451 obs)

. 
end of do-file

. sort conm

. use "$data/${doNum}_fullNet.dta", clear

. sort conm1_customer

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T
> //SD00936.000000"

. keep if _merge_customer == 3
(314,383 observations deleted)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T
> //SD00936.000000"

. gen year3 = floor((year-2)/3)*3+3                   
>                                                     
>                                 // so that 1976, 197
> 7 and 1978 are grouped in year3 = 1977

. 
end of do-file

. tab comp_customer if gvkey1 == 100737

                          comp_customer |      Freq.  
>    Percent        Cum.
----------------------------------------+-------------
> ----------------------
                               VOLKSWEN |        204  
>     100.00      100.00
----------------------------------------+-------------
> ----------------------
                                  Total |        204  
>     100.00

. tab gvkey1 if conm1 == "VOLKSWAGEN AG"

    1 gvkey |      Freq.     Percent        Cum.
------------+-----------------------------------
     100737 |        204      100.00      100.00
------------+-----------------------------------
      Total |        204      100.00

. tab conm if conm1 == "VOLKSWAGEN AG"

                                   conm |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                             VOLKSWAGEN |         19        9.31        9.31
                    VOLKSWAGEN AG  -ADR |         34       16.67       25.98
                             Volkswagen |          6        2.94       28.92
                          Volkswagen AG |         13        6.37       35.29
                    Volkswagen AG  -ADR |         31       15.20       50.49
                          Volkswagen Ag |         83       40.69       91.18
                    Volkswagen Ag  -ADR |          1        0.49       91.67
                    Volkswagen Ag  -Adr |          2        0.98       92.65
                       Volkswagen Group |         15        7.35      100.00
----------------------------------------+-----------------------------------
                                  Total |        204      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//
> SD00936.000000"

. rename conm conm_customer

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//
> SD00936.000000"

. import delimited "$orig/compustat_segment_customer_76_
> 19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//
> SD00936.000000"

. merge m:1 gvkey year using "$data/${doNum}_allComp.dta
> "

    Result                           # of obs.
    -----------------------------------------
    not matched                       277,458
        from master                    14,196  (_merge==
> 1)
        from using                    263,262  (_merge==
> 2)

    matched                           535,255  (_merge==
> 3)
    -----------------------------------------

. keep if year>1975
(29,153 observations deleted)

. 
. *mergining in clean customer data
. drop cid gareac gareat sid stype srcdate tic cusip cik

. foreach v of varlist gvkey salecs conm sic naics comp 
> sales _merge{
  2.         rename `v' `v'_supplier
  3.         }

. rename cnms conm

. do "$code/mres_xxx_cleanCompNames"

. 
. /*****************************************************
> **************************
>         
>         DESCRIPTION:    Cleaning company names -> Givi
> ng somewhat homogeneous names
>                                         across dataset
> s
>         
>         INFILES:        - any string variable with the
>  name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> ******************************************************
> *************************/
. 
. gen comp = conm
(262,060 missing values generated)

. replace comp = upper(comp)
(371,467 real changes made)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(24,270 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(1,468 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(2,481 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(139 real changes made)

. replace comp=subinword(comp,"CO","",.)
(11,938 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(32,716 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(296 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(5,891 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(34,294 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(1,910 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(7,649 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(4,080 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(1,853 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,332 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,392 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(529 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(810 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(13,696 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(943 real changes made)

. replace comp=trim(comp)
(64,169 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(14 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(3,127 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,373 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(342 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF F
> REIGHT",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(9 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(1,879 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(895 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(3,518 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(1,024 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(58 real changes made)

. replace comp=trim(comp)
(7,518 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM
> ",.)
(682 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(706 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(2,051 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","A
> MD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(2,191 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(5 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNO
> LOGY",.)
(10 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMI
> CALS",.)
(12 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COM
> MUNICATIONS",.)
(11 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(10,470 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(1,848 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,180 real changes made)

. replace comp=subinstr(comp," & ","",.)
(11,719 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(1,145 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(1,308 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(2,174 real changes made)

. replace comp=trim(comp)
(3,578 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(13,423 real changes made)

. replace comp=subinstr(comp,".","",.)
(18,563 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(0 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(1,114 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(188 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",
> .)
(10 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(127 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(1,486 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,148 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(8 real changes made)

. replace comp=trim(comp)
(10,039 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(926 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(1,223 real changes made)

. replace comp=subinstr(comp,"(","",.)
(5,832 real changes made)

. replace comp=subinstr(comp,")","",.)
(5,812 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(776 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(8 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(8 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(208 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(24 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(4,778 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(716 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(889 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(313 real changes made)

. replace comp=trim(comp)
(28 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND"
> ,.)
(21 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(2,650 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(23 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(268 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(342 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&ST
> RN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(125 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(109 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(99 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(53 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(36 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(888 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(558 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(155 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(138 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(278 real changes made)

. replace comp=trim(comp)
(2,414 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(967 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(134 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(120 real changes made)

. replace comp=trim(comp)
(1,101 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(1,857 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DU
> PONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(70 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(189 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(622 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,110 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,225 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(3 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(127 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(47 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(4 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(113 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",
> .)
(148 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(432 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(1 real change made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(5 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(2 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(33 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(7,188 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(86 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(85 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(10,240 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(407 real changes made)

. replace comp=trim(comp)
(3,256 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(5,282 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(89 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(5,334 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(883 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(66 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE
> ",.)
(5 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(27 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(191 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(756 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(13,023 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(48 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(335 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.
> )
(40 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(219 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(19 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(236 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(852 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,001 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(5,972 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(10,841 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(58 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(4,019 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(33 real changes made)

. replace comp=trim(comp)
(5,737 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(456 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(77 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(399 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(9 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(1,599 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(275 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(20 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(195 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(1,334 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(13,361 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(42 real changes made)

. replace comp=subinword(comp,"W","",.)
(95 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(36 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(668 real changes made)

. replace comp=subinword(comp,"SP","",.)
(212 real changes made)

. replace comp=trim(comp)
(938 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(546 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(111 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(2 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(3 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(18 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(1 real change made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(77 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(16 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(7 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(10 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(20 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(622 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(0 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(424 real changes made)

. replace comp=trim(comp)
(375 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(165 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(15 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(127 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJH
> NS",.)
(136 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(152 real changes made)

. replace comp=subinword(comp,"A","",.)
(610 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(67 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(12 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(5 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(11,389 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(2,976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER
> ",.)
(362 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(565 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(300 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(1,277 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(181 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(1,316 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(7 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(16 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(2 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(1 real change made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.
> )
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(1,748 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS"
> ,"DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(0 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-
> BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEE
> D",.)
(329 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.
> )
(91 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(1,599 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(225 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(86 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(82 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHR
> OP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES 
> COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(0 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(3,045 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)             
>                                                       
>     //BLUNT way of improving match, remove white space
(356,115 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUS
> T" " CO"{
>         replace toClean = subinstr(toClean, " `word'",
>  "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") 
> gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (
> 2011)
> */
. 
. 
. 
. 
. 
end of do-file

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//
> SD00936.000000"

. merge m:1 comp year using "$data/${doNum}_allcomp.dta"
variables comp year do not uniquely identify
    observations in the using data
r(459);

end of do-file

r(459);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. import delimited "$orig/compustat_quarterly_61_19.csv", clear
(26 vars, 1,592,184 obs)

. keep gvkey fyearq conm saleq sic

. gcollapse (sum) saleq (firstnm) gvkey, by(fyearq conm sic)                 
>                              // using firstnm as TELECOM ITALIA has two for
>  the years 2001-2003

. duplicates tag conm fyear, gen(tag)

Duplicates in terms of conm fyearq

. tab tag                                                                    
>                                                                            
>   // 0 duplicates, good

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    413,396      100.00      100.00
------------+-----------------------------------
      Total |    413,396      100.00

. rename fyearq year

. do "$code/mres_xxx_cleanCompNames"

. 
. /**************************************************************************
> *****
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat homogeneo
> us names
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> ***************************************************************************
> ****/
. 
. gen comp = conm

. replace comp = upper(comp)
(0 real changes made)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(101,518 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(603 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(147 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(851 real changes made)

. replace comp=subinword(comp,"CO","",.)
(27,604 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(187,645 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(882 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(7,553 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(35,918 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(5,480 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(12,885 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(1,590 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(469 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,102 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,122 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(105 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(430 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(2,366 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(7,118 real changes made)

. replace comp=trim(comp)
(291,215 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(15,795 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,614 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(6 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(6 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(4,032 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(10,130 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(2,065 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(10,596 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(86 real changes made)

. replace comp=trim(comp)
(27,084 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(186 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(7,418 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(3,497 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(4,711 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(8 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(0 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(6,877 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(3,525 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,332 real changes made)

. replace comp=subinstr(comp," & ","",.)
(12,000 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(2,502 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(2,315 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(1,483 real changes made)

. replace comp=trim(comp)
(12,271 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(8,978 real changes made)

. replace comp=subinstr(comp,".","",.)
(3,366 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(47 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(12,823 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(4,771 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(6 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(210 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(5,150 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,077 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(191 real changes made)

. replace comp=trim(comp)
(8,214 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(1,192 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(231 real changes made)

. replace comp=subinstr(comp,"(","",.)
(4,147 real changes made)

. replace comp=subinstr(comp,")","",.)
(4,147 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(953 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(37 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(56 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(182 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(6 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(245 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(321 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(82 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(1,214 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(1,738 real changes made)

. replace comp=trim(comp)
(32 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(25 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(1,575 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(0 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(896 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(431 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(58 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(0 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(246 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(69 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(135 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(9,508 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(505 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(184 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(188 real changes made)

. replace comp=trim(comp)
(1,116 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(43 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(128 real changes made)

. replace comp=trim(comp)
(43 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(7,248 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(11 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(833 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(1,230 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,068 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,388 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(6 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(841 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(102 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(261 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(210 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(3,873 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(0 real changes made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(31 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(14 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(58 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(5,630 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(40 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(368 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(12,248 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(436 real changes made)

. replace comp=trim(comp)
(2,486 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(3,419 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(407 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(2,927 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(2,585 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(184 real changes made)

. replace comp=trim(comp)
(7 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(68 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(184 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(2,322 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(14,144 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(0 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(1,280 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(0 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(1,478 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(156 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(296 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(859 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,688 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(2,183 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(6,692 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(203 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(1,994 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(233 real changes made)

. replace comp=trim(comp)
(12,396 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(623 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(74 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(540 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(0 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(324 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(82 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(54 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(219 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(341 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(26 real changes made)

. replace comp=subinstr(comp,",","",.)
(0 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(0 real changes made)

. replace comp=subinword(comp,"W","",.)
(218 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(52 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(601 real changes made)

. replace comp=subinword(comp,"SP","",.)
(2,055 real changes made)

. replace comp=trim(comp)
(331 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(17 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(310 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(60 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(28 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(0 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(0 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(21 real changes made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(84 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(48 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(50 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(115 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(152 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(318 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(7 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(1,837 real changes made)

. replace comp=trim(comp)
(1,823 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(184 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(0 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(169 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(57 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(1,073 real changes made)

. replace comp=subinword(comp,"A","",.)
(1,423 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(700 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(45 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(65 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(17,456 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(0 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(1,027 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(82 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(504 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(357 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(36 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(186 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(85 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(51 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(747 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(35 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(58 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(0 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(3,484 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(93 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(52 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(28 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(88 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(2,149 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                  
>                                      //BLUNT way of improving match, remove
>  white space
(295,952 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. gcollapse (sum) saleq (firstnm) gvkey, by(year comp sic)                   
>                              //very few firms are being collapsed together 
> after the cleaning, which is a good sign

. sort year comp

. hist year, discrete
(start=1961, width=1)

. rename saleq sales

. compress
  variable comp was str30 now str27
  (1,235,529 bytes saved)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. duplicates tag comp year, gen(tag)

Duplicates in terms of comp year

. 
end of do-file

. tab tag

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    408,250       99.13       99.13
          1 |      3,508        0.85       99.98
          2 |         81        0.02      100.00
          3 |          4        0.00      100.00
------------+-----------------------------------
      Total |    411,843      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. drop if tag!=0                                                             
>                                                                      // 99.
> 13% of unique firm*year records
(3,593 observations deleted)

. drop tag

. 
. save "$data/${doNum}_allComp.dta", replace 
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allComp.dta 
> saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. merge m:1 gvkey year using "$data/${doNum}_allComp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       279,468
        from master                    18,445  (_merge==1)
        from using                    261,023  (_merge==2)

    matched                           531,006  (_merge==3)
    -----------------------------------------

. keep if year>1975
(28,855 observations deleted)

. 
. *mergining in clean customer data
. drop cid gareac gareat sid stype srcdate tic cusip cik

. foreach v of varlist gvkey salecs conm sic naics comp sales _merge{
  2.         rename `v' `v'_supplier
  3.         }

. rename cnms conm

. do "$code/mres_xxx_cleanCompNames"

. 
. /**************************************************************************
> *****
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat homogeneo
> us names
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> ***************************************************************************
> ****/
. 
. gen comp = conm
(260,119 missing values generated)

. replace comp = upper(comp)
(371,467 real changes made)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(24,270 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(1,468 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(2,481 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(139 real changes made)

. replace comp=subinword(comp,"CO","",.)
(11,938 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(32,716 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(296 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(5,891 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(34,294 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(1,910 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(7,649 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(4,080 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(1,853 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,332 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,392 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(529 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(810 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(13,696 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(943 real changes made)

. replace comp=trim(comp)
(64,169 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(14 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(3,127 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,373 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(342 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(9 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(1,879 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(895 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(3,518 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(1,024 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(58 real changes made)

. replace comp=trim(comp)
(7,518 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(682 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(706 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(2,051 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(2,191 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(5 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(10 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(12 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(11 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(10,470 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(1,848 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,180 real changes made)

. replace comp=subinstr(comp," & ","",.)
(11,719 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(1,145 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(1,308 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(2,174 real changes made)

. replace comp=trim(comp)
(3,578 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(13,423 real changes made)

. replace comp=subinstr(comp,".","",.)
(18,563 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(0 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(1,114 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(188 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(10 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(127 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(1,486 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,148 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(8 real changes made)

. replace comp=trim(comp)
(10,039 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(926 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(1,223 real changes made)

. replace comp=subinstr(comp,"(","",.)
(5,832 real changes made)

. replace comp=subinstr(comp,")","",.)
(5,812 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(776 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(8 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(8 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(208 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(24 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(4,778 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(716 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(889 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(313 real changes made)

. replace comp=trim(comp)
(28 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(21 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(2,650 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(23 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(268 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(342 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(125 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(109 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(99 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(53 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(36 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(888 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(558 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(155 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(138 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(278 real changes made)

. replace comp=trim(comp)
(2,414 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(967 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(134 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(120 real changes made)

. replace comp=trim(comp)
(1,101 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(1,857 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(70 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(189 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(622 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,110 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,225 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(3 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(127 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(47 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(4 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(113 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(148 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(432 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(1 real change made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(5 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(2 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(33 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(7,188 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(86 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(85 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(10,240 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(407 real changes made)

. replace comp=trim(comp)
(3,256 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(5,282 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(89 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(5,334 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(883 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(66 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(27 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(191 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(756 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(13,023 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(48 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(335 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(40 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(219 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(19 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(236 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(852 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,001 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(5,972 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(10,841 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(58 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(4,019 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(33 real changes made)

. replace comp=trim(comp)
(5,737 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(456 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(77 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(399 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(9 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(1,599 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(275 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(20 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(195 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(1,334 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(13,361 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(42 real changes made)

. replace comp=subinword(comp,"W","",.)
(95 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(36 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(668 real changes made)

. replace comp=subinword(comp,"SP","",.)
(212 real changes made)

. replace comp=trim(comp)
(938 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(546 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(111 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(2 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(3 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(18 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(1 real change made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(77 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(16 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(7 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(10 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(20 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(622 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(0 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(424 real changes made)

. replace comp=trim(comp)
(375 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(165 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(15 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(127 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(136 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(152 real changes made)

. replace comp=subinword(comp,"A","",.)
(610 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(67 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(12 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(5 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(11,389 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(2,976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(362 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(565 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(300 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(1,277 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(181 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(1,316 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(7 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(16 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(2 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(1 real change made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(1,748 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(0 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(329 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(91 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(1,599 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(225 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(86 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(82 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(0 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(3,045 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                  
>                                      //BLUNT way of improving match, remove
>  white space
(356,115 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. merge m:1 comp year using "$data/${doNum}_allcomp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       916,696
        from master                   527,368  (_merge==1)
        from using                    389,328  (_merge==2)

    matched                           254,251  (_merge==3)
    -----------------------------------------

. 
end of do-file

. tab ctype _merge, mi

           |              _merge
     ctype | master on  using onl  matched ( |     Total
-----------+---------------------------------+----------
           |    65,408    389,328    166,760 |   621,496 
   COMPANY |   249,755          0     66,171 |   315,926 
    GEOREG |   100,771          0      6,954 |   107,725 
    GOVDOM |    23,760          0     12,323 |    36,083 
    GOVFRN |     3,651          0      1,014 |     4,665 
    GOVLOC |       542          0          0 |       542 
  GOVSTATE |     1,227          0          1 |     1,228 
    MARKET |    82,254          0      1,028 |    83,282 
-----------+---------------------------------+----------
     Total |   527,368    389,328    254,251 | 1,170,947 

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. tab ctype _merge, mi row 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |              _merge
     ctype | master on  using onl  matched ( |     Total
-----------+---------------------------------+----------
           |    65,408    389,328    166,760 |   621,496 
           |     10.52      62.64      26.83 |    100.00 
-----------+---------------------------------+----------
   COMPANY |   249,755          0     66,171 |   315,926 
           |     79.05       0.00      20.95 |    100.00 
-----------+---------------------------------+----------
    GEOREG |   100,771          0      6,954 |   107,725 
           |     93.54       0.00       6.46 |    100.00 
-----------+---------------------------------+----------
    GOVDOM |    23,760          0     12,323 |    36,083 
           |     65.85       0.00      34.15 |    100.00 
-----------+---------------------------------+----------
    GOVFRN |     3,651          0      1,014 |     4,665 
           |     78.26       0.00      21.74 |    100.00 
-----------+---------------------------------+----------
    GOVLOC |       542          0          0 |       542 
           |    100.00       0.00       0.00 |    100.00 
-----------+---------------------------------+----------
  GOVSTATE |     1,227          0          1 |     1,228 
           |     99.92       0.00       0.08 |    100.00 
-----------+---------------------------------+----------
    MARKET |    82,254          0      1,028 |    83,282 
           |     98.77       0.00       1.23 |    100.00 
-----------+---------------------------------+----------
     Total |   527,368    389,328    254,251 | 1,170,947 
           |     45.04      33.25      21.71 |    100.00 

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. merge m:1 gvkey year using "$data/${doNum}_allComp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       279,468
        from master                    18,445  (_merge==1)
        from using                    261,023  (_merge==2)

    matched                           531,006  (_merge==3)
    -----------------------------------------

. keep if year>1975
(28,855 observations deleted)

. 
. *mergining in clean customer data
. drop cid gareac gareat sid stype srcdate tic cusip cik

. foreach v of varlist gvkey salecs conm sic naics comp sales _merge{
  2.         rename `v' `v'_supplier
  3.         }

. rename cnms conm

. do "$code/mres_xxx_cleanCompNames"

. 
. /*******************************************************************************
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat homogeneous name
> s
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *******************************************************************************/
. 
. gen comp = conm
(260,119 missing values generated)

. replace comp = upper(comp)
(371,467 real changes made)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(24,270 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(1,468 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(2,481 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(139 real changes made)

. replace comp=subinword(comp,"CO","",.)
(11,938 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(32,716 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(296 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(5,891 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(34,294 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(1,910 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(7,649 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(4,080 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(1,853 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,332 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,392 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(529 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(810 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(13,696 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(943 real changes made)

. replace comp=trim(comp)
(64,169 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(14 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(3,127 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,373 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(342 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(9 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(1,879 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(895 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(3,518 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(1,024 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(58 real changes made)

. replace comp=trim(comp)
(7,518 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(682 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(706 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(2,051 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(2,191 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(5 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(10 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(12 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",.)
(11 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(10,470 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(1,848 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,180 real changes made)

. replace comp=subinstr(comp," & ","",.)
(11,719 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(1,145 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(1,308 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(2,174 real changes made)

. replace comp=trim(comp)
(3,578 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(13,423 real changes made)

. replace comp=subinstr(comp,".","",.)
(18,563 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(0 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(1,114 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(188 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(10 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(127 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(1,486 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,148 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(8 real changes made)

. replace comp=trim(comp)
(10,039 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(926 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(1,223 real changes made)

. replace comp=subinstr(comp,"(","",.)
(5,832 real changes made)

. replace comp=subinstr(comp,")","",.)
(5,812 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(776 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(8 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(8 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(208 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(24 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(4,778 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(716 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(889 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(313 real changes made)

. replace comp=trim(comp)
(28 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(21 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(2,650 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(23 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(268 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(342 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(125 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(109 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(99 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(53 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(36 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(888 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(558 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(155 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(138 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(278 real changes made)

. replace comp=trim(comp)
(2,414 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(967 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(134 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(120 real changes made)

. replace comp=trim(comp)
(1,101 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(1,857 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(70 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(189 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(622 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,110 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,225 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(3 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(127 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(47 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(4 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(113 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(148 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(432 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(1 real change made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(5 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(2 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(33 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(7,188 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(86 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(85 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(10,240 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(407 real changes made)

. replace comp=trim(comp)
(3,256 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(5,282 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(89 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(5,334 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(883 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(66 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(27 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(191 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(756 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(13,023 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(48 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(335 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(40 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(219 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(19 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(236 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(852 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,001 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(5,972 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(10,841 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(58 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(4,019 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(33 real changes made)

. replace comp=trim(comp)
(5,737 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(456 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(77 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(399 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(9 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(1,599 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(275 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(20 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(195 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(1,334 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(13,361 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(42 real changes made)

. replace comp=subinword(comp,"W","",.)
(95 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(36 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(668 real changes made)

. replace comp=subinword(comp,"SP","",.)
(212 real changes made)

. replace comp=trim(comp)
(938 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(546 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(111 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(2 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(3 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(18 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(1 real change made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(77 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(16 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(7 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(10 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(20 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(622 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(0 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(424 real changes made)

. replace comp=trim(comp)
(375 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(165 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(15 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(127 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(136 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(152 real changes made)

. replace comp=subinword(comp,"A","",.)
(610 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(67 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(12 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(5 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(11,389 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(2,976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(362 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(565 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(300 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(1,277 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(181 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(1,316 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(7 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(16 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(2 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(1 real change made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(1,748 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(0 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(329 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(91 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(1,599 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(225 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(86 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(82 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(0 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(3,045 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                                         
>                               //BLUNT way of improving match, remove white space
(356,115 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. merge 1:1 comp year using "$data/${doNum}_allcomp.dta"
variables comp year do not uniquely identify observations in the master data
r(459);

end of do-file

r(459);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. merge m:1 comp year using "$data/${doNum}_allcomp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       916,696
        from master                   527,368  (_merge==1)
        from using                    389,328  (_merge==2)

    matched                           254,251  (_merge==3)
    -----------------------------------------

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. tab ctype _merge, mi row 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |              _merge
     ctype | master on  using onl  matched ( |     Total
-----------+---------------------------------+----------
           |    65,408    389,328    166,760 |   621,496 
           |     10.52      62.64      26.83 |    100.00 
-----------+---------------------------------+----------
   COMPANY |   249,755          0     66,171 |   315,926 
           |     79.05       0.00      20.95 |    100.00 
-----------+---------------------------------+----------
    GEOREG |   100,771          0      6,954 |   107,725 
           |     93.54       0.00       6.46 |    100.00 
-----------+---------------------------------+----------
    GOVDOM |    23,760          0     12,323 |    36,083 
           |     65.85       0.00      34.15 |    100.00 
-----------+---------------------------------+----------
    GOVFRN |     3,651          0      1,014 |     4,665 
           |     78.26       0.00      21.74 |    100.00 
-----------+---------------------------------+----------
    GOVLOC |       542          0          0 |       542 
           |    100.00       0.00       0.00 |    100.00 
-----------+---------------------------------+----------
  GOVSTATE |     1,227          0          1 |     1,228 
           |     99.92       0.00       0.08 |    100.00 
-----------+---------------------------------+----------
    MARKET |    82,254          0      1,028 |    83,282 
           |     98.77       0.00       1.23 |    100.00 
-----------+---------------------------------+----------
     Total |   527,368    389,328    254,251 | 1,170,947 
           |     45.04      33.25      21.71 |    100.00 

. 
end of do-file

. br if _merge == 3 & ctype == ""

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. keep if ctype == "MARKET" | ctype == "COMPANY"
(771,739 observations deleted)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. import delimited "$orig/compustat_quarterly_61_19.csv", clear
(26 vars, 1,592,184 obs)

. keep gvkey fyearq conm saleq sic

. gcollapse (sum) saleq (firstnm) gvkey, by(fyearq conm sic)         
>                                      // using firstnm as TELECOM IT
> ALIA has two for the years 2001-2003

. duplicates tag conm fyear, gen(tag)

Duplicates in terms of conm fyearq

. tab tag                                                            
>                                                                    
>                   // 0 duplicates, good

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    413,396      100.00      100.00
------------+-----------------------------------
      Total |    413,396      100.00

. rename fyearq year

. do "$code/mres_xxx_cleanCompNames"

. 
. /******************************************************************
> *************
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat h
> omogeneous names
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *******************************************************************
> ************/
. 
. gen comp = conm

. replace comp = upper(comp)
(0 real changes made)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(101,518 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(603 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(147 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(851 real changes made)

. replace comp=subinword(comp,"CO","",.)
(27,604 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(187,645 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(882 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(7,553 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(35,918 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(5,480 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(12,885 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(1,590 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(469 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,102 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,122 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(105 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(430 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(2,366 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(7,118 real changes made)

. replace comp=trim(comp)
(291,215 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(15,795 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,614 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(6 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(6 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(4,032 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(10,130 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(2,065 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(10,596 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(86 real changes made)

. replace comp=trim(comp)
(27,084 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(186 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(7,418 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(3,497 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(4,711 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(8 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",
> .)
(0 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(6,877 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(3,525 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,332 real changes made)

. replace comp=subinstr(comp," & ","",.)
(12,000 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(2,502 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(2,315 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(1,483 real changes made)

. replace comp=trim(comp)
(12,271 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(8,978 real changes made)

. replace comp=subinstr(comp,".","",.)
(3,366 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(47 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(12,823 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(4,771 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(6 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(210 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(5,150 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,077 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(191 real changes made)

. replace comp=trim(comp)
(8,214 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(1,192 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(231 real changes made)

. replace comp=subinstr(comp,"(","",.)
(4,147 real changes made)

. replace comp=subinstr(comp,")","",.)
(4,147 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(953 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(37 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(56 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(182 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(6 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(245 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(321 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(82 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(1,214 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(1,738 real changes made)

. replace comp=trim(comp)
(32 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(25 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(1,575 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(0 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(896 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(431 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(58 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(0 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(246 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(69 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(135 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(9,508 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(505 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(184 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(0 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(188 real changes made)

. replace comp=trim(comp)
(1,116 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(0 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(43 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(128 real changes made)

. replace comp=trim(comp)
(43 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(7,248 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(11 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(833 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(1,230 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,068 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,388 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(6 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(841 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(102 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(261 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(210 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(3,873 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(0 real changes made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(31 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(14 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(58 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(5,630 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(40 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(368 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(12,248 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(436 real changes made)

. replace comp=trim(comp)
(2,486 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(3,419 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(407 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(2,927 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(2,585 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(184 real changes made)

. replace comp=trim(comp)
(7 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(0 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(68 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(184 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(2,322 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(14,144 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(0 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(1,280 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(0 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(1,478 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(156 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(296 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(859 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,688 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(2,183 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(6,692 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(203 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(1,994 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(233 real changes made)

. replace comp=trim(comp)
(12,396 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(623 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(74 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(540 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(0 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(324 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(82 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(54 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(219 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(341 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(26 real changes made)

. replace comp=subinstr(comp,",","",.)
(0 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(0 real changes made)

. replace comp=subinword(comp,"W","",.)
(218 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(52 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(601 real changes made)

. replace comp=subinword(comp,"SP","",.)
(2,055 real changes made)

. replace comp=trim(comp)
(331 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(17 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(310 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(60 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(28 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(0 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(0 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(21 real changes made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(84 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(48 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(50 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(115 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(152 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(318 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(7 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(1,837 real changes made)

. replace comp=trim(comp)
(1,823 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(184 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(0 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(169 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(57 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(1,073 real changes made)

. replace comp=subinword(comp,"A","",.)
(1,423 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(700 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(45 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(65 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(17,456 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(0 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(1,027 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(82 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(504 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(357 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(36 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(186 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(85 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(51 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(747 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)
> ",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(35 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(58 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(0 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(3,484 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(93 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(52 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(28 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(88 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(2,149 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                          
>                                              //BLUNT way of improvi
> ng match, remove white space
(295,952 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. gcollapse (sum) saleq (firstnm) gvkey conm, by(year comp sic)      
>                                      //very few firms are being col
> lapsed together after the cleaning, which is a good sign
'conm' found where numeric variable expected
r(7);

end of do-file

r(7);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. gcollapse (sum) saleq (firstnm) gvkey (firstnm) conm, by(year comp 
> sic)                                         //very few firms are b
> eing collapsed together after the cleaning, which is a good sign
'conm' found where numeric variable expected
r(7);

end of do-file

r(7);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. collapse (sum) saleq (firstnm) gvkey (firstnm) conm, by(year comp s
> ic)  fast    //very few firms are being collapsed together after th
> e cleaning, which is a good sign

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. sort year comp

. hist year, discrete
(start=1961, width=1)

. rename saleq sales

. compress
  variable comp was str30 now str27
  (1,235,529 bytes saved)

. 
. duplicates tag comp year, gen(tag)

Duplicates in terms of comp year

. drop if tag!=0                                                     
>                                                                    
>           // 99.13% of unique firm*year records
(3,593 observations deleted)

. drop tag

. 
. save "$data/${doNum}_allComp.dta", replace 
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_allC
> omp.dta saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clea
> r
(16 vars, 549,451 obs)

. gen year = floor(srcdate/10000)

. merge m:1 gvkey year using "$data/${doNum}_allComp.dta"
(note: variable conm was str29, now str30 to accommodate using
       data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                       279,468
        from master                    18,445  (_merge==1)
        from using                    261,023  (_merge==2)

    matched                           531,006  (_merge==3)
    -----------------------------------------

. keep if year>1975
(28,855 observations deleted)

. 
. *mergining in clean customer data
. drop cid gareac gareat sid stype srcdate tic cusip cik

. foreach v of varlist gvkey salecs conm sic naics comp sales _merge{
  2.         rename `v' `v'_supplier
  3.         }

. rename cnms conm

. do "$code/mres_xxx_cleanCompNames"

. 
. /******************************************************************
> *************
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat h
> omogeneous names
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> *******************************************************************
> ************/
. 
. gen comp = conm
(260,119 missing values generated)

. replace comp = upper(comp)
(371,467 real changes made)

. 
. *1st round
. replace comp=subinstr(comp,"CORP","",.)
(24,270 real changes made)

. replace comp=subinstr(comp,"COMPANIES","",.)
(1,468 real changes made)

. replace comp=subinstr(comp,"COMPANY","",.)
(2,481 real changes made)

. replace comp=subinstr(comp,"CONSOLIDATED","",.)
(139 real changes made)

. replace comp=subinword(comp,"CO","",.)
(11,938 real changes made)

. replace comp=subinstr(comp,"INC","",.)
(32,716 real changes made)

. replace comp=subinstr(comp,"LABORATORIES","LAB",.)
(296 real changes made)

. replace comp=subinstr(comp,"/"," ",.)
(5,891 real changes made)

. replace comp=subinstr(comp,"-"," ",.)
(34,294 real changes made)

. replace comp=subinstr(comp,"LP","",.)
(1,910 real changes made)

. replace comp=subinstr(comp,"LTD","",.)
(7,649 real changes made)

. replace comp=subinword(comp,"STORES","",.)
(4,080 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(1,853 real changes made)

. replace comp=subinstr(comp,"GENERAL","GENL",.)
(2,332 real changes made)

. replace comp=subinstr(comp,"GENL","GEN",.)
(2,392 real changes made)

. replace comp=subinword(comp,"MOBIL","",.)
(529 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(810 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(13,696 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(943 real changes made)

. replace comp=trim(comp)
(64,169 real changes made)

. 
. *2nd
. replace comp=subinstr(comp,"A T & T","AT&T",.)
(14 real changes made)

. replace comp=subinstr(comp,"GROUP","",.)
(3,127 real changes made)

. replace comp=subinstr(comp,"HEALTHCARE","HTHCR",.)
(1,373 real changes made)

. replace comp=subinstr(comp,"SPON ADR","",.)
(342 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT SYSTEM","ABF FREIGHT",.)
(0 real changes made)

. replace comp=subinstr(comp,"ABF FREIGHT","ABF",.)
(9 real changes made)

. replace comp=subinstr(comp,"PLC","",.)
(1,879 real changes made)

. replace comp=subinstr(comp,"HOLDINGS","",.)
(895 real changes made)

. replace comp=subinstr(comp,"ADR","",.)
(3,518 real changes made)

. replace comp=subinstr(comp,"INDUSTRIES","IND",.)
(1,024 real changes made)

. replace comp=subinstr(comp,"UNITED","UTD",.)
(58 real changes made)

. replace comp=trim(comp)
(7,518 real changes made)

. 
. *3rd
. replace comp=subinstr(comp,"TELECOMMUNICATIONS","TELEM",.)
(682 real changes made)

. replace comp=subinstr(comp,"CL A","",.)
(706 real changes made)

. replace comp=subinstr(comp,"MMUNICATIONS","MMUN",.)
(2,051 real changes made)

. replace comp=subinstr(comp,"ADVANCED MICRO DEVICES","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"ADV MICRO DV","AMD",.)
(0 real changes made)

. replace comp=subinstr(comp,"CP","",.)
(2,191 real changes made)

. replace comp=subinstr(comp,"CMPTRS","MPUTERS",.)
(5 real changes made)

. replace comp=subinstr(comp,"AHA BETA","AHA BETA TECHNOLOGY",.)
(10 real changes made)

. replace comp=subinstr(comp,"PRDS&CH","PRODUCTS & CHEMICALS",.)
(12 real changes made)

. replace comp=subinstr(comp,"AIRTOUCH CM","AIRTOUCH COMMUNICATIONS",
> .)
(11 real changes made)

. replace comp=subinstr(comp,"INTERNATIONAL","INTL",.)
(10,470 real changes made)

. replace comp=subinstr(comp,"POWER","PWR",.)
(1,848 real changes made)

. replace comp=subinstr(comp,"'","",.)
(2,180 real changes made)

. replace comp=subinstr(comp," & ","",.)
(11,719 real changes made)

. 
. *4th
. replace comp=subinword(comp,"SA","",.)
(1,145 real changes made)

. replace comp=subinstr(comp,"PRODUCTS","PROD",.)
(1,308 real changes made)

. replace comp=subinstr(comp,"ELECTRONICS","ELECT",.)
(2,174 real changes made)

. replace comp=trim(comp)
(3,578 real changes made)

. 
. *5th
. replace comp=subinstr(comp,"AMERICA","AMER",.)
(13,423 real changes made)

. replace comp=subinstr(comp,".","",.)
(18,563 real changes made)

. replace comp=subinstr(comp,"HYDRO ELECTRIC","HYD",.)
(0 real changes made)

. replace comp=subinstr(comp,"OLD","",.)
(1,114 real changes made)

. replace comp=subinstr(comp,"TRUST","TR",.)
(188 real changes made)

. replace comp=subinstr(comp,"BARCLAYS BANK","BARCLAYS",.)
(10 real changes made)

. replace comp=subinstr(comp," & ","&",.)
(0 real changes made)

. replace comp=subinstr(comp,"NOBLE","NOBL",.)
(127 real changes made)

. replace comp=subinstr(comp,"BANK","BK",.)
(1,486 real changes made)

. replace comp=subinstr(comp,"NEW","",.)
(3,148 real changes made)

. replace comp=subinstr(comp,"WRIGHT","WRGHT",.)
(8 real changes made)

. replace comp=trim(comp)
(10,039 real changes made)

. 
. *6th
. replace comp=subinstr(comp,"A G","AG",.)
(926 real changes made)

. replace comp=subinstr(comp,"AEROSPACE","AEROSPAC",.)
(1,223 real changes made)

. replace comp=subinstr(comp,"(","",.)
(5,832 real changes made)

. replace comp=subinstr(comp,")","",.)
(5,812 real changes made)

. replace comp=subinstr(comp,"L L","LL",.)
(776 real changes made)

. replace comp=subinstr(comp,"STEARNS","STRNS",.)
(8 real changes made)

. replace comp=subinstr(comp,"DICKINSON &","DICK",.)
(8 real changes made)

. replace comp=subinstr(comp,"AIRCRAFT","AIRCR",.)
(208 real changes made)

. replace comp=subinstr(comp,"AIRCRFT","AIRCR",.)
(24 real changes made)

. replace comp=subinstr(comp,"CANADA","CDA",.)
(4,778 real changes made)

. replace comp=subinstr(comp,"PROJECTED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"TELEM","TEL",.)
(716 real changes made)

. replace comp=subinstr(comp,"BETHLEHEM","BETHLHM",.)
(3 real changes made)

. replace comp=subinstr(comp,"STEEL","STL",.)
(889 real changes made)

. replace comp=subinstr(comp,"ENTERPRISES","ENT",.)
(313 real changes made)

. replace comp=trim(comp)
(28 real changes made)

. 
. *7th
. replace comp=subinstr(comp,"BIG THREE","BIG THREE IND",.)
(21 real changes made)

. replace comp=subinstr(comp,"LLC","",.)
(2,650 real changes made)

. replace comp=subinstr(comp,"BORG WARNER","",.)
(23 real changes made)

. replace comp=subinstr(comp,"SCIENTIFIC","SCI",.)
(268 real changes made)

. replace comp=subinstr(comp,"ADS","BP",.)
(342 real changes made)

. replace comp=subinstr(comp,"BRIGGS&STRATTON","BRIGG&STRN",.)
(0 real changes made)

. replace comp=subinstr(comp,"MYERS SQUIBB","MYRS",.)
(125 real changes made)

. replace comp=subinstr(comp,"CA CL","CA LA",.)
(109 real changes made)

. replace comp=subinstr(comp,"GOLF","GF",.)
(99 real changes made)

. replace comp=subinstr(comp,"SOUP","SP",.)
(53 real changes made)

. replace comp=subinstr(comp,"CAMPBELL","CAMPBL",.)
(36 real changes made)

. replace comp=subinstr(comp,"FINANCIAL","FINL",.)
(888 real changes made)

. replace comp=subinstr(comp,"NATURAL GAS","NAT",.)
(558 real changes made)

. replace comp=subinstr(comp,"CANADIAN","CDN",.)
(155 real changes made)

. replace comp=subinstr(comp,"AIRCFT","AIRC",.)
(138 real changes made)

. replace comp=subinstr(comp,"AIRCR","AIRC",.)
(278 real changes made)

. replace comp=trim(comp)
(2,414 real changes made)

. 
. *8th
. replace comp=subinstr(comp,"ROEBK","",.)
(967 real changes made)

. replace comp=subinstr(comp,"ROEBUCK &","",.)
(134 real changes made)

. replace comp=subinstr(comp,"AIR LINES","AIRL",.)
(120 real changes made)

. replace comp=trim(comp)
(1,101 real changes made)

. 
. *9th
. replace comp=subinstr(comp,"SYSTEMS","SYS",.)
(1,857 real changes made)

. replace comp=subinstr(comp,"DU PONT EI DE NEMOURS","DUPONT EI",.)
(0 real changes made)

. *replace comp=subinstr(comp,"EI","",.)
. replace comp=subinstr(comp,"PRO FORMA","",.)
(70 real changes made)

. replace comp=subinstr(comp,"CREDIT","CR",.)
(189 real changes made)

. replace comp=subinstr(comp,"LIGHT","LT",.)
(622 real changes made)

. replace comp=subinstr(comp,"CHEMICAL","CHEMICL",.)
(1,110 real changes made)

. replace comp=subinstr(comp,"&","",.)
(5,225 real changes made)

. replace comp=subinstr(comp,"DISCREET","DISCRT",.)
(3 real changes made)

. replace comp=subinstr(comp,"LOGIC","LGC",.)
(127 real changes made)

. replace comp=subinstr(comp,"TELEKOM","TELE",.)
(47 real changes made)

. replace comp=subinstr(comp,"TLKOM","TELE",.)
(4 real changes made)

. replace comp=subinstr(comp,"DEUTSCHE","DTSCH",.)
(113 real changes made)

. replace comp=subinstr(comp,"PWRLIGHT","PL",.)
(0 real changes made)

. replace comp=subinstr(comp,"SUPERMARKETS","SUPERMKTS",.)
(148 real changes made)

. replace comp=subinstr(comp,"CAPITAL","CAP",.)
(432 real changes made)

. replace comp=subinstr(comp,"GRAND ICE CREAM","",.)
(1 real change made)

. replace comp=subinstr(comp,"DREAMS","DRMS",.)
(5 real changes made)

. replace comp=subinstr(comp,"EMPORIUM","EMPORM",.)
(2 real changes made)

. replace comp=subinstr(comp,"HARDWAREGARDEN","HRDWR",.)
(8 real changes made)

. replace comp=subinstr(comp,"KODAK","KDK",.)
(33 real changes made)

. replace comp=subinstr(comp,"MAN","MN",.)
(7,188 real changes made)

. replace comp=subinstr(comp,"STORES","",.)
(86 real changes made)

. replace comp=subinstr(comp,"BROTHERS","BROS",.)
(85 real changes made)

. replace comp=subinstr(comp,"AG","",.)
(10,240 real changes made)

. replace comp=subinstr(comp,"ELECTRONIC","ELEC",.)
(407 real changes made)

. replace comp=trim(comp)
(3,256 real changes made)

. 
. *10th
. replace comp=subinstr(comp,"GAS","GS",.)
(5,282 real changes made)

. replace comp=subinstr(comp,"TOWN","TWN",.)
(89 real changes made)

. replace comp=subinstr(comp,"L M","",.)
(5,334 real changes made)

. replace comp=subinstr(comp,"LM","",.)
(883 real changes made)

. replace comp=subinstr(comp,"TELEFON","TEL",.)
(66 real changes made)

. replace comp=trim(comp)
(10 real changes made)

. 
. *11th
. replace comp=subinstr(comp,"ERICSSON TEL","ERCSON TELE",.)
(5 real changes made)

. replace comp=subinstr(comp,"WHEELER","WHLR",.)
(27 real changes made)

. replace comp=subinstr(comp,"FISHER","FISHR",.)
(191 real changes made)

. replace comp=subinstr(comp,"SCIEN","SCI",.)
(756 real changes made)

. replace comp=subinstr(comp,"INTL","",.)
(13,023 real changes made)

. replace comp=subinstr(comp,"FED EXPRESS","FEDEX",.)
(48 real changes made)

. replace comp=subinstr(comp,"WOOD","WD",.)
(335 real changes made)

. replace comp=subinstr(comp,"FLA ROCK","FLORIDA ROCK",.)
(40 real changes made)

. replace comp=subinstr(comp,"STONE","STN",.)
(219 real changes made)

. replace comp=subinstr(comp,"TIRERUBBER","TIR",.)
(19 real changes made)

. replace comp=subinstr(comp,"TIR","",.)
(236 real changes made)

. replace comp=subinstr(comp,"CENTER","CNTR",.)
(852 real changes made)

. replace comp=subinstr(comp,"","YR",.)
(0 real changes made)

. replace comp=subinstr(comp,"NSOLIDATED","",.)
(0 real changes made)

. replace comp=subinstr(comp,"MIC","MC",.)
(5,001 real changes made)

. replace comp=subinstr(comp,"ELECTRIC","ELEC",.)
(5,972 real changes made)

. replace comp=subinstr(comp,"ELEC","EL",.)
(10,841 real changes made)

. replace comp=subinstr(comp,"NSOL","",.)
(58 real changes made)

. replace comp=subinstr(comp,"PACIFIC","PAC",.)
(4,019 real changes made)

. replace comp=subinstr(comp,"W R","WR",.)
(33 real changes made)

. replace comp=trim(comp)
(5,737 real changes made)

. 
. *12th
. replace comp=subinstr(comp,"METRO","MET",.)
(456 real changes made)

. replace comp=subinstr(comp,"TECHNOLOGIES","TECHNOL",.)
(77 real changes made)

. replace comp=subinstr(comp,"DATA MM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"DATAMM","DATAM",.)
(0 real changes made)

. replace comp=subinstr(comp,"INSTRUMENT","INSTR",.)
(399 real changes made)

. replace comp=subinstr(comp,"INSTRMN","INSTR",.)
(9 real changes made)

. replace comp=subinstr(comp,"MOTORS","MTR",.)
(1,599 real changes made)

. replace comp=subinstr(comp,"INSTITUTE","INST",.)
(275 real changes made)

. replace comp=subinword(comp,"GENUINE","GENUIN",.)
(20 real changes made)

. replace comp=subinword(comp,"PARTS","PART",.)
(195 real changes made)

. replace comp=subinword(comp,"TEL","TE",.)
(1,334 real changes made)

. replace comp=subinword(comp,"GLOBALSTAR","GLBLSTR",.)
(2 real changes made)

. replace comp=subinstr(comp,",","",.)
(13,361 real changes made)

. replace comp=subinword(comp,"GOODYR E","GOODYR",.)
(42 real changes made)

. replace comp=subinword(comp,"W","",.)
(95 real changes made)

. replace comp=subinword(comp,"GRAINGER","GRAINGR",.)
(36 real changes made)

. replace comp=subinword(comp,"CHEMCL","CH",.)
(668 real changes made)

. replace comp=subinword(comp,"SP","",.)
(212 real changes made)

. replace comp=trim(comp)
(938 real changes made)

. 
. *13th
. replace comp=subinword(comp,"PACKARD","PCK",.)
(546 real changes made)

. replace comp=subinword(comp,"HOTELS","HTL",.)
(111 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *14th
. replace comp=subinword(comp,"TROY","TR",.)
(2 real changes made)

. replace comp=subinword(comp,"MEYERS","MEYR",.)
(3 real changes made)

. replace comp=subinword(comp,"H J","HJ",.)
(3 real changes made)

. replace comp=subinword(comp,"HOTL","HTL",.)
(18 real changes made)

. replace comp=subinword(comp,"HEALTHDYNE","HLTHDNE",.)
(1 real change made)

. replace comp=subinword(comp,"TECHNOL","TEC",.)
(77 real changes made)

. *replace comp=subinword(comp,"CELANESE","",.)
. replace comp=subinword(comp,"CEL","",.)
(16 real changes made)

. replace comp=subinword(comp,"MIFFLIN","MF",.)
(7 real changes made)

. replace comp=subinword(comp,"LTPWR","LP",.)
(10 real changes made)

. replace comp=subinword(comp,"HOST","HST",.)
(20 real changes made)

. replace comp=subinword(comp,"SUPPLY","SPLY",.)
(622 real changes made)

. replace comp=subinword(comp,"MATERIALS HNDLG","",.)
(0 real changes made)

. replace comp=subinword(comp,"SOLUTIONS","",.)
(424 real changes made)

. replace comp=trim(comp)
(375 real changes made)

. 
. *15th
. replace comp=subinword(comp,"CHASE","CHSE",.)
(165 real changes made)

. replace comp=subinword(comp,"J P MORGAN","JPMORGAN",.)
(15 real changes made)

. replace comp=subinword(comp,"CIRCUIT","CRCT",.)
(127 real changes made)

. replace comp=subinword(comp,"NTROLS","CNTL",.)
(0 real changes made)

. replace comp=subinword(comp,"JOHNSONJOHNSON","JOHNSNJHNS",.)
(136 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *16th
. replace comp=subinstr(comp,"AM TEL &TEL","AT&T",.)
(0 real changes made)

. replace comp=subinstr(comp,"-","",.)
(0 real changes made)

. replace comp=subinword(comp,"CL","",.)
(152 real changes made)

. replace comp=subinword(comp,"A","",.)
(610 real changes made)

. replace comp=subinword(comp,"HLDG","",.)
(67 real changes made)

. replace comp=subinword(comp,"WARD","WD",.)
(12 real changes made)

. replace comp=subinword(comp,"MONTGOMERY","MONTGMY",.)
(5 real changes made)

. replace comp=subinstr(comp,"PR","",.)
(11,389 real changes made)

. replace comp=subinword(comp,"CORP","",.)
(0 real changes made)

. replace comp=subinword(comp,"CO","",.)
(2,976 real changes made)

. replace comp=subinword(comp,"CP","",.)
(0 real changes made)

. replace comp=subinword(comp,"INC","",.)
(0 real changes made)

. replace comp=subinword(comp,"DAIMLERCHRYSLER","DAIMLER",.)
(362 real changes made)

. replace comp=subinword(comp,"AG","",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(565 real changes made)

. replace comp=subinword(comp,"EASTMAN","EASTMN",.)
(0 real changes made)

. replace comp=subinword(comp,"KODAK","KODK",.)
(0 real changes made)

. replace comp=subinword(comp,"MACHINES","MA",.)
(300 real changes made)

. replace comp=subinword(comp,"BUSINESS","BUS",.)
(1,277 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(181 real changes made)

. replace comp=subinword(comp,"EQUIPMENT","EQ",.)
(1,316 real changes made)

. replace comp=subinword(comp,"PROCTER","PRCTR",.)
(0 real changes made)

. replace comp=subinword(comp,"GAMBLE","GM",.)
(7 real changes made)

. replace comp=subinword(comp,"GENERAL","GEN",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTORS","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"MOTOR","MTR",.)
(0 real changes made)

. replace comp=subinword(comp,"FUNDING","",.)
(16 real changes made)

. replace comp=subinword(comp,"(J C)","(JC)",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(2 real changes made)

. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(1 real change made)

. replace comp=subinword(comp,"STORES","",.)
(0 real changes made)

. replace comp=subinword(comp,"EXXON MOBIL","EXXON",.)
(0 real changes made)

. replace comp=subinword(comp,"SPRINT NEXTEL","SPRINT",.)
(0 real changes made)

. replace comp=subinword(comp,"INSTRUMENTS","INSTR",.)
(0 real changes made)

. replace comp=subinword(comp,"TEXAS","TX",.)
(1,748 real changes made)

. replace comp=subinword(comp,"DU PONT (E I) DE NEMOURS","DUPONT (EI)
> ",.)
(0 real changes made)

. replace comp=subinword(comp,"MICRO","MICR",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGIES","TECHS",.)
(0 real changes made)

. replace comp=subinword(comp,"UNITED","UTD",.)
(0 real changes made)

. replace comp=subinword(comp,"COMPUTER","CMP",.)
(0 real changes made)

. replace comp=subinword(comp,"RICHFIELD","RIC",.)
(0 real changes made)

. replace comp=subinword(comp,"INTERNATIONAL","INTL",.)
(0 real changes made)

. replace comp=subinword(comp,"MACH","MA",.)
(0 real changes made)

. replace comp=subinword(comp,"ANHEUSER-BUSCH","ANHEUSR-BSH",.)
(0 real changes made)

. replace comp=subinword(comp,"LOCKHEED MARTIN","LOCKHEED",.)
(329 real changes made)

. replace comp=subinword(comp,"LOCKHD MART","LOCKHEED",.)
(91 real changes made)

. replace comp=subinword(comp,"LABORATORIES","LABS",.)
(0 real changes made)

. replace comp=subinword(comp,"AMERICAN","",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGYOLD","TEC",.)
(0 real changes made)

. replace comp=subinword(comp,"TECHNOLOGY","TEC",.)
(1,599 real changes made)

. replace comp=subinword(comp,"HOSPITAL","HOSP",.)
(225 real changes made)

. replace comp=subinword(comp,"SUPPLY","SUP",.)
(0 real changes made)

. replace comp=subinword(comp,"PHILIP","PHIL",.)
(86 real changes made)

. replace comp=subinword(comp,"MORRIS","MOR",.)
(82 real changes made)

. replace comp=subinword(comp,"NORTHROP GRUMMAN","NORTHROP",.)
(0 real changes made)

. replace comp=subinword(comp,"LOWE'S COMPANIES","LOWES COS",.)
(0 real changes made)

. replace comp=subinword(comp,"MARIETTA","MRTA",.)
(0 real changes made)

. replace comp=subinword(comp,"MICROSYSTEMS","MICRO",.)
(0 real changes made)

. replace comp=trim(comp)
(3,045 real changes made)

. 
. *17th
. replace comp=subinword(comp,"MCDONNELL","MCDONNEL",.)
(0 real changes made)

. replace comp=subinword(comp,"DOUGLAS","DG",.)
(0 real changes made)

. replace comp = subinstr(comp, " ", "", .)                          
>                                              //BLUNT way of improvi
> ng match, remove white space
(356,115 real changes made)

. replace comp=trim(comp)
(0 real changes made)

. 
. *OLD CODE, UPDATED 21/03/2020
. /*White spaces, capital letters and punctuations
> replace toClean = trim(toClean)
> foreach word in "CORP" "INC" "LTD" ".COM" "PLC" " TRUST" " CO"{
>         replace toClean = subinstr(toClean, " `word'", "", .)
>         }
> 
> *Punctuation
> strip toClean, of("'`!$%^&*()-_+=][}{#;~@:/.,?><\|") gen(toClean2)
> drop toClean
> rename toClean2 toClean
> 
> *White space
> *replace toClean = subinstr(toClean, " ", "", .)
> 
> *Upper case
> replace toClean=upper(toClean)
> 
> *From Atalay, Hortacsu, Roberts, and Syverson's code (2011)
> */
. 
. 
. 
. 
. 
end of do-file

. merge m:1 comp year using "$data/${doNum}_allcomp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       916,696
        from master                   527,368  (_merge==1)
        from using                    389,328  (_merge==2)

    matched                           254,251  (_merge==3)
    -----------------------------------------

. tab ctype _merge, mi row 

+----------------+
| Key            |
|----------------|
|   frequency    |
| row percentage |
+----------------+

           |              _merge
     ctype | master on  using onl  matched ( |     Total
-----------+---------------------------------+----------
           |    65,408    389,328    166,760 |   621,496 
           |     10.52      62.64      26.83 |    100.00 
-----------+---------------------------------+----------
   COMPANY |   249,755          0     66,171 |   315,926 
           |     79.05       0.00      20.95 |    100.00 
-----------+---------------------------------+----------
    GEOREG |   100,771          0      6,954 |   107,725 
           |     93.54       0.00       6.46 |    100.00 
-----------+---------------------------------+----------
    GOVDOM |    23,760          0     12,323 |    36,083 
           |     65.85       0.00      34.15 |    100.00 
-----------+---------------------------------+----------
    GOVFRN |     3,651          0      1,014 |     4,665 
           |     78.26       0.00      21.74 |    100.00 
-----------+---------------------------------+----------
    GOVLOC |       542          0          0 |       542 
           |    100.00       0.00       0.00 |    100.00 
-----------+---------------------------------+----------
  GOVSTATE |     1,227          0          1 |     1,228 
           |     99.92       0.00       0.08 |    100.00 
-----------+---------------------------------+----------
    MARKET |    82,254          0      1,028 |    83,282 
           |     98.77       0.00       1.23 |    100.00 
-----------+---------------------------------+----------
     Total |   527,368    389,328    254,251 | 1,170,947 
           |     45.04      33.25      21.71 |    100.00 

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. keep if ctype == "MARKET" | ctype == "COMPANY"
(771,739 observations deleted)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. foreach v of varlist conm ctype comp sic sales gvkey n _merge{
  2.         rename `v' `v'_customer
  3.         }

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. compress
  variable year was float now int
  variable ctype_customer was str8 now str7
  variable conm_supplier was str30 now str29
  variable comp_customer was str50 now str46
  (3,193,664 bytes saved)

. save "$data/${doNum}_fullNet.dta", replace
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_full
> Net.dta saved

. 
. *Keeping matched customer
. keep if _merge_customer == 3
(332,009 observations deleted)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. gen year3 = floor((year-2)/3)*3+3                                  
>                                                                    
>   // so that 1976, 1977 and 1978 are grouped in year3 = 1977

. rename conm conm_customer
conm ambiguous abbreviation
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. collapse (firstnm) conm_customer (sum) sale* , by(year3 sic_supplie
> r sic_customer gvkey_supplier gvkey_customer comp_customer)

. 
end of do-file

. use "$data/${doNum}_fullNet.dta", clear

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3                                  
>                                                                    
>   // so that 1976, 1977 and 1978 are grouped in year3 = 1977

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. collapse (firstnm) conm_customer conm_supplier (sum) sale* , by(yea
> r3 sic_supplier sic_customer gvkey_supplier gvkey_customer comp_cus
> tomer comp_supplier)

. 
end of do-file

. tab year3

      year3 |      Freq.     Percent        Cum.
------------+-----------------------------------
       1977 |        587        1.62        1.62
       1980 |      1,010        2.79        4.41
       1983 |      1,253        3.46        7.86
       1986 |      1,828        5.04       12.90
       1989 |      1,727        4.76       17.67
       1992 |      2,056        5.67       23.34
       1995 |      2,682        7.40       30.74
       1998 |      3,110        8.58       39.32
       2001 |      3,535        9.75       49.07
       2004 |      3,485        9.61       58.68
       2007 |      3,228        8.90       67.59
       2010 |      3,204        8.84       76.42
       2013 |      3,445        9.50       85.93
       2016 |      3,228        8.90       94.83
       2019 |      1,874        5.17      100.00
------------+-----------------------------------
      Total |     36,252      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.co
> m/mdroste/stata-scheme-modern/master/")
> set scheme modern, perm
> ssc install gtools
> gtools, upgrade*/
. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                 
>                                      // I'm using a different orig 
> folder so as not to commit large datasets to GitHub

. global data "$wd/data/001_network"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. 
. *do-file number, used to save outputs 
. global doNum "003"                                      

. 
. *log
. cap log close
---------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/003_buildYear
> lyNetworks.log
  log type:  text
 opened on:  22 Mar 2020, 19:03:20

. 
end of do-file

. use "$data/${doNum}_fullNet.dta", clear

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3                                  
>                                                                    
>   // so that 1976, 1977 and 1978 are grouped in year3 = 1977

. 
. collapse (firstnm) conm_customer conm_supplier (sum) sale* , by(yea
> r3 sic_supplier sic_customer gvkey_supplier gvkey_customer comp_cus
> tomer comp_supplier)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. gen share = salesc_supplier/sales_supplier
salesc_supplier not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. gen share = salecs_supplier/sales_supplier
(1,425 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. hist share
(bin=45, start=-.31902757, width=3.2478305)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. replace share = 1 if share>=1
(1,550 real changes made)

. hist share
(bin=45, start=-.31902757, width=.02931172)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.00000
> 0"

. replace share = . if share<0
(2 real changes made, 2 to missing)

. 
end of do-file

. su share if share!=0

    Variable |        Obs        Mean    Std. Dev.       Min        M
> ax
-------------+-------------------------------------------------------
> --
       share |     28,448    .2218701    .2510284   6.67e-06         
>  1

. su share if share!=0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       share |     28,448    .2218701    .2510284   6.67e-06          1

. sort share

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. levelsof year3
1977 1980 1983 1986 1989 1992 1995 1998 2001 2004 2007 2010 2013 2016 2019

. foreach y in `r(levels)'{
  2.         keep if year3 = `y'
  3.         compress
  4.         save "$data/${doNum}_fullNet`y'.dta", replace
  5.         export delimited "$data/${doNum}_fullNet`y'.csv", replace
  6.         }
=exp not allowed
r(101);

end of do-file

r(101);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. levelsof year3
1977 1980 1983 1986 1989 1992 1995 1998 2001 2004 2007 2010 2013 2016 2019

. foreach y in `r(levels)'{
  2.         keep if year3 == `y'
  3.         compress
  4.         save "$data/${doNum}_fullNet`y'.dta", replace
  5.         export delimited "$data/${doNum}_fullNet`y'.csv", replace
  6.         }
(35,665 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str24
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (47,547 bytes saved)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977.csv saved
(587 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016.csv saved
(0 observations deleted)
(note: dataset contains 0 observations)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019.dta saved
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019.csv saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. levelsof year3


. foreach y in `r(levels)'{
  2.         preserve
  3.         keep if year3 == `y'
  4.         compress
  5.         save "$data/${doNum}_fullNet`y'.dta", replace
  6.         export delimited "$data/${doNum}_fullNet`y'.csv", replace
  7.         restore
  8.         }

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. use "$data/${doNum}_fullNet.dta", clear

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3                                                                        
>                                // so that 1976, 1977 and 1978 are grouped in year3 = 1977

. 
. collapse (firstnm) conm_customer conm_supplier (sum) sale* , by(year3 sic_supplier sic_customer gvkey_sup
> plier gvkey_customer comp_customer comp_supplier)

. gen share = salecs_supplier/sales_supplier
(1,425 missing values generated)

. replace share = 1 if share>=1
(1,550 real changes made)

. replace share = . if share<0
(2 real changes made, 2 to missing)

. hist share
(bin=45, start=0, width=.02222222)

. levelsof year3
1977 1980 1983 1986 1989 1992 1995 1998 2001 2004 2007 2010 2013 2016 2019

. foreach y in `r(levels)'{
  2.         preserve
  3.         keep if year3 == `y'
  4.         compress
  5.         save "$data/${doNum}_fullNet`y'.dta", replace
  6.         export delimited "$data/${doNum}_fullNet`y'.csv", replace
  7.         restore
  8.         }
(35,665 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str24
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (47,547 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977.csv saved
(35,242 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (79,790 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980.csv saved
(34,999 observations deleted)
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str13
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (95,228 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983.csv saved
(34,424 observations deleted)
  variable gvkey_supplier was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (140,756 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986.csv saved
(34,525 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (129,525 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989.csv saved
(34,196 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (154,200 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992.csv saved
(33,570 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str21
  variable conm_customer was str50 now str26
  variable conm_supplier was str29 now str28
  (142,146 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995.csv saved
(33,142 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str28
  variable conm_supplier was str29 now str28
  (146,170 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998.csv saved
(32,717 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str34
  variable conm_supplier was str29 now str28
  (144,935 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001.csv saved
(32,767 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str36
  variable conm_supplier was str29 now str28
  (135,915 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004.csv saved
(33,024 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str26
  variable conm_customer was str50 now str36
  variable conm_supplier was str29 now str28
  (122,664 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007.csv saved
(33,048 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (115,344 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010.csv saved
(32,807 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (124,020 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013.csv saved
(33,024 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (116,208 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016.csv saved
(34,378 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (67,464 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019.csv saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. use "$data/${doNum}_fullNet.dta", clear

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3                                                                        
>                                // so that 1976, 1977 and 1978 are grouped in year3 = 1977

. 
. collapse (firstnm) conm_customer conm_supplier (sum) sale* , by(year3 sic_supplier sic_customer gvkey_sup
> plier gvkey_customer comp_customer comp_supplier)

. gen share = salecs_supplier/sales_supplier
(1,425 missing values generated)

. replace share = 1 if share>=1
(1,550 real changes made)

. replace share = . if share<0
(2 real changes made, 2 to missing)

. hist share
(bin=45, start=0, width=.02222222)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. replace share = 0.1 if share == 0
(7,802 real changes made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. hist share
(bin=45, start=6.666e-06, width=.02222207)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. hist share, freq
(bin=45, start=6.666e-06, width=.02222207)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. hist share, freq
(bin=45, start=6.666e-06, width=.02222207)

. levelsof year3
1977 1980 1983 1986 1989 1992 1995 1998 2001 2004 2007 2010 2013 2016 2019

. foreach y in `r(levels)'{
  2.         preserve
  3.         keep if year3 == `y'
  4.         compress
  5.         rename gvkey_supplier = Source
  6.         rename gvkey_customer = Target
  7.         save "$data/${doNum}_fullNet`y'.dta", replace
  8.         export delimited "$data/${doNum}_fullNet`y'.csv", replace
  9.         restore
 10.         }
(35,665 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str24
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (47,547 bytes saved)
syntax error
    Syntax is
        rename  oldname    newname   [, renumber[(#)] addnumber[(#)] sort ...]
        rename (oldnames) (newnames) [, renumber[(#)] addnumber[(#)] sort ...]
        rename  oldnames              , {upper|lower|proper}
r(198);

end of do-file

r(198);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00936.000000"

. use "$data/${doNum}_fullNet.dta", clear

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3                                                                            
>                            // so that 1976, 1977 and 1978 are grouped in year3 = 1977

. 
. collapse (firstnm) conm_customer conm_supplier (sum) sale* , by(year3 sic_supplier sic_customer gvkey_supplie
> r gvkey_customer comp_customer comp_supplier)

. gen share = salecs_supplier/sales_supplier
(1,425 missing values generated)

. replace share = 1 if share>=1
(1,550 real changes made)

. replace share = . if share<0
(2 real changes made, 2 to missing)

. replace share = 0.1 if share == 0
(7,802 real changes made)

. hist share, freq
(bin=45, start=6.666e-06, width=.02222207)

. levelsof year3
1977 1980 1983 1986 1989 1992 1995 1998 2001 2004 2007 2010 2013 2016 2019

. foreach y in `r(levels)'{
  2.         preserve
  3.         keep if year3 == `y'
  4.         compress
  5.         rename gvkey_supplier Source
  6.         rename gvkey_customer Target
  7.         save "$data/${doNum}_fullNet`y'.dta", replace
  8.         export delimited "$data/${doNum}_fullNet`y'.csv", replace
  9.         restore
 10.         }
(35,665 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str24
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (47,547 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977.csv saved
(35,242 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (79,790 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980.csv saved
(34,999 observations deleted)
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str13
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (95,228 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983.csv saved
(34,424 observations deleted)
  variable gvkey_supplier was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (140,756 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986.csv saved
(34,525 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (129,525 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989.csv saved
(34,196 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (154,200 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992.csv saved
(33,570 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str21
  variable conm_customer was str50 now str26
  variable conm_supplier was str29 now str28
  (142,146 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995.csv saved
(33,142 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str28
  variable conm_supplier was str29 now str28
  (146,170 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998.csv saved
(32,717 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str34
  variable conm_supplier was str29 now str28
  (144,935 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001.csv saved
(32,767 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str36
  variable conm_supplier was str29 now str28
  (135,915 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004.csv saved
(33,024 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str26
  variable conm_customer was str50 now str36
  variable conm_supplier was str29 now str28
  (122,664 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007.csv saved
(33,048 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (115,344 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010.csv saved
(32,807 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (124,020 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013.csv saved
(33,024 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (116,208 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016.csv saved
(34,378 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (67,464 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019.dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019.csv saved

. 
end of do-file

-----------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_p
> aper/log/003_buildYearlyNetworks.log
  log type:  text
 opened on:  24 Mar 2020, 17:34:39

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD05025.000000"

. use "$data/${doNum}_fullNet.dta", clear

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3            
>                                              
>                                              
>  // so that 1976, 1977 and 1978 are grouped i
> n year3 = 1977

. 
. collapse (firstnm) conm_customer conm_supplie
> r (sum) sale* , by(year3 sic_supplier sic_cus
> tomer gvkey_supplier gvkey_customer comp_cust
> omer comp_supplier)

. gen share = salecs_supplier/sales_supplier
(1,425 missing values generated)

. replace share = 1 if share>=1
(1,550 real changes made)

. replace share = . if share<0
(2 real changes made, 2 to missing)

. replace share = 0.1 if share == 0
(7,802 real changes made)

. hist share, freq
(bin=45, start=6.666e-06, width=.02222207)

. levelsof year3
1977 1980 1983 1986 1989 1992 1995 1998 2001 20
> 04 2007 2010 2013 2016 2019

. 
end of do-file

. outfile using "/Users/ios/Documents/GitHub/mr
> es_paper/data/001_network/test.raw", replace 
> wide
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/test.raw not found)

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD05025.000000"

. outfile using "/Users/ios/Documents/GitHub/mr
> es_paper/data/001_network/test.txt", replace 
> wide

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD05025.000000"

. use "$data/${doNum}_fullNet.dta", clear

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3            
>                                              
>                                              
>  // so that 1976, 1977 and 1978 are grouped i
> n year3 = 1977

. 
. collapse (firstnm) conm_customer conm_supplie
> r (sum) sale* , by(year3 sic_supplier sic_cus
> tomer gvkey_supplier gvkey_customer comp_cust
> omer comp_supplier)

. gen share = salecs_supplier/sales_supplier
(1,425 missing values generated)

. replace share = 1 if share>=1
(1,550 real changes made)

. replace share = . if share<0
(2 real changes made, 2 to missing)

. replace share = 0.1 if share == 0
(7,802 real changes made)

. hist share, freq
(bin=45, start=6.666e-06, width=.02222207)

. levelsof year3
1977 1980 1983 1986 1989 1992 1995 1998 2001 20
> 04 2007 2010 2013 2016 2019

. 
. foreach y in `r(levels)'{
  2.         preserve
  3.         keep if year3 == `y'
  4.         compress
  5.         rename gvkey_supplier Source
  6.         rename gvkey_customer Target
  7.         save "$data/${doNum}_fullNet`y'.dt
> a", replace
  8.         export delimited "$data/${doNum}_f
> ullNet`y'.csv", replace
  9.         
.         *For Python
.         keep Source Target share
 10.         order Source Target share
 11.         outfile using "$data/${doNum}_full
> Net`y'.txt", replace wide
 12.         restore
 13.         }
(35,665 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str24
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (47,547 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1977.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1977.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1977.txt not 
> found)
(35,242 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (79,790 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1980.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1980.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1980.txt not 
> found)
(34,999 observations deleted)
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str13
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (95,228 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1983.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1983.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1983.txt not 
> found)
(34,424 observations deleted)
  variable gvkey_supplier was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (140,756 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1986.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1986.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1986.txt not 
> found)
(34,525 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (129,525 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1989.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1989.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1989.txt not 
> found)
(34,196 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (154,200 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1992.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1992.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1992.txt not 
> found)
(33,570 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str21
  variable conm_customer was str50 now str26
  variable conm_supplier was str29 now str28
  (142,146 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1995.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1995.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1995.txt not 
> found)
(33,142 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str28
  variable conm_supplier was str29 now str28
  (146,170 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1998.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1998.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1998.txt not 
> found)
(32,717 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str34
  variable conm_supplier was str29 now str28
  (144,935 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2001.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2001.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2001.txt not 
> found)
(32,767 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str36
  variable conm_supplier was str29 now str28
  (135,915 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2004.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2004.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2004.txt not 
> found)
(33,024 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str26
  variable conm_customer was str50 now str36
  variable conm_supplier was str29 now str28
  (122,664 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2007.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2007.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2007.txt not 
> found)
(33,048 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (115,344 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2010.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2010.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2010.txt not 
> found)
(32,807 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (124,020 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2013.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2013.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2013.txt not 
> found)
(33,024 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (116,208 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2016.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2016.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2016.txt not 
> found)
(34,378 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (67,464 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2019.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2019.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2019.txt not 
> found)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD05025.000000"

. use "$data/${doNum}_fullNet.dta", clear

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3            
>                                              
>                                              
>  // so that 1976, 1977 and 1978 are grouped i
> n year3 = 1977

. 
. collapse (firstnm) conm_customer conm_supplie
> r (sum) sale* , by(year3 sic_supplier sic_cus
> tomer gvkey_supplier gvkey_customer comp_cust
> omer comp_supplier)

. gen share = salecs_supplier/sales_supplier
(1,425 missing values generated)

. replace share = 1 if share>=1
(1,550 real changes made)

. replace share = . if share<0
(2 real changes made, 2 to missing)

. replace share = 0.1 if share == 0
(7,802 real changes made)

. hist share, freq
(bin=45, start=6.666e-06, width=.02222207)

. levelsof year3
1977 1980 1983 1986 1989 1992 1995 1998 2001 20
> 04 2007 2010 2013 2016 2019

. 
. foreach y in `r(levels)'{
  2.         preserve
  3.         keep if year3 == `y'
  4.         compress
  5.         rename gvkey_supplier Source
  6.         rename gvkey_customer Target
  7.         save "$data/${doNum}_fullNet`y'.dt
> a", replace
  8.         export delimited "$data/${doNum}_f
> ullNet`y'.csv", replace
  9.         
.         *For Python
.         keep Source Target share
 10.         order Source Target share
 11.         outfile using "$data/${doNum}_full
> Net`y'.txt", replace wide
 12.         export delimited "$data/${doNum}_f
> ullNet`y'_short.csv", replace
 13.         restore
 14.         }
(35,665 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str24
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (47,547 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1977.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1977.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1977_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1977_short.csv saved
(35,242 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (79,790 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1980.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1980.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1980_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1980_short.csv saved
(34,999 observations deleted)
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str13
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (95,228 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1983.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1983.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1983_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1983_short.csv saved
(34,424 observations deleted)
  variable gvkey_supplier was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (140,756 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1986.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1986.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1986_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1986_short.csv saved
(34,525 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (129,525 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1989.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1989.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1989_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1989_short.csv saved
(34,196 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (154,200 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1992.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1992.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1992_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1992_short.csv saved
(33,570 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str21
  variable conm_customer was str50 now str26
  variable conm_supplier was str29 now str28
  (142,146 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1995.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1995.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1995_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1995_short.csv saved
(33,142 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str28
  variable conm_supplier was str29 now str28
  (146,170 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1998.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1998.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet1998_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet1998_short.csv saved
(32,717 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str34
  variable conm_supplier was str29 now str28
  (144,935 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2001.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2001.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2001_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2001_short.csv saved
(32,767 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str36
  variable conm_supplier was str29 now str28
  (135,915 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2004.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2004.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2004_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2004_short.csv saved
(33,024 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str26
  variable conm_customer was str50 now str36
  variable conm_supplier was str29 now str28
  (122,664 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2007.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2007.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2007_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2007_short.csv saved
(33,048 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (115,344 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2010.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2010.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2010_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2010_short.csv saved
(32,807 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (124,020 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2013.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2013.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2013_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2013_short.csv saved
(33,024 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (116,208 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2016.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2016.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2016_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2016_short.csv saved
(34,378 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (67,464 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2019.dta saved
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2019.csv saved
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/001_network/003_fullNet2019_short.cs
> v not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/001_network/003_fullNet2019_short.csv saved

. 
end of do-file

. use "$data/${doNum}_fullNet2016.dta", clear

. tab sic_supplier, mi

sic_supplie |
          r |      Freq.     Percent        Cum.
------------+-----------------------------------
        100 |          3        0.09        0.09
        200 |          1        0.03        0.12
        700 |          1        0.03        0.15
        800 |          1        0.03        0.19
       1000 |          2        0.06        0.25
       1040 |          4        0.12        0.37
       1220 |         25        0.77        1.15
       1221 |          3        0.09        1.24
       1311 |        117        3.62        4.86
       1381 |         42        1.30        6.16
       1382 |         10        0.31        6.47
       1389 |         43        1.33        7.81
       1400 |         11        0.34        8.15
       1600 |          8        0.25        8.40
       1623 |         13        0.40        8.80
       1700 |          1        0.03        8.83
       2000 |          5        0.15        8.98
       2011 |          3        0.09        9.08
       2013 |          4        0.12        9.20
       2015 |          3        0.09        9.29
       2020 |          4        0.12        9.42
       2030 |          7        0.22        9.63
       2033 |          5        0.15        9.79
       2040 |          5        0.15        9.94
       2050 |          2        0.06       10.01
       2052 |          1        0.03       10.04
       2060 |          8        0.25       10.29
       2080 |          3        0.09       10.38
       2086 |         10        0.31       10.69
       2090 |         10        0.31       11.00
       2111 |          1        0.03       11.03
       2200 |          2        0.06       11.09
       2211 |          6        0.19       11.28
       2300 |         12        0.37       11.65
       2320 |          4        0.12       11.77
       2340 |          1        0.03       11.80
       2400 |          5        0.15       11.96
       2421 |          1        0.03       11.99
       2430 |          4        0.12       12.11
       2452 |          7        0.22       12.33
       2510 |          1        0.03       12.36
       2531 |          9        0.28       12.64
       2621 |          6        0.19       12.83
       2650 |          1        0.03       12.86
       2670 |          5        0.15       13.01
       2721 |          1        0.03       13.04
       2750 |          3        0.09       13.14
       2780 |          3        0.09       13.23
       2800 |          1        0.03       13.26
       2810 |         18        0.56       13.82
       2820 |          1        0.03       13.85
       2833 |          2        0.06       13.91
       2834 |        164        5.08       18.99
       2835 |         22        0.68       19.67
       2836 |        204        6.32       25.99
       2840 |          2        0.06       26.05
       2842 |          1        0.03       26.08
       2844 |         12        0.37       26.46
       2851 |          1        0.03       26.49
       2860 |          8        0.25       26.73
       2870 |          4        0.12       26.86
       2890 |          5        0.15       27.01
       2911 |          4        0.12       27.14
       2950 |          1        0.03       27.17
       2990 |          4        0.12       27.29
       3050 |         15        0.46       27.76
       3060 |          2        0.06       27.82
       3086 |          1        0.03       27.85
       3089 |         10        0.31       28.16
       3140 |          2        0.06       28.22
       3231 |          9        0.28       28.50
       3290 |          5        0.15       28.66
       3310 |          1        0.03       28.69
       3312 |         15        0.46       29.15
       3334 |          1        0.03       29.18
       3341 |          1        0.03       29.21
       3350 |          4        0.12       29.34
       3390 |          1        0.03       29.37
       3411 |          6        0.19       29.55
       3420 |          7        0.22       29.77
       3440 |          1        0.03       29.80
       3442 |          3        0.09       29.89
       3443 |          1        0.03       29.93
       3460 |          2        0.06       29.99
       3480 |          2        0.06       30.05
       3490 |          5        0.15       30.20
       3510 |         11        0.34       30.55
       3523 |          1        0.03       30.58
       3531 |          1        0.03       30.61
       3533 |         17        0.53       31.13
       3537 |          1        0.03       31.16
       3540 |          2        0.06       31.23
       3550 |          2        0.06       31.29
       3559 |         15        0.46       31.75
       3560 |          2        0.06       31.82
       3561 |          5        0.15       31.97
       3562 |          4        0.12       32.09
       3570 |          1        0.03       32.13
       3572 |         16        0.50       32.62
       3576 |         23        0.71       33.33
       3577 |         10        0.31       33.64
       3578 |          3        0.09       33.74
       3585 |          6        0.19       33.92
       3590 |          2        0.06       33.98
       3612 |          3        0.09       34.08
       3613 |          1        0.03       34.11
       3620 |          3        0.09       34.20
       3621 |          2        0.06       34.26
       3630 |          2        0.06       34.32
       3634 |          2        0.06       34.39
       3640 |          3        0.09       34.48
       3651 |         22        0.68       35.16
       3661 |         13        0.40       35.56
       3663 |         25        0.77       36.34
       3669 |          2        0.06       36.40
       3670 |         16        0.50       36.90
       3672 |         36        1.12       38.01
       3674 |        179        5.55       43.56
       3678 |          4        0.12       43.68
       3679 |         14        0.43       44.11
       3690 |         11        0.34       44.45
       3711 |         10        0.31       44.76
       3714 |        152        4.71       49.47
       3721 |          3        0.09       49.57
       3724 |          3        0.09       49.66
       3728 |         13        0.40       50.06
       3743 |          8        0.25       50.31
       3760 |          2        0.06       50.37
       3812 |         22        0.68       51.05
       3823 |          3        0.09       51.15
       3825 |         30        0.93       52.08
       3826 |          1        0.03       52.11
       3827 |          4        0.12       52.23
       3829 |          5        0.15       52.39
       3841 |         16        0.50       52.88
       3842 |          4        0.12       53.00
       3844 |          5        0.15       53.16
       3845 |         23        0.71       53.87
       3861 |          3        0.09       53.97
       3873 |          2        0.06       54.03
       3942 |         12        0.37       54.40
       3944 |         10        0.31       54.71
       3949 |          3        0.09       54.80
       3990 |         18        0.56       55.36
       4011 |          1        0.03       55.39
       4210 |          3        0.09       55.48
       4213 |          9        0.28       55.76
       4400 |          9        0.28       56.04
       4412 |         30        0.93       56.97
       4512 |          7        0.22       57.19
       4513 |          2        0.06       57.25
       4522 |         13        0.40       57.65
       4581 |         15        0.46       58.12
       4610 |          9        0.28       58.40
       4731 |          1        0.03       58.43
       4812 |          6        0.19       58.61
       4813 |          3        0.09       58.71
       4833 |          4        0.12       58.83
       4841 |          6        0.19       59.01
       4899 |         23        0.71       59.73
       4911 |         10        0.31       60.04
       4922 |         16        0.50       60.53
       4923 |          4        0.12       60.66
       4924 |          1        0.03       60.69
       4931 |          4        0.12       60.81
       4950 |          9        0.28       61.09
       4955 |          1        0.03       61.12
       4991 |         18        0.56       61.68
       5031 |          1        0.03       61.71
       5045 |          4        0.12       61.83
       5047 |          5        0.15       61.99
       5080 |          6        0.19       62.17
       5122 |          6        0.19       62.36
       5140 |          4        0.12       62.48
       5141 |          1        0.03       62.52
       5150 |          3        0.09       62.61
       5160 |          8        0.25       62.86
       5171 |          8        0.25       63.10
       5172 |          8        0.25       63.35
       5190 |          2        0.06       63.41
       5211 |          5        0.15       63.57
       5331 |          1        0.03       63.60
       5400 |          1        0.03       63.63
       5500 |          7        0.22       63.85
       5600 |          1        0.03       63.88
       5712 |          1        0.03       63.91
       5912 |          2        0.06       63.97
       5961 |          1        0.03       64.00
       6099 |          1        0.03       64.03
       6153 |          1        0.03       64.06
       6200 |          1        0.03       64.10
       6282 |         23        0.71       64.81
       6331 |          5        0.15       64.96
       6351 |          2        0.06       65.02
       6411 |          3        0.09       65.12
       6500 |          2        0.06       65.18
       6510 |         13        0.40       65.58
       6512 |         14        0.43       66.02
       6519 |          5        0.15       66.17
       6726 |          1        0.03       66.20
       6792 |          6        0.19       66.39
       6794 |         14        0.43       66.82
       6795 |          5        0.15       66.98
       6798 |        618       19.14       86.12
       6799 |          1        0.03       86.15
       7011 |          1        0.03       86.18
       7310 |          9        0.28       86.46
       7323 |          2        0.06       86.52
       7340 |          1        0.03       86.56
       7350 |          1        0.03       86.59
       7359 |         10        0.31       86.90
       7361 |         38        1.18       88.07
       7363 |          2        0.06       88.14
       7370 |        148        4.58       92.72
       7371 |          3        0.09       92.81
       7372 |         68        2.11       94.92
       7373 |         22        0.68       95.60
       7374 |         25        0.77       96.38
       7389 |         20        0.62       97.00
       7812 |          6        0.19       97.18
       7822 |          6        0.19       97.37
       7830 |          1        0.03       97.40
       7900 |          3        0.09       97.49
       8011 |          2        0.06       97.55
       8060 |          1        0.03       97.58
       8071 |          2        0.06       97.65
       8090 |          6        0.19       97.83
       8200 |         19        0.59       98.42
       8711 |         17        0.53       98.95
       8721 |         20        0.62       99.57
       8731 |          6        0.19       99.75
       8741 |          5        0.15       99.91
       8742 |          1        0.03       99.94
       9995 |          1        0.03       99.97
       9997 |          1        0.03      100.00
------------+-----------------------------------
      Total |      3,228      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

. import delimited "$orig/compustat_segment_customer_76_19.csv", clear
(16 vars, 549,451 obs)

. 
end of do-file

. sort sic

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

. use "$data/${doNum}_fullNet.dta", clear

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3                                         
>                                                               // so that 1
> 976, 1977 and 1978 are grouped in year3 = 1977

. 
. collapse (firstnm) conm_customer conm_supplier (sum) sale* , by(year3 sic_
> supplier sic_customer gvkey_supplier gvkey_customer comp_customer comp_sup
> plier)

. gen share = salecs_supplier/sales_supplier
(1,425 missing values generated)

. replace share = 1 if share>=1
(1,550 real changes made)

. replace share = . if share<0
(2 real changes made, 2 to missing)

. replace share = 0.1 if share == 0
(7,802 real changes made)

. hist share, freq
(bin=45, start=6.666e-06, width=.02222207)

. 
end of do-file

. keep if year3 == 2016
(33,024 observations deleted)

. use "$data/${doNum}_allcomp.dta", clear

. use "$data/${doNum}_allcomp.dta", clear

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

. gen tempSIC = floor(soc/100)
soc not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

. gen tempSIC = floor(sic/100)

. 
end of do-file

. tab sic

        sic |      Freq.     Percent        Cum.
------------+-----------------------------------
        100 |        813        0.20        0.20
        200 |        193        0.05        0.25
        700 |        195        0.05        0.29
        800 |        141        0.03        0.33
        900 |         35        0.01        0.34
       1000 |      1,541        0.38        0.71
       1040 |      3,142        0.77        1.48
       1044 |        144        0.04        1.52
       1090 |        287        0.07        1.59
       1220 |        600        0.15        1.74
       1221 |        195        0.05        1.78
       1311 |     11,547        2.83        4.61
       1381 |      1,200        0.29        4.91
       1382 |        552        0.14        5.04
       1389 |        999        0.24        5.29
       1400 |        794        0.19        5.48
       1520 |        187        0.05        5.53
       1531 |      1,671        0.41        5.94
       1540 |        248        0.06        6.00
       1600 |        733        0.18        6.18
       1623 |        462        0.11        6.29
       1700 |        552        0.14        6.43
       1731 |        289        0.07        6.50
       2000 |        536        0.13        6.63
       2011 |        438        0.11        6.73
       2013 |        443        0.11        6.84
       2015 |        316        0.08        6.92
       2020 |        326        0.08        7.00
       2024 |        176        0.04        7.04
       2030 |        774        0.19        7.23
       2033 |        212        0.05        7.28
       2040 |        687        0.17        7.45
       2050 |        331        0.08        7.53
       2052 |        117        0.03        7.56
       2060 |        746        0.18        7.75
       2070 |        185        0.05        7.79
       2080 |        282        0.07        7.86
       2082 |        596        0.15        8.01
       2084 |        156        0.04        8.04
       2085 |        204        0.05        8.09
       2086 |        924        0.23        8.32
       2090 |        658        0.16        8.48
       2092 |         36        0.01        8.49
       2100 |        146        0.04        8.53
       2111 |        279        0.07        8.59
       2200 |        573        0.14        8.74
       2211 |        584        0.14        8.88
       2221 |        241        0.06        8.94
       2250 |        349        0.09        9.02
       2253 |        281        0.07        9.09
       2273 |        297        0.07        9.16
       2300 |      1,563        0.38        9.55
       2320 |        712        0.17        9.72
       2330 |        760        0.19        9.91
       2340 |        206        0.05        9.96
       2390 |        243        0.06       10.02
       2400 |        544        0.13       10.15
       2421 |        195        0.05       10.20
       2430 |        408        0.10       10.30
       2451 |        415        0.10       10.40
       2452 |        375        0.09       10.49
       2510 |        700        0.17       10.66
       2511 |        264        0.06       10.73
       2520 |        129        0.03       10.76
       2522 |        267        0.07       10.83
       2531 |        175        0.04       10.87
       2540 |        126        0.03       10.90
       2590 |        104        0.03       10.92
       2600 |        104        0.03       10.95
       2611 |        166        0.04       10.99
       2621 |        942        0.23       11.22
       2631 |        474        0.12       11.34
       2650 |        529        0.13       11.47
       2670 |      1,111        0.27       11.74
       2673 |         95        0.02       11.76
       2711 |        570        0.14       11.90
       2721 |        513        0.13       12.03
       2731 |        698        0.17       12.20
       2732 |         62        0.02       12.21
       2741 |        336        0.08       12.30
       2750 |        904        0.22       12.52
       2761 |        388        0.10       12.61
       2771 |         99        0.02       12.64
       2780 |        180        0.04       12.68
       2790 |        122        0.03       12.71
       2800 |        391        0.10       12.81
       2810 |      1,233        0.30       13.11
       2820 |        460        0.11       13.22
       2821 |        702        0.17       13.39
       2833 |        378        0.09       13.49
       2834 |      8,569        2.10       15.58
       2835 |      2,294        0.56       16.15
       2836 |      8,087        1.98       18.13
       2840 |        473        0.12       18.24
       2842 |        419        0.10       18.35
       2844 |      1,535        0.38       18.72
       2851 |        513        0.13       18.85
       2860 |      1,199        0.29       19.14
       2870 |        855        0.21       19.35
       2890 |        992        0.24       19.59
       2891 |        258        0.06       19.66
       2911 |      2,015        0.49       20.15
       2950 |        216        0.05       20.20
       2990 |        311        0.08       20.28
       3011 |        339        0.08       20.36
       3021 |        172        0.04       20.40
       3050 |        215        0.05       20.46
       3060 |        410        0.10       20.56
       3080 |        577        0.14       20.70
       3081 |        391        0.10       20.80
       3086 |        203        0.05       20.84
       3089 |      1,520        0.37       21.22
       3100 |        259        0.06       21.28
       3140 |        778        0.19       21.47
       3211 |         43        0.01       21.48
       3220 |        131        0.03       21.51
       3221 |        137        0.03       21.55
       3231 |        122        0.03       21.58
       3241 |        541        0.13       21.71
       3250 |        172        0.04       21.75
       3260 |        105        0.03       21.78
       3270 |        461        0.11       21.89
       3272 |        141        0.03       21.93
       3281 |         20        0.00       21.93
       3290 |        614        0.15       22.08
       3310 |        479        0.12       22.20
       3312 |      1,722        0.42       22.62
       3317 |        339        0.08       22.70
       3320 |        235        0.06       22.76
       3330 |        437        0.11       22.87
       3334 |        152        0.04       22.90
       3341 |        169        0.04       22.95
       3350 |        782        0.19       23.14
       3357 |        437        0.11       23.24
       3360 |         85        0.02       23.27
       3390 |        183        0.04       23.31
       3411 |        372        0.09       23.40
       3412 |         33        0.01       23.41
       3420 |        746        0.18       23.59
       3430 |        171        0.04       23.63
       3433 |        174        0.04       23.68
       3440 |        305        0.07       23.75
       3442 |        337        0.08       23.83
       3443 |        381        0.09       23.93
       3444 |        147        0.04       23.96
       3448 |        202        0.05       24.01
       3451 |         44        0.01       24.02
       3452 |        476        0.12       24.14
       3460 |        477        0.12       24.26
       3470 |        204        0.05       24.31
       3480 |        288        0.07       24.38
       3490 |      1,106        0.27       24.65
       3510 |        502        0.12       24.77
       3523 |        498        0.12       24.89
       3524 |        110        0.03       24.92
       3530 |        276        0.07       24.99
       3531 |        505        0.12       25.11
       3532 |        183        0.04       25.16
       3533 |        766        0.19       25.34
       3537 |        304        0.07       25.42
       3540 |        779        0.19       25.61
       3541 |        184        0.05       25.65
       3550 |        229        0.06       25.71
       3555 |        304        0.07       25.78
       3559 |      1,946        0.48       26.26
       3560 |        664        0.16       26.42
       3561 |        434        0.11       26.53
       3562 |        345        0.08       26.61
       3564 |        514        0.13       26.74
       3567 |        201        0.05       26.79
       3569 |        583        0.14       26.93
       3570 |        317        0.08       27.01
       3571 |        944        0.23       27.24
       3572 |      1,033        0.25       27.49
       3575 |        346        0.08       27.58
       3576 |      1,683        0.41       27.99
       3577 |      1,807        0.44       28.43
       3578 |        493        0.12       28.56
       3579 |        361        0.09       28.64
       3580 |        665        0.16       28.81
       3585 |      1,007        0.25       29.05
       3590 |        444        0.11       29.16
       3600 |        253        0.06       29.22
       3612 |        291        0.07       29.30
       3613 |        205        0.05       29.35
       3620 |        873        0.21       29.56
       3621 |        789        0.19       29.75
       3630 |        406        0.10       29.85
       3634 |        315        0.08       29.93
       3640 |      1,121        0.27       30.20
       3651 |      1,084        0.27       30.47
       3652 |        227        0.06       30.52
       3661 |      2,155        0.53       31.05
       3663 |      2,887        0.71       31.76
       3669 |      1,034        0.25       32.01
       3670 |        762        0.19       32.20
       3672 |        868        0.21       32.41
       3674 |      5,135        1.26       33.67
       3677 |        107        0.03       33.70
       3678 |        442        0.11       33.80
       3679 |      1,949        0.48       34.28
       3690 |      1,491        0.37       34.65
       3695 |         87        0.02       34.67
       3711 |      1,060        0.26       34.93
       3713 |        260        0.06       34.99
       3714 |      2,746        0.67       35.66
       3715 |         95        0.02       35.69
       3716 |        174        0.04       35.73
       3720 |         56        0.01       35.74
       3721 |        604        0.15       35.89
       3724 |        460        0.11       36.00
       3728 |        744        0.18       36.19
       3730 |        395        0.10       36.28
       3743 |        333        0.08       36.37
       3751 |        120        0.03       36.39
       3760 |        240        0.06       36.45
       3790 |        339        0.08       36.54
       3812 |      1,399        0.34       36.88
       3821 |        268        0.07       36.94
       3822 |        140        0.03       36.98
       3823 |      1,216        0.30       37.28
       3824 |        170        0.04       37.32
       3825 |      1,353        0.33       37.65
       3826 |      1,138        0.28       37.93
       3827 |        591        0.14       38.07
       3829 |      1,025        0.25       38.32
       3841 |      2,636        0.65       38.97
       3842 |      2,101        0.51       39.48
       3843 |        403        0.10       39.58
       3844 |        290        0.07       39.65
       3845 |      3,869        0.95       40.60
       3851 |        398        0.10       40.70
       3861 |        749        0.18       40.88
       3873 |        180        0.04       40.93
       3910 |        119        0.03       40.96
       3911 |        188        0.05       41.00
       3931 |         98        0.02       41.03
       3942 |        146        0.04       41.06
       3944 |        646        0.16       41.22
       3949 |        816        0.20       41.42
       3950 |        206        0.05       41.47
       3960 |        167        0.04       41.51
       3990 |      1,028        0.25       41.76
       4011 |      1,036        0.25       42.02
       4013 |         40        0.01       42.03
       4100 |        191        0.05       42.07
       4210 |        598        0.15       42.22
       4213 |      1,519        0.37       42.59
       4220 |        101        0.02       42.62
       4400 |        858        0.21       42.83
       4412 |      1,084        0.27       43.09
       4512 |      1,865        0.46       43.55
       4513 |        206        0.05       43.60
       4522 |        287        0.07       43.67
       4581 |        248        0.06       43.73
       4610 |        375        0.09       43.82
       4700 |        551        0.13       43.96
       4731 |        559        0.14       44.10
       4812 |      1,948        0.48       44.57
       4813 |      4,012        0.98       45.55
       4822 |        102        0.02       45.58
       4832 |        610        0.15       45.73
       4833 |      1,225        0.30       46.03
       4841 |      1,455        0.36       46.39
       4888 |        246        0.06       46.45
       4899 |      1,844        0.45       46.90
       4911 |      6,781        1.66       48.56
       4922 |      1,443        0.35       48.91
       4923 |      1,135        0.28       49.19
       4924 |      2,106        0.52       49.71
       4931 |      3,954        0.97       50.67
       4932 |        303        0.07       50.75
       4941 |        841        0.21       50.95
       4950 |        208        0.05       51.01
       4953 |        639        0.16       51.16
       4955 |        807        0.20       51.36
       4961 |         34        0.01       51.37
       4991 |        728        0.18       51.55
       5000 |        151        0.04       51.58
       5010 |        223        0.05       51.64
       5013 |        303        0.07       51.71
       5020 |         86        0.02       51.73
       5030 |        174        0.04       51.78
       5031 |        162        0.04       51.82
       5040 |        435        0.11       51.92
       5045 |      1,052        0.26       52.18
       5047 |        555        0.14       52.32
       5050 |          3        0.00       52.32
       5051 |        570        0.14       52.46
       5063 |        283        0.07       52.53
       5064 |         21        0.01       52.53
       5065 |      1,106        0.27       52.80
       5070 |        377        0.09       52.89
       5072 |        257        0.06       52.96
       5080 |        659        0.16       53.12
       5082 |         49        0.01       53.13
       5084 |        351        0.09       53.22
       5090 |        380        0.09       53.31
       5093 |        166        0.04       53.35
       5094 |        121        0.03       53.38
       5099 |        128        0.03       53.41
       5110 |        360        0.09       53.50
       5122 |        981        0.24       53.74
       5130 |        210        0.05       53.79
       5140 |        888        0.22       54.01
       5141 |        479        0.12       54.13
       5150 |        173        0.04       54.17
       5160 |        316        0.08       54.25
       5171 |        335        0.08       54.33
       5172 |        595        0.15       54.47
       5180 |         38        0.01       54.48
       5190 |        489        0.12       54.60
       5200 |        282        0.07       54.67
       5211 |        463        0.11       54.79
       5271 |         30        0.01       54.79
       5311 |      1,009        0.25       55.04
       5331 |      1,099        0.27       55.31
       5399 |        195        0.05       55.36
       5400 |        166        0.04       55.40
       5411 |      2,071        0.51       55.90
       5412 |        287        0.07       55.97
       5500 |        777        0.19       56.17
       5531 |        294        0.07       56.24
       5600 |        512        0.13       56.36
       5621 |        826        0.20       56.56
       5651 |        661        0.16       56.73
       5661 |        435        0.11       56.83
       5700 |        322        0.08       56.91
       5712 |        363        0.09       57.00
       5731 |        430        0.11       57.11
       5734 |        140        0.03       57.14
       5735 |        176        0.04       57.18
       5810 |        165        0.04       57.22
       5812 |      4,416        1.08       58.31
       5900 |        535        0.13       58.44
       5912 |      1,074        0.26       58.70
       5940 |        657        0.16       58.86
       5944 |        374        0.09       58.95
       5945 |        267        0.07       59.02
       5960 |        202        0.05       59.07
       5961 |      1,699        0.42       59.48
       5990 |        778        0.19       59.67
       6020 |     21,645        5.30       64.98
       6022 |          6        0.00       64.98
       6035 |      5,926        1.45       66.43
       6036 |      2,668        0.65       67.08
       6099 |        479        0.12       67.20
       6111 |        194        0.05       67.25
       6141 |      1,326        0.32       67.57
       6153 |        885        0.22       67.79
       6159 |        812        0.20       67.99
       6162 |        877        0.21       68.20
       6163 |        109        0.03       68.23
       6172 |        437        0.11       68.34
       6199 |        224        0.05       68.39
       6200 |        509        0.12       68.52
       6211 |      2,156        0.53       69.04
       6282 |      1,416        0.35       69.39
       6311 |      1,864        0.46       69.85
       6321 |        435        0.11       69.95
       6324 |        894        0.22       70.17
       6331 |      3,528        0.86       71.04
       6351 |        696        0.17       71.21
       6361 |        164        0.04       71.25
       6399 |         64        0.02       71.26
       6411 |      1,365        0.33       71.60
       6500 |        401        0.10       71.70
       6510 |        386        0.09       71.79
       6512 |      1,365        0.33       72.13
       6513 |        317        0.08       72.20
       6519 |        110        0.03       72.23
       6531 |        550        0.13       72.36
       6532 |        453        0.11       72.48
       6552 |      1,157        0.28       72.76
       6722 |     17,970        4.40       77.16
       6726 |     18,158        4.45       81.61
       6792 |        863        0.21       81.82
       6794 |      1,541        0.38       82.20
       6795 |        418        0.10       82.30
       6797 |        754        0.18       82.48
       6798 |      8,698        2.13       84.61
       6799 |      1,788        0.44       85.05
       7000 |        100        0.02       85.08
       7011 |      1,606        0.39       85.47
       7200 |        859        0.21       85.68
       7310 |        552        0.14       85.82
       7311 |        500        0.12       85.94
       7320 |        161        0.04       85.98
       7323 |        266        0.07       86.04
       7330 |        118        0.03       86.07
       7331 |        161        0.04       86.11
       7340 |        314        0.08       86.19
       7350 |        293        0.07       86.26
       7359 |        947        0.23       86.49
       7361 |        325        0.08       86.57
       7363 |      1,096        0.27       86.84
       7370 |      8,369        2.05       88.89
       7371 |        543        0.13       89.02
       7372 |     10,743        2.63       91.65
       7373 |      4,234        1.04       92.69
       7374 |      1,553        0.38       93.07
       7377 |        124        0.03       93.10
       7380 |        372        0.09       93.19
       7381 |        366        0.09       93.28
       7384 |        140        0.03       93.32
       7385 |        160        0.04       93.36
       7389 |      2,021        0.50       93.85
       7500 |        323        0.08       93.93
       7510 |        433        0.11       94.04
       7600 |        145        0.04       94.07
       7812 |      1,109        0.27       94.34
       7819 |        281        0.07       94.41
       7822 |        321        0.08       94.49
       7829 |         13        0.00       94.50
       7830 |        412        0.10       94.60
       7841 |        128        0.03       94.63
       7900 |        428        0.10       94.73
       7948 |        408        0.10       94.83
       7990 |      2,353        0.58       95.41
       7996 |        111        0.03       95.44
       7997 |         89        0.02       95.46
       8000 |        246        0.06       95.52
       8011 |        424        0.10       95.62
       8050 |        113        0.03       95.65
       8051 |        602        0.15       95.80
       8060 |        478        0.12       95.91
       8062 |        592        0.15       96.06
       8071 |      1,144        0.28       96.34
       8082 |        623        0.15       96.49
       8090 |        747        0.18       96.67
       8093 |        368        0.09       96.76
       8111 |         64        0.02       96.78
       8200 |      1,184        0.29       97.07
       8300 |        251        0.06       97.13
       8351 |        113        0.03       97.16
       8400 |          7        0.00       97.16
       8600 |          6        0.00       97.16
       8700 |        634        0.16       97.32
       8711 |      1,572        0.39       97.70
       8721 |        253        0.06       97.77
       8731 |      1,010        0.25       98.01
       8734 |        365        0.09       98.10
       8741 |        365        0.09       98.19
       8742 |        963        0.24       98.43
       8744 |        145        0.04       98.46
       8900 |         12        0.00       98.47
       9995 |      5,876        1.44       99.90
       9997 |        388        0.10      100.00
------------+-----------------------------------
      Total |    408,250      100.00

. tab tempSIC

    tempSIC |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        813        0.20        0.20
          2 |        193        0.05        0.25
          7 |        195        0.05        0.29
          8 |        141        0.03        0.33
          9 |         35        0.01        0.34
         10 |      5,114        1.25        1.59
         12 |        795        0.19        1.78
         13 |     14,298        3.50        5.29
         14 |        794        0.19        5.48
         15 |      2,106        0.52        6.00
         16 |      1,195        0.29        6.29
         17 |        841        0.21        6.50
         20 |      8,143        1.99        8.49
         21 |        425        0.10        8.59
         22 |      2,325        0.57        9.16
         23 |      3,484        0.85       10.02
         24 |      1,937        0.47       10.49
         25 |      1,765        0.43       10.92
         26 |      3,421        0.84       11.76
         27 |      3,872        0.95       12.71
         28 |     28,358        6.95       19.66
         29 |      2,542        0.62       20.28
         30 |      3,827        0.94       21.22
         31 |      1,037        0.25       21.47
         32 |      2,487        0.61       22.08
         33 |      5,020        1.23       23.31
         34 |      5,463        1.34       24.65
         35 |     18,427        4.51       29.16
         36 |     22,481        5.51       34.67
         37 |      7,626        1.87       36.54
         38 |     17,926        4.39       40.93
         39 |      3,414        0.84       41.76
         40 |      1,076        0.26       42.03
         41 |        191        0.05       42.07
         42 |      2,218        0.54       42.62
         44 |      1,942        0.48       43.09
         45 |      2,606        0.64       43.73
         46 |        375        0.09       43.82
         47 |      1,110        0.27       44.10
         48 |     11,442        2.80       46.90
         49 |     18,979        4.65       51.55
         50 |      7,612        1.86       53.41
         51 |      4,864        1.19       54.60
         52 |        775        0.19       54.79
         53 |      2,303        0.56       55.36
         54 |      2,524        0.62       55.97
         55 |      1,071        0.26       56.24
         56 |      2,434        0.60       56.83
         57 |      1,431        0.35       57.18
         58 |      4,581        1.12       58.31
         59 |      5,586        1.37       59.67
         60 |     30,724        7.53       67.20
         61 |      4,864        1.19       68.39
         62 |      4,081        1.00       69.39
         63 |      7,645        1.87       71.26
         64 |      1,365        0.33       71.60
         65 |      4,739        1.16       72.76
         67 |     50,190       12.29       85.05
         70 |      1,706        0.42       85.47
         72 |        859        0.21       85.68
         73 |     33,358        8.17       93.85
         75 |        756        0.19       94.04
         76 |        145        0.04       94.07
         78 |      2,264        0.55       94.63
         79 |      3,389        0.83       95.46
         80 |      5,337        1.31       96.76
         81 |         64        0.02       96.78
         82 |      1,184        0.29       97.07
         83 |        364        0.09       97.16
         84 |          7        0.00       97.16
         86 |          6        0.00       97.16
         87 |      5,307        1.30       98.46
         89 |         12        0.00       98.47
         99 |      6,264        1.53      100.00
------------+-----------------------------------
      Total |    408,250      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

.         do "$code/mres_xxx_cleanCompNames"

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Cleaning company names -> Giving somewhat homogene
> ous names
>                                         across datasets
>         
>         INFILES:        - any string variable with the name toClean
>         
>         OUTFILES:       - cleaned company name
>         
>         LOG:            Created 21/03/2020
>         
> **************************************************************************
> *****/
. 
. gen comp = conm
variable comp already defined
r(110);

end of do-file
r(110);

end of do-file

r(110);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION: Do file building yearly networks of firms, using the 
> cleaning
>                                 procedure of 002
>         
>         INFILES:        - 
>         
>         OUTFILES:       - 
>         
>         LOG: Created 28/02/2020
>         
> **************************************************************************
> *****/
. 
. /*************************************************************************
> ******
>         SETUP
> **************************************************************************
> *****/
. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdros
> te/stata-scheme-modern/master/")
> set scheme modern, perm
> ssc install gtools
> gtools, upgrade*/
. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                        
>                               // I'm using a different orig folder so as n
> ot to commit large datasets to GitHub

. global data "$wd/data/001_network"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. 
. *do-file number, used to save outputs 
. global doNum "003"                                      

. 
. *log
. cap log close
----------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/003_buildYearlyNetwo
> rks.log
  log type:  text
 opened on:  24 Mar 2020, 22:21:44

. 
. /*************************************************************************
> ******
>         GETTING THE WHOLE COMPUSTAT COMPANY DATA WITH GVKEYs
> **************************************************************************
> *****/
. 
. import delimited "$orig/compustat_quarterly_61_19.csv", clear
--Break--
r(1);

end of do-file

--Break--
r(1);

. use "$data/${doNum}_allcomp.dta", clear

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

.         do "$code/mres_xxx_coarseningSIC"

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. gen coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                           
>                                       // Mining
variable coarseSIC already defined
r(110);

end of do-file
r(110);

end of do-file

r(110);

. use "$data/${doNum}_allcomp.dta", clear

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

.         do "$code/mres_xxx_coarseningSIC"

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file

. 
end of do-file

. tab coarseSIC, mi sort

  coarseSIC |      Freq.     Percent        Cum.
------------+-----------------------------------
          3 |    143,980       35.27       35.27
          7 |    103,608       25.38       60.65
          8 |     54,758       13.41       74.06
          4 |     39,939        9.78       83.84
          1 |     21,001        5.14       88.99
          6 |     20,705        5.07       94.06
          5 |     12,476        3.06       97.11
          9 |      6,264        1.53       98.65
          2 |      4,142        1.01       99.66
          0 |      1,377        0.34      100.00
------------+-----------------------------------
      Total |    408,250      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

.         gen year3 = floor((year-2)/3)*3+3

. 
end of do-file

. replace sales = . if year3!=2016
(379,616 real changes made, 379,616 to missing)

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

.         collapse (firstnm) conm comp (mean) sales, by(gvkey) fast

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

. use "$data/${doNum}_fullNet.dta", clear

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3                                         
>                                                               // so that 1
> 976, 1977 and 1978 are grouped in year3 = 1977

. 
. collapse (firstnm) conm_customer conm_supplier (sum) sale* , by(year3 sic_
> supplier sic_customer gvkey_supplier gvkey_customer comp_customer comp_sup
> plier)

. gen share = salecs_supplier/sales_supplier
(1,425 missing values generated)

. replace share = 1 if share>=1
(1,550 real changes made)

. replace share = . if share<0
(2 real changes made, 2 to missing)

. replace share = 0.1 if share == 0
(7,802 real changes made)

. hist share, freq
(bin=45, start=6.666e-06, width=.02222207)

. levelsof year3
1977 1980 1983 1986 1989 1992 1995 1998 2001 2004 2007 2010 2013 2016 2019

. 
. foreach y in `r(levels)'{
  2.         preserve
  3.         keep if year3 == `y'
  4.         compress
  5.         
.         *Creating edge list
.         rename gvkey_supplier Source
  6.         rename gvkey_customer Target
  7.         gen Type = "Directed"
  8.         rename share Weight
  9.         save "$data/${doNum}_fullNet`y'.dta", replace
 10.         export delimited "$data/${doNum}_fullNet`y'.csv", replace
 11.                 
.         *For Python
.         keep Source Target Weight
 12.         order Source Target Weight
 13.         outfile using "$data/${doNum}_fullNet`y'.txt", replace wide
 14.         export delimited "$data/${doNum}_fullNet`y'_short.csv", replace
 15.         restore
 16.         
.         *Creating node list
.         use "$data/${doNum}_allcomp.dta", clear
 17.         keep if year3 == `y'
 18.         compress
 19.         do "$code/mres_xxx_coarseningSIC"
 20.         gen year3 = floor((year-2)/3)*3+3
 21.         replace sales = . if year3!=`y'
 22.         collapse (firstnm) conm comp sic coarseSIC (mean) sales, by(gvk
> ey) fast
 23.         rename gvkey Id
 24.         export delimited "$data/${doNum}_nodeList`y'.csv", replace     
>  
 25.         }
(35,665 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str24
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (47,547 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977
> _short.csv saved
year3 not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

. use "$data/${doNum}_fullNet.dta", clear

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3                                         
>                                                               // so that 1
> 976, 1977 and 1978 are grouped in year3 = 1977

. 
. collapse (firstnm) conm_customer conm_supplier (sum) sale* , by(year3 sic_
> supplier sic_customer gvkey_supplier gvkey_customer comp_customer comp_sup
> plier)

. gen share = salecs_supplier/sales_supplier
(1,425 missing values generated)

. replace share = 1 if share>=1
(1,550 real changes made)

. replace share = . if share<0
(2 real changes made, 2 to missing)

. replace share = 0.1 if share == 0
(7,802 real changes made)

. hist share, freq
(bin=45, start=6.666e-06, width=.02222207)

. levelsof year3
1977 1980 1983 1986 1989 1992 1995 1998 2001 2004 2007 2010 2013 2016 2019

. 
. foreach y in `r(levels)'{
  2.         preserve
  3.         keep if year3 == `y'
  4.         compress
  5.         
.         *Creating edge list
.         rename gvkey_supplier Source
  6.         rename gvkey_customer Target
  7.         gen Type = "Directed"
  8.         rename share Weight
  9.         save "$data/${doNum}_fullNet`y'.dta", replace
 10.         export delimited "$data/${doNum}_fullNet`y'.csv", replace
 11.                 
.         *For Python
.         keep Source Target Weight
 12.         order Source Target Weight
 13.         outfile using "$data/${doNum}_fullNet`y'.txt", replace wide
 14.         export delimited "$data/${doNum}_fullNet`y'_short.csv", replace
 15.         restore
 16.         
.         *Creating node list
.         use "$data/${doNum}_allcomp.dta", clear
 17.         compress
 18.         do "$code/mres_xxx_coarseningSIC"
 19.         gen year3 = floor((year-2)/3)*3+3
 20.         keep if year3 == `y'
 21.         replace sales = . if year3!=`y'
 22.         collapse (firstnm) conm comp sic coarseSIC (mean) sales, by(gvk
> ey) fast
 23.         rename gvkey Id
 24.         export delimited "$data/${doNum}_nodeList`y'.csv", replace     
>  
 25.         }
(35,665 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str24
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (47,547 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(399,548 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List1977.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList197
> 7.csv saved
year3 not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD05025.000000"

. use "$data/${doNum}_fullNet.dta", clear

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3                                         
>                                                               // so that 1
> 976, 1977 and 1978 are grouped in year3 = 1977

. 
. collapse (firstnm) conm_customer conm_supplier (sum) sale* , by(year3 sic_
> supplier sic_customer gvkey_supplier gvkey_customer comp_customer comp_sup
> plier)

. gen share = salecs_supplier/sales_supplier
(1,425 missing values generated)

. replace share = 1 if share>=1
(1,550 real changes made)

. replace share = . if share<0
(2 real changes made, 2 to missing)

. replace share = 0.1 if share == 0
(7,802 real changes made)

. hist share, freq
(bin=45, start=6.666e-06, width=.02222207)

. levelsof year3
1977 1980 1983 1986 1989 1992 1995 1998 2001 2004 2007 2010 2013 2016 2019

. 
. foreach y in `r(levels)'{
  2.         preserve
  3.         keep if year3 == `y'
  4.         compress
  5.         
.         *Creating edge list
.         rename gvkey_supplier Source
  6.         rename gvkey_customer Target
  7.         gen Type = "Directed"
  8.         rename share Weight
  9.         save "$data/${doNum}_fullNet`y'.dta", replace
 10.         export delimited "$data/${doNum}_fullNet`y'.csv", replace
 11.                 
.         *For Python
.         keep Source Target Weight
 12.         order Source Target Weight
 13.         outfile using "$data/${doNum}_fullNet`y'.txt", replace wide
 14.         export delimited "$data/${doNum}_fullNet`y'_short.csv", replace
 15.         
.         *Creating node list
.         use "$data/${doNum}_allcomp.dta", clear
 16.         compress
 17.         do "$code/mres_xxx_coarseningSIC"
 18.         gen year3 = floor((year-2)/3)*3+3
 19.         keep if year3 == `y'
 20.         replace sales = . if year3!=`y'
 21.         collapse (firstnm) conm comp sic coarseSIC (mean) sales, by(gvk
> ey) fast
 22.         rename gvkey Id
 23.         export delimited "$data/${doNum}_nodeList`y'.csv", replace
 24.         
.         restore
 25.         }
(35,665 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str24
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (47,547 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(399,548 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList197
> 7.csv saved
(35,242 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (79,790 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(397,503 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List1980.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList198
> 0.csv saved
(34,999 observations deleted)
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str13
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (95,228 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(387,018 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List1983.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList198
> 3.csv saved
(34,424 observations deleted)
  variable gvkey_supplier was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (140,756 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(383,457 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List1986.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList198
> 6.csv saved
(34,525 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (129,525 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(382,688 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List1989.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList198
> 9.csv saved
(34,196 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (154,200 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(380,897 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List1992.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList199
> 2.csv saved
(33,570 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str21
  variable conm_customer was str50 now str26
  variable conm_supplier was str29 now str28
  (142,146 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(375,357 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List1995.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList199
> 5.csv saved
(33,142 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str28
  variable conm_supplier was str29 now str28
  (146,170 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(373,680 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List1998.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList199
> 8.csv saved
(32,717 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str34
  variable conm_supplier was str29 now str28
  (144,935 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(375,519 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List2001.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList200
> 1.csv saved
(32,767 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str36
  variable conm_supplier was str29 now str28
  (135,915 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(378,646 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List2004.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList200
> 4.csv saved
(33,024 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str26
  variable conm_customer was str50 now str36
  variable conm_supplier was str29 now str28
  (122,664 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(379,636 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List2007.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList200
> 7.csv saved
(33,048 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (115,344 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(380,219 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List2010.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList201
> 0.csv saved
(32,807 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (124,020 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(378,933 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List2013.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList201
> 3.csv saved
(33,024 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (116,208 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(379,616 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List2016.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList201
> 6.csv saved
(34,378 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (67,464 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019
> .dta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019
> .csv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019
> _short.csv saved
  (0 bytes saved)

. 
. /*************************************************************************
> ******
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse
>  sectors
>         
>         LOG:            Created 24/03/2020
>         
> **************************************************************************
> *****/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                          
>                                                       // Agriculture, fore
> stry and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                       
>                                               // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                       
>                                               // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                       
>                                               // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                       
>                                               // Transportation, communica
> tions, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                       
>                                               // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                       
>                                               // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                       
>                                               // Finance, insurance and re
> al estate
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                       
>                                               // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                       
>                                               // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(391,638 observations deleted)
(0 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_node
> List2019.csv not found)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList201
> 9.csv saved

. 
end of do-file

------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/003_buildYearlyNetwork
> s.log
  log type:  text
 opened on:  25 Mar 2020, 10:55:38

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD01084.000000"

. use "$data/${doNum}_fullNet.dta", clear

. keep if _merge_customer == 3
(332,009 observations deleted)

. 
. *generating 3 year windows
. gen year3 = floor((year-2)/3)*3+3                                           
>                                                             // so that 1976,
>  1977 and 1978 are grouped in year3 = 1977

. 
. collapse (firstnm) conm_customer conm_supplier (sum) sale* , by(year3 sic_su
> pplier sic_customer gvkey_supplier gvkey_customer comp_customer comp_supplie
> r)

. gen share = salecs_supplier/sales_supplier
(1,425 missing values generated)

. replace share = 1 if share>=1
(1,550 real changes made)

. replace share = . if share<0
(2 real changes made, 2 to missing)

. replace share = 0.1 if share == 0
(7,802 real changes made)

. hist share, freq
(bin=45, start=6.666e-06, width=.02222207)

. levelsof year3
1977 1980 1983 1986 1989 1992 1995 1998 2001 2004 2007 2010 2013 2016 2019

. 
. foreach y in `r(levels)'{
  2.         preserve
  3.         keep if year3 == `y'
  4.         compress
  5.         
.         *Creating edge list
.         rename gvkey_supplier Source
  6.         rename gvkey_customer Target
  7.         gen Type = "Directed"
  8.         rename share Weight
  9.         save "$data/${doNum}_fullNet`y'.dta", replace
 10.         export delimited "$data/${doNum}_fullNet`y'.csv", replace
 11.                 
.         *For Python
.         keep Source Target Weight
 12.         order Source Target Weight
 13.         outfile using "$data/${doNum}_fullNet`y'.txt", replace wide
 14.         export delimited "$data/${doNum}_fullNet`y'_short.csv", replace
 15.         
.         *Creating node list
.         use "$data/${doNum}_allcomp.dta", clear
 16.         compress
 17.         do "$code/mres_xxx_coarseningSIC"
 18.         gen year3 = floor((year-2)/3)*3+3
 19.         keep if year3 == `y'
 20.         replace sales = . if year3!=`y'
 21.         collapse (firstnm) conm comp sic coarseSIC (mean) sales, by(gvkey
> ) fast
 22.         rename gvkey Id
 23.         rename conm Label
 24.         export delimited "$data/${doNum}_nodeList`y'.csv", replace
 25.         
.         restore
 26.         }
(35,665 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str24
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (47,547 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1977_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(399,548 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList1977.
> csv saved
(35,242 observations deleted)
  variable gvkey_supplier was long now int
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (79,790 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(397,503 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList1980.
> csv saved
(34,999 observations deleted)
  variable gvkey_customer was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str13
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (95,228 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1983_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(387,018 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList1983.
> csv saved
(34,424 observations deleted)
  variable gvkey_supplier was long now int
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (140,756 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1986_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(383,457 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList1986.
> csv saved
(34,525 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (129,525 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1989_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(382,688 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList1989.
> csv saved
(34,196 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str12
  variable conm_customer was str50 now str13
  variable conm_supplier was str29 now str28
  (154,200 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1992_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(380,897 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList1992.
> csv saved
(33,570 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str21
  variable conm_customer was str50 now str26
  variable conm_supplier was str29 now str28
  (142,146 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1995_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(375,357 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList1995.
> csv saved
(33,142 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str28
  variable conm_supplier was str29 now str28
  (146,170 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1998_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(373,680 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList1998.
> csv saved
(32,717 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str34
  variable conm_supplier was str29 now str28
  (144,935 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2001_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(375,519 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList2001.
> csv saved
(32,767 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str36
  variable conm_supplier was str29 now str28
  (135,915 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2004_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(378,646 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList2004.
> csv saved
(33,024 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str26
  variable conm_customer was str50 now str36
  variable conm_supplier was str29 now str28
  (122,664 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2007_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(379,636 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList2007.
> csv saved
(33,048 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (115,344 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2010_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(380,219 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList2010.
> csv saved
(32,807 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (124,020 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2013_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(378,933 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList2013.
> csv saved
(33,024 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (116,208 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2016_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(379,616 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList2016.
> csv saved
(34,378 observations deleted)
  variable year3 was float now int
  variable comp_supplier was str27 now str26
  variable comp_customer was str46 now str25
  variable conm_customer was str50 now str39
  variable conm_supplier was str29 now str28
  (67,464 bytes saved)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019.d
> ta saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019.c
> sv saved
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet2019_s
> hort.csv saved
  (0 bytes saved)

. 
. /***************************************************************************
> ****
>         
>         DESCRIPTION:    Transforning the sic codes into granular ones for 
>                                         visualisation
>         
>         INFILES:        - file with sic integer variable
>         
>         OUTFILES:       - same file with new variable containing 10 coarse s
> ectors
>         
>         LOG:            Created 24/03/2020
>         
> ****************************************************************************
> ***/
. 
. gen tempSIC = floor(sic/100)

. 
. gen coarseSIC = 0 if tempSIC <=9                                            
>                                                     // Agriculture, forestry
>  and fishing
(406,873 missing values generated)

. replace coarseSIC = 1 if tempSIC >=10 & tempSIC<=14                         
>                                             // Mining
(21,001 real changes made)

. replace coarseSIC = 2 if tempSIC >=15 & tempSIC<=17                         
>                                             // Construction
(4,142 real changes made)

. replace coarseSIC = 3 if tempSIC >=20 & tempSIC<=39                         
>                                             // Manufacturing
(143,980 real changes made)

. replace coarseSIC = 4 if tempSIC >=40 & tempSIC<=49                         
>                                             // Transportation, communication
> s, electric, gas, and sanitary services
(39,939 real changes made)

. replace coarseSIC = 5 if tempSIC >=50 & tempSIC<=51                         
>                                             // Wholesale trade
(12,476 real changes made)

. replace coarseSIC = 6 if tempSIC >=52 & tempSIC<=59                         
>                                             // Retail trade
(20,705 real changes made)

. replace coarseSIC = 7 if tempSIC >=60 & tempSIC<=67                         
>                                             // Finance, insurance and real e
> state
(103,608 real changes made)

. replace coarseSIC = 8 if tempSIC >=70 & tempSIC<=89                         
>                                             // Services
(54,758 real changes made)

. replace coarseSIC = 9 if tempSIC >=91 & tempSIC<=99                         
>                                             // Public administration
(6,264 real changes made)

. 
. 
. 
. 
. 
. 
. 
end of do-file
(391,638 observations deleted)
(0 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_nodeList2019.
> csv saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD01084.000000"

. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste
> /stata-scheme-modern/master/")
> ssc install gtools
> gtools, upgrade*/
. 
. set scheme modern, perm
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                          
>                             // I'm using a different orig folder so as not t
> o commit large datasets to GitHub

. global data "$wd/data/001_network"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. 
. *do-file number, used to save outputs 
. global doNum "004"                                      

. 
. *log
. cap log close
