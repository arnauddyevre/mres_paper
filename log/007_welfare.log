-----------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   4 May 2020, 15:54:48

. 
. 
. /*******************************************************************************
>         Getting the all the supply chains leading to final demand
> *******************************************************************************/
. 
. use "$wd/data/006_network&Markups/006_markups&Network1980.dta", clear

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980.dta", clear

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-scheme-modern/master/")
> ssc install gtools
> gtools, upgrade*/
. 
. set scheme modern, perm
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                                                      // I'm 
> using a different orig folder so as not to commit large datasets to GitHub

. global data "$wd/data/006_network&Markups"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. global DLEU "$orig/Data DLEU"

. 
. *do-file number, used to save outputs 
. global doNum "006"                                      

. 
. *log
. cap log close
-----------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   4 May 2020, 15:58:43

. 
. 
. /*******************************************************************************
>         Getting the all the supply chains leading to final demand
> *******************************************************************************/
. 
. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use use "$wd/data/001_network/003_fullNet1980.dta", clear
invalid '"/Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1980.dta' 
r(198);

end of do-file

r(198);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/001_network/003_fullNet1980.dta", clear

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-scheme-modern/master/")
> set scheme modern, perm
> ssc install gtools
> gtools, upgrade*/
. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                                                      // I'm 
> using a different orig folder so as not to commit large datasets to GitHub

. global data "$wd/data/001_network"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. 
. *do-file number, used to save outputs 
. global doNum "003"                                      

. 
. *log
. cap log close
----------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welf
> are.log
  log type:  text
 opened on:   4 May 2020, 16:42:41

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.
> 000000"

. use "$wd/data/001_network/003_fullNet1980.dta", clear

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.
> 000000"

. gen aij = salesc_supplier/sales_customer
salesc_supplier not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.
> 000000"

. gen aij = salecs_supplier/sales_customer
(1 missing value generated)

. 
end of do-file

. su aij, de

                             aij
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%     1.62e-06              0       Obs               1,009
25%     .0000872              0       Sum of Wgt.       1,009

50%     .0004047                      Mean           .0099001
                        Largest       Std. Dev.      .0664858
75%     .0018175       .7788627
90%     .0098426       .8174173       Variance       .0044204
95%     .0231207       .8185583       Skewness       11.16108
99%     .2064978       1.017409       Kurtosis        137.716

. hist aij
(bin=30, start=0, width=.03391362)

. hist aij if aij<0.2
(bin=29, start=0, width=.00560402)

. hist aij if aij<0.1
(bin=29, start=0, width=.00325556)

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. keep Source comp_supplier comp_customer Targe
> t year3 aij

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. save "$data/007_aij.dta", replace
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/007_welfare/007_aij.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/007_welfare/007_aij.dta saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoin
> t1980_wide.dta", clear

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. rename endPoint_0 = gvkey
syntax error
    Syntax is
        rename  oldname    newname   [, renumbe
> r[(#)] addnumber[(#)] sort ...]
        rename (oldnames) (newnames) [, renumbe
> r[(#)] addnumber[(#)] sort ...]
        rename  oldnames              , {upper|
> lower|proper}
r(198);

end of do-file

r(198);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. rename endPoint_0 gvkey

. gen year = 1980

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. merge m:1 gkvey year using "$wd/data/005_mark
> ups/temp_file.dta"
variable gkvey not found
r(111);

end of do-file

r(111);

. use "$wd/data/005_markups/temp_file.dta", cle
> ar

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoin
> t1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gkvey year using "$wd/data/006_netw
> ork&Markups/006_markups1980.dta"
variable gkvey not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. merge m:1 gvkey year using "$wd/data/006_netw
> ork&Markups/006_markups1980.dta"
(note: variable gvkey was float, now double
       to accommodate using data's values)
(note: variable year was float, now double to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  
> (_merge==1)
        from using                      3,371  
> (_merge==2)

    matched                               879  
> (_merge==3)
    -----------------------------------------

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
end of do-file

. h merge

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoin
> t1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_netw
> ork&Markups/006_markups1980.dta", keep(mu_1 s
> ale)
mu_1:  invalid resulttype
    results, specified in options assert()
    and keep(), are the integers 1 through 5,
    or master (equivalent to 1), using (2),
    match (3), match_update (4), or
    match_conflict (5).  The last two arise
    only when option update is specified.
r(198);

end of do-file

r(198);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. merge m:1 gvkey year using "$wd/data/006_netw
> ork&Markups/006_markups1980.dta", keepusing(m
> u_1 sale)
(note: variable gvkey was float, now double
       to accommodate using data's values)
(note: variable year was float, now double to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  
> (_merge==1)
        from using                      3,371  
> (_merge==2)

    matched                               879  
> (_merge==3)
    -----------------------------------------

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. merge m:1 gvkey year using "$wd/data/001_netw
> ork/$001_allcomp.dta"
file
    /Users/ios/Documents/GitHub/mres_paper/da
    > ta/001_network/$001_allcomp.dta not
    found
r(601);

end of do-file

r(601);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. merge m:1 gvkey year using "$wd/data/001_netw
> ork/001_allcomp.dta"
file
    /Users/ios/Documents/GitHub/mres_paper/da
    > ta/001_network/001_allcomp.dta not
    found
r(601);

end of do-file

r(601);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. merge m:1 gvkey year using "$wd/data/001_netw
> ork/003_allcomp.dta"

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  
> (_merge==1)
        from using                    408,064  
> (_merge==2)

    matched                               963  
> (_merge==3)
    -----------------------------------------

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoin
> t1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_netw
> ork&Markups/006_markups1980.dta", keepusing(m
> u_1 sale)
(note: variable gvkey was float, now double
       to accommodate using data's values)
(note: variable year was float, now double to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  
> (_merge==1)
        from using                      3,371  
> (_merge==2)

    matched                               879  
> (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_netw
> ork/003_allcomp.dta", keep(conm)
conm:  invalid resulttype
    results, specified in options assert()
    and keep(), are the integers 1 through 5,
    or master (equivalent to 1), using (2),
    match (3), match_update (4), or
    match_conflict (5).  The last two arise
    only when option update is specified.
r(198);

end of do-file

r(198);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. merge m:1 gvkey year using "$wd/data/001_netw
> ork/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  
> (_merge==1)
        from using                    408,064  
> (_merge==2)

    matched                               963  
> (_merge==3)
    -----------------------------------------

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
end of do-file

. sort sale

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. rename sale finalSale

. rename mu_1 mu_0

. rename conm
syntax error
    Syntax is
        rename  oldname    newname   [, renumbe
> r[(#)] addnumber[(#)] sort ...]
        rename (oldnames) (newnames) [, renumbe
> r[(#)] addnumber[(#)] sort ...]
        rename  oldnames              , {upper|
> lower|proper}
r(198);

end of do-file

r(198);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. use "$wd/data/001_network/003_fullNet1980.dta
> ", clear

. gen aij = salecs_supplier/sales_customer
(1 missing value generated)

. keep Source comp_supplier comp_customer Targe
> t year3 aij

. save "$data/007_aij1980.dta", replace
(note: file /Users/ios/Documents/GitHub/mres_pa
> per/data/007_welfare/007_aij1980.dta not foun
> d)
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/007_welfare/007_aij1980.dta saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoin
> t1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_netw
> ork&Markups/006_markups1980.dta", keepusing(m
> u_1 sale)
(note: variable gvkey was float, now double
       to accommodate using data's values)
(note: variable year was float, now double to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  
> (_merge==1)
        from using                      3,371  
> (_merge==2)

    matched                               879  
> (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_netw
> ork/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  
> (_merge==1)
        from using                    408,064  
> (_merge==2)

    matched                               963  
> (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. rename conm
syntax error
    Syntax is
        rename  oldname    newname   [, renumbe
> r[(#)] addnumber[(#)] sort ...]
        rename (oldnames) (newnames) [, renumbe
> r[(#)] addnumber[(#)] sort ...]
        rename  oldnames              , {upper|
> lower|proper}
r(198);

end of do-file

r(198);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. rename gvkey Target 

. rename endPoint_1 Source

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. merge m:1 Source comp_supplier comp_customer 
> Target year "$data/007_aij1980.dta", keepusin
> g(aij)
variable comp_supplier not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. merge m:1 Source Target year "$data/007_aij19
> 80.dta", keepusing(aij)
factor-variable and time-series operators not a
> llowed
r(101);

end of do-file

r(101);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. merge m:1 Source Target year using "$data/007
> _aij1980.dta", keepusing(aij)
variable year not found in using data
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. use "$wd/data/001_network/003_fullNet1980.dta
> ", clear

. gen aij = salecs_supplier/sales_customer
(1 missing value generated)

. keep Source comp_supplier comp_customer Targe
> t year3 aij

. rename year3 year

. save "$data/007_aij1980.dta", replace
file /Users/ios/Documents/GitHub/mres_paper/dat
> a/007_welfare/007_aij1980.dta saved

. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoin
> t1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_netw
> ork&Markups/006_markups1980.dta", keepusing(m
> u_1 sale)
(note: variable gvkey was float, now double
       to accommodate using data's values)
(note: variable year was float, now double to
       accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  
> (_merge==1)
        from using                      3,371  
> (_merge==2)

    matched                               879  
> (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_netw
> ork/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  
> (_merge==1)
        from using                    408,064  
> (_merge==2)

    matched                               963  
> (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. rename conm
syntax error
    Syntax is
        rename  oldname    newname   [, renumbe
> r[(#)] addnumber[(#)] sort ...]
        rename (oldnames) (newnames) [, renumbe
> r[(#)] addnumber[(#)] sort ...]
        rename  oldnames              , {upper|
> lower|proper}
r(198);

end of do-file

r(198);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007
> _aij1980.dta", keepusing(aij)
variables Source Target year do not uniquely
    identify observations in the using data
r(459);

end of do-file

r(459);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0
> 000gn/T//SD00332.000000"

. use "$wd/data/001_network/003_fullNet1980.dta
> ", clear

. gen aij = salecs_supplier/sales_customer
(1 missing value generated)

. keep Source comp_supplier comp_customer Targe
> t year3 aij

. rename year3 year

. 
end of do-file

. duplicates tag Source Target, gen(tag)

Duplicates in terms of Source Target

. tab tag

        tag |      Freq.     Percent        Cum
> .
------------+----------------------------------
> -
          0 |        756       74.85       74.8
> 5
          1 |        254       25.15      100.0
> 0
------------+----------------------------------
> -
      Total |      1,010      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.0000
> 00"

. use "$wd/data/001_network/003_fullNet1980.dta", clear

. 
end of do-file

. sort Source Target

. duplicates tag Source Target, gen(tag)

Duplicates in terms of Source Target

. tab tag

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        756       74.85       74.85
          1 |        254       25.15      100.00
------------+-----------------------------------
      Total |      1,010      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.0000
> 00"

. use "$wd/data/001_network/003_fullNet1980.dta", clear

. gen aij = salecs_supplier/sales_customer
(1 missing value generated)

. keep Source comp_supplier comp_customer Target year3 aij

. rename year3 year

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.0000
> 00"

. use "$wd/data/001_network/003_fullNet1980.dta", clear

. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) com
> p_supplier comp_customer , by(Source Target year)

. 
end of do-file

. duplicates tag Source Target, gen(tag)

Duplicates in terms of Source Target

. tab tag

        tag |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        883      100.00      100.00
------------+-----------------------------------
      Total |        883      100.00

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.0000
> 00"

. gen aij = salecs_supplier/sales_customer

. keep Source comp_supplier comp_customer Target year3 aij

. rename year3 year

. 
end of do-file

. su aij

    Variable |        Obs        Mean    Std. Dev.       Min        
> Max
-------------+------------------------------------------------------
> ---
         aij |        883    .0113346    .0810052          0   1.636
> 077

. su aij, de

                             aij
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs                 883
25%     .0001021              0       Sum of Wgt.         883

50%     .0004526                      Mean           .0113346
                        Largest       Std. Dev.      .0810052
75%     .0023456       .7737927
90%      .010918       .7788627       Variance       .0065618
95%     .0268046       1.017409       Skewness       13.92638
99%     .2733241       1.636077       Kurtosis       232.3134

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/001_network/003_fullNet1980.dta", clear

. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , by
> (Source Target year)

. gen aij = salecs_supplier/sales_customer

. keep Source comp_supplier comp_customer Target year3 aij

. rename year3 year

. replace aij = 1 if aij>1
(2 real changes made)

. save "$data/007_aij1980.dta", replace
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1980.dta saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(aij)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/001_network/003_fullNet1980.dta", clear

. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , by
> (Source Target year)

. gen a = salecs_supplier/sales_customer

. keep Source comp_supplier comp_customer Target year3 a

. rename year3 year

. replace a = 1 if a>1
(2 real changes made)

. save "$data/007_aij1980.dta", replace
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1980.dta saved

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. rename Target endPoint_0

. rename Source Target

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. 
. *Now including markups and sales shares of other steps in the value chain
. rename Target endPoint_0

. rename Source gvkey

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,080 observations deleted)

. drop _merge

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. rename mu_1 mu_1
  (all newnames==oldnames)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. rename gvkey Target 

. rename endPoint_0 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(883 observations deleted)

. drop _merge

. rename a a21

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. 
. *Now including markups and sales shares of other steps in the value chain
. rename Target endPoint_0

. rename Source gvkey

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1) 
> //markups
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,080 observations deleted)

. drop _merge

. rename mu_1 mu_1
  (all newnames==oldnames)

. rename gvkey Target 

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. rename endPoint_2 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,814
        from master                       959  (_merge==1)
        from using                        855  (_merge==2)

    matched                                35  (_merge==3)
    -----------------------------------------

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. drop if _merge == 2
(855 observations deleted)

. drop _merge

. rename a a21

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. rename Target endPoint_0

. rename Source endPoint_1

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. forval step = 2/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endpoint_`tep' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu_1) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu_1 mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         }
variable endpoint_ not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. forval step = 2/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endpoint_`step' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu_1) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu_1 mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         }
variable endpoint_2 not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. forval step = 2/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endPoint_`step' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu_1) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu_1 mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         }
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)
variable endPoint_3 not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. forval step = 2/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endPoint_`step' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu_1) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu_1 mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         }
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)
variable endPoint_3 not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 2/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endPoint_`step' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu_1) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu_1 mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         rename Target endPoint_`step'
 16.         rename Source endPoint_`nextStep'
 17.         }
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,502
        from master                       990  (_merge==1)
        from using                      3,512  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(3,512 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)

. 
end of do-file

. su a*

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         a10 |        994    .0112652    .0716783          0          1
         a32 |          4    .0011134    .0021266          0   .0043015
         a43 |          0
         a54 |          0
         a65 |          0
-------------+---------------------------------------------------------
         a76 |          0
         a87 |          0
         a98 |          0

. br  endPoint_0 finalSale

. sort endPoint_0

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. bys endPoint_0: gen n = _n

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen sales = finalSale if n==1
(850 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. egen totSales = sum(sales)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen salesSh = sales/totSales
(850 missing values generated)

. 
end of do-file

. sort salesSh

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen sales_mu0 = sales/mu_0
(850 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. egen totSales_mu0 = sum(sales_mu0)

. 
end of do-file

. su totSales

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    totSales |        994    8.06e+08           0   8.06e+08   8.06e+08

. su totSales_mu0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
totSales_mu0 |        994    6.81e+08           0   6.81e+08   6.81e+08

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen ratio_mu0 = totSales/totSales_mu0

. 
end of do-file

. sort endPoint_0

. br

. di 1.25^(0.013)
1.0029051

. di 1.25^(0.06)
1.0134786

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. forval step = 1/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endPoint_`step' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu_1) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu_1 mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         rename Target endPoint_`step'
 16.         rename Source endPoint_`nextStep'
 17.         }
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------
(3,080 observations deleted)
  (all newnames==oldnames)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,814
        from master                       959  (_merge==1)
        from using                        855  (_merge==2)

    matched                                35  (_merge==3)
    -----------------------------------------
(855 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,502
        from master                       990  (_merge==1)
        from using                      3,512  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(3,512 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)

. 
end of do-file

. sort endPoint_0

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. forval step = 1/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endPoint_`step' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu_1) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu_1 mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         rename Target endPoint_`step'
 16.         rename Source endPoint_`nextStep'
 17.         }
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------
(3,080 observations deleted)
  (all newnames==oldnames)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,814
        from master                       959  (_merge==1)
        from using                        855  (_merge==2)

    matched                                35  (_merge==3)
    -----------------------------------------
(855 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,502
        from master                       990  (_merge==1)
        from using                      3,512  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(3,512 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

.         local step = 1

.         local nextStep = `step'+1

.         local previousStep = `step'-1

.         rename endPoint_`step' gvkey

.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusin
> g(mu_1) //markups
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------

.         drop if _merge == 2
(3,080 observations deleted)

.         drop _merge

.         rename mu_1 mu_`step'
  (all newnames==oldnames)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

.         local step = 1

.         local nextStep = `step'+1

.         local previousStep = `step'-1

.         rename endPoint_`step' gvkey

.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusin
> g(mu_1) //markups
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------

.         drop if _merge == 2
(3,080 observations deleted)

.         drop _merge

.         rename mu_1 mu_`step'
  (all newnames==oldnames)

.         rename gvkey Target 

.         rename endPoint_`nextStep' Source

.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,814
        from master                       959  (_merge==1)
        from using                        855  (_merge==2)

    matched                                35  (_merge==3)
    -----------------------------------------

.         drop if _merge == 2
(855 observations deleted)

.         drop _merge

.         rename a a`nextStep'`step'

.         rename Target endPoint_`step'

.         rename Source endPoint_`nextStep'

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

.         local step = 2

.         local nextStep = `step'+1

.         local previousStep = `step'-1

.         rename endPoint_`step' gvkey

.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusin
> g(mu_1) //markups
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------

.         drop if _merge == 2
(3,493 observations deleted)

.         drop _merge

.         rename mu_1 mu_`step'

.         rename gvkey Target 

.         rename endPoint_`nextStep' Source

.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------

.         drop if _merge == 2
(880 observations deleted)

.         drop _merge

.         rename a a`nextStep'`step'

.         rename Target endPoint_`step'

.         rename Source endPoint_`nextStep'

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-scheme-moder
> n/master/")
> ssc install gtools
> gtools, upgrade*/
. 
. set scheme modern, perm
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                                             
>          // I'm using a different orig folder so as not to commit large datasets to GitHub

. global data "$wd/data/006_network&Markups"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. global DLEU "$orig/Data DLEU"

. 
. *do-file number, used to save outputs 
. global doNum "006"                                      

. 
. *log
. cap log close
-------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   4 May 2020, 18:50:55

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/001_network/003_fullNet1980.dta", clear

. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , by
> (Source Target year)

. gen a = salecs_supplier/sales_customer

. keep Source comp_supplier comp_customer Target year3 a

. rename year3 year

. replace a = 1 if a>1
(2 real changes made)

. save "$data/007_aij1980.dta", replace
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1980.dta saved

. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
  2.         local step = 2
  3.         local nextStep = `step'+1
  4.         local previousStep = `step'-1
  5.         rename endPoint_`step' gvkey
  6.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu) //markups
  7.         drop if _merge == 2
  8.         drop _merge
  9.         rename mu mu_`step'
 10.         rename gvkey Target 
 11.         rename endPoint_`nextStep' Source
 12.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 13.         drop if _merge == 2
 14.         drop _merge
 15.         rename a a`nextStep'`step'
 16.         rename Target endPoint_`step'
 17.         rename Source endPoint_`nextStep'
 18.         }
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)
variable mu_2 already defined
r(110);

end of do-file

r(110);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/001_network/003_fullNet1980.dta", clear

. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , by
> (Source Target year)

. gen a = salecs_supplier/sales_customer

. keep Source comp_supplier comp_customer Target year3 a

. rename year3 year

. replace a = 1 if a>1
(2 real changes made)

. save "$data/007_aij1980.dta", replace
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1980.dta saved

. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endPoint_`step' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         rename Target endPoint_`step'
 16.         rename Source endPoint_`nextStep'
 17.         }
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------
(3,080 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,814
        from master                       959  (_merge==1)
        from using                        855  (_merge==2)

    matched                                35  (_merge==3)
    -----------------------------------------
(855 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,502
        from master                       990  (_merge==1)
        from using                      3,512  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(3,512 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)

. 
end of do-file

. h egen

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen a_log_mu = ln(mu_1)*a10
(273 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. bys endPoint_0: egen pi_1 = sum(a_log_mu)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endPoint_`step' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         rename Target endPoint_`step'
 16.         rename Source endPoint_`nextStep'
 17.         }
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------
(3,080 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,814
        from master                       959  (_merge==1)
        from using                        855  (_merge==2)

    matched                                35  (_merge==3)
    -----------------------------------------
(855 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,502
        from master                       990  (_merge==1)
        from using                      3,512  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(3,512 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)

.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n

. gen sales = finalSale if n==1
(850 missing values generated)

. egen totSales = sum(sales)

. gen salesSh = sales/totSales
(850 missing values generated)

. gen sales_mu0 = sales/mu_0
(850 missing values generated)

. egen totSales_mu0 = sum(sales_mu0)

. gen ratio_mu0 = totSales/totSales_mu0                                                          
>                          //18%, looks credible

. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_log_mu = ln(mu_1)*a10
(273 missing values generated)

. bys endPoint_0: egen pi_1 = sum(a_log_mu)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endPoint_`step' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         rename Target endPoint_`step'
 16.         rename Source endPoint_`nextStep'
 17.         }
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------
(3,080 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,814
        from master                       959  (_merge==1)
        from using                        855  (_merge==2)

    matched                                35  (_merge==3)
    -----------------------------------------
(855 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,502
        from master                       990  (_merge==1)
        from using                      3,512  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(3,512 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)

.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n

. gen sales = finalSale if n==1
(850 missing values generated)

. egen totSales = sum(sales)

. gen salesSh = sales/totSales
(850 missing values generated)

. gen sales_mu0 = sales/mu_0
(850 missing values generated)

. egen totSales_mu0 = sum(sales_mu0)

. gen ratio_mu0 = totSales/totSales_mu0                                                          
>                          //18%, looks credible

. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu = ln(mu_1)*a10
(273 missing values generated)

. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen pi_1 = exp(ln_pi_1) if n == 1
(788 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen sales_mu0mu1 = sales/(mu_0*pi_1)
(850 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. egen totSales_mu0mu1 = sum(sales_mu0mu1)

. gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                    
>                                  //18%, looks credible

. 
end of do-file

. su ratio_mu0mu1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
ratio_mu0mu1 |        994    1.190317           0   1.190317   1.190317

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endPoint_`step' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         rename Target endPoint_`step'
 16.         rename Source endPoint_`nextStep'
 17.         }
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------
(3,080 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,814
        from master                       959  (_merge==1)
        from using                        855  (_merge==2)

    matched                                35  (_merge==3)
    -----------------------------------------
(855 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,502
        from master                       990  (_merge==1)
        from using                      3,512  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(3,512 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. bys endPoint_0: gen n = _n

. gen sales = finalSale if n==1
(850 missing values generated)

. egen totSales = sum(sales)

. gen salesSh = sales/totSales
(850 missing values generated)

. gen sales_mu0 = sales/mu_0
(850 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen a_ln_mu_1 = ln(mu_1)*a10
(273 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)

. gen pi_1 = exp(ln_pi_1) if n == 1
(788 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen a_ln_mu_2 = ln(mu_2)*a10*a21
(964 missing values generated)

. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)

. gen pi_2 = exp(ln_pi_1) if n == 1
(788 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/001_network/003_fullNet1980.dta", clear

. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , by
> (Source Target year)

. gen a = salecs_supplier/sales_customer

. keep Source comp_supplier comp_customer Target year3 a

. rename year3 year

. replace a = 1 if a>1
(2 real changes made)

. save "$data/007_aij1980.dta", replace
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1980.dta saved

. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endPoint_`step' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         rename Target endPoint_`step'
 16.         rename Source endPoint_`nextStep'
 17.         }
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------
(3,080 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,814
        from master                       959  (_merge==1)
        from using                        855  (_merge==2)

    matched                                35  (_merge==3)
    -----------------------------------------
(855 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,502
        from master                       990  (_merge==1)
        from using                      3,512  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(3,512 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)

.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n

. gen sales = finalSale if n==1
(850 missing values generated)

. egen totSales = sum(sales)

. gen salesSh = sales/totSales
(850 missing values generated)

. gen sales_mu0 = sales/mu_0
(850 missing values generated)

. *egen totSales_mu0 = sum(sales_mu0)
. *gen ratio_mu0 = totSales/totSales_mu0                                                         
>                          //18%, looks credible
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
(273 missing values generated)

. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)

. gen pi_1 = exp(ln_pi_1) if n == 1
(788 missing values generated)

. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
(964 missing values generated)

. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)

. gen pi_2 = exp(ln_pi_2) if n == 1
(788 missing values generated)

. 
end of do-file

. su pi_2

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        pi_2 |        206    1.000005    .0000636          1   1.000909

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. use "$wd/data/006_network&Markups/006_endPoint1980_wide.dta", clear

. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey

. gen year = 1980

. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepusing(mu_1 s
> ale)
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(3,371 observations deleted)

. drop _merge

. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(408,064 observations deleted)

. drop _merge

. 
. rename sale finalSale

. rename mu_1 mu_0

. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 

. rename endPoint_1 Source

. merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------

. drop if _merge == 2
(34 observations deleted)

. drop _merge

. rename a a10

. rename Target endPoint_0

. rename Source endPoint_1

. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
  2.         local nextStep = `step'+1
  3.         local previousStep = `step'-1
  4.         rename endPoint_`step' gvkey
  5.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups1980.dta", keepu
> sing(mu) //markups
  6.         drop if _merge == 2
  7.         drop _merge
  8.         rename mu mu_`step'
  9.         rename gvkey Target 
 10.         rename endPoint_`nextStep' Source
 11.         merge m:1 Source Target year using "$data/007_aij1980.dta", keepusing(a)
 12.         drop if _merge == 2
 13.         drop _merge
 14.         rename a a`nextStep'`step'
 15.         rename Target endPoint_`step'
 16.         rename Source endPoint_`nextStep'
 17.         }
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------
(3,080 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,814
        from master                       959  (_merge==1)
        from using                        855  (_merge==2)

    matched                                35  (_merge==3)
    -----------------------------------------
(855 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,502
        from master                       990  (_merge==1)
        from using                      3,512  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(3,512 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)

.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n

. gen sales = finalSale if n==1
(850 missing values generated)

. egen totSales = sum(sales)

. gen salesSh = sales/totSales
(850 missing values generated)

. gen sales_mu0 = sales/mu_0
(850 missing values generated)

. *egen totSales_mu0 = sum(sales_mu0)
. *gen ratio_mu0 = totSales/totSales_mu0                                                         
>                          //18%, looks credible
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
(273 missing values generated)

. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)

. gen pi_1 = exp(ln_pi_1) if n == 1
(788 missing values generated)

. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
(964 missing values generated)

. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)

. gen pi_2 = exp(ln_pi_2) if n == 1
(788 missing values generated)

. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
(990 missing values generated)

. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)

. gen pi_3 = exp(ln_pi_3) if n == 1
(788 missing values generated)

. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
(994 missing values generated)

. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)

. gen pi_4 = exp(ln_pi_4) if n == 1
(788 missing values generated)

. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
(994 missing values generated)

. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)

. gen pi_5 = exp(ln_pi_5) if n == 1
(788 missing values generated)

. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
(994 missing values generated)

. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)

. gen pi_6 = exp(ln_pi_6) if n == 1
(788 missing values generated)

. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
(994 missing values generated)

. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)

. gen pi_7 = exp(ln_pi_7) if n == 1
(788 missing values generated)

. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
(994 missing values generated)

. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)

. gen pi_8 = exp(ln_pi_8) if n == 1
(788 missing values generated)

. 
end of do-file

. br pi_*

. br mu_0 pi_*

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen denom = mu_0*p_1*p_2*p_3*p_4*p_5*p_6*p_7*p_8
p_1 not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
(850 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. egen totSales_mu0 = sum(sales_mu0)

. gen ratio_mu0 = totSales/totSales_mu0                                                          
>                          //18%, looks credible 

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. su ratio_mu0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |        994    1.184584           0   1.184584   1.184584

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen gen sales_mu = sales/denom
too many variables specified
r(103);

end of do-file

r(103);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen sales_mu = sales/denom
(850 missing values generated)

. 
end of do-file

. scatter sales_mu sales_mu0

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. egen totSales_mu = sum(sales_mu)

. gen ratio_mu = totSales/totSales_mu                                                            
>                          //18%, looks credible 

. su ratio_mu

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |        994    1.190332           0   1.190332   1.190332

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. su ratio_mu0

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |        994    1.184584           0   1.184584   1.184584

. global mu0_1980 = `r(mean)'

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. su ratio_mu

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |        994    1.190332           0   1.190332   1.190332

. global mu_1980 = `r(mean)'

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. di $mu0_1980, $mu_1980
1.1845839 1.1903316

. 
end of do-file

. do "/Users/ios/Documents/GitHub/mres_paper/code/mres_007_welfare.do"

. 
. /*******************************************************************************
>         
>         DESCRIPTION: Generation of welfare statistics
>         
>         INFILES:        - 
>         
>         OUTFILES:       - 
>         
>         LOG: Created 04/05/2020
>                         Last modified XX/05/2020
>         
> *******************************************************************************/
. 
. /*******************************************************************************
>         SETUP
> *******************************************************************************/
. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-scheme-moder
> n/master/")
> ssc install gtools
> gtools, upgrade*/
. 
. set scheme modern, perm
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                                             
>          // I'm using a different orig folder so as not to commit large datasets to GitHub

. global data "$wd/data/007_welfare"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. global DLEU "$orig/Data DLEU"

. 
. *do-file number, used to save outputs 
. global doNum "007"                                      

. 
. *log
. cap log close
-------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   4 May 2020, 19:40:17

. 
. 
. /*******************************************************************************
>         Getting the all the supply chains leading to final demand
> *******************************************************************************/
. 
. forval y = `y'(3)2016{
  2. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  3. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  4. gen a = salecs_supplier/sales_customer
  5. keep Source comp_supplier comp_customer Target year3 a
  6. rename year3 year
  7. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. di $mu0_`y', $mu_`y'
 85. }
invalid syntax
r(198);

end of do-file

r(198);

. do "/Users/ios/Documents/GitHub/mres_paper/code/mres_007_welfare.do"

. 
. /*******************************************************************************
>         
>         DESCRIPTION: Generation of welfare statistics
>         
>         INFILES:        - 
>         
>         OUTFILES:       - 
>         
>         LOG: Created 04/05/2020
>                         Last modified XX/05/2020
>         
> *******************************************************************************/
. 
. /*******************************************************************************
>         SETUP
> *******************************************************************************/
. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-scheme-moder
> n/master/")
> ssc install gtools
> gtools, upgrade*/
. 
. set scheme modern, perm
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                                             
>          // I'm using a different orig folder so as not to commit large datasets to GitHub

. global data "$wd/data/007_welfare"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. global DLEU "$orig/Data DLEU"

. 
. *do-file number, used to save outputs 
. global doNum "007"                                      

. 
. *log
. cap log close
-------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   4 May 2020, 19:40:50

. 
. 
. /*******************************************************************************
>         Getting the all the supply chains leading to final demand
> *******************************************************************************/
. 
. forval y = 1980(3)2016{
  2. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  3. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  4. gen a = salecs_supplier/sales_customer
  5. keep Source comp_supplier comp_customer Target year3 a
  6. rename year3 year
  7. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. di $mu0_`y', $mu_`y'
 85. }
(2 real changes made)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1980.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,486
        from master                       115  (_merge==1)
        from using                      3,371  (_merge==2)

    matched                               879  (_merge==3)
    -----------------------------------------
(3,371 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,095
        from master                        31  (_merge==1)
        from using                    408,064  (_merge==2)

    matched                               963  (_merge==3)
    -----------------------------------------
(408,064 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                               994  (_merge==3)
    -----------------------------------------
(34 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,353
        from master                       273  (_merge==1)
        from using                      3,080  (_merge==2)

    matched                               721  (_merge==3)
    -----------------------------------------
(3,080 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,814
        from master                       959  (_merge==1)
        from using                        855  (_merge==2)

    matched                                35  (_merge==3)
    -----------------------------------------
(855 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,457
        from master                       964  (_merge==1)
        from using                      3,493  (_merge==2)

    matched                                30  (_merge==3)
    -----------------------------------------
(3,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,870
        from master                       990  (_merge==1)
        from using                        880  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(880 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,502
        from master                       990  (_merge==1)
        from using                      3,512  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(3,512 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,509
        from master                       994  (_merge==1)
        from using                      3,515  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,515 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         1,877
        from master                       994  (_merge==1)
        from using                        883  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(883 observations deleted)
(850 missing values generated)
(850 missing values generated)
(850 missing values generated)
(273 missing values generated)
(788 missing values generated)
(964 missing values generated)
(788 missing values generated)
(990 missing values generated)
(788 missing values generated)
(994 missing values generated)
(788 missing values generated)
(994 missing values generated)
(788 missing values generated)
(994 missing values generated)
(788 missing values generated)
(994 missing values generated)
(788 missing values generated)
(994 missing values generated)
(788 missing values generated)
(850 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |        994    1.184584           0   1.184584   1.184584
(850 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |        994    1.190332           0   1.190332   1.190332
1980 1980
(11 missing values generated)
(19 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1983.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1983.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,591
        from master                       156  (_merge==1)
        from using                      4,435  (_merge==2)

    matched                             1,061  (_merge==3)
    -----------------------------------------
(4,435 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       408,009
        from master                        24  (_merge==1)
        from using                    407,985  (_merge==2)

    matched                             1,193  (_merge==3)
    -----------------------------------------
(407,985 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                            90
        from master                         0  (_merge==1)
        from using                         90  (_merge==2)

    matched                             1,217  (_merge==3)
    -----------------------------------------
(90 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,307
        from master                       290  (_merge==1)
        from using                      4,017  (_merge==2)

    matched                               927  (_merge==3)
    -----------------------------------------
(4,017 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         2,288
        from master                     1,123  (_merge==1)
        from using                      1,165  (_merge==2)

    matched                                94  (_merge==3)
    -----------------------------------------
(1,165 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,727
        from master                     1,145  (_merge==1)
        from using                      4,582  (_merge==2)

    matched                                72  (_merge==3)
    -----------------------------------------
(4,582 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         2,461
        from master                     1,213  (_merge==1)
        from using                      1,248  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(1,248 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,855
        from master                     1,214  (_merge==1)
        from using                      4,641  (_merge==2)

    matched                                 3  (_merge==3)
    -----------------------------------------
(4,641 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         2,469
        from master                     1,217  (_merge==1)
        from using                      1,252  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,252 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,861
        from master                     1,217  (_merge==1)
        from using                      4,644  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(4,644 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         2,469
        from master                     1,217  (_merge==1)
        from using                      1,252  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,252 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,861
        from master                     1,217  (_merge==1)
        from using                      4,644  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(4,644 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         2,469
        from master                     1,217  (_merge==1)
        from using                      1,252  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,252 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,861
        from master                     1,217  (_merge==1)
        from using                      4,644  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(4,644 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         2,469
        from master                     1,217  (_merge==1)
        from using                      1,252  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,252 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,861
        from master                     1,217  (_merge==1)
        from using                      4,644  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(4,644 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         2,469
        from master                     1,217  (_merge==1)
        from using                      1,252  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,252 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,861
        from master                     1,217  (_merge==1)
        from using                      4,644  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(4,644 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         2,469
        from master                     1,217  (_merge==1)
        from using                      1,252  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,252 observations deleted)
(1,008 missing values generated)
(1,008 missing values generated)
(1,008 missing values generated)
(290 missing values generated)
(942 missing values generated)
(1,145 missing values generated)
(942 missing values generated)
(1,214 missing values generated)
(942 missing values generated)
(1,217 missing values generated)
(942 missing values generated)
(1,217 missing values generated)
(942 missing values generated)
(1,217 missing values generated)
(942 missing values generated)
(1,217 missing values generated)
(942 missing values generated)
(1,217 missing values generated)
(942 missing values generated)
(1,008 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |      1,217    1.197885           0   1.197885   1.197885
(1,008 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |      1,217    1.204741           0   1.204741   1.204741
1983 1983
(7 missing values generated)
(13 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1986.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1986.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,527
        from master                       278  (_merge==1)
        from using                      5,249  (_merge==2)

    matched                             1,491  (_merge==3)
    -----------------------------------------
(5,249 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       407,959
        from master                        37  (_merge==1)
        from using                    407,922  (_merge==2)

    matched                             1,732  (_merge==3)
    -----------------------------------------
(407,922 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                           130
        from master                         1  (_merge==1)
        from using                        129  (_merge==2)

    matched                             1,768  (_merge==3)
    -----------------------------------------
(129 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,954
        from master                       355  (_merge==1)
        from using                      4,599  (_merge==2)

    matched                             1,414  (_merge==3)
    -----------------------------------------
(4,599 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,321
        from master                     1,630  (_merge==1)
        from using                      1,691  (_merge==2)

    matched                               139  (_merge==3)
    -----------------------------------------
(1,691 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,063
        from master                     1,659  (_merge==1)
        from using                      5,404  (_merge==2)

    matched                               110  (_merge==3)
    -----------------------------------------
(5,404 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,574
        from master                     1,762  (_merge==1)
        from using                      1,812  (_merge==2)

    matched                                 7  (_merge==3)
    -----------------------------------------
(1,812 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,255
        from master                     1,762  (_merge==1)
        from using                      5,493  (_merge==2)

    matched                                 7  (_merge==3)
    -----------------------------------------
(5,493 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,586
        from master                     1,769  (_merge==1)
        from using                      1,817  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,817 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,267
        from master                     1,769  (_merge==1)
        from using                      5,498  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,498 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,586
        from master                     1,769  (_merge==1)
        from using                      1,817  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,817 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,267
        from master                     1,769  (_merge==1)
        from using                      5,498  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,498 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,586
        from master                     1,769  (_merge==1)
        from using                      1,817  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,817 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,267
        from master                     1,769  (_merge==1)
        from using                      5,498  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,498 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,586
        from master                     1,769  (_merge==1)
        from using                      1,817  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,817 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,267
        from master                     1,769  (_merge==1)
        from using                      5,498  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,498 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,586
        from master                     1,769  (_merge==1)
        from using                      1,817  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,817 observations deleted)
(note: variable gvkey was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,267
        from master                     1,769  (_merge==1)
        from using                      5,498  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,498 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,586
        from master                     1,769  (_merge==1)
        from using                      1,817  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,817 observations deleted)
(1,520 missing values generated)
(1,520 missing values generated)
(1,520 missing values generated)
(355 missing values generated)
(1,422 missing values generated)
(1,659 missing values generated)
(1,422 missing values generated)
(1,762 missing values generated)
(1,422 missing values generated)
(1,769 missing values generated)
(1,422 missing values generated)
(1,769 missing values generated)
(1,422 missing values generated)
(1,769 missing values generated)
(1,422 missing values generated)
(1,769 missing values generated)
(1,422 missing values generated)
(1,769 missing values generated)
(1,422 missing values generated)
(1,520 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |      1,769    1.214764           0   1.214764   1.214764
(1,520 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |      1,769    1.225034           0   1.225034   1.225034
1986 1986
(4 missing values generated)
(6 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1989.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1989.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,424
        from master                       371  (_merge==1)
        from using                      5,053  (_merge==2)

    matched                             1,310  (_merge==3)
    -----------------------------------------
(5,053 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       407,944
        from master                        28  (_merge==1)
        from using                    407,916  (_merge==2)

    matched                             1,653  (_merge==3)
    -----------------------------------------
(407,916 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                            98
        from master                         3  (_merge==1)
        from using                         95  (_merge==2)

    matched                             1,678  (_merge==3)
    -----------------------------------------
(95 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,782
        from master                       349  (_merge==1)
        from using                      4,433  (_merge==2)

    matched                             1,332  (_merge==3)
    -----------------------------------------
(4,433 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,205
        from master                     1,578  (_merge==1)
        from using                      1,627  (_merge==2)

    matched                               103  (_merge==3)
    -----------------------------------------
(1,627 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,842
        from master                     1,608  (_merge==1)
        from using                      5,234  (_merge==2)

    matched                                73  (_merge==3)
    -----------------------------------------
(5,234 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,393
        from master                     1,676  (_merge==1)
        from using                      1,717  (_merge==2)

    matched                                 5  (_merge==3)
    -----------------------------------------
(1,717 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,972
        from master                     1,678  (_merge==1)
        from using                      5,294  (_merge==2)

    matched                                 3  (_merge==3)
    -----------------------------------------
(5,294 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,400
        from master                     1,681  (_merge==1)
        from using                      1,719  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,719 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,976
        from master                     1,681  (_merge==1)
        from using                      5,295  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,295 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,400
        from master                     1,681  (_merge==1)
        from using                      1,719  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,719 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,976
        from master                     1,681  (_merge==1)
        from using                      5,295  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,295 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,400
        from master                     1,681  (_merge==1)
        from using                      1,719  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,719 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,976
        from master                     1,681  (_merge==1)
        from using                      5,295  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,295 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,400
        from master                     1,681  (_merge==1)
        from using                      1,719  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,719 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,976
        from master                     1,681  (_merge==1)
        from using                      5,295  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,295 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,400
        from master                     1,681  (_merge==1)
        from using                      1,719  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,719 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,976
        from master                     1,681  (_merge==1)
        from using                      5,295  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,295 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,400
        from master                     1,681  (_merge==1)
        from using                      1,719  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(1,719 observations deleted)
(1,439 missing values generated)
(1,439 missing values generated)
(1,439 missing values generated)
(349 missing values generated)
(1,331 missing values generated)
(1,608 missing values generated)
(1,331 missing values generated)
(1,678 missing values generated)
(1,331 missing values generated)
(1,681 missing values generated)
(1,331 missing values generated)
(1,681 missing values generated)
(1,331 missing values generated)
(1,681 missing values generated)
(1,331 missing values generated)
(1,681 missing values generated)
(1,331 missing values generated)
(1,681 missing values generated)
(1,331 missing values generated)
(1,439 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |      1,681      1.2562           0     1.2562     1.2562
(1,439 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |      1,681    1.264908           0   1.264908   1.264908
1989 1989
(10 missing values generated)
(15 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1992.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1992.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,917
        from master                       464  (_merge==1)
        from using                      5,453  (_merge==2)

    matched                             1,530  (_merge==3)
    -----------------------------------------
(5,453 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       407,893
        from master                        14  (_merge==1)
        from using                    407,879  (_merge==2)

    matched                             1,980  (_merge==3)
    -----------------------------------------
(407,879 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                           138
        from master                         6  (_merge==1)
        from using                        132  (_merge==2)

    matched                             1,988  (_merge==3)
    -----------------------------------------
(132 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,101
        from master                       424  (_merge==1)
        from using                      4,677  (_merge==2)

    matched                             1,570  (_merge==3)
    -----------------------------------------
(4,677 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         3,769
        from master                     1,849  (_merge==1)
        from using                      1,920  (_merge==2)

    matched                               145  (_merge==3)
    -----------------------------------------
(1,920 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,527
        from master                     1,890  (_merge==1)
        from using                      5,637  (_merge==2)

    matched                               104  (_merge==3)
    -----------------------------------------
(5,637 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,030
        from master                     1,985  (_merge==1)
        from using                      2,045  (_merge==2)

    matched                                 9  (_merge==3)
    -----------------------------------------
(2,045 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,706
        from master                     1,987  (_merge==1)
        from using                      5,719  (_merge==2)

    matched                                 7  (_merge==3)
    -----------------------------------------
(5,719 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,039
        from master                     1,992  (_merge==1)
        from using                      2,047  (_merge==2)

    matched                                 2  (_merge==3)
    -----------------------------------------
(2,047 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,715
        from master                     1,994  (_merge==1)
        from using                      5,721  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,721 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,039
        from master                     1,992  (_merge==1)
        from using                      2,047  (_merge==2)

    matched                                 2  (_merge==3)
    -----------------------------------------
(2,047 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,715
        from master                     1,994  (_merge==1)
        from using                      5,721  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,721 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,039
        from master                     1,992  (_merge==1)
        from using                      2,047  (_merge==2)

    matched                                 2  (_merge==3)
    -----------------------------------------
(2,047 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,715
        from master                     1,994  (_merge==1)
        from using                      5,721  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,721 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,039
        from master                     1,992  (_merge==1)
        from using                      2,047  (_merge==2)

    matched                                 2  (_merge==3)
    -----------------------------------------
(2,047 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,715
        from master                     1,994  (_merge==1)
        from using                      5,721  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,721 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,039
        from master                     1,992  (_merge==1)
        from using                      2,047  (_merge==2)

    matched                                 2  (_merge==3)
    -----------------------------------------
(2,047 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,715
        from master                     1,994  (_merge==1)
        from using                      5,721  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(5,721 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,039
        from master                     1,992  (_merge==1)
        from using                      2,047  (_merge==2)

    matched                                 2  (_merge==3)
    -----------------------------------------
(2,047 observations deleted)
(1,726 missing values generated)
(1,726 missing values generated)
(1,726 missing values generated)
(424 missing values generated)
(1,615 missing values generated)
(1,890 missing values generated)
(1,615 missing values generated)
(1,987 missing values generated)
(1,615 missing values generated)
(1,994 missing values generated)
(1,615 missing values generated)
(1,994 missing values generated)
(1,615 missing values generated)
(1,994 missing values generated)
(1,615 missing values generated)
(1,994 missing values generated)
(1,615 missing values generated)
(1,994 missing values generated)
(1,615 missing values generated)
(1,726 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |      1,994    1.276399           0   1.276399   1.276399
(1,726 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |      1,994    1.292598           0   1.292598   1.292598
1992 1992
(8 missing values generated)
(21 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1995.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1995.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,554
        from master                       643  (_merge==1)
        from using                      6,911  (_merge==2)

    matched                             1,944  (_merge==3)
    -----------------------------------------
(6,911 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       407,877
        from master                        75  (_merge==1)
        from using                    407,802  (_merge==2)

    matched                             2,512  (_merge==3)
    -----------------------------------------
(407,802 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                           232
        from master                        10  (_merge==1)
        from using                        222  (_merge==2)

    matched                             2,577  (_merge==3)
    -----------------------------------------
(222 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,471
        from master                       541  (_merge==1)
        from using                      5,930  (_merge==2)

    matched                             2,046  (_merge==3)
    -----------------------------------------
(5,930 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,788
        from master                     2,329  (_merge==1)
        from using                      2,459  (_merge==2)

    matched                               258  (_merge==3)
    -----------------------------------------
(2,459 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,474
        from master                     2,384  (_merge==1)
        from using                      7,090  (_merge==2)

    matched                               203  (_merge==3)
    -----------------------------------------
(7,090 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,223
        from master                     2,567  (_merge==1)
        from using                      2,656  (_merge==2)

    matched                                20  (_merge==3)
    -----------------------------------------
(2,656 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,816
        from master                     2,576  (_merge==1)
        from using                      7,240  (_merge==2)

    matched                                11  (_merge==3)
    -----------------------------------------
(7,240 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,253
        from master                     2,583  (_merge==1)
        from using                      2,670  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(2,670 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,833
        from master                     2,586  (_merge==1)
        from using                      7,247  (_merge==2)

    matched                                 1  (_merge==3)
    -----------------------------------------
(7,247 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,253
        from master                     2,583  (_merge==1)
        from using                      2,670  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(2,670 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,833
        from master                     2,586  (_merge==1)
        from using                      7,247  (_merge==2)

    matched                                 1  (_merge==3)
    -----------------------------------------
(7,247 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,253
        from master                     2,583  (_merge==1)
        from using                      2,670  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(2,670 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,833
        from master                     2,586  (_merge==1)
        from using                      7,247  (_merge==2)

    matched                                 1  (_merge==3)
    -----------------------------------------
(7,247 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,253
        from master                     2,583  (_merge==1)
        from using                      2,670  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(2,670 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,833
        from master                     2,586  (_merge==1)
        from using                      7,247  (_merge==2)

    matched                                 1  (_merge==3)
    -----------------------------------------
(7,247 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,253
        from master                     2,583  (_merge==1)
        from using                      2,670  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(2,670 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,833
        from master                     2,586  (_merge==1)
        from using                      7,247  (_merge==2)

    matched                                 1  (_merge==3)
    -----------------------------------------
(7,247 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,253
        from master                     2,583  (_merge==1)
        from using                      2,670  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(2,670 observations deleted)
(2,250 missing values generated)
(2,250 missing values generated)
(2,250 missing values generated)
(541 missing values generated)
(2,116 missing values generated)
(2,384 missing values generated)
(2,116 missing values generated)
(2,576 missing values generated)
(2,116 missing values generated)
(2,586 missing values generated)
(2,116 missing values generated)
(2,586 missing values generated)
(2,116 missing values generated)
(2,586 missing values generated)
(2,116 missing values generated)
(2,586 missing values generated)
(2,116 missing values generated)
(2,586 missing values generated)
(2,116 missing values generated)
(2,250 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |      2,587    1.297031           0   1.297031   1.297031
(2,250 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |      2,587    1.311844           0   1.311844   1.311844
1995 1995
(17 missing values generated)
(49 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1998.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij1998.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,883
        from master                       912  (_merge==1)
        from using                      6,971  (_merge==2)

    matched                             2,051  (_merge==3)
    -----------------------------------------
(6,971 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       407,645
        from master                        47  (_merge==1)
        from using                    407,598  (_merge==2)

    matched                             2,916  (_merge==3)
    -----------------------------------------
(407,598 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                           342
        from master                         3  (_merge==1)
        from using                        339  (_merge==2)

    matched                             2,960  (_merge==3)
    -----------------------------------------
(339 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,605
        from master                       574  (_merge==1)
        from using                      6,031  (_merge==2)

    matched                             2,389  (_merge==3)
    -----------------------------------------
(6,031 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,354
        from master                     2,573  (_merge==1)
        from using                      2,781  (_merge==2)

    matched                               390  (_merge==3)
    -----------------------------------------
(2,781 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,889
        from master                     2,661  (_merge==1)
        from using                      7,228  (_merge==2)

    matched                               302  (_merge==3)
    -----------------------------------------
(7,228 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,997
        from master                     2,928  (_merge==1)
        from using                      3,069  (_merge==2)

    matched                                35  (_merge==3)
    -----------------------------------------
(3,069 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                        10,341
        from master                     2,934  (_merge==1)
        from using                      7,407  (_merge==2)

    matched                                29  (_merge==3)
    -----------------------------------------
(7,407 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,061
        from master                     2,963  (_merge==1)
        from using                      3,098  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,098 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                        10,391
        from master                     2,963  (_merge==1)
        from using                      7,428  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(7,428 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,061
        from master                     2,963  (_merge==1)
        from using                      3,098  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,098 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                        10,391
        from master                     2,963  (_merge==1)
        from using                      7,428  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(7,428 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,061
        from master                     2,963  (_merge==1)
        from using                      3,098  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,098 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                        10,391
        from master                     2,963  (_merge==1)
        from using                      7,428  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(7,428 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,061
        from master                     2,963  (_merge==1)
        from using                      3,098  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,098 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                        10,391
        from master                     2,963  (_merge==1)
        from using                      7,428  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(7,428 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,061
        from master                     2,963  (_merge==1)
        from using                      3,098  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,098 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                        10,391
        from master                     2,963  (_merge==1)
        from using                      7,428  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(7,428 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,061
        from master                     2,963  (_merge==1)
        from using                      3,098  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,098 observations deleted)
(2,506 missing values generated)
(2,506 missing values generated)
(2,506 missing values generated)
(574 missing values generated)
(2,287 missing values generated)
(2,661 missing values generated)
(2,287 missing values generated)
(2,934 missing values generated)
(2,287 missing values generated)
(2,963 missing values generated)
(2,287 missing values generated)
(2,963 missing values generated)
(2,287 missing values generated)
(2,963 missing values generated)
(2,287 missing values generated)
(2,963 missing values generated)
(2,287 missing values generated)
(2,963 missing values generated)
(2,287 missing values generated)
(2,506 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |      2,963    1.297252           0   1.297252   1.297252
(2,506 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |      2,963    1.332449           0   1.332449   1.332449
1998 1998
(17 missing values generated)
(68 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij2001.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij2001.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,208
        from master                     1,105  (_merge==1)
        from using                      6,103  (_merge==2)

    matched                             2,201  (_merge==3)
    -----------------------------------------
(6,103 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       407,690
        from master                        90  (_merge==1)
        from using                    407,600  (_merge==2)

    matched                             3,216  (_merge==3)
    -----------------------------------------
(407,600 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                           668
        from master                         0  (_merge==1)
        from using                        668  (_merge==2)

    matched                             3,306  (_merge==3)
    -----------------------------------------
(668 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,935
        from master                       711  (_merge==1)
        from using                      5,224  (_merge==2)

    matched                             2,595  (_merge==3)
    -----------------------------------------
(5,224 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,544
        from master                     2,564  (_merge==1)
        from using                      2,980  (_merge==2)

    matched                               742  (_merge==3)
    -----------------------------------------
(2,980 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,908
        from master                     2,702  (_merge==1)
        from using                      6,206  (_merge==2)

    matched                               604  (_merge==3)
    -----------------------------------------
(6,206 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,533
        from master                     3,137  (_merge==1)
        from using                      3,396  (_merge==2)

    matched                               169  (_merge==3)
    -----------------------------------------
(3,396 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,638
        from master                     3,171  (_merge==1)
        from using                      6,467  (_merge==2)

    matched                               135  (_merge==3)
    -----------------------------------------
(6,467 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,779
        from master                     3,277  (_merge==1)
        from using                      3,502  (_merge==2)

    matched                                29  (_merge==3)
    -----------------------------------------
(3,502 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,809
        from master                     3,281  (_merge==1)
        from using                      6,528  (_merge==2)

    matched                                25  (_merge==3)
    -----------------------------------------
(6,528 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,827
        from master                     3,303  (_merge==1)
        from using                      3,524  (_merge==2)

    matched                                 3  (_merge==3)
    -----------------------------------------
(3,524 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,849
        from master                     3,303  (_merge==1)
        from using                      6,546  (_merge==2)

    matched                                 3  (_merge==3)
    -----------------------------------------
(6,546 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,833
        from master                     3,306  (_merge==1)
        from using                      3,527  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,527 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,855
        from master                     3,306  (_merge==1)
        from using                      6,549  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(6,549 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,833
        from master                     3,306  (_merge==1)
        from using                      3,527  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,527 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,855
        from master                     3,306  (_merge==1)
        from using                      6,549  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(6,549 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,833
        from master                     3,306  (_merge==1)
        from using                      3,527  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,527 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,855
        from master                     3,306  (_merge==1)
        from using                      6,549  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(6,549 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,833
        from master                     3,306  (_merge==1)
        from using                      3,527  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(3,527 observations deleted)
(2,860 missing values generated)
(2,860 missing values generated)
(2,860 missing values generated)
(711 missing values generated)
(2,596 missing values generated)
(2,702 missing values generated)
(2,596 missing values generated)
(3,171 missing values generated)
(2,596 missing values generated)
(3,281 missing values generated)
(2,596 missing values generated)
(3,303 missing values generated)
(2,596 missing values generated)
(3,306 missing values generated)
(2,596 missing values generated)
(3,306 missing values generated)
(2,596 missing values generated)
(3,306 missing values generated)
(2,596 missing values generated)
(2,860 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |      3,306    1.333655           0   1.333655   1.333655
(2,860 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |      3,306      1.3714           0     1.3714     1.3714
2001 2001
(12 missing values generated)
(46 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij2004.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij2004.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,267
        from master                       615  (_merge==1)
        from using                      5,652  (_merge==2)

    matched                             2,660  (_merge==3)
    -----------------------------------------
(5,652 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       407,648
        from master                        69  (_merge==1)
        from using                    407,579  (_merge==2)

    matched                             3,206  (_merge==3)
    -----------------------------------------
(407,579 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                           778
        from master                        27  (_merge==1)
        from using                        751  (_merge==2)

    matched                             3,248  (_merge==3)
    -----------------------------------------
(751 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,825
        from master                       926  (_merge==1)
        from using                      4,899  (_merge==2)

    matched                             2,349  (_merge==3)
    -----------------------------------------
(4,899 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,398
        from master                     2,424  (_merge==1)
        from using                      2,974  (_merge==2)

    matched                               851  (_merge==3)
    -----------------------------------------
(2,974 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,425
        from master                     2,622  (_merge==1)
        from using                      5,803  (_merge==2)

    matched                               653  (_merge==3)
    -----------------------------------------
(5,803 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,286
        from master                     2,975  (_merge==1)
        from using                      3,311  (_merge==2)

    matched                               300  (_merge==3)
    -----------------------------------------
(3,311 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,108
        from master                     3,087  (_merge==1)
        from using                      6,021  (_merge==2)

    matched                               188  (_merge==3)
    -----------------------------------------
(6,021 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,520
        from master                     3,142  (_merge==1)
        from using                      3,378  (_merge==2)

    matched                               133  (_merge==3)
    -----------------------------------------
(3,378 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,247
        from master                     3,186  (_merge==1)
        from using                      6,061  (_merge==2)

    matched                                89  (_merge==3)
    -----------------------------------------
(6,061 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,706
        from master                     3,243  (_merge==1)
        from using                      3,463  (_merge==2)

    matched                                32  (_merge==3)
    -----------------------------------------
(3,463 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,366
        from master                     3,252  (_merge==1)
        from using                      6,114  (_merge==2)

    matched                                23  (_merge==3)
    -----------------------------------------
(6,114 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,718
        from master                     3,253  (_merge==1)
        from using                      3,465  (_merge==2)

    matched                                22  (_merge==3)
    -----------------------------------------
(3,465 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,383
        from master                     3,263  (_merge==1)
        from using                      6,120  (_merge==2)

    matched                                12  (_merge==3)
    -----------------------------------------
(6,120 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,734
        from master                     3,261  (_merge==1)
        from using                      3,473  (_merge==2)

    matched                                14  (_merge==3)
    -----------------------------------------
(3,473 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,391
        from master                     3,267  (_merge==1)
        from using                      6,124  (_merge==2)

    matched                                 8  (_merge==3)
    -----------------------------------------
(6,124 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,738
        from master                     3,263  (_merge==1)
        from using                      3,475  (_merge==2)

    matched                                12  (_merge==3)
    -----------------------------------------
(3,475 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         9,389
        from master                     3,266  (_merge==1)
        from using                      6,123  (_merge==2)

    matched                                 9  (_merge==3)
    -----------------------------------------
(6,123 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,740
        from master                     3,264  (_merge==1)
        from using                      3,476  (_merge==2)

    matched                                11  (_merge==3)
    -----------------------------------------
(3,476 observations deleted)
(2,801 missing values generated)
(2,801 missing values generated)
(2,801 missing values generated)
(926 missing values generated)
(2,578 missing values generated)
(2,622 missing values generated)
(2,578 missing values generated)
(3,087 missing values generated)
(2,578 missing values generated)
(3,186 missing values generated)
(2,578 missing values generated)
(3,252 missing values generated)
(2,578 missing values generated)
(3,263 missing values generated)
(2,578 missing values generated)
(3,267 missing values generated)
(2,578 missing values generated)
(3,266 missing values generated)
(2,578 missing values generated)
(2,801 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |      3,275    1.357684           0   1.357684   1.357684
(2,801 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |      3,275    1.410938           0   1.410938   1.410938
2004 2004
(8 missing values generated)
(43 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij2007.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij2007.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,760
        from master                       613  (_merge==1)
        from using                      5,147  (_merge==2)

    matched                             2,395  (_merge==3)
    -----------------------------------------
(5,147 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       407,746
        from master                       112  (_merge==1)
        from using                    407,634  (_merge==2)

    matched                             2,896  (_merge==3)
    -----------------------------------------
(407,634 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                           702
        from master                        60  (_merge==1)
        from using                        642  (_merge==2)

    matched                             2,948  (_merge==3)
    -----------------------------------------
(642 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,393
        from master                       917  (_merge==1)
        from using                      4,476  (_merge==2)

    matched                             2,091  (_merge==3)
    -----------------------------------------
(4,476 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,131
        from master                     2,332  (_merge==1)
        from using                      2,799  (_merge==2)

    matched                               676  (_merge==3)
    -----------------------------------------
(2,799 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,883
        from master                     2,547  (_merge==1)
        from using                      5,336  (_merge==2)

    matched                               461  (_merge==3)
    -----------------------------------------
(5,336 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,816
        from master                     2,771  (_merge==1)
        from using                      3,045  (_merge==2)

    matched                               237  (_merge==3)
    -----------------------------------------
(3,045 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,347
        from master                     2,851  (_merge==1)
        from using                      5,496  (_merge==2)

    matched                               157  (_merge==3)
    -----------------------------------------
(5,496 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,111
        from master                     2,941  (_merge==1)
        from using                      3,170  (_merge==2)

    matched                                67  (_merge==3)
    -----------------------------------------
(3,170 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,540
        from master                     2,971  (_merge==1)
        from using                      5,569  (_merge==2)

    matched                                37  (_merge==3)
    -----------------------------------------
(5,569 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,198
        from master                     2,989  (_merge==1)
        from using                      3,209  (_merge==2)

    matched                                19  (_merge==3)
    -----------------------------------------
(3,209 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,583
        from master                     2,999  (_merge==1)
        from using                      5,584  (_merge==2)

    matched                                 9  (_merge==3)
    -----------------------------------------
(5,584 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,220
        from master                     3,001  (_merge==1)
        from using                      3,219  (_merge==2)

    matched                                 7  (_merge==3)
    -----------------------------------------
(3,219 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,589
        from master                     3,002  (_merge==1)
        from using                      5,587  (_merge==2)

    matched                                 6  (_merge==3)
    -----------------------------------------
(5,587 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,224
        from master                     3,004  (_merge==1)
        from using                      3,220  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(3,220 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,591
        from master                     3,004  (_merge==1)
        from using                      5,587  (_merge==2)

    matched                                 4  (_merge==3)
    -----------------------------------------
(5,587 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,227
        from master                     3,006  (_merge==1)
        from using                      3,221  (_merge==2)

    matched                                 2  (_merge==3)
    -----------------------------------------
(3,221 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,594
        from master                     3,006  (_merge==1)
        from using                      5,588  (_merge==2)

    matched                                 2  (_merge==3)
    -----------------------------------------
(5,588 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,227
        from master                     3,006  (_merge==1)
        from using                      3,221  (_merge==2)

    matched                                 2  (_merge==3)
    -----------------------------------------
(3,221 observations deleted)
(2,566 missing values generated)
(2,566 missing values generated)
(2,566 missing values generated)
(917 missing values generated)
(2,360 missing values generated)
(2,547 missing values generated)
(2,360 missing values generated)
(2,851 missing values generated)
(2,360 missing values generated)
(2,971 missing values generated)
(2,360 missing values generated)
(2,999 missing values generated)
(2,360 missing values generated)
(3,002 missing values generated)
(2,360 missing values generated)
(3,004 missing values generated)
(2,360 missing values generated)
(3,006 missing values generated)
(2,360 missing values generated)
(2,566 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |      3,008    1.311616           0   1.311616   1.311616
(2,566 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |      3,008    1.346854           0   1.346854   1.346854
2007 2007
(10 missing values generated)
(29 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij2010.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij2010.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,160
        from master                       456  (_merge==1)
        from using                      4,704  (_merge==2)

    matched                             2,533  (_merge==3)
    -----------------------------------------
(4,704 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       407,651
        from master                        55  (_merge==1)
        from using                    407,596  (_merge==2)

    matched                             2,934  (_merge==3)
    -----------------------------------------
(407,596 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                           684
        from master                        19  (_merge==1)
        from using                        665  (_merge==2)

    matched                             2,970  (_merge==3)
    -----------------------------------------
(665 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,228
        from master                       999  (_merge==1)
        from using                      4,229  (_merge==2)

    matched                             1,990  (_merge==3)
    -----------------------------------------
(4,229 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,029
        from master                     2,274  (_merge==1)
        from using                      2,755  (_merge==2)

    matched                               715  (_merge==3)
    -----------------------------------------
(2,755 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,445
        from master                     2,498  (_merge==1)
        from using                      4,947  (_merge==2)

    matched                               491  (_merge==3)
    -----------------------------------------
(4,947 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,723
        from master                     2,703  (_merge==1)
        from using                      3,020  (_merge==2)

    matched                               286  (_merge==3)
    -----------------------------------------
(3,020 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,922
        from master                     2,817  (_merge==1)
        from using                      5,105  (_merge==2)

    matched                               172  (_merge==3)
    -----------------------------------------
(5,105 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,020
        from master                     2,888  (_merge==1)
        from using                      3,132  (_merge==2)

    matched                               101  (_merge==3)
    -----------------------------------------
(3,132 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,115
        from master                     2,950  (_merge==1)
        from using                      5,165  (_merge==2)

    matched                                39  (_merge==3)
    -----------------------------------------
(5,165 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,152
        from master                     2,966  (_merge==1)
        from using                      3,186  (_merge==2)

    matched                                23  (_merge==3)
    -----------------------------------------
(3,186 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,158
        from master                     2,979  (_merge==1)
        from using                      5,179  (_merge==2)

    matched                                10  (_merge==3)
    -----------------------------------------
(5,179 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,180
        from master                     2,982  (_merge==1)
        from using                      3,198  (_merge==2)

    matched                                 7  (_merge==3)
    -----------------------------------------
(3,198 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,164
        from master                     2,982  (_merge==1)
        from using                      5,182  (_merge==2)

    matched                                 7  (_merge==3)
    -----------------------------------------
(5,182 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,179
        from master                     2,982  (_merge==1)
        from using                      3,197  (_merge==2)

    matched                                 7  (_merge==3)
    -----------------------------------------
(3,197 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,166
        from master                     2,984  (_merge==1)
        from using                      5,182  (_merge==2)

    matched                                 5  (_merge==3)
    -----------------------------------------
(5,182 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,182
        from master                     2,984  (_merge==1)
        from using                      3,198  (_merge==2)

    matched                                 5  (_merge==3)
    -----------------------------------------
(3,198 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,166
        from master                     2,984  (_merge==1)
        from using                      5,182  (_merge==2)

    matched                                 5  (_merge==3)
    -----------------------------------------
(5,182 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,182
        from master                     2,984  (_merge==1)
        from using                      3,198  (_merge==2)

    matched                                 5  (_merge==3)
    -----------------------------------------
(3,198 observations deleted)
(2,507 missing values generated)
(2,507 missing values generated)
(2,507 missing values generated)
(999 missing values generated)
(2,312 missing values generated)
(2,498 missing values generated)
(2,312 missing values generated)
(2,817 missing values generated)
(2,312 missing values generated)
(2,950 missing values generated)
(2,312 missing values generated)
(2,979 missing values generated)
(2,312 missing values generated)
(2,982 missing values generated)
(2,312 missing values generated)
(2,984 missing values generated)
(2,312 missing values generated)
(2,984 missing values generated)
(2,312 missing values generated)
(2,507 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |      2,989    1.320596           0   1.320596   1.320596
(2,507 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |      2,989    1.355645           0   1.355645   1.355645
2010 2010
(29 missing values generated)
(49 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij2013.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij2013.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,400
        from master                       700  (_merge==1)
        from using                      4,700  (_merge==2)

    matched                             2,568  (_merge==3)
    -----------------------------------------
(4,700 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       407,699
        from master                       148  (_merge==1)
        from using                    407,551  (_merge==2)

    matched                             3,120  (_merge==3)
    -----------------------------------------
(407,551 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                           697
        from master                        25  (_merge==1)
        from using                        672  (_merge==2)

    matched                             3,243  (_merge==3)
    -----------------------------------------
(672 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,405
        from master                     1,103  (_merge==1)
        from using                      4,302  (_merge==2)

    matched                             2,165  (_merge==3)
    -----------------------------------------
(4,302 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,392
        from master                     2,426  (_merge==1)
        from using                      2,966  (_merge==2)

    matched                               842  (_merge==3)
    -----------------------------------------
(2,966 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,590
        from master                     2,619  (_merge==1)
        from using                      4,971  (_merge==2)

    matched                               649  (_merge==3)
    -----------------------------------------
(4,971 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,221
        from master                     2,928  (_merge==1)
        from using                      3,293  (_merge==2)

    matched                               340  (_merge==3)
    -----------------------------------------
(3,293 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,284
        from master                     3,132  (_merge==1)
        from using                      5,152  (_merge==2)

    matched                               136  (_merge==3)
    -----------------------------------------
(5,152 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,457
        from master                     3,112  (_merge==1)
        from using                      3,345  (_merge==2)

    matched                               156  (_merge==3)
    -----------------------------------------
(3,345 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,295
        from master                     3,152  (_merge==1)
        from using                      5,143  (_merge==2)

    matched                               116  (_merge==3)
    -----------------------------------------
(5,143 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,618
        from master                     3,212  (_merge==1)
        from using                      3,406  (_merge==2)

    matched                                56  (_merge==3)
    -----------------------------------------
(3,406 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,455
        from master                     3,258  (_merge==1)
        from using                      5,197  (_merge==2)

    matched                                10  (_merge==3)
    -----------------------------------------
(5,197 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,661
        from master                     3,236  (_merge==1)
        from using                      3,425  (_merge==2)

    matched                                32  (_merge==3)
    -----------------------------------------
(3,425 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,453
        from master                     3,250  (_merge==1)
        from using                      5,203  (_merge==2)

    matched                                18  (_merge==3)
    -----------------------------------------
(5,203 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,682
        from master                     3,251  (_merge==1)
        from using                      3,431  (_merge==2)

    matched                                17  (_merge==3)
    -----------------------------------------
(3,431 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,472
        from master                     3,267  (_merge==1)
        from using                      5,205  (_merge==2)

    matched                                 1  (_merge==3)
    -----------------------------------------
(5,205 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,683
        from master                     3,253  (_merge==1)
        from using                      3,430  (_merge==2)

    matched                                15  (_merge==3)
    -----------------------------------------
(3,430 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         8,464
        from master                     3,260  (_merge==1)
        from using                      5,204  (_merge==2)

    matched                                 8  (_merge==3)
    -----------------------------------------
(5,204 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,691
        from master                     3,260  (_merge==1)
        from using                      3,431  (_merge==2)

    matched                                 8  (_merge==3)
    -----------------------------------------
(3,431 observations deleted)
(2,762 missing values generated)
(2,762 missing values generated)
(2,762 missing values generated)
(1,103 missing values generated)
(2,553 missing values generated)
(2,619 missing values generated)
(2,553 missing values generated)
(3,132 missing values generated)
(2,553 missing values generated)
(3,152 missing values generated)
(2,553 missing values generated)
(3,258 missing values generated)
(2,553 missing values generated)
(3,250 missing values generated)
(2,553 missing values generated)
(3,267 missing values generated)
(2,553 missing values generated)
(3,260 missing values generated)
(2,553 missing values generated)
(2,762 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |      3,268    1.312479           0   1.312479   1.312479
(2,762 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |      3,268    1.334732           0   1.334732   1.334732
2013 2013
(15 missing values generated)
(37 real changes made)
(note: file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij2016.dta not found)
file /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/007_aij2016.dta saved
(note: variable gvkey was float, now double to accommodate using data's values)
(note: variable year was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,742
        from master                       588  (_merge==1)
        from using                      4,154  (_merge==2)

    matched                             2,413  (_merge==3)
    -----------------------------------------
(4,154 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                       407,688
        from master                        90  (_merge==1)
        from using                    407,598  (_merge==2)

    matched                             2,911  (_merge==3)
    -----------------------------------------
(407,598 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                           761
        from master                        27  (_merge==1)
        from using                        734  (_merge==2)

    matched                             2,974  (_merge==3)
    -----------------------------------------
(734 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,900
        from master                     1,047  (_merge==1)
        from using                      3,853  (_merge==2)

    matched                             1,954  (_merge==3)
    -----------------------------------------
(3,853 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         4,966
        from master                     2,196  (_merge==1)
        from using                      2,770  (_merge==2)

    matched                               805  (_merge==3)
    -----------------------------------------
(2,770 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,804
        from master                     2,442  (_merge==1)
        from using                      4,362  (_merge==2)

    matched                               559  (_merge==3)
    -----------------------------------------
(4,362 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,668
        from master                     2,670  (_merge==1)
        from using                      2,998  (_merge==2)

    matched                               331  (_merge==3)
    -----------------------------------------
(2,998 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,271
        from master                     2,772  (_merge==1)
        from using                      4,499  (_merge==2)

    matched                               229  (_merge==3)
    -----------------------------------------
(4,499 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         5,993
        from master                     2,859  (_merge==1)
        from using                      3,134  (_merge==2)

    matched                               142  (_merge==3)
    -----------------------------------------
(3,134 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,505
        from master                     2,918  (_merge==1)
        from using                      4,587  (_merge==2)

    matched                                83  (_merge==3)
    -----------------------------------------
(4,587 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,150
        from master                     2,949  (_merge==1)
        from using                      3,201  (_merge==2)

    matched                                52  (_merge==3)
    -----------------------------------------
(3,201 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,579
        from master                     2,970  (_merge==1)
        from using                      4,609  (_merge==2)

    matched                                31  (_merge==3)
    -----------------------------------------
(4,609 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,179
        from master                     2,968  (_merge==1)
        from using                      3,211  (_merge==2)

    matched                                33  (_merge==3)
    -----------------------------------------
(3,211 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,595
        from master                     2,981  (_merge==1)
        from using                      4,614  (_merge==2)

    matched                                20  (_merge==3)
    -----------------------------------------
(4,614 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,195
        from master                     2,981  (_merge==1)
        from using                      3,214  (_merge==2)

    matched                                20  (_merge==3)
    -----------------------------------------
(3,214 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,605
        from master                     2,990  (_merge==1)
        from using                      4,615  (_merge==2)

    matched                                11  (_merge==3)
    -----------------------------------------
(4,615 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,202
        from master                     2,985  (_merge==1)
        from using                      3,217  (_merge==2)

    matched                                16  (_merge==3)
    -----------------------------------------
(3,217 observations deleted)

    Result                           # of obs.
    -----------------------------------------
    not matched                         7,619
        from master                     3,001  (_merge==1)
        from using                      4,618  (_merge==2)

    matched                                 0  (_merge==3)
    -----------------------------------------
(4,618 observations deleted)
(note: variable Source was float, now double to accommodate using data's values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         6,208
        from master                     2,990  (_merge==1)
        from using                      3,218  (_merge==2)

    matched                                11  (_merge==3)
    -----------------------------------------
(3,218 observations deleted)
(2,537 missing values generated)
(2,537 missing values generated)
(2,537 missing values generated)
(1,047 missing values generated)
(2,314 missing values generated)
(2,442 missing values generated)
(2,314 missing values generated)
(2,772 missing values generated)
(2,314 missing values generated)
(2,918 missing values generated)
(2,314 missing values generated)
(2,970 missing values generated)
(2,314 missing values generated)
(2,981 missing values generated)
(2,314 missing values generated)
(2,990 missing values generated)
(2,314 missing values generated)
(3,001 missing values generated)
(2,314 missing values generated)
(2,537 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
   ratio_mu0 |      3,001    1.321636           0   1.321636   1.321636
(2,537 missing values generated)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    ratio_mu |      3,001    1.360908           0   1.360908   1.360908
2016 2016

. 
end of do-file

. do "/Users/ios/Documents/GitHub/mres_paper/code/mres_007_welfare.do"

. 
. /*******************************************************************************
>         
>         DESCRIPTION: Generation of welfare statistics
>         
>         INFILES:        - 
>         
>         OUTFILES:       - 
>         
>         LOG: Created 04/05/2020
>                         Last modified XX/05/2020
>         
> *******************************************************************************/
. 
. /*******************************************************************************
>         SETUP
> *******************************************************************************/
. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-scheme-moder
> n/master/")
> ssc install gtools
> gtools, upgrade*/
. 
. set scheme modern, perm
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                                             
>          // I'm using a different orig folder so as not to commit large datasets to GitHub

. global data "$wd/data/007_welfare"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. global DLEU "$orig/Data DLEU"

. 
. *do-file number, used to save outputs 
. global doNum "007"                                      

. 
. *log
. cap log close
-------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   4 May 2020, 19:42:40

. 
. 
. /*******************************************************************************
>         Getting the all the supply chains leading to final demand
> *******************************************************************************/
. 
. forval y = 1980(3)2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target year3 a
  7. rename year3 year
  8. replace a = 1 if a>1
  9. save "$data/007_aij`y'.dta", replace
 10. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 11. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 12. gen year = `y'
 13. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 14. drop if _merge == 2
 15. drop _merge
 16. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 17. drop if _merge == 2
 18. drop _merge
 19. 
. rename sale finalSale
 20. rename mu_1 mu_0
 21. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 22. rename endPoint_1 Source
 23. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 24. drop if _merge == 2
 25. drop _merge
 26. rename a a10
 27. rename Target endPoint_0
 28. rename Source endPoint_1
 29. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 30.         local nextStep = `step'+1
 31.         local previousStep = `step'-1
 32.         rename endPoint_`step' gvkey
 33.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 34.         drop if _merge == 2
 35.         drop _merge
 36.         rename mu mu_`step'
 37.         rename gvkey Target 
 38.         rename endPoint_`nextStep' Source
 39.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 40.         drop if _merge == 2
 41.         drop _merge
 42.         rename a a`nextStep'`step'
 43.         rename Target endPoint_`step'
 44.         rename Source endPoint_`nextStep'
 45.         }
 46.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 47. gen sales = finalSale if n==1
 48. egen totSales = sum(sales)
 49. gen salesSh = sales/totSales
 50. gen sales_mu0 = sales/mu_0
 51. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 52. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 53. gen pi_1 = exp(ln_pi_1) if n == 1
 54. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 55. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 56. gen pi_2 = exp(ln_pi_2) if n == 1
 57. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 58. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 59. gen pi_3 = exp(ln_pi_3) if n == 1
 60. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 61. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 62. gen pi_4 = exp(ln_pi_4) if n == 1
 63. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 64. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 65. gen pi_5 = exp(ln_pi_5) if n == 1
 66. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 67. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 68. gen pi_6 = exp(ln_pi_6) if n == 1
 69. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 70. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 71. gen pi_7 = exp(ln_pi_7) if n == 1
 72. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 73. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 74. gen pi_8 = exp(ln_pi_8) if n == 1
 75. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 76. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 77. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 78. su ratio_mu0
 79. global mu0_`y' = `r(mean)'
 80. 
. gen sales_mu = sales/denom
 81. egen totSales_mu = sum(sales_mu)
 82. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 83. su ratio_mu
 84. global mu_`y' = `r(mean)'
 85. 
. }
 86. 
. di ${mu0_`y'}, ${mu_`y'}
 87. }
1.1845839 1.1903316
1.1978852 1.2047412
1.214764 1.2250336
1.2562001 1.2649083
1.2763993 1.2925981
1.297031 1.3118438
1.2972523 1.3324487
1.3336548 1.3713996
1.3576841 1.410938
1.3116162 1.3468543
1.3205963 1.3556448
1.3124787 1.3347322
1.3216358 1.3609077

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. set obs 15
observation number out of range
    Observation number must be between 3,001 and 2,147,483,619.  (Observation numbers are typed
    without commas.)
r(198);

end of do-file

r(198);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. set obs 3001
number of observations (_N) was 3,001, now 3,001

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen y = 1980 + _n*3 - 3

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. clear

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. set obs 15
number of observations (_N) was 0, now 15

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen y = 1980 + _n*3 - 3

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen mu0 = .
(15 missing values generated)

. gen mu = .
(15 missing values generated)

. forval y = 1980(3)2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. clear

. set obs 15
number of observations (_N) was 0, now 15

. gen y = 1980 + _n*3 - 3

. gen mu0 = .
(15 missing values generated)

. gen mu = .
(15 missing values generated)

. forval y = 1980(3)2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'      
  4.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (line mu0 year) ///
>         (line mu year)
variable year not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (line mu0 y) ///
>         (line mu y)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (line mu0 y) ///
>         (line mu y)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (line mu0 y) ///
>         (line mu y), ///
>         ylabel(1(0.1)1.4)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (line mu0 y) ///
>         (line mu y), ///
>         ylabel(1(0.1)1.5)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-scheme-moder
> n/master/")
> set scheme modern, perm
> ssc install gtools
> gtools, upgrade*/
. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                                             
>          // I'm using a different orig folder so as not to commit large datasets to GitHub

. global data "$wd/data/001_network"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. 
. *do-file number, used to save outputs 
. global doNum "003"                                      

. 
. *log
. cap log close
-------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   4 May 2020, 22:46:12

. 
. 
. /*******************************************************************************
>         Getting the all the supply chains leading to final demand
> *******************************************************************************/
. 
. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target year3 a
  7. rename year3 year
  8. replace a = 1 if a>1
  9. save "$data/007_aij`y'.dta", replace
 10. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 11. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 12. gen year = `y'
 13. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 14. drop if _merge == 2
 15. drop _merge
 16. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 17. drop if _merge == 2
 18. drop _merge
 19. 
. rename sale finalSale
 20. rename mu_1 mu_0
 21. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 22. rename endPoint_1 Source
 23. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 24. drop if _merge == 2
 25. drop _merge
 26. rename a a10
 27. rename Target endPoint_0
 28. rename Source endPoint_1
 29. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 30.         local nextStep = `step'+1
 31.         local previousStep = `step'-1
 32.         rename endPoint_`step' gvkey
 33.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 34.         drop if _merge == 2
 35.         drop _merge
 36.         rename mu mu_`step'
 37.         rename gvkey Target 
 38.         rename endPoint_`nextStep' Source
 39.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 40.         drop if _merge == 2
 41.         drop _merge
 42.         rename a a`nextStep'`step'
 43.         rename Target endPoint_`step'
 44.         rename Source endPoint_`nextStep'
 45.         }
 46.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 47. gen sales = finalSale if n==1
 48. egen totSales = sum(sales)
 49. gen salesSh = sales/totSales
 50. gen sales_mu0 = sales/mu_0
 51. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 52. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 53. gen pi_1 = exp(ln_pi_1) if n == 1
 54. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 55. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 56. gen pi_2 = exp(ln_pi_2) if n == 1
 57. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 58. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 59. gen pi_3 = exp(ln_pi_3) if n == 1
 60. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 61. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 62. gen pi_4 = exp(ln_pi_4) if n == 1
 63. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 64. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 65. gen pi_5 = exp(ln_pi_5) if n == 1
 66. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 67. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 68. gen pi_6 = exp(ln_pi_6) if n == 1
 69. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 70. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 71. gen pi_7 = exp(ln_pi_7) if n == 1
 72. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 73. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 74. gen pi_8 = exp(ln_pi_8) if n == 1
 75. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 76. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 77. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 78. su ratio_mu0
 79. global mu0_`y' = `r(mean)'
 80. 
. gen sales_mu = sales/denom
 81. egen totSales_mu = sum(sales_mu)
 82. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 83. su ratio_mu
 84. global mu_`y' = `r(mean)'
 85. 
. }
 86. 
. di ${mu0_`y'}, ${mu_`y'}
 87. }
1.2462733 1.2511804
1.2514908 1.2566092
1.2461021 1.2510047
1.2212306 1.2289917
1.1845839 1.190219
1.1561338 1.1627455
1.1672745 1.172418
1.1978852 1.204385
1.1951668 1.2013651
1.2118467 1.2201377
1.214764 1.2248343
1.2249029 1.2354693
1.2756764 1.2857471
1.2562001 1.2638267
1.2608562 1.2699409
1.261023 1.2762533
1.2763993 1.2925977
1.2933741 1.3095055
1.3046876 1.319717
1.297031 1.3117468
1.3036669 1.3175056
1.3011936 1.3326299
1.2972523 1.3332112
1.3168288 1.3571655
1.31749 1.3542181
1.3336548 1.3717747
1.3420149 1.3833852
1.3440522 1.3918597
1.3576841 1.4101123
1.3357953 1.3867067
1.307541 1.3446443
1.3116162 1.3469661
1.3100889 1.3577152
1.3039891 1.3362143
1.3205963 1.3551188
1.3101102 1.3439831
1.3158644 1.3388183
1.3124787 1.3372339
1.3106097 1.3313462
1.3071151 1.344851
1.3216358 1.3584836

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. clear

. set obs 41
number of observations (_N) was 0, now 41

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'      
  4.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. twoway (line mu0 y) ///
>         (line mu y), ///
>         ylabel(1(0.1)1.5)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(o) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(o) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(o) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(o) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) ytitle("Year") subtitle("Equivalent variation", pos(11))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(o) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(o) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(5) col(1) order(1 "1976-1985" 2 "1986-2016"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(4) col(1) order(1 "1976-1985" 2 "1986-2016"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(3) col(1) order(1 "1976-1985" 2 "1986-2016"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "1976-1985" 2 "1986-2016"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{subscript:1})" 2 "1986-2016"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1}, u{superscript:1}|{
> &mu}{subscript:0} = 0)" 2 "1986-2016"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:0}, u{superscript:1}|{
> &mu}{subscript:0} = 0)" 2 "1986-2016"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1}, u{superscript:1}) 
> - e(q{superscript:0}, u{superscript:1}|{&mu}{subscript:0} = 0)" 2 "e(q{superscript:1}, u{supers
> cript:1}) - e(q{superscript:0}, u{superscript:1}|{bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD00332.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. graph export "$outputs/007_welfare.pdf", as(pdf) replace
(file /Users/ios/Documents/GitHub/mres_paper/outputs/007_welfare.pdf written in PDF format)

. 
end of do-file

---------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   5 May 2020, 09:44:45

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target year3 a
  7. rename year3 year
  8. replace a = 1 if a>1
  9. save "$data/007_aij`y'.dta", replace
 10. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 11. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 12. gen year = `y'
 13. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 14. drop if _merge == 2
 15. drop _merge
 16. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 17. drop if _merge == 2
 18. drop _merge
 19. 
. rename sale finalSale
 20. rename mu_1 mu_0
 21. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 22. rename endPoint_1 Source
 23. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 24. drop if _merge == 2
 25. drop _merge
 26. rename a a10
 27. rename Target endPoint_0
 28. rename Source endPoint_1
 29. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 30.         local nextStep = `step'+1
 31.         local previousStep = `step'-1
 32.         rename endPoint_`step' gvkey
 33.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 34.         drop if _merge == 2
 35.         drop _merge
 36.         rename mu mu_`step'
 37.         rename gvkey Target 
 38.         rename endPoint_`nextStep' Source
 39.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 40.         drop if _merge == 2
 41.         drop _merge
 42.         rename a a`nextStep'`step'
 43.         rename Target endPoint_`step'
 44.         rename Source endPoint_`nextStep'
 45.         }
 46.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 47. gen sales = finalSale if n==1
 48. egen totSales = sum(sales)
 49. gen salesSh = sales/totSales
 50. gen sales_mu0 = sales/mu_0
 51. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 52. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 53. gen pi_1 = exp(ln_pi_1) if n == 1
 54. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 55. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 56. gen pi_2 = exp(ln_pi_2) if n == 1
 57. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 58. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 59. gen pi_3 = exp(ln_pi_3) if n == 1
 60. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 61. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 62. gen pi_4 = exp(ln_pi_4) if n == 1
 63. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 64. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 65. gen pi_5 = exp(ln_pi_5) if n == 1
 66. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 67. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 68. gen pi_6 = exp(ln_pi_6) if n == 1
 69. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 70. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 71. gen pi_7 = exp(ln_pi_7) if n == 1
 72. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 73. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 74. gen pi_8 = exp(ln_pi_8) if n == 1
 75. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 76. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 77. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 78. su ratio_mu0
 79. global mu0_`y' = `r(mean)'
 80. 
. gen sales_mu = sales/denom
 81. egen totSales_mu = sum(sales_mu)
 82. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 83. su ratio_mu
 84. global mu_`y' = `r(mean)'
 85. 
. }
 86. 
. di ${mu0_`y'}, ${mu_`y'}
 87. }
1.2462733 1.2511804
1.2514908 1.2566092
1.2461021 1.2510047
1.2212306 1.2289917
1.1845839 1.190219
1.1561338 1.1627455
1.1672745 1.172418
1.1978852 1.204385
1.1951668 1.2013651
1.2118467 1.2201377
1.214764 1.2248343
1.2249029 1.2354693
1.2756764 1.2857471
1.2562001 1.2638267
1.2608562 1.2699409
1.261023 1.2762533
1.2763993 1.2925977
1.2933741 1.3095055
1.3046876 1.319717
1.297031 1.3117468
1.3036669 1.3175056
1.3011936 1.3326299
1.2972523 1.3332112
1.3168288 1.3571655
1.31749 1.3542181
1.3336548 1.3717747
1.3420149 1.3833852
1.3440522 1.3918597
1.3576841 1.4101123
1.3357953 1.3867067
1.307541 1.3446443
1.3116162 1.3469661
1.3100889 1.3577152
1.3039891 1.3362143
1.3205963 1.3551188
1.3101102 1.3439831
1.3158644 1.3388183
1.3124787 1.3372339
1.3106097 1.3313462
1.3071151 1.344851
1.3216358 1.3584836

. 
. *graph
. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'      
  4.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. di 3585/3216
1.1147388

. h nwsum

. h nwsummarize

. h nwset

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-scheme-moder
> n/master/")
> ssc install gtools
> gtools, upgrade*/
. 
. set scheme modern, perm
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                                             
>          // I'm using a different orig folder so as not to commit large datasets to GitHub

. global data "$wd/data/001_network"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. 
. *do-file number, used to save outputs 
. global doNum "004"                                      

. 
. *log
. cap log close
-------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   5 May 2020, 10:58:52

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target year3 a
  7. rename year3 year
  8. replace a = 1 if a>1
  9. save "$data/007_aij`y'.dta", replace
 10. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 11. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 12. gen year = `y'
 13. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 14. drop if _merge == 2
 15. drop _merge
 16. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 17. drop if _merge == 2
 18. drop _merge
 19. 
. rename sale finalSale
 20. rename mu_1 mu_0
 21. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 22. rename endPoint_1 Source
 23. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 24. drop if _merge == 2
 25. drop _merge
 26. rename a a10
 27. rename Target endPoint_0
 28. rename Source endPoint_1
 29. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 30.         local nextStep = `step'+1
 31.         local previousStep = `step'-1
 32.         rename endPoint_`step' gvkey
 33.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 34.         drop if _merge == 2
 35.         drop _merge
 36.         rename mu mu_`step'
 37.         rename gvkey Target 
 38.         rename endPoint_`nextStep' Source
 39.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 40.         drop if _merge == 2
 41.         drop _merge
 42.         rename a a`nextStep'`step'
 43.         rename Target endPoint_`step'
 44.         rename Source endPoint_`nextStep'
 45.         }
 46.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 47. gen sales = finalSale if n==1
 48. egen totSales = sum(sales)
 49. gen salesSh = sales/totSales
 50. gen sales_mu0 = sales/mu_0
 51. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 52. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 53. gen pi_1 = exp(ln_pi_1) if n == 1
 54. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 55. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 56. gen pi_2 = exp(ln_pi_2) if n == 1
 57. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 58. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 59. gen pi_3 = exp(ln_pi_3) if n == 1
 60. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 61. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 62. gen pi_4 = exp(ln_pi_4) if n == 1
 63. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 64. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 65. gen pi_5 = exp(ln_pi_5) if n == 1
 66. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 67. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 68. gen pi_6 = exp(ln_pi_6) if n == 1
 69. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 70. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 71. gen pi_7 = exp(ln_pi_7) if n == 1
 72. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 73. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 74. gen pi_8 = exp(ln_pi_8) if n == 1
 75. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 76. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 77. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 78. su ratio_mu0
 79. global mu0_`y' = `r(mean)'
 80. 
. gen sales_mu = sales/denom
 81. egen totSales_mu = sum(sales_mu)
 82. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 83. su ratio_mu
 84. global mu_`y' = `r(mean)'
 85. 
. }
 86. 
. di ${mu0_`y'}, ${mu_`y'}
 87. }
variable year3 not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-scheme-moder
> n/master/")
> ssc install gtools
> gtools, upgrade*/
. 
. set scheme modern, perm
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                                             
>          // I'm using a different orig folder so as not to commit large datasets to GitHub

. global data "$wd/data/007_welfare"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. global DLEU "$orig/Data DLEU"

. 
. *do-file number, used to save outputs 
. global doNum "007"                                      

. 
. *log
. cap log close
-------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   5 May 2020, 10:59:50

. 
. 
. /*******************************************************************************
>         Getting the all the supply chains leading to final demand
> *******************************************************************************/
. 
. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. }
 85. 
. di ${mu0_`y'}, ${mu_`y'}
 86. }
1.2462733 1.2470191
1.2514908 1.2545708
1.2461021 1.25065
1.2212306 1.2252241
1.1845839 1.1893389
1.1561338 1.161692
1.1672745 1.1717163
1.1978852 1.203681
1.1951668 1.2012508
1.2118467 1.2185867
1.214764 1.2234739
1.2249029 1.2351422
1.2756764 1.2847062
1.2562001 1.2629728
1.2608562 1.2685417
1.261023 1.2701826
1.2763993 1.2864141
1.2933741 1.3098754
1.3046876 1.3172969
1.297031 1.3100673
1.3036669 1.3139817
1.3011936 1.3285367
1.2972523 1.311579
1.3168288 1.3383976
1.31749 1.3463537
1.3336548 1.3668854
1.3420149 1.3807535
1.3440522 1.379342
1.3576841 1.3957651
1.3357953 1.3878981
1.307541 1.3378433
1.3116162 1.3376291
1.3100889 1.3527344
1.3039891 1.3293927
1.3205963 1.3544036
1.3101102 1.3379862
1.3158644 1.3372812
1.3124787 1.3311018
1.3106097 1.3270282
1.3071151 1.3250663
1.3216358 1.3559417

. 
. *graph
. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'      
  4.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. di 3559/3216
1.1066542

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. graph export "$outputs/007_welfare_2.pdf", as(pdf) replace
(file /Users/ios/Documents/GitHub/mres_paper/outputs/007_welfare_2.pdf written in PDF format)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-scheme-moder
> n/master/")
> set scheme modern, perm
> ssc install gtools
> gtools, upgrade*/
. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                                             
>          // I'm using a different orig folder so as not to commit large datasets to GitHub

. global data "$wd/data/001_network"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. 
. *do-file number, used to save outputs 
. global doNum "003"                                      

. 
. *log
. cap log close
-------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   5 May 2020, 21:58:01

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. forval y = 1978/1978{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. }
 85. 
. di ${mu0_`y'}, ${mu_`y'}
 86. }
1.2461021 1.25065

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. sort finalSales
variable finalSales not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. sort finalSale

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. egen topSale = max(finalSale)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. gen alphaOverBeta = topSale/finalSale
(49 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
(472 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. egen totSales_mu_subs = sum(sales_mu_subs)

. gen ratio_mu_subs = totSales/totSales_mu_subs                                                  
>                                  //18%, looks credible 

. su ratio_mu_subs

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
ratio_mu_s~s |        578    .1123836           0   .1123836   .1123836

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. forval y = 1978/1978{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price incre
> ase
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this
>  product)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                  //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. }
 85. 
. di ${mu0_`y'}, ${mu_`y'}
 86. }
1.2461021 1.25065

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. gen shInitial = totSale/finalSale
totSale ambiguous abbreviation
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. gen shInitial = finalSale/totSales
(49 missing values generated)

. gen shFinal = sales_mu/totSales_mu
(472 missing values generated)

. 
end of do-file

. scatter shInitial shFinal

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. gen subs_ratio = shInitial/shFinal
(472 missing values generated)

. 
end of do-file

. hist subs_ratio
(bin=10, start=.80848432, width=.1328191)

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. gen sales_mu_subs = sales_mu*subs_ratio
(472 missing values generated)

. egen totSales_mu_subs = sum(sales_mu_subs)

. gen ratio_mu_subs = totSales/totSales_mu_subs                                                  
>                                  //18%, looks credible 

. su ratio_mu_subs

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
ratio_mu_s~s |        578     1.25065           0    1.25065    1.25065

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. 
. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price incre
> ase
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this
>  product)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                  //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen subs_ratio = shInitial/shFinal
 87. 
. gen sales_mu_subs = sales_mu*subs_ratio
 88. egen totSales_mu_subs = sum(sales_mu_subs)
 89. gen ratio_mu_subs = totSales/totSales_mu_subs                                               
>                                     //18%, looks credible 
 90. su ratio_mu_subs
 91. global mu_`y'_subs = `r(mean)'
 92. 
. sales_mu0_subs = sales_mu0*subs_ratio
 93. egen totSales_mu0_subs = sum(sales_mu0_subs)
 94. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                             
>                                     //18%, looks credible 
 95. su ratio_mu0_subs
 96. global mu0_`y'_subs = `r(mean)'
 97. 
. }
 98. 
. di ${mu0_`y'}, ${mu_`y'}, ${mu_`y'_subs}, ${mu0_`y'_subs}
 99. }
command sales_mu0_subs is unrecognized
r(199);

end of do-file

r(199);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price incre
> ase
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this
>  product)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                  //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen subs_ratio = shInitial/shFinal
 87. 
. gen sales_mu_subs = sales_mu*subs_ratio
 88. egen totSales_mu_subs = sum(sales_mu_subs)
 89. gen ratio_mu_subs = totSales/totSales_mu_subs                                               
>                                     //18%, looks credible 
 90. su ratio_mu_subs
 91. global mu_`y'_subs = `r(mean)'
 92. 
. gen sales_mu0_subs = sales_mu0*subs_ratio
 93. egen totSales_mu0_subs = sum(sales_mu0_subs)
 94. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                             
>                                     //18%, looks credible 
 95. su ratio_mu0_subs
 96. global mu0_`y'_subs = `r(mean)'
 97. 
. }
 98. 
. di ${mu0_`y'}, ${mu_`y'}, ${mu_`y'_subs}, ${mu0_`y'_subs}
 99. }
1.2462733 1.2470191 1.2470191 1.2463142
1.2514908 1.2545708 1.2545708 1.2515178
1.2461021 1.25065 1.2506502 1.2461255
1.2212306 1.2252241 1.2252241 1.2213521
1.1845839 1.1893389 1.1893389 1.1847683
1.1561338 1.161692 1.161692 1.1555325
1.1672745 1.1717163 1.1717163 1.1668116
1.1978852 1.203681 1.203681 1.1977204
1.1951668 1.2012508 1.2012508 1.1945027
1.2118467 1.2185867 1.2185867 1.2116721
1.214764 1.2234739 1.2234739 1.2146624
1.2249029 1.2351422 1.2351422 1.2243319
1.2756764 1.2847062 1.2847062 1.2748764
1.2562001 1.2629728 1.2629728 1.2555789
1.2608562 1.2685417 1.2685417 1.2608825
1.261023 1.2701826 1.2701826 1.261126
1.2763993 1.2864141 1.2864141 1.276507
1.2933741 1.3098754 1.3098754 1.2893019
1.3046876 1.3172969 1.3172969 1.3047189
1.297031 1.3100673 1.3100673 1.2968905
1.3036669 1.3139817 1.3139817 1.3034334
1.3011936 1.3285367 1.3285367 .869802
1.2972523 1.311579 1.311579 1.2939029
1.3168288 1.3383976 1.3383976 1.0730599
1.31749 1.3463537 1.3463538 1.303502
1.3336548 1.3668854 1.3668854 1.3175156
1.3420149 1.3807535 1.3807536 1.3231604
1.3440522 1.379342 1.379342 1.3305213
1.3576841 1.3957651 1.3957651 1.3444006
1.3357953 1.3878981 1.3878981 1.3054101
1.307541 1.3378433 1.3378433 1.2977393
1.3116162 1.3376291 1.3376291 1.3042651
1.3100889 1.3527344 1.3527344 1.2626867
1.3039891 1.3293927 1.3293926 1.2977737
1.3205963 1.3544036 1.3544036 1.3092587
1.3101102 1.3379862 1.3379862 1.3047861
1.3158644 1.3372812 1.3372813 1.1520342
1.3124787 1.3311018 1.3311019 1.3101196
1.3106097 1.3270282 1.3270282 1.3078727
1.3071151 1.3250663 1.3250663 1.301613
1.3216358 1.3559417 1.3559417 .00819496

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'
  4.         replace mu0_subs = ${mu0_`y'_subs} if y == `y'
  5.         replace mu_subs = ${mu_`y'_subs} if y == `y'
  6.         }
(1 real change made)
(1 real change made)
variable mu0_subs not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. gen mu0_subs = .
(41 missing values generated)

. gen mu_subs = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'
  4.         replace mu0_subs = ${mu0_`y'_subs} if y == `y'
  5.         replace mu_subs = ${mu_`y'_subs} if y == `y'
  6.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0_subs y if mu0_subs>1.2, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0_subs y if mu0_subs>1.2, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price incre
> ase
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this
>  product)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                  //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen subs_ratio = shInitial/shFinal
 87. 
. gen sales_mu_subs = sales_mu*subs_ratio
 88. egen totSales_mu_subs = sum(sales_mu_subs)
 89. gen ratio_mu_subs = totSales/totSales_mu_subs                                               
>                                     //18%, looks credible 
 90. su ratio_mu_subs
 91. global mu_`y'_subs = `r(mean)'
 92. 
. gen sales_mu0_subs = sales_mu0*subs_ratio
 93. egen totSales_mu0_subs = sum(sales_mu0_subs)
 94. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                             
>                                     //18%, looks credible 
 95. su ratio_mu0_subs
 96. global mu0_`y'_subs = `r(mean)'
 97. 
. }
 98. di "`y'"
 99. su subs_ratio
100. 
. di ${mu0_`y'}, ${mu_`y'}, ${mu_`y'_subs}, ${mu0_`y'_subs}
101. }
1976

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        103    1.102899    .2396503   .7983941   2.246668
1.2462733 1.2470191 1.2470191 1.2463142
1977

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        103    1.105283     .247588   .7654348   2.318316
1.2514908 1.2545708 1.2545708 1.2515178
1978

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        106    1.106413    .2543675   .8084843   2.136675
1.2461021 1.25065 1.2506502 1.2461255
1979

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        144    1.142876      .31042   .7815315   2.560082
1.2212306 1.2252241 1.2252241 1.2213521
1980

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        144    1.167435    .3057465   .7612076    2.43352
1.1845839 1.1893389 1.1893389 1.1847683
1981

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        144    1.166035    .3219018   .7899722   2.640925
1.1561338 1.161692 1.161692 1.1555325
1982

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        208    1.158364    .3515291   .5269988   3.118774
1.1672745 1.1717163 1.1717163 1.1668116
1983

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        209    1.140831    .3433312   .3540562   3.255057
1.1978852 1.203681 1.203681 1.1977204
1984

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        209    1.132168     .341661   .4480363   3.279802
1.1951668 1.2012508 1.2012508 1.1945027
1985

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        258    1.169436    .4311503   .1952033   5.341208
1.2118467 1.2185867 1.2185867 1.2116721
1986

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        249    1.181177    .4547539   .5059096   5.518414
1.214764 1.2234739 1.2234739 1.2146624
1987

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        249    1.194304    .5185553   .2758386   6.491694
1.2249029 1.2351422 1.2351422 1.2243319
1988

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        247    1.171757    .5400185   .2625991   6.285619
1.2756764 1.2847062 1.2847062 1.2748764
1989

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        242    1.158871    .4970442   .2658879   6.133488
1.2562001 1.2629728 1.2629728 1.2555789
1990

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        239    1.127907    .3942553   .1386878   3.114864
1.2608562 1.2685417 1.2685417 1.2608825
1991

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        270    1.229597    .5159405   .6732748   3.776832
1.261023 1.2701826 1.2701826 1.261126
1992

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        268    1.198997    .4958329   .6630762   4.333798
1.2763993 1.2864141 1.2864141 1.276507
1993

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        266    1.181326    .4982604   .6442079   4.463412
1.2933741 1.3098754 1.3098754 1.2893019
1994

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        336    1.252423    .7685158   .4851864   10.44571
1.3046876 1.3172969 1.3172969 1.3047189
1995

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        337    1.310147    1.310775   .3295226   17.48831
1.297031 1.3100673 1.3100673 1.2968905
1996

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        341    1.312126    1.400027   .4318863   21.66351
1.3036669 1.3139817 1.3139817 1.3034334
1997

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        456    1.359539    3.012027   .1611723   64.27931
1.3011936 1.3285367 1.3285367 .869802
1998

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        457    1.195952    .5707541   .0491675   5.378345
1.2972523 1.311579 1.311579 1.2939029
1999

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        426    1.268622    1.251911   .1285969   23.47169
1.3168288 1.3383976 1.3383976 1.0730599
2000

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        475     1.28004    1.289032   .0460688   23.65471
1.31749 1.3463537 1.3463538 1.303502
2001

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        446    1.261384    .8723263   .3440664   12.53952
1.3336548 1.3668854 1.3668854 1.3175156
2002

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        430    1.302458     1.03941   .3955034   14.44338
1.3420149 1.3807535 1.3807536 1.3231604
2003

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        484    1.222694    .6201084   .0783813   4.962038
1.3440522 1.379342 1.379342 1.3305213
2004

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        474    1.222439     .595598   .2551016   4.327365
1.3576841 1.3957651 1.3957651 1.3444006
2005

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        455    1.263477    .7841751   .3355851   9.483335
1.3357953 1.3878981 1.3878981 1.3054101
2006

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        458    1.235261    .6365197   .3572412   5.295519
1.307541 1.3378433 1.3378433 1.2977393
2007

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        442    1.261041     1.07524   .3540379    19.7164
1.3116162 1.3376291 1.3376291 1.3042651
2008

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        429    1.294902     1.23789   .3171613   21.23109
1.3100889 1.3527344 1.3527344 1.2626867
2009

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        493    1.290804    1.102074   .1987246    19.0635
1.3039891 1.3293927 1.3293926 1.2977737
2010

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        482    1.270084    .7327669   .2156033   6.036643
1.3205963 1.3544036 1.3544036 1.3092587
2011

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        464    1.285587    .7363952   .3777128   6.542892
1.3101102 1.3379862 1.3379862 1.3047861
2012

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        508    1.469367    3.011017   .0147639   66.03091
1.3158644 1.3372812 1.3372813 1.1520342
2013

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        506    1.328794    .8942559   .0201825   7.463267
1.3124787 1.3311018 1.3311019 1.3101196
2014

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        483    1.370955    .9471814   .2168286   9.229357
1.3106097 1.3270282 1.3270282 1.3078727
2015

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        479    1.337929    1.063931   .0090136   11.29634
1.3071151 1.3250663 1.3250663 1.301613
2016

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        464    56.74021    1193.923   .0160823    25719.2
1.3216358 1.3559417 1.3559417 .00819496

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. gen mu0_subs = .
(41 missing values generated)

. gen mu_subs = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'
  4.         replace mu0_subs = ${mu0_`y'_subs} if y == `y'
  5.         replace mu_subs = ${mu_`y'_subs} if y == `y'
  6.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price incre
> ase
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this
>  product)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                  //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen subs_ratio = shInitial/shFinal
 87. replace subs_ratio=15 if subs_ratio>15
 88. 
. gen sales_mu_subs = sales_mu*subs_ratio
 89. egen totSales_mu_subs = sum(sales_mu_subs)
 90. gen ratio_mu_subs = totSales/totSales_mu_subs                                               
>                                     //18%, looks credible 
 91. su ratio_mu_subs
 92. global mu_`y'_subs = `r(mean)'
 93. 
. gen sales_mu0_subs = sales_mu0*subs_ratio
 94. egen totSales_mu0_subs = sum(sales_mu0_subs)
 95. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                             
>                                     //18%, looks credible 
 96. su ratio_mu0_subs
 97. global mu0_`y'_subs = `r(mean)'
 98. 
. }
 99. di "`y'"
100. su subs_ratio
101. 
. di ${mu0_`y'}, ${mu_`y'}, ${mu_`y'_subs}, ${mu0_`y'_subs}
102. }
1976

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        578    12.52353    5.323725   .7983941         15
1.2462733 1.2470191 1.2470191 1.2463142
1977

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        578    12.52395    5.322876   .7654348         15
1.2514908 1.2545708 1.2545708 1.2515178
1978

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        578    12.45204    5.382385   .8084843         15
1.2461021 1.25065 1.2506502 1.2461255
1979

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        992    12.98848    4.885243   .7815315         15
1.2212306 1.2252241 1.2252241 1.2213521
1980

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        997    13.00212    4.866361   .7612076         15
1.1845839 1.1893389 1.1893389 1.1847683
1981

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        996    12.99991    4.869036   .7899722         15
1.1561338 1.161692 1.161692 1.1555325
1982

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |      1,217     12.6343    5.214596   .5269988         15
1.1672745 1.1717163 1.1717163 1.1668116
1983

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |      1,217    12.61991    5.231047   .3540562         15
1.1978852 1.203681 1.203681 1.1977204
1984

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |      1,218    12.62038    5.232589   .4480363         15
1.1951668 1.2012508 1.2012508 1.1945027
1985

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |      1,769    12.98288    4.885656   .1952033         15
1.2118467 1.2185867 1.2185867 1.2116721
1986

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |      1,770      13.056    4.809026   .5059096         15
1.214764 1.2234739 1.2234739 1.2146624
1987

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |      1,769    13.05674    4.806507   .2758386         15
1.2249029 1.2351422 1.2351422 1.2243319
1988

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |      1,681    12.96813      4.9016   .2625991         15
1.2756764 1.2847062 1.2847062 1.2748764
1989

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |      1,681     13.0074    4.864034   .2658879         15
1.2562001 1.2629728 1.2629728 1.2555789
1990

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |      1,681     13.0277     4.84829   .1386878         15
1.2608562 1.2685417 1.2685417 1.2608825
--Break--
r(1);

end of do-file

--Break--
r(1);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price incre
> ase
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this
>  product)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                  //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen subs_ratio = shInitial/shFinal
 87. replace subs_ratio=15 if subs_ratio>15 & subs_ratio!=.
 88. 
. gen sales_mu_subs = sales_mu*subs_ratio
 89. egen totSales_mu_subs = sum(sales_mu_subs)
 90. gen ratio_mu_subs = totSales/totSales_mu_subs                                               
>                                     //18%, looks credible 
 91. su ratio_mu_subs
 92. global mu_`y'_subs = `r(mean)'
 93. 
. gen sales_mu0_subs = sales_mu0*subs_ratio
 94. egen totSales_mu0_subs = sum(sales_mu0_subs)
 95. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                             
>                                     //18%, looks credible 
 96. su ratio_mu0_subs
 97. global mu0_`y'_subs = `r(mean)'
 98. 
. }
 99. di "`y'"
100. su subs_ratio
101. 
. di ${mu0_`y'}, ${mu_`y'}, ${mu_`y'_subs}, ${mu0_`y'_subs}
102. }
1976

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        103    1.102899    .2396503   .7983941   2.246668
1.2462733 1.2470191 1.2470191 1.2463142
1977

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        103    1.105283     .247588   .7654348   2.318316
1.2514908 1.2545708 1.2545708 1.2515178
1978

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        106    1.106413    .2543675   .8084843   2.136675
1.2461021 1.25065 1.2506502 1.2461255
1979

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        144    1.142876      .31042   .7815315   2.560082
1.2212306 1.2252241 1.2252241 1.2213521
1980

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        144    1.167435    .3057465   .7612076    2.43352
1.1845839 1.1893389 1.1893389 1.1847683
1981

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        144    1.166035    .3219018   .7899722   2.640925
1.1561338 1.161692 1.161692 1.1555325
1982

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        208    1.158364    .3515291   .5269988   3.118774
1.1672745 1.1717163 1.1717163 1.1668116
1983

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        209    1.140831    .3433312   .3540562   3.255057
1.1978852 1.203681 1.203681 1.1977204
1984

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        209    1.132168     .341661   .4480363   3.279802
1.1951668 1.2012508 1.2012508 1.1945027
1985

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        258    1.169436    .4311503   .1952033   5.341208
1.2118467 1.2185867 1.2185867 1.2116721
1986

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        249    1.181177    .4547539   .5059096   5.518414
1.214764 1.2234739 1.2234739 1.2146624
1987

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        249    1.194304    .5185553   .2758386   6.491694
1.2249029 1.2351422 1.2351422 1.2243319
1988

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        247    1.171757    .5400185   .2625991   6.285619
1.2756764 1.2847062 1.2847062 1.2748764
1989

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        242    1.158871    .4970442   .2658879   6.133488
1.2562001 1.2629728 1.2629728 1.2555789
1990

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        239    1.127907    .3942553   .1386878   3.114864
1.2608562 1.2685417 1.2685417 1.2608825
1991

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        270    1.229597    .5159405   .6732748   3.776832
1.261023 1.2701826 1.2701826 1.261126
1992

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        268    1.198997    .4958329   .6630762   4.333798
1.2763993 1.2864141 1.2864141 1.276507
1993

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        266    1.181326    .4982604   .6442079   4.463412
1.2933741 1.3098754 1.3098754 1.2893019
1994

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        336    1.252423    .7685158   .4851864   10.44571
1.3046876 1.3172969 1.3172969 1.3047189
1995

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        337    1.301231    1.205816   .3295226         15
1.297031 1.3100673 1.3100684 1.2969078
1996

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        341    1.292585    1.136914   .4318863         15
1.3036669 1.3139817 1.313987 1.3035368
1997

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        456     1.25147     .876731   .1611723         15
1.3011936 1.3285367 1.3365426 1.1527941
1998

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        457    1.195952    .5707541   .0491675   5.378345
1.2972523 1.311579 1.311579 1.2939029
1999

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        426    1.248736     .922274   .1285969         15
1.3168288 1.3383976 1.3434978 1.1573009
2000

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        475     1.26182    1.001111   .0460688         15
1.31749 1.3463537 1.3463551 1.3035235
2001

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        446    1.261384    .8723263   .3440664   12.53952
1.3336548 1.3668854 1.3668854 1.3175156
2002

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        430    1.302458     1.03941   .3955034   14.44338
1.3420149 1.3807535 1.3807536 1.3231604
2003

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        484    1.222694    .6201084   .0783813   4.962038
1.3440522 1.379342 1.379342 1.3305213
2004

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        474    1.222439     .595598   .2551016   4.327365
1.3576841 1.3957651 1.3957651 1.3444006
2005

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        455    1.263477    .7841751   .3355851   9.483335
1.3357953 1.3878981 1.3878981 1.3054101
2006

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        458    1.235261    .6365197   .3572412   5.295519
1.307541 1.3378433 1.3378433 1.2977393
2007

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        442    1.250371    .9009527   .3540379         15
1.3116162 1.3376291 1.3376343 1.3042874
2008

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        429    1.280377    1.020974   .3171613         15
1.3100889 1.3527344 1.3527414 1.2627162
2009

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        493    1.282562    .9769773   .1987246         15
1.3039891 1.3293927 1.3293991 1.2977992
2010

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        482    1.270084    .7327669   .2156033   6.036643
1.3205963 1.3544036 1.3544036 1.3092587
2011

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        464    1.285587    .7363952   .3777128   6.542892
1.3101102 1.3379862 1.3379862 1.3047861
2012

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        508    1.368912    1.093583   .0147639         15
1.3158644 1.3372812 1.3397018 1.2776185
2013

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        506    1.328794    .8942559   .0201825   7.463267
1.3124787 1.3311018 1.3311019 1.3101196
2014

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        483    1.370955    .9471814   .2168286   9.229357
1.3106097 1.3270282 1.3270282 1.3078727
2015

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        479    1.337929    1.063931   .0090136   11.29634
1.3071151 1.3250663 1.3250663 1.301613
2016

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        464    1.341476    1.303696   .0160823         15
1.3216358 1.3559417 1.3647522 1.2123177

. 
. *graph
. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. gen mu0_subs = .
(41 missing values generated)

. gen mu_subs = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'
  4.         replace mu0_subs = ${mu0_`y'_subs} if y == `y'
  5.         replace mu_subs = ${mu_`y'_subs} if y == `y'
  6.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price incre
> ase
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this
>  product)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                  //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen subs_ratio = shInitial/shFinal
 87. replace subs_ratio=5 if subs_ratio>5 & subs_ratio!=.
 88. 
. gen sales_mu_subs = sales_mu*subs_ratio
 89. egen totSales_mu_subs = sum(sales_mu_subs)
 90. gen ratio_mu_subs = totSales/totSales_mu_subs                                               
>                                     //18%, looks credible 
 91. su ratio_mu_subs
 92. global mu_`y'_subs = `r(mean)'
 93. 
. gen sales_mu0_subs = sales_mu0*subs_ratio
 94. egen totSales_mu0_subs = sum(sales_mu0_subs)
 95. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                             
>                                     //18%, looks credible 
 96. su ratio_mu0_subs
 97. global mu0_`y'_subs = `r(mean)'
 98. 
. }
 99. di "`y'"
100. su subs_ratio
101. 
. di ${mu0_`y'}, ${mu_`y'}, ${mu_`y'_subs}, ${mu0_`y'_subs}
102. }
1976

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        103    1.102899    .2396503   .7983941   2.246668
1.2462733 1.2470191 1.2470191 1.2463142
1977

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        103    1.105283     .247588   .7654348   2.318316
1.2514908 1.2545708 1.2545708 1.2515178
1978

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        106    1.106413    .2543675   .8084843   2.136675
1.2461021 1.25065 1.2506502 1.2461255
1979

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        144    1.142876      .31042   .7815315   2.560082
1.2212306 1.2252241 1.2252241 1.2213521
1980

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        144    1.167435    .3057465   .7612076    2.43352
1.1845839 1.1893389 1.1893389 1.1847683
1981

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        144    1.166035    .3219018   .7899722   2.640925
1.1561338 1.161692 1.161692 1.1555325
1982

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        208    1.158364    .3515291   .5269988   3.118774
1.1672745 1.1717163 1.1717163 1.1668116
1983

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        209    1.140831    .3433312   .3540562   3.255057
1.1978852 1.203681 1.203681 1.1977204
1984

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        209    1.132168     .341661   .4480363   3.279802
1.1951668 1.2012508 1.2012508 1.1945027
1985

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        258    1.168113     .418646   .1952033          5
1.2118467 1.2185867 1.2185885 1.2116737
1986

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        249    1.179095    .4356001   .5059096          5
1.214764 1.2234739 1.2234788 1.2146672
1987

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        249    1.188313    .4627196   .2758386          5
1.2249029 1.2351422 1.2351584 1.2243479
1988

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        247    1.166552    .4948338   .2625991          5
1.2756764 1.2847062 1.2847281 1.2748978
1989

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        242    1.154187    .4533962   .2658879          5
1.2562001 1.2629728 1.2629993 1.255605
1990

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        239    1.127907    .3942553   .1386878   3.114864
1.2608562 1.2685417 1.2685417 1.2608825
1991

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        270    1.229597    .5159405   .6732748   3.776832
1.261023 1.2701826 1.2701826 1.261126
1992

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        268    1.198997    .4958329   .6630762   4.333798
1.2763993 1.2864141 1.2864141 1.276507
1993

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        266    1.181326    .4982604   .6442079   4.463412
1.2933741 1.3098754 1.3098754 1.2893019
1994

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        336    1.233599     .598263   .4851864          5
1.3046876 1.3172969 1.3173473 1.3048307
1995

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        337    1.239856     .631036   .3295226          5
1.297031 1.3100673 1.310119 1.2971274
1996

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        341    1.233954    .6136852   .4318863          5
1.3036669 1.3139817 1.314572 1.3043038
1997

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        456    1.227279    .6043969   .1611723          5
1.3011936 1.3285367 1.3391976 1.2403302
1998

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        457    1.195124    .5649187   .0491675          5
1.2972523 1.311579 1.3115848 1.2939086
1999

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        426    1.224879    .6597363   .1285969          5
1.3168288 1.3383976 1.3497999 1.2757071
2000

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        475    1.226692    .6703762   .0460688          5
1.31749 1.3463537 1.3476009 1.3090816
2001

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        446    1.237584     .665129   .3440664          5
1.3336548 1.3668854 1.3696811 1.3260763
2002

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        430    1.266399    .7199018   .3955034          5
1.3420149 1.3807535 1.3812187 1.3285584
2003

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        484    1.222694    .6201084   .0783813   4.962038
1.3440522 1.379342 1.379342 1.3305213
2004

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        474    1.222439     .595598   .2551016   4.327365
1.3576841 1.3957651 1.3957651 1.3444006
2005

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        455    1.249685    .6783108   .3355851          5
1.3357953 1.3878981 1.3879727 1.3054764
2006

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        458    1.234616    .6325321   .3572412          5
1.307541 1.3378433 1.3378446 1.2977405
2007

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        442    1.227746    .6437345   .3540379          5
1.3116162 1.3376291 1.3376454 1.3043346
2008

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        429    1.241617    .6807644   .3171613          5
1.3100889 1.3527344 1.3544842 1.2765071
2009

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        493    1.250979    .7047135   .1987246          5
1.3039891 1.3293927 1.3295449 1.2979854
2010

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        482    1.263282    .6926938   .2156033          5
1.3205963 1.3544036 1.3545195 1.3093669
2011

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        464     1.27877      .69526   .3777128          5
1.3101102 1.3379862 1.3380817 1.3048769
2012

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        508    1.328797     .813048   .0147639          5
1.3158644 1.3372812 1.3409535 1.3062432
2013

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        506    1.307891    .7798574   .0201825          5
1.3124787 1.3311018 1.3319883 1.3109784
2014

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        483    1.345626    .8039888   .2168286          5
1.3106097 1.3270282 1.3274014 1.3082355
2015

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        479    1.297588    .8201744   .0090136          5
1.3071151 1.3250663 1.3266687 1.3031642
2016

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        464    1.270816    .8200706   .0160823          5
1.3216358 1.3559417 1.3673028 1.2880911

. 
. *graph
. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. gen mu0_subs = .
(41 missing values generated)

. gen mu_subs = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'
  4.         replace mu0_subs = ${mu0_`y'_subs} if y == `y'
  5.         replace mu_subs = ${mu_`y'_subs} if y == `y'
  6.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer ,
>  by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1
>  sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepus
> ing(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                   
>                                  //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                       
>                             //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                         
>                             //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price incre
> ase
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this
>  product)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                  //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen subs_ratio = shInitial/shFinal
 87. replace subs_ratio=4 if subs_ratio>4 & subs_ratio!=.
 88. 
. gen sales_mu_subs = sales_mu*subs_ratio
 89. egen totSales_mu_subs = sum(sales_mu_subs)
 90. gen ratio_mu_subs = totSales/totSales_mu_subs                                               
>                                     //18%, looks credible 
 91. su ratio_mu_subs
 92. global mu_`y'_subs = `r(mean)'
 93. 
. gen sales_mu0_subs = sales_mu0*subs_ratio
 94. egen totSales_mu0_subs = sum(sales_mu0_subs)
 95. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                             
>                                     //18%, looks credible 
 96. su ratio_mu0_subs
 97. global mu0_`y'_subs = `r(mean)'
 98. 
. }
 99. di "`y'"
100. su subs_ratio
101. 
. di ${mu0_`y'}, ${mu_`y'}, ${mu_`y'_subs}, ${mu0_`y'_subs}
102. }
1976

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        103    1.102899    .2396503   .7983941   2.246668
1.2462733 1.2470191 1.2470191 1.2463142
1977

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        103    1.105283     .247588   .7654348   2.318316
1.2514908 1.2545708 1.2545708 1.2515178
1978

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        106    1.106413    .2543675   .8084843   2.136675
1.2461021 1.25065 1.2506502 1.2461255
1979

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        144    1.142876      .31042   .7815315   2.560082
1.2212306 1.2252241 1.2252241 1.2213521
1980

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        144    1.167435    .3057465   .7612076    2.43352
1.1845839 1.1893389 1.1893389 1.1847683
1981

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        144    1.166035    .3219018   .7899722   2.640925
1.1561338 1.161692 1.161692 1.1555325
1982

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        208    1.158364    .3515291   .5269988   3.118774
1.1672745 1.1717163 1.1717163 1.1668116
1983

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        209    1.140831    .3433312   .3540562   3.255057
1.1978852 1.203681 1.203681 1.1977204
1984

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        209    1.132168     .341661   .4480363   3.279802
1.1951668 1.2012508 1.2012508 1.1945027
1985

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        258    1.164237    .3864199   .1952033          4
1.2118467 1.2185867 1.2185937 1.2116789
1986

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        249    1.175079    .4036704   .5059096          4
1.214764 1.2234739 1.2234881 1.2146765
1987

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        249    1.184297    .4328812   .2758386          4
1.2249029 1.2351422 1.2351693 1.2243588
1988

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        247    1.162503    .4666293   .2625991          4
1.2756764 1.2847062 1.2847451 1.2749146
1989

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        242    1.150055    .4216454   .2658879          4
1.2562001 1.2629728 1.2630225 1.2556282
1990

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        239    1.127907    .3942553   .1386878   3.114864
1.2608562 1.2685417 1.2685417 1.2608825
1991

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        270    1.229597    .5159405   .6732748   3.776832
1.261023 1.2701826 1.2701826 1.261126
1992

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        268    1.197752    .4882907   .6630762          4
1.2763993 1.2864141 1.2865702 1.2766608
1993

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        266    1.179584    .4874339   .6442079          4
1.2933741 1.3098754 1.310167 1.2895855
1994

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        336    1.225058    .5497459   .4851864          4
1.3046876 1.3172969 1.3179017 1.3053893
1995

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        337    1.228456    .5691382   .3295226          4
1.297031 1.3100673 1.3107681 1.2977896
1996

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        341    1.221912    .5457595   .4318863          4
1.3036669 1.3139817 1.3155075 1.305254
1997

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        456      1.2182    .5536362   .1611723          4
1.3011936 1.3285367 1.3409829 1.2589227
1998

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        457     1.19148    .5439311   .0491675          4
1.2972523 1.311579 1.3116075 1.2939304
1999

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        426    1.215302    .6120672   .1285969          4
1.3168288 1.3383976 1.3519007 1.290239
2000

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        475    1.219805    .6361478   .0460688          4
1.31749 1.3463537 1.348945 1.3110861
2001

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        446    1.229559    .6248186   .3440664          4
1.3336548 1.3668854 1.370898 1.3280203
2002

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        430    1.256432    .6754979   .3955034          4
1.3420149 1.3807535 1.3831251 1.3311514
2003

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        484    1.217726    .5946039   .0783813          4
1.3440522 1.379342 1.3803391 1.3314781
2004

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        474    1.220453    .5858118   .2551016          4
1.3576841 1.3957651 1.3959392 1.3445636
2005

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        455    1.241547    .6393824   .3355851          4
1.3357953 1.3878981 1.3893671 1.3067254
2006

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        458    1.230081    .6099407   .3572412          4
1.307541 1.3378433 1.3384181 1.2982819
2007

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        442    1.221883    .6147331   .3540379          4
1.3116162 1.3376291 1.3377002 1.3043904
2008

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        429    1.232629    .6368093   .3171613          4
1.3100889 1.3527344 1.3549656 1.279907
2009

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        493    1.238393    .6443176   .1987246          4
1.3039891 1.3293927 1.3297086 1.2981464
2010

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        482    1.251348    .6352758   .2156033          4
1.3205963 1.3544036 1.3548647 1.3101871
2011

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        464    1.267211    .6407985   .3777128          4
1.3101102 1.3379862 1.3382944 1.3050791
2012

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        508    1.308563    .7308311   .0147639          4
1.3158644 1.3372812 1.3415467 1.3096223
2013

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        506    1.288761    .6975418   .0201825          4
1.3124787 1.3311018 1.3326104 1.3115823
2014

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        483    1.323516    .7119324   .2168286          4
1.3106097 1.3270282 1.3281956 1.3090104
2015

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        479    1.274845    .7261866   .0090136          4
1.3071151 1.3250663 1.3279232 1.3043795
2016

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  subs_ratio |        464    1.247026    .7202972   .0160823          4
1.3216358 1.3559417 1.3685813 1.2971179

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. gen mu0_subs = .
(41 missing values generated)

. gen mu_subs = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'
  4.         replace mu0_subs = ${mu0_`y'_subs} if y == `y'
  5.         replace mu_subs = ${mu_`y'_subs} if y == `y'
  6.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD02748.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) -
>  e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscri
> pt:1}) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

---------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   6 May 2020, 10:09:53

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1978/1978{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen sales_mu_subs=.
 87. 
. 
. *gen subs_ratio = shInitial/shFinal
. *replace subs_ratio=4 if subs_ratio>4 & subs_ratio!=.
. 
. *gen sales_mu_subs = sales_mu*subs_ratio
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y'_subs = `r(mean)'
. 
. *gen sales_mu0_subs = sales_mu0*subs_ratio
. *egen totSales_mu0_subs = sum(sales_mu0_subs)
. *gen ratio_mu0_subs = totSales/totSales_mu0_subs                                                 
>                                        //18%, looks credible 
. *su ratio_mu0_subs
. *global mu0_`y'_subs = `r(mean)'
. 
. }
 88. di "`y'"
 89. su subs_ratio
 90. 
. di ${mu0_`y'}, ${mu_`y'}, ${mu_`y'_subs}, ${mu0_`y'_subs}
 91. }
1978
variable subs_ratio not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. scatter shFinal shInitial

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval i=1/100{
  2.         if shFinal>shInitial{
  3.                 replace sales_mu_subs=sales_mu_subs*0.99                        //decrease exp
> enditure on that good
  4.                 }
  5.         if shInitial>shFinal{
  6.                 replace sales_mu_subs=sales_mu_subs*1.01                        //increase exp
> enditure on that good
  7.                 }
  8.         }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. scatter shFinal shInitial

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. gen sales_mu_subs=sales_mu
variable sales_mu_subs already defined
r(110);

end of do-file

r(110);

. drop sales_mu_subs

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. gen sales_mu_subs=sales_mu
(472 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. gen shFinal_subs = shFinal
(472 missing values generated)

. gen shInitial_subs = shInitial
(49 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. scatter shFinal shInitial

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval i=1/10{
  2.         if shFinal_subs>shInitial_subs{
  3.                 replace sales_mu_subs=sales_mu_subs*0.99                        //decrease exp
> enditure on that good
  4.                 replace shFinal_subs=shFinal_subs*0.99
  5.                 }
  6.         if shInitial_subs>shFinal_subs{
  7.                 replace sales_mu_subs=sales_mu_subs*1.01                        //increase exp
> enditure on that good
  8.                 replace shFinal_subs=shFinal_subs*0.99
  9.                 }
 10.         }
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. scatter shFinal shInitial

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval i=1/100{
  2.         if shFinal_subs>shInitial_subs{
  3.                 replace sales_mu_subs=sales_mu_subs*0.99                        //decrease exp
> enditure on that good
  4.                 replace shFinal_subs=shFinal_subs*0.99
  5.                 }
  6.         if shInitial_subs>shFinal_subs{
  7.                 replace sales_mu_subs=sales_mu_subs*1.01                        //increase exp
> enditure on that good
  8.                 replace shFinal_subs=shFinal_subs*0.99
  9.                 }
 10.         }
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. scatter shFinal shInitial

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. scatter shFinal_subs shInitial_subs

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. scatter shFinal shInitial

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. scatter shFinal_subs shInitial_subs

. 
end of do-file

. h else

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1978/1978{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen sales_mu_subs=sales_mu
 87. 
. 
. gen shFinal_subs = shFinal
 88. gen shInitial_subs = shInitial
 89. 
. scatter shFinal shInitial
 90. }}
program error:  code follows on the same line as close brace
r(198);

end of do-file

r(198);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval i=1/100{
  2.         if shFinal_subs>shInitial_subs{
  3.                 replace sales_mu_subs=sales_mu_subs*0.99                        //decrease exp
> enditure on that good
  4.                 replace shFinal_subs=shFinal_subs*0.99
  5.                 }
  6.         else /*if shInitial_subs>shFinal_subs*/{
  7.                 replace sales_mu_subs=sales_mu_subs*1.01                        //increase exp
> enditure on that good
  8.                 replace shFinal_subs=shFinal_subs*1.01
  9.                 }
 10.         }
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)
(106 real changes made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. scatter shFinal_subs shInitial_subs

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. scatter shFinal shInitial

. 
end of do-file

. scatter shFinal shFinal_subs

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1978/1978{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen sales_mu_subs=sales_mu
 87. 
. 
. gen shFinal_subs = shFinal
 88. gen shInitial_subs = shInitial
 89. 
. scatter shFinal shInitial
 90. }}
program error:  code follows on the same line as close brace
r(198);

end of do-file

r(198);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1978/1978{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen sales_mu_subs=sales_mu
 87. 
. 
. gen shFinal_subs = shFinal
 88. gen shInitial_subs = shInitial
 89. 
. scatter shFinal shInitial
 90.                 }
 91.         }

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval i=1/10{
  2.         if shFinal_subs>shInitial{
  3.                 replace sales_mu_subs=sales_mu_subs*0.99                        //decrease exp
> enditure on that good
  4.                 egen totSales_mu_subs=sum(sales_mu_subs)
  5.                 replace shFinal_subs=sales_mu_subs/totSales_mu_subs
  6.                 drop totSales_mu_subs
  7.                 }
  8.         else /*if shInitial_subs>shFinal_subs*/{
  9.                 replace sales_mu_subs=sales_mu_subs*1.01                        //increase exp
> enditure on that good
 10.                 egen totSales_mu_subs=sum(sales_mu_subs)
 11.                 replace shFinal_subs=sales_mu_subs/totSales_mu_subs
 12.                 drop totSales_mu_subs
 13.                 }
 14.         }
(106 real changes made)
(29 real changes made)
(106 real changes made)
(26 real changes made)
(106 real changes made)
(40 real changes made)
(106 real changes made)
(56 real changes made)
(106 real changes made)
(74 real changes made)
(106 real changes made)
(42 real changes made)
(106 real changes made)
(39 real changes made)
(106 real changes made)
(23 real changes made)
(106 real changes made)
(26 real changes made)
(106 real changes made)
(32 real changes made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. scatter shFinal_subs shInitial_subs

. 
end of do-file

. scatter shFinal_subs shFinal

. 
. count if if shFinal_subs>shInitial
if not found
r(111);

. count if shFinal_subs>shInitial
  474

. count if shFinal_subs<shInitial
  55

. br if shFinal_subs>shInitial

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. 
. forval y = 1978/1978{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen sales_mu_subs=sales_mu
 87. 
. 
. gen shFinal_subs = shFinal
 88. gen shInitial_subs = shInitial
 89. 
. scatter shFinal shInitial
 90.                 }
 91.         }

. 
end of do-file

. drop shInitial_subs

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. gen shInitial_subs = shInitial if shFinal_subs!=.
(472 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

.         if shFinal_subs>shInitial_subs & shFinal_subs!=.{
.                 replace sales_mu_subs=sales_mu_subs*0.99                        //decrease expend
> iture on that good
.                 egen totSales_mu_subs=sum(sales_mu_subs)
.                 replace shFinal_subs=sales_mu_subs/totSales_mu_subs
.                 drop totSales_mu_subs
.                 }

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.        
>                //decrease expenditure on that good
(51 real changes made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. egen totSales_mu_subs=sum(sales_mu_subs)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
(106 real changes made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. drop totSales_mu_subs   

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. scatter shFinal_subs shInitial_subs

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter shFinal_subs shInitial_subs) //

.         (scatter shFinal shInitial)
( is not a valid command name
r(199);

end of do-file

r(199);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //decrease expenditure on that good
(57 real changes made)

. egen totSales_mu_subs=sum(sales_mu_subs)

. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
(106 real changes made)

. drop totSales_mu_subs

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.        
>                //decrease expenditure on that good
(51 real changes made)

. egen totSales_mu_subs=sum(sales_mu_subs)

. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
(106 real changes made)

. drop totSales_mu_subs   

. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //decrease expenditure on that good
(56 real changes made)

. egen totSales_mu_subs=sum(sales_mu_subs)

. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
(106 real changes made)

. drop totSales_mu_subs

.         
. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval i=1/10{
  2. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.     
>                   //decrease expenditure on that good
  3. egen totSales_mu_subs=sum(sales_mu_subs)
  4. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
  5. drop totSales_mu_subs   
  6. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //decrease expenditure on that good
  7. egen totSales_mu_subs=sum(sales_mu_subs)
  8. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
  9. drop totSales_mu_subs
 10. }
(51 real changes made)
(106 real changes made)
(56 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(56 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(56 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(62 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(62 real changes made)
(106 real changes made)
(35 real changes made)
(106 real changes made)
(73 real changes made)
(106 real changes made)
(36 real changes made)
(106 real changes made)
(63 real changes made)
(106 real changes made)
(43 real changes made)
(106 real changes made)
(71 real changes made)
(106 real changes made)
(30 real changes made)
(106 real changes made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval i=1/50{
  2. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.     
>                   //decrease expenditure on that good
  3. egen totSales_mu_subs=sum(sales_mu_subs)
  4. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
  5. drop totSales_mu_subs   
  6. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //decrease expenditure on that good
  7. egen totSales_mu_subs=sum(sales_mu_subs)
  8. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
  9. drop totSales_mu_subs
 10. }
(78 real changes made)
(106 real changes made)
(30 real changes made)
(106 real changes made)
(69 real changes made)
(106 real changes made)
(39 real changes made)
(106 real changes made)
(72 real changes made)
(106 real changes made)
(31 real changes made)
(106 real changes made)
(79 real changes made)
(106 real changes made)
(34 real changes made)
(106 real changes made)
(74 real changes made)
(106 real changes made)
(32 real changes made)
(106 real changes made)
(77 real changes made)
(106 real changes made)
(25 real changes made)
(106 real changes made)
(83 real changes made)
(106 real changes made)
(32 real changes made)
(106 real changes made)
(74 real changes made)
(106 real changes made)
(28 real changes made)
(106 real changes made)
(78 real changes made)
(106 real changes made)
(23 real changes made)
(106 real changes made)
(83 real changes made)
(106 real changes made)
(34 real changes made)
(106 real changes made)
(74 real changes made)
(106 real changes made)
(27 real changes made)
(106 real changes made)
(81 real changes made)
(106 real changes made)
(16 real changes made)
(106 real changes made)
(77 real changes made)
(106 real changes made)
(24 real changes made)
(106 real changes made)
(81 real changes made)
(106 real changes made)
(23 real changes made)
(106 real changes made)
(86 real changes made)
(106 real changes made)
(17 real changes made)
(106 real changes made)
(88 real changes made)
(106 real changes made)
(29 real changes made)
(106 real changes made)
(80 real changes made)
(106 real changes made)
(23 real changes made)
(106 real changes made)
(90 real changes made)
(106 real changes made)
(18 real changes made)
(106 real changes made)
(92 real changes made)
(106 real changes made)
(24 real changes made)
(106 real changes made)
(77 real changes made)
(106 real changes made)
(20 real changes made)
(106 real changes made)
(94 real changes made)
(106 real changes made)
(17 real changes made)
(106 real changes made)
(99 real changes made)
(106 real changes made)
(24 real changes made)
(106 real changes made)
(76 real changes made)
(106 real changes made)
(26 real changes made)
(106 real changes made)
(83 real changes made)
(106 real changes made)
(10 real changes made)
(106 real changes made)
(79 real changes made)
(106 real changes made)
(31 real changes made)
(106 real changes made)
(81 real changes made)
(106 real changes made)
(22 real changes made)
(106 real changes made)
(87 real changes made)
(106 real changes made)
(36 real changes made)
(106 real changes made)
(77 real changes made)
(106 real changes made)
(27 real changes made)
(106 real changes made)
(73 real changes made)
(106 real changes made)
(35 real changes made)
(106 real changes made)
(81 real changes made)
(106 real changes made)
(18 real changes made)
(106 real changes made)
(71 real changes made)
(106 real changes made)
(40 real changes made)
(106 real changes made)
(80 real changes made)
(106 real changes made)
(27 real changes made)
(106 real changes made)
(61 real changes made)
(106 real changes made)
(34 real changes made)
(106 real changes made)
(79 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(74 real changes made)
(106 real changes made)
(34 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(38 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)

.         
. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval i=1/1000{
  2. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.     
>                   //decrease expenditure on that good
  3. egen totSales_mu_subs=sum(sales_mu_subs)
  4. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
  5. drop totSales_mu_subs   
  6. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //decrease expenditure on that good
  7. egen totSales_mu_subs=sum(sales_mu_subs)
  8. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
  9. drop totSales_mu_subs
 10. }
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(45 real changes made)
(106 real changes made)
(45 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(42 real changes made)
(106 real changes made)
(42 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(45 real changes made)
(106 real changes made)
(45 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(45 real changes made)
(106 real changes made)
(45 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(56 real changes made)
(106 real changes made)
(56 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(50 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(46 real changes made)
(106 real changes made)
(37 real changes made)
(106 real changes made)
(37 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(40 real changes made)
(106 real changes made)
(40 real changes made)
(106 real changes made)
(42 real changes made)
(106 real changes made)
(42 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(47 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(44 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(56 real changes made)
(106 real changes made)
(56 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(55 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(51 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(54 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(53 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(52 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(48 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(58 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(57 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)
(49 real changes made)
(106 real changes made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1978/1978{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen shInitial0 = finalSale/totSales
 87. gen shFinal0 = sales_mu0/totSales_mu0
 88. gen sales_mu_subs=sales_mu
 89. gen sales_mu0_subs=sales_mu0
 90. 
. 
. gen shFinal_subs = shFinal
 91. gen shInitial_subs = shInitial if shFinal_subs0!=.
 92. gen shFinal_subs0 = shFinal0
 93. gen shInitial_subs0 = shInitial0 if shFinal_subs0!=.
 94. }
 95. }
shFinal_subs0 not found
r(111);

end of do-file

r(111);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. gen shInitial_subs = shInitial if shFinal_subs!=.
(472 missing values generated)

. gen shFinal_subs0 = shFinal0
(472 missing values generated)

. gen shInitial_subs0 = shInitial0 if shFinal_subs0!=.
(472 missing values generated)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1978/1978{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen shInitial0 = finalSale/totSales
 87. gen shFinal0 = sales_mu0/totSales_mu0
 88. gen sales_mu_subs=sales_mu
 89. gen sales_mu0_subs=sales_mu0
 90. 
. 
. gen shFinal_subs = shFinal
 91. gen shInitial_subs = shInitial if shFinal_subs!=.
 92. gen shFinal_subs0 = shFinal0
 93. gen shInitial_subs0 = shInitial0 if shFinal_subs0!=.
 94. }
 95. }

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1978/1978{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen shInitial0 = finalSale/totSales
 87. gen shFinal0 = sales_mu0/totSales_mu0
 88. gen sales_mu_subs=sales_mu
 89. gen sales_mu0_subs=sales_mu0
 90. 
. 
. gen shFinal_subs = shFinal
 91. gen shInitial_subs = shInitial if shFinal_subs!=.
 92. gen shFinal_subs0 = shFinal0
 93. gen shInitial_subs0 = shInitial0 if shFinal_subs0!=.
 94. 
. forval i=1/1000{
 95. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.     
>                   //decrease expenditure on that good
 96. egen totSales_mu_subs=sum(sales_mu_subs)
 97. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
 98. drop totSales_mu_subs   
 99. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //increase expenditure on that good
100. egen totSales_mu_subs=sum(sales_mu_subs)
101. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
102. drop totSales_mu_subs
103. 
. replace sales_mu0_subs=sales_mu0_subs*0.99 if shFinal_subs0>shInitial_subs0 & shFinal_subs0!=.   
>                //decrease expenditure on that good
104. egen totSales_mu0_subs=sum(sales_mu0_subs)
105. replace shFinal_subs0=sales_mu0_subs/totSales_mu0_subs
106. drop totSales_mu0_subs  
107. 
. replace sales_mu0_subs=sales_mu0_subs*1.01 if shFinal_subs0<shInitial_subs0 & shFinal_subs0!=.   
>                //increase expenditure on that good
108. egen totSales_mu0_subs=sum(sales_mu0_subs)
109. replace shFinal_subs=sales_mu0_subs/totSales_mu0_subs
110. drop totSales_mu0_subs
111. 
. }
112. }
113. }

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter shFinal_subs0 shInitial_subs0) ///
>         (scatter shFinal shInitial)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. egen totSales_mu_subs = sum(sales_mu_subs)

. gen ratio_mu_subs = totSales/totSales_mu_subs                                                    
>                                //18%, looks credible 

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. su ratio_mu_subs

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
ratio_mu_s~s |        578    1.702397           0   1.702397   1.702397

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. egen totSales_mu0_subs = sum(sales_mu0_subs)

. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                                  
>                                //18%, looks credible 

. su ratio_mu0_subs

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
ratio_mu0_~s |        578    1.679984           0   1.679984   1.679984

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1978/1978{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen shInitial0 = finalSale/totSales
 87. gen shFinal0 = sales_mu0/totSales_mu0
 88. gen sales_mu_subs=sales_mu
 89. gen sales_mu0_subs=sales_mu0
 90. 
. 
. gen shFinal_subs = shFinal
 91. gen shInitial_subs = shInitial if shFinal_subs!=.
 92. gen shFinal_subs0 = shFinal0
 93. gen shInitial_subs0 = shInitial0 if shFinal_subs0!=.
 94. 
. forval i=1/1000{
 95. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.     
>                   //decrease expenditure on that good
 96. egen totSales_mu_subs=sum(sales_mu_subs)
 97. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
 98. drop totSales_mu_subs   
 99. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //increase expenditure on that good
100. egen totSales_mu_subs=sum(sales_mu_subs)
101. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
102. drop totSales_mu_subs
103. 
. replace sales_mu0_subs=sales_mu0_subs*0.99 if shFinal_subs0>shInitial_subs0 & shFinal_subs0!=.   
>                //decrease expenditure on that good
104. egen totSales_mu0_subs=sum(sales_mu0_subs)
105. replace shFinal_subs0=sales_mu0_subs/totSales_mu0_subs
106. drop totSales_mu0_subs  
107. 
. replace sales_mu0_subs=sales_mu0_subs*1.01 if shFinal_subs0<shInitial_subs0 & shFinal_subs0!=.   
>                //increase expenditure on that good
108. egen totSales_mu0_subs=sum(sales_mu0_subs)
109. replace shFinal_subs=sales_mu0_subs/totSales_mu0_subs
110. drop totSales_mu0_subs
111. 
. }
112.         
. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)
113. 
. twoway (scatter shFinal_subs0 shInitial_subs0) ///
>         (scatter shFinal shInitial)
114. 
. 
. *gen subs_ratio = shInitial/shFinal
. *replace subs_ratio=4 if subs_ratio>4 & subs_ratio!=.
. 
. *gen sales_mu_subs = sales_mu*subs_ratio
. egen totSales_mu_subs = sum(sales_mu_subs)
115. gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                   //18%, looks credible 
116. su ratio_mu_subs
117. global mu_`y'_subs = `r(mean)'
118. 
. *gen sales_mu0_subs = sales_mu0*subs_ratio
. egen totSales_mu0_subs = sum(sales_mu0_subs)
119. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                               
>                                   //18%, looks credible 
120. su ratio_mu0_subs
121. global mu0_`y'_subs = `r(mean)'
122. 
. }
123. di "`y'"
124. di ${mu0_`y'}, ${mu_`y'}, ${mu_`y'_subs}, ${mu0_`y'_subs}
125. }
1978
1.2461021 1.25065 1.7023971 1.6799841

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen shInitial0 = finalSale/totSales
 87. gen shFinal0 = sales_mu0/totSales_mu0
 88. gen sales_mu_subs=sales_mu
 89. gen sales_mu0_subs=sales_mu0
 90. 
. 
. gen shFinal_subs = shFinal
 91. gen shInitial_subs = shInitial if shFinal_subs!=.
 92. gen shFinal_subs0 = shFinal0
 93. gen shInitial_subs0 = shInitial0 if shFinal_subs0!=.
 94. 
. forval i=1/1000{
 95. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.     
>                   //decrease expenditure on that good
 96. egen totSales_mu_subs=sum(sales_mu_subs)
 97. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
 98. drop totSales_mu_subs   
 99. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //increase expenditure on that good
100. egen totSales_mu_subs=sum(sales_mu_subs)
101. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
102. drop totSales_mu_subs
103. 
. replace sales_mu0_subs=sales_mu0_subs*0.99 if shFinal_subs0>shInitial_subs0 & shFinal_subs0!=.   
>                //decrease expenditure on that good
104. egen totSales_mu0_subs=sum(sales_mu0_subs)
105. replace shFinal_subs0=sales_mu0_subs/totSales_mu0_subs
106. drop totSales_mu0_subs  
107. 
. replace sales_mu0_subs=sales_mu0_subs*1.01 if shFinal_subs0<shInitial_subs0 & shFinal_subs0!=.   
>                //increase expenditure on that good
108. egen totSales_mu0_subs=sum(sales_mu0_subs)
109. replace shFinal_subs=sales_mu0_subs/totSales_mu0_subs
110. drop totSales_mu0_subs
111. 
. }
112.         
. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)
113. 
. twoway (scatter shFinal_subs0 shInitial_subs0) ///
>         (scatter shFinal shInitial)
114. 
. 
. *gen subs_ratio = shInitial/shFinal
. *replace subs_ratio=4 if subs_ratio>4 & subs_ratio!=.
. 
. *gen sales_mu_subs = sales_mu*subs_ratio
. egen totSales_mu_subs = sum(sales_mu_subs)
115. gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                   //18%, looks credible 
116. su ratio_mu_subs
117. global mu_`y'_subs = `r(mean)'
118. 
. *gen sales_mu0_subs = sales_mu0*subs_ratio
. egen totSales_mu0_subs = sum(sales_mu0_subs)
119. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                               
>                                   //18%, looks credible 
120. su ratio_mu0_subs
121. global mu0_`y'_subs = `r(mean)'
122. 
. }
123. di "`y'"
124. di ${mu0_`y'}, ${mu_`y'}, ${mu_`y'_subs}, ${mu0_`y'_subs}
125. }
1976
1.2462733 1.2470191 1.7625116 1.7286844
1977
1.2514908 1.2545708 1.7852756 1.7310536
1978
1.2461021 1.25065 1.7023971 1.6799841
1979
1.2212306 1.2252241 1.6054066 1.5764587
1980
1.1845839 1.1893389 1.5212718 1.4894685
1981
1.1561338 1.161692 1.4787956 1.44083
1982
1.1672745 1.1717163 1.4934231 1.4804233
1983
1.1978852 1.203681 1.5310096 1.5214251
1984
1.1951668 1.2012508 1.5226703 1.5089616
1985
1.2118467 1.2185867 1.5303048 1.5078787
1986
1.214764 1.2234739 1.5119153 1.4847876
1987
1.2249029 1.2351422 1.6170199 1.5801027
1988
1.2756764 1.2847062 1.6476593 1.6220031
1989
1.2562001 1.2629728 1.6473469 1.6077925
1990
1.2608562 1.2685417 1.7241529 1.666669
1991
1.261023 1.2701826 1.7542152 1.6920214
1992
1.2763993 1.2864141 1.828306 1.7754921
1993
1.2933741 1.3098754 1.9199907 1.8252549
1994
1.3046876 1.3172969 1.9323221 1.8365216
1995
1.297031 1.3100673 1.9980925 1.9126558
1996
1.3036669 1.3139817 2.1814771 2.0500484
1997
1.3011936 1.3285367 2.0885055 1.769519
1998
1.2972523 1.311579 1.7873541 1.7149718
1999
1.3168288 1.3383976 2.6925225 2.0256026
2000
1.31749 1.3463537 2.2789533 2.1916926
2001
1.3336548 1.3668854 2.6450808 2.4403019
2002
1.3420149 1.3807535 2.4423416 2.3011658
2003
1.3440522 1.379342 2.3044565 2.209795
2004
1.3576841 1.3957651 2.2480781 2.1607764
2005
1.3357953 1.3878981 2.410135 2.2026443
2006
1.307541 1.3378433 2.2008688 2.125205
2007
1.3116162 1.3376291 2.1110103 2.0510197
2008
1.3100889 1.3527344 2.3543618 2.0699294
2009
1.3039891 1.3293927 1.9608049 1.9104648
2010
1.3205963 1.3544036 2.2169626 2.1266623
2011
1.3101102 1.3379862 2.200259 2.1153452
2012
1.3158644 1.3372812 2.3337731 2.1298785
2013
1.3124787 1.3311018 2.1297202 2.0578413
2014
1.3106097 1.3270282 2.1449883 2.0478792
2015
1.3071151 1.3250663 1.8269203 1.8179427
2016
1.3216358 1.3559417 3.1293485 2.2394285

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. gen mu0_subs = .
(41 missing values generated)

. gen mu_subs = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'
  4.         replace mu0_subs = ${mu0_`y'_subs} if y == `y'
  5.         replace mu_subs = ${mu_`y'_subs} if y == `y'
  6.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)2.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen shInitial0 = finalSale/totSales
 87. gen shFinal0 = sales_mu0/totSales_mu0
 88. gen sales_mu_subs=sales_mu
 89. gen sales_mu0_subs=sales_mu0
 90. 
. 
. gen shFinal_subs = shFinal
 91. gen shInitial_subs = shInitial if shFinal_subs!=.
 92. gen shFinal_subs0 = shFinal0
 93. gen shInitial_subs0 = shInitial0 if shFinal_subs0!=.
 94. 
. forval i=1/10{
 95. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.     
>                   //decrease expenditure on that good
 96. egen totSales_mu_subs=sum(sales_mu_subs)
 97. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
 98. drop totSales_mu_subs   
 99. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //increase expenditure on that good
100. egen totSales_mu_subs=sum(sales_mu_subs)
101. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
102. drop totSales_mu_subs
103. 
. replace sales_mu0_subs=sales_mu0_subs*0.99 if shFinal_subs0>shInitial_subs0 & shFinal_subs0!=.   
>                //decrease expenditure on that good
104. egen totSales_mu0_subs=sum(sales_mu0_subs)
105. replace shFinal_subs0=sales_mu0_subs/totSales_mu0_subs
106. drop totSales_mu0_subs  
107. 
. replace sales_mu0_subs=sales_mu0_subs*1.01 if shFinal_subs0<shInitial_subs0 & shFinal_subs0!=.   
>                //increase expenditure on that good
108. egen totSales_mu0_subs=sum(sales_mu0_subs)
109. replace shFinal_subs=sales_mu0_subs/totSales_mu0_subs
110. drop totSales_mu0_subs
111. 
. }
112.         
. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)
113. 
. twoway (scatter shFinal_subs0 shInitial_subs0) ///
>         (scatter shFinal shInitial)
114. 
. 
. *gen subs_ratio = shInitial/shFinal
. *replace subs_ratio=4 if subs_ratio>4 & subs_ratio!=.
. 
. *gen sales_mu_subs = sales_mu*subs_ratio
. egen totSales_mu_subs = sum(sales_mu_subs)
115. gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                   //18%, looks credible 
116. su ratio_mu_subs
117. global mu_`y'_subs = `r(mean)'
118. 
. *gen sales_mu0_subs = sales_mu0*subs_ratio
. egen totSales_mu0_subs = sum(sales_mu0_subs)
119. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                               
>                                   //18%, looks credible 
120. su ratio_mu0_subs
121. global mu0_`y'_subs = `r(mean)'
122. 
. }
123. di "`y'"
124. di ${mu0_`y'}, ${mu_`y'}, ${mu0_`y'_subs}, ${mu_`y'_subs}
125. }
1976
1.2462733 1.2470191 1.2975454 1.3019985
1977
1.2514908 1.2545708 1.3062049 1.3123786
1978
1.2461021 1.25065 1.3057792 1.3122402
1979
1.2212306 1.2252241 1.2767994 1.2836312
1980
1.1845839 1.1893389 1.239717 1.2474416
1981
1.1561338 1.161692 1.2146095 1.2202445
1982
1.1672745 1.1717163 1.2204634 1.2252496
1983
1.1978852 1.203681 1.2556328 1.2638441
1984
1.1951668 1.2012508 1.2502936 1.2573637
1985
1.2118467 1.2185867 1.2664356 1.2754539
1986
1.214764 1.2234739 1.2567502 1.2685086
1987
1.2249029 1.2351422 1.2701769 1.2821653
1988
1.2756764 1.2847062 1.3190588 1.3312306
1989
1.2562001 1.2629728 1.2942944 1.3032696
1990
1.2608562 1.2685417 1.3002089 1.3105022
1991
1.261023 1.2701826 1.2908278 1.3030293
1992
1.2763993 1.2864141 1.3116094 1.3237972
1993
1.2933741 1.3098754 1.3207452 1.343256
1994
1.3046876 1.3172969 1.3345872 1.3489994
1995
1.297031 1.3100673 1.3374451 1.3530173
1996
1.3036669 1.3139817 1.3500432 1.3630449
1997
1.3011936 1.3285367 1.3514222 1.391385
1998
1.2972523 1.311579 1.3512636 1.3689559
1999
1.3168288 1.3383976 1.3789657 1.4086248
2000
1.31749 1.3463537 1.3818858 1.4129422
2001
1.3336548 1.3668854 1.4041324 1.4389421
2002
1.3420149 1.3807535 1.4092416 1.4508852
2003
1.3440522 1.379342 1.4082146 1.4475197
2004
1.3576841 1.3957651 1.4255873 1.465176
2005
1.3357953 1.3878981 1.4044573 1.4660782
2006
1.307541 1.3378433 1.3764832 1.4097416
2007
1.3116162 1.3376291 1.3756607 1.4039602
2008
1.3100889 1.3527344 1.3762746 1.4227649
2009
1.3039891 1.3293927 1.3636893 1.3905157
2010
1.3205963 1.3544036 1.3857332 1.4213161
2011
1.3101102 1.3379862 1.3754816 1.4049608
2012
1.3158644 1.3372812 1.3806202 1.4027301
2013
1.3124787 1.3311018 1.372363 1.3916117
2014
1.3106097 1.3270282 1.3702779 1.3857907
2015
1.3071151 1.3250663 1.3576999 1.3739285
2016
1.3216358 1.3559417 1.3762014 1.4130855

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. gen mu0_subs = .
(41 missing values generated)

. gen mu_subs = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'
  4.         replace mu0_subs = ${mu0_`y'_subs} if y == `y'
  5.         replace mu_subs = ${mu_`y'_subs} if y == `y'
  6.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)2.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.5) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen shInitial0 = finalSale/totSales
 87. gen shFinal0 = sales_mu0/totSales_mu0
 88. gen sales_mu_subs=sales_mu
 89. gen sales_mu0_subs=sales_mu0
 90. 
. 
. gen shFinal_subs = shFinal
 91. gen shInitial_subs = shInitial if shFinal_subs!=.
 92. gen shFinal_subs0 = shFinal0
 93. gen shInitial_subs0 = shInitial0 if shFinal_subs0!=.
 94. 
. forval i=1/100{
 95. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.     
>                   //decrease expenditure on that good
 96. egen totSales_mu_subs=sum(sales_mu_subs)
 97. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
 98. drop totSales_mu_subs   
 99. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //increase expenditure on that good
100. egen totSales_mu_subs=sum(sales_mu_subs)
101. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
102. drop totSales_mu_subs
103. 
. replace sales_mu0_subs=sales_mu0_subs*0.99 if shFinal_subs0>shInitial_subs0 & shFinal_subs0!=.   
>                //decrease expenditure on that good
104. egen totSales_mu0_subs=sum(sales_mu0_subs)
105. replace shFinal_subs0=sales_mu0_subs/totSales_mu0_subs
106. drop totSales_mu0_subs  
107. 
. replace sales_mu0_subs=sales_mu0_subs*1.01 if shFinal_subs0<shInitial_subs0 & shFinal_subs0!=.   
>                //increase expenditure on that good
108. egen totSales_mu0_subs=sum(sales_mu0_subs)
109. replace shFinal_subs=sales_mu0_subs/totSales_mu0_subs
110. drop totSales_mu0_subs
111. 
. }
112.         
. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)
113. 
. twoway (scatter shFinal_subs0 shInitial_subs0) ///
>         (scatter shFinal shInitial)
114. 
. 
. *gen subs_ratio = shInitial/shFinal
. *replace subs_ratio=4 if subs_ratio>4 & subs_ratio!=.
. 
. *gen sales_mu_subs = sales_mu*subs_ratio
. egen totSales_mu_subs = sum(sales_mu_subs)
115. gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                   //18%, looks credible 
116. su ratio_mu_subs
117. global mu_`y'_subs = `r(mean)'
118. 
. *gen sales_mu0_subs = sales_mu0*subs_ratio
. egen totSales_mu0_subs = sum(sales_mu0_subs)
119. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                               
>                                   //18%, looks credible 
120. su ratio_mu0_subs
121. global mu0_`y'_subs = `r(mean)'
122. 
. }
123. di "`y'"
124. di ${mu0_`y'}, ${mu_`y'}, ${mu0_`y'_subs}, ${mu_`y'_subs}
125. }
1976
1.2462733 1.2470191 1.652615 1.6827464
1977
1.2514908 1.2545708 1.6548796 1.6984684
1978
1.2461021 1.25065 1.606057 1.6302831
1979
1.2212306 1.2252241 1.5070872 1.5392429
1980
1.1845839 1.1893389 1.4239249 1.4488753
1981
1.1561338 1.161692 1.3774267 1.4055469
1982
1.1672745 1.1717163 1.4152778 1.4267088
1983
1.1978852 1.203681 1.4544752 1.4704695
1984
1.1951668 1.2012508 1.4425601 1.4623663
1985
1.2118467 1.2185867 1.4414642 1.4579524
1986
1.214764 1.2234739 1.4194758 1.4480683
1987
1.2249029 1.2351422 1.51062 1.5512378
1988
1.2756764 1.2847062 1.5506647 1.5843472
1989
1.2562001 1.2629728 1.5371157 1.5791129
1990
1.2608562 1.2685417 1.5932539 1.642166
1991
1.261023 1.2701826 1.6178291 1.6822848
1992
1.2763993 1.2864141 1.6982944 1.7552314
1993
1.2933741 1.3098754 1.7466731 1.8310452
1994
1.3046876 1.3172969 1.7572916 1.839373
1995
1.297031 1.3100673 1.8267921 1.9113404
1996
1.3036669 1.3139817 1.9571245 2.0695121
1997
1.3011936 1.3285367 1.6920471 2.01157
1998
1.2972523 1.311579 1.638617 1.7143459
1999
1.3168288 1.3383976 1.920462 2.4138656
2000
1.31749 1.3463537 2.0667379 2.164942
2001
1.3336548 1.3668854 2.2433977 2.4053419
2002
1.3420149 1.3807535 2.2009475 2.3245914
2003
1.3440522 1.379342 2.1130559 2.2092297
2004
1.3576841 1.3957651 2.0662181 2.160995
2005
1.3357953 1.3878981 2.0902188 2.2989564
2006
1.307541 1.3378433 2.0343282 2.1069047
2007
1.3116162 1.3376291 1.9611167 2.028863
2008
1.3100889 1.3527344 1.9798517 2.2507284
2009
1.3039891 1.3293927 1.8540308 1.8995513
2010
1.3205963 1.3544036 2.0323765 2.1205218
2011
1.3101102 1.3379862 2.0227947 2.0976415
2012
1.3158644 1.3372812 2.0396619 2.230124
2013
1.3124787 1.3311018 1.9704919 2.0351357
2014
1.3106097 1.3270282 1.9614645 2.0540698
2015
1.3071151 1.3250663 1.7261504 1.749228
2016
1.3216358 1.3559417 1.9819065 2.3998044

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. gen mu0_subs = .
(41 missing values generated)

. gen mu_subs = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'
  4.         replace mu0_subs = ${mu0_`y'_subs} if y == `y'
  5.         replace mu_subs = ${mu_`y'_subs} if y == `y'
  6.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)2) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen shInitial0 = finalSale/totSales
 87. gen shFinal0 = sales_mu0/totSales_mu0
 88. gen sales_mu_subs=sales_mu
 89. gen sales_mu0_subs=sales_mu0
 90. 
. 
. gen shFinal_subs = shFinal
 91. gen shInitial_subs = shInitial if shFinal_subs!=.
 92. gen shFinal_subs0 = shFinal0
 93. gen shInitial_subs0 = shInitial0 if shFinal_subs0!=.
 94. 
. forval i=1/10{
 95. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.     
>                   //decrease expenditure on that good
 96. egen totSales_mu_subs=sum(sales_mu_subs)
 97. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
 98. drop totSales_mu_subs   
 99. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //increase expenditure on that good
100. egen totSales_mu_subs=sum(sales_mu_subs)
101. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
102. drop totSales_mu_subs
103. 
. replace sales_mu0_subs=sales_mu0_subs*0.99 if shFinal_subs0>shInitial_subs0 & shFinal_subs0!=.   
>                //decrease expenditure on that good
104. egen totSales_mu0_subs=sum(sales_mu0_subs)
105. replace shFinal_subs0=sales_mu0_subs/totSales_mu0_subs
106. drop totSales_mu0_subs  
107. 
. replace sales_mu0_subs=sales_mu0_subs*1.01 if shFinal_subs0<shInitial_subs0 & shFinal_subs0!=.   
>                //increase expenditure on that good
108. egen totSales_mu0_subs=sum(sales_mu0_subs)
109. replace shFinal_subs=sales_mu0_subs/totSales_mu0_subs
110. drop totSales_mu0_subs
111. 
. }
112.         
. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)
113. 
. twoway (scatter shFinal_subs0 shInitial_subs0) ///
>         (scatter shFinal shInitial)
114. 
. 
. *gen subs_ratio = shInitial/shFinal
. *replace subs_ratio=4 if subs_ratio>4 & subs_ratio!=.
. 
. *gen sales_mu_subs = sales_mu*subs_ratio
. egen totSales_mu_subs = sum(sales_mu_subs)
115. gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                   //18%, looks credible 
116. su ratio_mu_subs
117. global mu_`y'_subs = `r(mean)'
118. 
. *gen sales_mu0_subs = sales_mu0*subs_ratio
. egen totSales_mu0_subs = sum(sales_mu0_subs)
119. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                               
>                                   //18%, looks credible 
120. su ratio_mu0_subs
121. global mu0_`y'_subs = `r(mean)'
122. 
. }
123. di "`y'"
124. di ${mu0_`y'}, ${mu_`y'}, ${mu0_`y'_subs}, ${mu_`y'_subs}
125. }
1976
1.2462733 1.2470191 1.2975454 1.3019985
1977
1.2514908 1.2545708 1.3062049 1.3123786
1978
1.2461021 1.25065 1.3057792 1.3122402
1979
1.2212306 1.2252241 1.2767994 1.2836312
1980
1.1845839 1.1893389 1.239717 1.2474416
1981
1.1561338 1.161692 1.2146095 1.2202445
--Break--
r(1);

end of do-file

--Break--
r(1);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen shInitial0 = finalSale/totSales
 87. gen shFinal0 = sales_mu0/totSales_mu0
 88. gen sales_mu_subs=sales_mu
 89. gen sales_mu0_subs=sales_mu0
 90. 
. 
. gen shFinal_subs = shFinal
 91. gen shInitial_subs = shInitial if shFinal_subs!=.
 92. gen shFinal_subs0 = shFinal0
 93. gen shInitial_subs0 = shInitial0 if shFinal_subs0!=.
 94. 
. forval i=1/30{
 95. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.     
>                   //decrease expenditure on that good
 96. egen totSales_mu_subs=sum(sales_mu_subs)
 97. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
 98. drop totSales_mu_subs   
 99. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //increase expenditure on that good
100. egen totSales_mu_subs=sum(sales_mu_subs)
101. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
102. drop totSales_mu_subs
103. 
. replace sales_mu0_subs=sales_mu0_subs*0.99 if shFinal_subs0>shInitial_subs0 & shFinal_subs0!=.   
>                //decrease expenditure on that good
104. egen totSales_mu0_subs=sum(sales_mu0_subs)
105. replace shFinal_subs0=sales_mu0_subs/totSales_mu0_subs
106. drop totSales_mu0_subs  
107. 
. replace sales_mu0_subs=sales_mu0_subs*1.01 if shFinal_subs0<shInitial_subs0 & shFinal_subs0!=.   
>                //increase expenditure on that good
108. egen totSales_mu0_subs=sum(sales_mu0_subs)
109. replace shFinal_subs=sales_mu0_subs/totSales_mu0_subs
110. drop totSales_mu0_subs
111. 
. }
112.         
. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)
113. 
. twoway (scatter shFinal_subs0 shInitial_subs0) ///
>         (scatter shFinal shInitial)
114. 
. 
. *gen subs_ratio = shInitial/shFinal
. *replace subs_ratio=4 if subs_ratio>4 & subs_ratio!=.
. 
. *gen sales_mu_subs = sales_mu*subs_ratio
. egen totSales_mu_subs = sum(sales_mu_subs)
115. gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                   //18%, looks credible 
116. su ratio_mu_subs
117. global mu_`y'_subs = `r(mean)'
118. 
. *gen sales_mu0_subs = sales_mu0*subs_ratio
. egen totSales_mu0_subs = sum(sales_mu0_subs)
119. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                               
>                                   //18%, looks credible 
120. su ratio_mu0_subs
121. global mu0_`y'_subs = `r(mean)'
122. 
. }
123. di "`y'"
124. di ${mu0_`y'}, ${mu_`y'}, ${mu0_`y'_subs}, ${mu_`y'_subs}
125. }
1976
1.2462733 1.2470191 1.4890848 1.4997873
1977
1.2514908 1.2545708 1.4899161 1.5073533
1978
1.2461021 1.25065 1.4869797 1.4976287
1979
1.2212306 1.2252241 1.4424191 1.4601908
1980
1.1845839 1.1893389 1.3762289 1.3980703
1981
1.1561338 1.161692 1.3552448 1.3757544
1982
1.1672745 1.1717163 1.3741283 1.3915497
1983
1.1978852 1.203681 1.4085091 1.4234492
1984
1.1951668 1.2012508 1.4032267 1.4194773
1985
1.2118467 1.2185867 1.4117056 1.432427
1986
1.214764 1.2234739 1.3815339 1.3958137
1987
1.2249029 1.2351422 1.4062883 1.4286361
1988
1.2756764 1.2847062 1.4480616 1.466192
1989
1.2562001 1.2629728 1.403471 1.422104
1990
1.2608562 1.2685417 1.4298937 1.4415566
1991
1.261023 1.2701826 1.4058119 1.4194078
1992
1.2763993 1.2864141 1.4403753 1.454754
1993
1.2933741 1.3098754 1.4508944 1.4880106
1994
1.3046876 1.3172969 1.4556472 1.4727401
1995
1.297031 1.3100673 1.4588901 1.476873
1996
1.3036669 1.3139817 1.4868485 1.4997962
1997
1.3011936 1.3285367 1.48728 1.571571
1998
1.2972523 1.311579 1.4666923 1.5028533
1999
1.3168288 1.3383976 1.5164474 1.5763216
2000
1.31749 1.3463537 1.5529985 1.5859227
2001
1.3336548 1.3668854 1.5963371 1.6294249
2002
1.3420149 1.3807535 1.5991231 1.6461011
2003
1.3440522 1.379342 1.5843298 1.6338834
2004
1.3576841 1.3957651 1.6024131 1.653093
2005
1.3357953 1.3878981 1.593416 1.6719654
2006
1.307541 1.3378433 1.5731801 1.6120424
2007
1.3116162 1.3376291 1.5637081 1.5920397
2008
1.3100889 1.3527344 1.5541263 1.611663
2009
1.3039891 1.3293927 1.5270886 1.5482608
2010
1.3205963 1.3544036 1.5637839 1.5944892
2011
1.3101102 1.3379862 1.5605019 1.58613
2012
1.3158644 1.3372812 1.5590168 1.5828563
2013
1.3124787 1.3311018 1.5394285 1.5600203
2014
1.3106097 1.3270282 1.5361038 1.5487875
2015
1.3071151 1.3250663 1.4902743 1.5089128
2016
1.3216358 1.3559417 1.5214241 1.5774329

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. gen mu0_subs = .
(41 missing values generated)

. gen mu_subs = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'
  4.         replace mu0_subs = ${mu0_`y'_subs} if y == `y'
  5.         replace mu_subs = ${mu_`y'_subs} if y == `y'
  6.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)2) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.7) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. di 1.5774329/1.5214241
1.0368134

. di 0.5774329/0.5214241
1.1074151

. gen losses = (mu_subs-1)/(mu0_subs-1)

. su losses

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      losses |         41    1.057081    .0322045   1.021867   1.172983

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. graph export "$outputs/007_welfare.pdf", as(pdf) replace
(file /Users/ios/Documents/GitHub/mres_paper/outputs/007_welfare.pdf written in PDF format)

. 
. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.7) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. graph export "$outputs/007_welfare_2.pdf", as(pdf) replace
(file /Users/ios/Documents/GitHub/mres_paper/outputs/007_welfare_2.pdf written in PDF format)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/stata-scheme-modern/
> master/")
> ssc install gtools
> gtools, upgrade*/
. 
. set scheme modern, perm
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                                               
>        // I'm using a different orig folder so as not to commit large datasets to GitHub

. global data "$wd/data/006_network&Markups"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. global DLEU "$orig/Data DLEU"

. 
. *do-file number, used to save outputs 
. global doNum "006"                                      

. 
. *log
. cap log close
---------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:   6 May 2020, 12:42:38

. 
. 
. /*******************************************************************************
>         Getting the all the supply chains leading to final demand
> *******************************************************************************/
. 
. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_supplier comp_customer , b
> y(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the value chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusing(mu_1 s
> ale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Getting company names
. merge m:1 gvkey year using "$wd/data/001_network/003_allcomp.dta", keepusing(conm)
 16. drop if _merge == 2
 17. drop _merge
 18. 
. rename sale finalSale
 19. rename mu_1 mu_0
 20. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 21. rename endPoint_1 Source
 22. merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 23. drop if _merge == 2
 24. drop _merge
 25. rename a a10
 26. rename Target endPoint_0
 27. rename Source endPoint_1
 28. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 29.         local nextStep = `step'+1
 30.         local previousStep = `step'-1
 31.         rename endPoint_`step' gvkey
 32.         merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dta", keepusin
> g(mu) //markups
 33.         drop if _merge == 2
 34.         drop _merge
 35.         rename mu mu_`step'
 36.         rename gvkey Target 
 37.         rename endPoint_`nextStep' Source
 38.         merge m:1 Source Target year using "$data/007_aij`y'.dta", keepusing(a)
 39.         drop if _merge == 2
 40.         drop _merge
 41.         rename a a`nextStep'`step'
 42.         rename Target endPoint_`step'
 43.         rename Source endPoint_`nextStep'
 44.         }
 45.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 46. gen sales = finalSale if n==1
 47. egen totSales = sum(sales)
 48. gen salesSh = sales/totSales
 49. gen sales_mu0 = sales/mu_0
 50. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 51. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 52. gen pi_1 = exp(ln_pi_1) if n == 1
 53. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                                     
>                                //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 54. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 55. gen pi_2 = exp(ln_pi_2) if n == 1
 56. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 57. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 58. gen pi_3 = exp(ln_pi_3) if n == 1
 59. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 60. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 61. gen pi_4 = exp(ln_pi_4) if n == 1
 62. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 63. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 64. gen pi_5 = exp(ln_pi_5) if n == 1
 65. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 66. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 67. gen pi_6 = exp(ln_pi_6) if n == 1
 68. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 69. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 70. gen pi_7 = exp(ln_pi_7) if n == 1
 71. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 72. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 73. gen pi_8 = exp(ln_pi_8) if n == 1
 74. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 75. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 76. gen ratio_mu0 = totSales/totSales_mu0                                                         
>                           //18%, looks credible 
 77. su ratio_mu0
 78. global mu0_`y' = `r(mean)'
 79. 
. gen sales_mu = sales/denom
 80. egen totSales_mu = sum(sales_mu)
 81. gen ratio_mu = totSales/totSales_mu                                                           
>                           //18%, looks credible 
 82. su ratio_mu
 83. global mu_`y' = `r(mean)'
 84. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and after the price increas
> e
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/sales share of this p
> roduct)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                                                   
>                                //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 85. gen shFinal = sales_mu/totSales_mu
 86. gen shInitial0 = finalSale/totSales
 87. gen shFinal0 = sales_mu0/totSales_mu0
 88. gen sales_mu_subs=sales_mu
 89. gen sales_mu0_subs=sales_mu0
 90. 
. 
. gen shFinal_subs = shFinal
 91. gen shInitial_subs = shInitial if shFinal_subs!=.
 92. gen shFinal_subs0 = shFinal0
 93. gen shInitial_subs0 = shInitial0 if shFinal_subs0!=.
 94. 
. forval i=1/30{
 95. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & shFinal_subs!=.     
>                   //decrease expenditure on that good
 96. egen totSales_mu_subs=sum(sales_mu_subs)
 97. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
 98. drop totSales_mu_subs   
 99. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shFinal_subs!=.        
>                //increase expenditure on that good
100. egen totSales_mu_subs=sum(sales_mu_subs)
101. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
102. drop totSales_mu_subs
103. 
. replace sales_mu0_subs=sales_mu0_subs*0.99 if shFinal_subs0>shInitial_subs0 & shFinal_subs0!=.   
>                //decrease expenditure on that good
104. egen totSales_mu0_subs=sum(sales_mu0_subs)
105. replace shFinal_subs0=sales_mu0_subs/totSales_mu0_subs
106. drop totSales_mu0_subs  
107. 
. replace sales_mu0_subs=sales_mu0_subs*1.01 if shFinal_subs0<shInitial_subs0 & shFinal_subs0!=.   
>                //increase expenditure on that good
108. egen totSales_mu0_subs=sum(sales_mu0_subs)
109. replace shFinal_subs=sales_mu0_subs/totSales_mu0_subs
110. drop totSales_mu0_subs
111. 
. }
112.         
. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)
113. 
. twoway (scatter shFinal_subs0 shInitial_subs0) ///
>         (scatter shFinal shInitial)
114. 
. 
. *gen subs_ratio = shInitial/shFinal
. *replace subs_ratio=4 if subs_ratio>4 & subs_ratio!=.
. 
. *gen sales_mu_subs = sales_mu*subs_ratio
. egen totSales_mu_subs = sum(sales_mu_subs)
115. gen ratio_mu_subs = totSales/totSales_mu_subs                                                 
>                                   //18%, looks credible 
116. su ratio_mu_subs
117. global mu_`y'_subs = `r(mean)'
118. 
. *gen sales_mu0_subs = sales_mu0*subs_ratio
. egen totSales_mu0_subs = sum(sales_mu0_subs)
119. gen ratio_mu0_subs = totSales/totSales_mu0_subs                                               
>                                   //18%, looks credible 
120. su ratio_mu0_subs
121. global mu0_`y'_subs = `r(mean)'
122. 
. }
123. di "`y'"
124. di ${mu0_`y'}, ${mu_`y'}, ${mu0_`y'_subs}, ${mu_`y'_subs}
125. }
1976
1.2462733 1.2470191 1.4890848 1.4997873
1977
1.2514908 1.2545708 1.4899161 1.5073533
1978
1.2461021 1.25065 1.4869797 1.4976287
1979
1.2212306 1.2252241 1.4424191 1.4601908
1980
1.1845839 1.1893389 1.3762289 1.3980703
1981
1.1561338 1.161692 1.3552448 1.3757544
1982
1.1672745 1.1717163 1.3741283 1.3915497
1983
1.1978852 1.203681 1.4085091 1.4234492
1984
1.1951668 1.2012508 1.4032267 1.4194773
1985
1.2118467 1.2185867 1.4117056 1.432427
1986
1.214764 1.2234739 1.3815339 1.3958137
1987
1.2249029 1.2351422 1.4062883 1.4286361
1988
1.2756764 1.2847062 1.4480616 1.466192
1989
1.2562001 1.2629728 1.403471 1.422104
1990
1.2608562 1.2685417 1.4298937 1.4415566
1991
1.261023 1.2701826 1.4058119 1.4194078
1992
1.2763993 1.2864141 1.4403753 1.454754
1993
1.2933741 1.3098754 1.4508944 1.4880106
1994
1.3046876 1.3172969 1.4556472 1.4727401
1995
1.297031 1.3100673 1.4588901 1.476873
1996
1.3036669 1.3139817 1.4868485 1.4997962
1997
1.3011936 1.3285367 1.48728 1.571571
1998
1.2972523 1.311579 1.4666923 1.5028533
1999
1.3168288 1.3383976 1.5164474 1.5763216
2000
1.31749 1.3463537 1.5529985 1.5859227
2001
1.3336548 1.3668854 1.5963371 1.6294249
2002
1.3420149 1.3807535 1.5991231 1.6461011
2003
1.3440522 1.379342 1.5843298 1.6338834
2004
1.3576841 1.3957651 1.6024131 1.653093
2005
1.3357953 1.3878981 1.593416 1.6719654
2006
1.307541 1.3378433 1.5731801 1.6120424
2007
1.3116162 1.3376291 1.5637081 1.5920397
2008
1.3100889 1.3527344 1.5541263 1.611663
2009
1.3039891 1.3293927 1.5270886 1.5482608
2010
1.3205963 1.3544036 1.5637839 1.5944892
2011
1.3101102 1.3379862 1.5605019 1.58613
2012
1.3158644 1.3372812 1.5590168 1.5828563
2013
1.3124787 1.3311018 1.5394285 1.5600203
2014
1.3106097 1.3270282 1.5361038 1.5487875
2015
1.3071151 1.3250663 1.4902743 1.5089128
2016
1.3216358 1.3559417 1.5214241 1.5774329

. 
. *graph
. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. gen mu0_subs = .
(41 missing values generated)

. gen mu_subs = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'
  4.         replace mu0_subs = ${mu0_`y'_subs} if y == `y'
  5.         replace mu_subs = ${mu_`y'_subs} if y == `y'
  6.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Equivalent variation", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1}) - e
> (q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1
> }) - e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Ratio of expenditure functions", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1})/e(q
> {superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1})
> /e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. graph export "$outputs/007_welfare.pdf", as(pdf) replace
(file /Users/ios/Documents/GitHub/mres_paper/outputs/007_welfare.pdf written in PDF format)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.7) xtitle("Year") subtitle("Ratio of expenditure functions", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u{superscript:1})/e(q
> {superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)" 2 "e(q{superscript:1},u{superscript:1})
> /e(q{superscript:0},u{superscript:1} | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD04138.000000"

. graph export "$outputs/007_welfare_2.pdf", as(pdf) replace
(file /Users/ios/Documents/GitHub/mres_paper/outputs/007_welfare_2.pdf written in PDF format)

. 
end of do-file

-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:  12 May 2020, 19:34:25

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD12005.000000"

. forval y = 1976/1976{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$wd/data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_suppli
> er comp_customer , by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_aij`y'.dta", replace
  9. 
. *Starting from the supply chain
. use "$wd/data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$wd/data/006_network&Markups/006_markups`y'.dt
> a", keepusing(mu_1 sale)
 13. drop if _merge == 2
 14. drop _merge
 15. }
 16. }
file
    /Users/ios/Documents/GitHub/mres_paper/data/001_network/003_fullNet1976.d
    > ta not found
r(601);

end of do-file

r(601);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD12005.000000"

. forval y = 1976/1976{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_suppli
> er comp_customer , by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_welfare/007_aij`y'.dta", replace
  9. 
. *Starting from the supply chain
. use "$data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$data/006_network&Markups/006_markups`y'.dta",
>  keepusing(mu_1 sale)
 13. drop if _merge == 2
 14. drop _merge
 15. }
 16. }
file
    /Users/ios/Documents/GitHub/mres_paper/data/007_welfare/001_network/003_f
    > ullNet1976.dta not found
r(601);

end of do-file

r(601);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD12005.000000"

. 
. /****************************************************************************
> ***
>         
>         DESCRIPTION: Generation of welfare statistics
>         
>         INFILES:        - 
>         
>         OUTFILES:       - 
>         
>         LOG: Created 04/05/2020
>                         Last modified XX/05/2020
>         
> *****************************************************************************
> **/
. 
. /****************************************************************************
> ***
>         SETUP
> *****************************************************************************
> **/
. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/
> stata-scheme-modern/master/")
> ssc install gtools
> gtools, upgrade*/
. 
. set scheme modern, perm
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                           
>                            // I'm using a different orig folder so as not to 
> commit large datasets to GitHub

. global data "$orig/Data_output"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. global DLEU "$orig/Data DLEU"

. 
. *do-file number, used to save outputs 
. global doNum "007"                                      

. 
. *log
. cap log close
-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:  12 May 2020, 19:36:30

. 
. 
. /****************************************************************************
> ***
>         Getting the all the supply chains leading to final demand
> *****************************************************************************
> **/
. 
. forval y = 1976/1976{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_suppli
> er comp_customer , by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_welfare/007_aij`y'.dta", replace
  9. 
. *Starting from the supply chain
. use "$data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$data/006_network&Markups/006_markups`y'.dta",
>  keepusing(mu_1 sale)
 13. drop if _merge == 2
 14. drop _merge
 15. }
 16. }

. stop
command stop is unrecognized
r(199);

end of do-file

r(199);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD12005.000000"

. 
. forval y = 1976/1976{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_suppli
> er comp_customer , by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_welfare/007_aij`y'.dta", replace
  9. 
. *Starting from the supply chain
. use "$data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$data/006_network&Markups/006_markups`y'.dta",
>  keepusing(mu_1 sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Replacing missing markup by average markup
. su mu_1
 16. replace mu_1 = `r(mean)' if mu_1 == .
 17. }
 18. }

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD12005.000000"

. forval y = 1976/1976{
  2. 
. *qui{
. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$data/001_network/003_fullNet`y'.dta", clear
  3. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_suppli
> er comp_customer , by(Source Target year)
  4. gen a = salecs_supplier/sales_customer
  5. keep Source comp_supplier comp_customer Target /*year3*/ year a
  6. *rename year3 year
. replace a = 1 if a>1
  7. save "$data/007_welfare/007_aij`y'.dta", replace
  8. 
. *Starting from the supply chain
. use "$data/006_network&Markups/006_endPoint`y'_wide.dta", clear
  9. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 10. gen year = `y'
 11. merge m:1 gvkey year using "$data/006_network&Markups/006_markups`y'.dta",
>  keepusing(mu_1 sale)
 12. drop if _merge == 2
 13. drop _merge
 14. 
. *Replacing missing markup by average markup
. su mu_1
 15. replace mu_1 = `r(mean)' if mu_1 == .
 16. *}
. }
(0 real changes made)
file /Users/ios/Documents/mres_paper_orig/Data_output/007_welfare/007_aij1976.d
> ta saved
(note: variable gvkey was float, now double to accommodate using data's
       values)
(note: variable year was float, now double to accommodate using data's
       values)

    Result                           # of obs.
    -----------------------------------------
    not matched                         2,950
        from master                        57  (_merge==1)
        from using                      2,893  (_merge==2)

    matched                               521  (_merge==3)
    -----------------------------------------
(2,893 observations deleted)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        mu_1 |        521    1.325209    .3597008   .9956127   2.801528
(57 real changes made)

. 
end of do-file

. do "/Users/ios/Documents/GitHub/mres_paper/code/mres_007_welfare.do"

. 
. /****************************************************************************
> ***
>         
>         DESCRIPTION: Generation of welfare statistics
>         
>         INFILES:        - 
>         
>         OUTFILES:       - 
>         
>         LOG: Created 04/05/2020
>                         Last modified XX/05/2020
>         
> *****************************************************************************
> **/
. 
. /****************************************************************************
> ***
>         SETUP
> *****************************************************************************
> **/
. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/
> stata-scheme-modern/master/")
> ssc install gtools
> gtools, upgrade*/
. 
. set scheme modern, perm
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                           
>                            // I'm using a different orig folder so as not to 
> commit large datasets to GitHub

. global data "$orig/Data_output"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. global DLEU "$orig/Data DLEU"

. 
. *do-file number, used to save outputs 
. global doNum "007"                                      

. 
. *log
. cap log close
-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/ios/Documents/GitHub/mres_paper/log/007_welfare.log
  log type:  text
 opened on:  12 May 2020, 19:39:22

. 
. 
. /****************************************************************************
> ***
>         Getting the all the supply chains leading to final demand
> *****************************************************************************
> **/
. 
. forval y = 1976/2016{
  2. 
. qui{
  3. 
. *Adding a_ij's i.e. input expenditures as a share of sales
. use "$data/001_network/003_fullNet`y'.dta", clear
  4. collapse (sum) salecs_supplier (mean) sales_customer (firstnm) comp_suppli
> er comp_customer , by(Source Target year)
  5. gen a = salecs_supplier/sales_customer
  6. keep Source comp_supplier comp_customer Target /*year3*/ year a
  7. *rename year3 year
. replace a = 1 if a>1
  8. save "$data/007_welfare/007_aij`y'.dta", replace
  9. 
. *Starting from the supply chain
. use "$data/006_network&Markups/006_endPoint`y'_wide.dta", clear
 10. 
. *Getting the sales share of the end point
. rename endPoint_0 gvkey
 11. gen year = `y'
 12. merge m:1 gvkey year using "$data/006_network&Markups/006_markups`y'.dta",
>  keepusing(mu_1 sale)
 13. drop if _merge == 2
 14. drop _merge
 15. 
. *Replacing missing markup by average markup
. su mu_1
 16. replace mu_1 = `r(mean)' if mu_1 == .
 17. 
. *Getting company names
. merge m:1 gvkey year using "$data/001_network/003_allcomp.dta", keepusing(con
> m)
 18. drop if _merge == 2
 19. drop _merge
 20. 
. rename sale finalSale
 21. rename mu_1 mu_0
 22. 
. *Now including sales of shares and markups further up the value chain
. rename gvkey Target 
 23. rename endPoint_1 Source
 24. merge m:1 Source Target year using "$data/007_welfare/007_aij`y'.dta", kee
> pusing(a)
 25. drop if _merge == 2
 26. drop _merge
 27. rename a a10
 28. rename Target endPoint_0
 29. rename Source endPoint_1
 30. 
. *Now including markups and sales shares of other steps in the value chain
. forval step = 1/8{
 31.         local nextStep = `step'+1
 32.         local previousStep = `step'-1
 33.         rename endPoint_`step' gvkey
 34.         merge m:1 gvkey year using "$data/006_network&Markups/006_markups`
> y'.dta", keepusing(mu) //markups
 35.         drop if _merge == 2
 36.         drop _merge
 37.         rename mu mu_`step'
 38.         rename gvkey Target 
 39.         rename endPoint_`nextStep' Source
 40.         merge m:1 Source Target year using "$data/007_welfare/007_aij`y'.d
> ta", keepusing(a)
 41.         drop if _merge == 2
 42.         drop _merge
 43.         rename a a`nextStep'`step'
 44.         rename Target endPoint_`step'
 45.         rename Source endPoint_`nextStep'
 46.         }
 47.         
. *e(q1, u1)
. 
. *Last endpoint
. bys endPoint_0: gen n = _n
 48. gen sales = finalSale if n==1
 49. egen totSales = sum(sales)
 50. gen salesSh = sales/totSales
 51. gen sales_mu0 = sales/mu_0
 52. 
. 
. *Shutting down all markups in the value chain
. *generating product\mu_j^{a_ij}
. gen a_ln_mu_1 = ln(mu_1)*a10
 53. bys endPoint_0: egen ln_pi_1 = sum(a_ln_mu_1)
 54. gen pi_1 = exp(ln_pi_1) if n == 1
 55. 
. *gen sales_mu0mu1 = sales/(mu_0*pi_1)
. *egen totSales_mu0mu1 = sum(sales_mu0mu1)
. *gen ratio_mu0mu1 = totSales/totSales_mu0mu1                                 
>                                                    //19%, looks credible
. 
. gen a_ln_mu_2 = ln(mu_2)*a10*a21
 56. bys endPoint_0: egen ln_pi_2 = sum(a_ln_mu_2)
 57. gen pi_2 = exp(ln_pi_2) if n == 1
 58. 
. gen a_ln_mu_3 = ln(mu_3)*a10*a21*a32
 59. bys endPoint_0: egen ln_pi_3 = sum(a_ln_mu_3)
 60. gen pi_3 = exp(ln_pi_3) if n == 1
 61. 
. gen a_ln_mu_4 = ln(mu_4)*a10*a21*a32*a43
 62. bys endPoint_0: egen ln_pi_4 = sum(a_ln_mu_4)
 63. gen pi_4 = exp(ln_pi_4) if n == 1
 64. 
. gen a_ln_mu_5 = ln(mu_5)*a10*a21*a32*a43*a54
 65. bys endPoint_0: egen ln_pi_5 = sum(a_ln_mu_5)
 66. gen pi_5 = exp(ln_pi_5) if n == 1
 67. 
. gen a_ln_mu_6 = ln(mu_6)*a10*a21*a32*a43*a54*a65
 68. bys endPoint_0: egen ln_pi_6 = sum(a_ln_mu_6)
 69. gen pi_6 = exp(ln_pi_6) if n == 1
 70. 
. gen a_ln_mu_7 = ln(mu_7)*a10*a21*a32*a43*a54*a65*a76
 71. bys endPoint_0: egen ln_pi_7 = sum(a_ln_mu_7)
 72. gen pi_7 = exp(ln_pi_7) if n == 1
 73. 
. gen a_ln_mu_8 = ln(mu_8)*a10*a21*a32*a43*a54*a65*a76*a87
 74. bys endPoint_0: egen ln_pi_8 = sum(a_ln_mu_8)
 75. gen pi_8 = exp(ln_pi_8) if n == 1
 76. 
. 
. *Final welfare loss
. gen denom = mu_0*pi_1*pi_2*pi_3*pi_4*pi_5*pi_6*pi_7*pi_8
 77. 
. *First step i  value chain
. egen totSales_mu0 = sum(sales_mu0)
 78. gen ratio_mu0 = totSales/totSales_mu0                                     
>                                               //18%, looks credible 
 79. su ratio_mu0
 80. global mu0_`y' = `r(mean)'
 81. 
. gen sales_mu = sales/denom
 82. egen totSales_mu = sum(sales_mu)
 83. gen ratio_mu = totSales/totSales_mu                                       
>                                               //18%, looks credible 
 84. su ratio_mu
 85. global mu_`y' = `r(mean)'
 86. 
. *Accounting for substitution of consumption
. *Setting the quantity of the most commonly consumed good equal before and aft
> er the price increase
. *(the expenses just decrease by the network-adjusted markup)
. *Multiply each sales without markup by alpha/beta (sales share of numeraire/s
> ales share of this product)
. 
. *Finding the numeraire (max sales shares)
. *sort finalSale
. *egen topSale = max(finalSale)
. *gen alphaOverBeta = topSale/finalSale
. 
. *gen sales_mu_subs = (sales/denom)*(alphaOverBeta)
. *egen totSales_mu_subs = sum(sales_mu_subs)
. *gen ratio_mu_subs = totSales/totSales_mu_subs                               
>                                                    //18%, looks credible 
. *su ratio_mu_subs
. *global mu_`y' = `r(mean)'
. 
. *equalising shares of expenditures
. gen shInitial = finalSale/totSales
 87. gen shFinal = sales_mu/totSales_mu
 88. gen shInitial0 = finalSale/totSales
 89. gen shFinal0 = sales_mu0/totSales_mu0
 90. gen sales_mu_subs=sales_mu
 91. gen sales_mu0_subs=sales_mu0
 92. 
. 
. gen shFinal_subs = shFinal
 93. gen shInitial_subs = shInitial if shFinal_subs!=.
 94. gen shFinal_subs0 = shFinal0
 95. gen shInitial_subs0 = shInitial0 if shFinal_subs0!=.
 96. 
. forval i=1/30{
 97. replace sales_mu_subs=sales_mu_subs*0.99 if shFinal_subs>shInitial_subs & 
> shFinal_subs!=.                       //decrease expenditure on that good
 98. egen totSales_mu_subs=sum(sales_mu_subs)
 99. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
100. drop totSales_mu_subs   
101. 
. replace sales_mu_subs=sales_mu_subs*1.01 if shFinal_subs<shInitial_subs & shF
> inal_subs!=.                       //increase expenditure on that good
102. egen totSales_mu_subs=sum(sales_mu_subs)
103. replace shFinal_subs=sales_mu_subs/totSales_mu_subs
104. drop totSales_mu_subs
105. 
. replace sales_mu0_subs=sales_mu0_subs*0.99 if shFinal_subs0>shInitial_subs0 &
>  shFinal_subs0!=.                  //decrease expenditure on that good
106. egen totSales_mu0_subs=sum(sales_mu0_subs)
107. replace shFinal_subs0=sales_mu0_subs/totSales_mu0_subs
108. drop totSales_mu0_subs  
109. 
. replace sales_mu0_subs=sales_mu0_subs*1.01 if shFinal_subs0<shInitial_subs0 &
>  shFinal_subs0!=.                  //increase expenditure on that good
110. egen totSales_mu0_subs=sum(sales_mu0_subs)
111. replace shFinal_subs=sales_mu0_subs/totSales_mu0_subs
112. drop totSales_mu0_subs
113. 
. }
114.         
. twoway (scatter shFinal_subs shInitial_subs) ///
>         (scatter shFinal shInitial)
115. 
. twoway (scatter shFinal_subs0 shInitial_subs0) ///
>         (scatter shFinal shInitial)
116. 
. 
. *gen subs_ratio = shInitial/shFinal
. *replace subs_ratio=4 if subs_ratio>4 & subs_ratio!=.
. 
. *gen sales_mu_subs = sales_mu*subs_ratio
. egen totSales_mu_subs = sum(sales_mu_subs)
117. gen ratio_mu_subs = totSales/totSales_mu_subs                             
>                                                       //18%, looks credible 
118. su ratio_mu_subs
119. global mu_`y'_subs = `r(mean)'
120. 
. *gen sales_mu0_subs = sales_mu0*subs_ratio
. egen totSales_mu0_subs = sum(sales_mu0_subs)
121. gen ratio_mu0_subs = totSales/totSales_mu0_subs                           
>                                                       //18%, looks credible 
122. su ratio_mu0_subs
123. global mu0_`y'_subs = `r(mean)'
124. 
. }
125. di "`y'"
126. di ${mu0_`y'}, ${mu_`y'}, ${mu0_`y'_subs}, ${mu_`y'_subs}
127. }
1976
1.2462733 1.2470191 1.4890848 1.4997873
1977
1.2514908 1.2545708 1.4899161 1.5073533
1978
1.2461021 1.25065 1.4869797 1.4976287
1979
1.2212306 1.2252241 1.4424191 1.4601908
1980
1.1845839 1.1893389 1.3762289 1.3980703
1981
1.1561338 1.161692 1.3552448 1.3757544
1982
1.1672745 1.1717163 1.3741283 1.3915497
1983
1.1978852 1.203681 1.4085091 1.4234492
1984
1.1951668 1.2012508 1.4032267 1.4194773
1985
1.2118467 1.2185867 1.4117056 1.432427
1986
1.214764 1.2234739 1.3815339 1.3958137
1987
1.2249029 1.2351422 1.4062883 1.4286361
1988
1.2756764 1.2847062 1.4480616 1.466192
1989
1.2562001 1.2629728 1.403471 1.422104
1990
1.2608562 1.2685417 1.4298937 1.4415566
1991
1.261023 1.2701826 1.4058119 1.4194078
1992
1.2763993 1.2864141 1.4403753 1.454754
1993
1.2933741 1.3098754 1.4508944 1.4880106
1994
1.3046876 1.3172969 1.4556472 1.4727401
1995
1.297031 1.3100673 1.4588901 1.476873
1996
1.3036669 1.3139817 1.4868485 1.4997962
1997
1.3011936 1.3285367 1.48728 1.571571
1998
1.2972523 1.311579 1.4666923 1.5028533
1999
1.3168288 1.3383976 1.5164474 1.5763216
2000
1.31749 1.3463537 1.5529985 1.5859227
2001
1.3336548 1.3668854 1.5963371 1.6294249
2002
1.3420149 1.3807535 1.5991231 1.6461011
2003
1.3440522 1.379342 1.5843298 1.6338834
2004
1.3576841 1.3957651 1.6024131 1.653093
2005
1.3357953 1.3878981 1.593416 1.6719654
2006
1.307541 1.3378433 1.5731801 1.6120424
2007
1.3116162 1.3376291 1.5637081 1.5920397
2008
1.3100889 1.3527344 1.5541263 1.611663
2009
1.3039891 1.3293927 1.5270886 1.5482608
2010
1.3205963 1.3544036 1.5637839 1.5944892
2011
1.3101102 1.3379862 1.5605019 1.58613
2012
1.3158644 1.3372812 1.5590168 1.5828563
2013
1.3124787 1.3311018 1.5394285 1.5600203
2014
1.3106097 1.3270282 1.5361038 1.5487875
2015
1.3071151 1.3250663 1.4902743 1.5089128
2016
1.3216358 1.3559417 1.5214241 1.5774329

. 
. stop
command stop is unrecognized
r(199);

end of do-file

r(199);

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD12005.000000"

. clear

. set obs 41
number of observations (_N) was 0, now 41

. gen y = 1975 + _n

. gen mu0 = .
(41 missing values generated)

. gen mu = .
(41 missing values generated)

. gen mu0_subs = .
(41 missing values generated)

. gen mu_subs = .
(41 missing values generated)

. forval y = 1976/2016{
  2.         replace mu0 = ${mu0_`y'} if y == `y'
  3.         replace mu = ${mu_`y'} if y == `y'
  4.         replace mu0_subs = ${mu0_`y'_subs} if y == `y'
  5.         replace mu_subs = ${mu_`y'_subs} if y == `y'
  6.         }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Ratio of expenditure funct
> ions", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u
> {superscript:1})/e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)"
>  2 "e(q{superscript:1},u{superscript:1})/e(q{superscript:0},u{superscript:1} 
> | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD12005.000000"

. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.7) xtitle("Year") subtitle("Ratio of expenditure funct
> ions", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u
> {superscript:1})/e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)"
>  2 "e(q{superscript:1},u{superscript:1})/e(q{superscript:0},u{superscript:1} 
> | {bf:{&mu}} = 0)"))

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD12005.000000"

. twoway (scatter mu0 y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.4) xtitle("Year") subtitle("Ratio of expenditure funct
> ions", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u
> {superscript:1})/e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)"
>  2 "e(q{superscript:1},u{superscript:1})/e(q{superscript:0},u{superscript:1} 
> | {bf:{&mu}} = 0)"))

. graph export "$outputs/007_welfare.pdf", as(pdf) replace
(file /Users/ios/Documents/GitHub/mres_paper/outputs/007_welfare.pdf written in
>  PDF format)

. 
. twoway (scatter mu0_subs y, msymbol(O) mfcolor(white) connect(direct)) ///
>         (scatter mu_subs y, msymbol(O) mfcolor(white) connect(direct)), ///
>         ylabel(1(0.1)1.7) xtitle("Year") subtitle("Ratio of expenditure funct
> ions", pos(11)) ///
>         yline(1) legend( ring(0) pos(11) col(1) order(1 "e(q{superscript:1},u
> {superscript:1})/e(q{superscript:0},u{superscript:1} | {&mu}{subscript:0}=0)"
>  2 "e(q{superscript:1},u{superscript:1})/e(q{superscript:0},u{superscript:1} 
> | {bf:{&mu}} = 0)"))

. graph export "$outputs/007_welfare_2.pdf", as(pdf) replace
(file /Users/ios/Documents/GitHub/mres_paper/outputs/007_welfare_2.pdf written 
> in PDF format)

. 
end of do-file

. do "/var/folders/sx/s0vrcm_s2vx1br13ck5gvstw0000gn/T//SD12005.000000"

. 
. /****************************************************************************
> ***
>         
>         DESCRIPTION: Calculating welfare losses using input-output matrices
>         
>         INFILES:        - 
>         
>         OUTFILES:       - 
>         
>         LOG: Created 12/05/2020
>                         Last modified XX/05/2020
>         
> *****************************************************************************
> **/
. 
. /****************************************************************************
> ***
>         SETUP
> *****************************************************************************
> **/
. 
. clear all

. set more off

. macro drop _all

. set scheme s1color

. set matsize 10000

. 
. *Useful packages
. /*net install scheme-modern, from("https://raw.githubusercontent.com/mdroste/
> stata-scheme-modern/master/")
> ssc install gtools
> gtools, upgrade*/
. 
. set scheme modern, perm
(set scheme preference recorded)

. 
. *Paths
. global wd "/Users/ios/Documents/GitHub/mres_paper"

. global orig "/Users/ios/Documents/mres_paper_orig"                           
>                            // I'm using a different orig folder so as not to 
> commit large datasets to GitHub

. global data "$orig/Data_output/007_welfare"

. global outputs "$wd/outputs"

. global doc "$wd/doc"

. global code "$wd/code"

. global log "$wd/log"

. global DLEU "$orig/Data DLEU"

. 
. *do-file number, used to save outputs 
. global doNum "007"                                      

. 
. *log
. cap log close
